var Ap=Object.defineProperty;var Cp=(e,t,s)=>t in e?Ap(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var W=(e,t,s)=>(Cp(e,typeof t!="symbol"?t+"":t,s),s);function El(e,t){const s=Object.create(null),i=e.split(",");for(let r=0;r<i.length;r++)s[i[r]]=!0;return t?r=>!!s[r.toLowerCase()]:r=>!!s[r]}function bl(e){if(mt(e)){const t={};for(let s=0;s<e.length;s++){const i=e[s],r=Yt(i)?Mp(i):bl(i);if(r)for(const n in r)t[n]=r[n]}return t}else{if(Yt(e))return e;if(kt(e))return e}}const Ip=/;(?![^(]*\))/g,Rp=/:([^]+)/,Pp=/\/\*.*?\*\//gs;function Mp(e){const t={};return e.replace(Pp,"").split(Ip).forEach(s=>{if(s){const i=s.split(Rp);i.length>1&&(t[i[0].trim()]=i[1].trim())}}),t}function Tl(e){let t="";if(Yt(e))t=e;else if(mt(e))for(let s=0;s<e.length;s++){const i=Tl(e[s]);i&&(t+=i+" ")}else if(kt(e))for(const s in e)e[s]&&(t+=s+" ");return t.trim()}const Op="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",Bp=El(Op);function Su(e){return!!e||e===""}const Sw=e=>Yt(e)?e:e==null?"":mt(e)||kt(e)&&(e.toString===Ru||!gt(e.toString))?JSON.stringify(e,Au,2):String(e),Au=(e,t)=>t&&t.__v_isRef?Au(e,t.value):Ai(t)?{[`Map(${t.size})`]:[...t.entries()].reduce((s,[i,r])=>(s[`${i} =>`]=r,s),{})}:Cu(t)?{[`Set(${t.size})`]:[...t.values()]}:kt(t)&&!mt(t)&&!Pu(t)?String(t):t,Nt={},Si=[],Fe=()=>{},Dp=()=>!1,Lp=/^on[^a-z]/,Jn=e=>Lp.test(e),wl=e=>e.startsWith("onUpdate:"),le=Object.assign,Sl=(e,t)=>{const s=e.indexOf(t);s>-1&&e.splice(s,1)},Fp=Object.prototype.hasOwnProperty,wt=(e,t)=>Fp.call(e,t),mt=Array.isArray,Ai=e=>Qn(e)==="[object Map]",Cu=e=>Qn(e)==="[object Set]",gt=e=>typeof e=="function",Yt=e=>typeof e=="string",Al=e=>typeof e=="symbol",kt=e=>e!==null&&typeof e=="object",Iu=e=>kt(e)&&gt(e.then)&&gt(e.catch),Ru=Object.prototype.toString,Qn=e=>Ru.call(e),Np=e=>Qn(e).slice(8,-1),Pu=e=>Qn(e)==="[object Object]",Cl=e=>Yt(e)&&e!=="NaN"&&e[0]!=="-"&&""+parseInt(e,10)===e,gn=El(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),to=e=>{const t=Object.create(null);return s=>t[s]||(t[s]=e(s))},Up=/-(\w)/g,ss=to(e=>e.replace(Up,(t,s)=>s?s.toUpperCase():"")),kp=/\B([A-Z])/g,Wi=to(e=>e.replace(kp,"-$1").toLowerCase()),eo=to(e=>e.charAt(0).toUpperCase()+e.slice(1)),Mo=to(e=>e?`on${eo(e)}`:""),xr=(e,t)=>!Object.is(e,t),Oo=(e,t)=>{for(let s=0;s<e.length;s++)e[s](t)},Pn=(e,t,s)=>{Object.defineProperty(e,t,{configurable:!0,enumerable:!1,value:s})},Gp=e=>{const t=parseFloat(e);return isNaN(t)?e:t};let _h;const Hp=()=>_h||(_h=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});let ge;class Mu{constructor(t=!1){this.detached=t,this._active=!0,this.effects=[],this.cleanups=[],this.parent=ge,!t&&ge&&(this.index=(ge.scopes||(ge.scopes=[])).push(this)-1)}get active(){return this._active}run(t){if(this._active){const s=ge;try{return ge=this,t()}finally{ge=s}}}on(){ge=this}off(){ge=this.parent}stop(t){if(this._active){let s,i;for(s=0,i=this.effects.length;s<i;s++)this.effects[s].stop();for(s=0,i=this.cleanups.length;s<i;s++)this.cleanups[s]();if(this.scopes)for(s=0,i=this.scopes.length;s<i;s++)this.scopes[s].stop(!0);if(!this.detached&&this.parent&&!t){const r=this.parent.scopes.pop();r&&r!==this&&(this.parent.scopes[this.index]=r,r.index=this.index)}this.parent=void 0,this._active=!1}}}function $p(e){return new Mu(e)}function Wp(e,t=ge){t&&t.active&&t.effects.push(e)}function Ou(){return ge}function Xp(e){ge&&ge.cleanups.push(e)}const Il=e=>{const t=new Set(e);return t.w=0,t.n=0,t},Bu=e=>(e.w&Os)>0,Du=e=>(e.n&Os)>0,zp=({deps:e})=>{if(e.length)for(let t=0;t<e.length;t++)e[t].w|=Os},jp=e=>{const{deps:t}=e;if(t.length){let s=0;for(let i=0;i<t.length;i++){const r=t[i];Bu(r)&&!Du(r)?r.delete(e):t[s++]=r,r.w&=~Os,r.n&=~Os}t.length=s}},Ea=new WeakMap;let ir=0,Os=1;const ba=30;let Be;const Qs=Symbol(""),Ta=Symbol("");class Rl{constructor(t,s=null,i){this.fn=t,this.scheduler=s,this.active=!0,this.deps=[],this.parent=void 0,Wp(this,i)}run(){if(!this.active)return this.fn();let t=Be,s=Rs;for(;t;){if(t===this)return;t=t.parent}try{return this.parent=Be,Be=this,Rs=!0,Os=1<<++ir,ir<=ba?zp(this):xh(this),this.fn()}finally{ir<=ba&&jp(this),Os=1<<--ir,Be=this.parent,Rs=s,this.parent=void 0,this.deferStop&&this.stop()}}stop(){Be===this?this.deferStop=!0:this.active&&(xh(this),this.onStop&&this.onStop(),this.active=!1)}}function xh(e){const{deps:t}=e;if(t.length){for(let s=0;s<t.length;s++)t[s].delete(e);t.length=0}}let Rs=!0;const Lu=[];function Xi(){Lu.push(Rs),Rs=!1}function zi(){const e=Lu.pop();Rs=e===void 0?!0:e}function de(e,t,s){if(Rs&&Be){let i=Ea.get(e);i||Ea.set(e,i=new Map);let r=i.get(s);r||i.set(s,r=Il()),Fu(r)}}function Fu(e,t){let s=!1;ir<=ba?Du(e)||(e.n|=Os,s=!Bu(e)):s=!e.has(Be),s&&(e.add(Be),Be.deps.push(e))}function ms(e,t,s,i,r,n){const o=Ea.get(e);if(!o)return;let a=[];if(t==="clear")a=[...o.values()];else if(s==="length"&&mt(e)){const l=Number(i);o.forEach((h,c)=>{(c==="length"||c>=l)&&a.push(h)})}else switch(s!==void 0&&a.push(o.get(s)),t){case"add":mt(e)?Cl(s)&&a.push(o.get("length")):(a.push(o.get(Qs)),Ai(e)&&a.push(o.get(Ta)));break;case"delete":mt(e)||(a.push(o.get(Qs)),Ai(e)&&a.push(o.get(Ta)));break;case"set":Ai(e)&&a.push(o.get(Qs));break}if(a.length===1)a[0]&&wa(a[0]);else{const l=[];for(const h of a)h&&l.push(...h);wa(Il(l))}}function wa(e,t){const s=mt(e)?e:[...e];for(const i of s)i.computed&&vh(i);for(const i of s)i.computed||vh(i)}function vh(e,t){(e!==Be||e.allowRecurse)&&(e.scheduler?e.scheduler():e.run())}const Vp=El("__proto__,__v_isRef,__isVue"),Nu=new Set(Object.getOwnPropertyNames(Symbol).filter(e=>e!=="arguments"&&e!=="caller").map(e=>Symbol[e]).filter(Al)),Yp=Pl(),Kp=Pl(!1,!0),qp=Pl(!0),yh=Zp();function Zp(){const e={};return["includes","indexOf","lastIndexOf"].forEach(t=>{e[t]=function(...s){const i=It(this);for(let n=0,o=this.length;n<o;n++)de(i,"get",n+"");const r=i[t](...s);return r===-1||r===!1?i[t](...s.map(It)):r}}),["push","pop","shift","unshift","splice"].forEach(t=>{e[t]=function(...s){Xi();const i=It(this)[t].apply(this,s);return zi(),i}}),e}function Jp(e){const t=It(this);return de(t,"has",e),t.hasOwnProperty(e)}function Pl(e=!1,t=!1){return function(i,r,n){if(r==="__v_isReactive")return!e;if(r==="__v_isReadonly")return e;if(r==="__v_isShallow")return t;if(r==="__v_raw"&&n===(e?t?pm:$u:t?Hu:Gu).get(i))return i;const o=mt(i);if(!e){if(o&&wt(yh,r))return Reflect.get(yh,r,n);if(r==="hasOwnProperty")return Jp}const a=Reflect.get(i,r,n);return(Al(r)?Nu.has(r):Vp(r))||(e||de(i,"get",r),t)?a:oe(a)?o&&Cl(r)?a:a.value:kt(a)?e?Dl(a):Bl(a):a}}const Qp=Uu(),tm=Uu(!0);function Uu(e=!1){return function(s,i,r,n){let o=s[i];if(Fi(o)&&oe(o)&&!oe(r))return!1;if(!e&&(!Mn(r)&&!Fi(r)&&(o=It(o),r=It(r)),!mt(s)&&oe(o)&&!oe(r)))return o.value=r,!0;const a=mt(s)&&Cl(i)?Number(i)<s.length:wt(s,i),l=Reflect.set(s,i,r,n);return s===It(n)&&(a?xr(r,o)&&ms(s,"set",i,r):ms(s,"add",i,r)),l}}function em(e,t){const s=wt(e,t);e[t];const i=Reflect.deleteProperty(e,t);return i&&s&&ms(e,"delete",t,void 0),i}function sm(e,t){const s=Reflect.has(e,t);return(!Al(t)||!Nu.has(t))&&de(e,"has",t),s}function im(e){return de(e,"iterate",mt(e)?"length":Qs),Reflect.ownKeys(e)}const ku={get:Yp,set:Qp,deleteProperty:em,has:sm,ownKeys:im},rm={get:qp,set(e,t){return!0},deleteProperty(e,t){return!0}},nm=le({},ku,{get:Kp,set:tm}),Ml=e=>e,so=e=>Reflect.getPrototypeOf(e);function Ur(e,t,s=!1,i=!1){e=e.__v_raw;const r=It(e),n=It(t);s||(t!==n&&de(r,"get",t),de(r,"get",n));const{has:o}=so(r),a=i?Ml:s?Fl:vr;if(o.call(r,t))return a(e.get(t));if(o.call(r,n))return a(e.get(n));e!==r&&e.get(t)}function kr(e,t=!1){const s=this.__v_raw,i=It(s),r=It(e);return t||(e!==r&&de(i,"has",e),de(i,"has",r)),e===r?s.has(e):s.has(e)||s.has(r)}function Gr(e,t=!1){return e=e.__v_raw,!t&&de(It(e),"iterate",Qs),Reflect.get(e,"size",e)}function Eh(e){e=It(e);const t=It(this);return so(t).has.call(t,e)||(t.add(e),ms(t,"add",e,e)),this}function bh(e,t){t=It(t);const s=It(this),{has:i,get:r}=so(s);let n=i.call(s,e);n||(e=It(e),n=i.call(s,e));const o=r.call(s,e);return s.set(e,t),n?xr(t,o)&&ms(s,"set",e,t):ms(s,"add",e,t),this}function Th(e){const t=It(this),{has:s,get:i}=so(t);let r=s.call(t,e);r||(e=It(e),r=s.call(t,e)),i&&i.call(t,e);const n=t.delete(e);return r&&ms(t,"delete",e,void 0),n}function wh(){const e=It(this),t=e.size!==0,s=e.clear();return t&&ms(e,"clear",void 0,void 0),s}function Hr(e,t){return function(i,r){const n=this,o=n.__v_raw,a=It(o),l=t?Ml:e?Fl:vr;return!e&&de(a,"iterate",Qs),o.forEach((h,c)=>i.call(r,l(h),l(c),n))}}function $r(e,t,s){return function(...i){const r=this.__v_raw,n=It(r),o=Ai(n),a=e==="entries"||e===Symbol.iterator&&o,l=e==="keys"&&o,h=r[e](...i),c=s?Ml:t?Fl:vr;return!t&&de(n,"iterate",l?Ta:Qs),{next(){const{value:u,done:d}=h.next();return d?{value:u,done:d}:{value:a?[c(u[0]),c(u[1])]:c(u),done:d}},[Symbol.iterator](){return this}}}}function Es(e){return function(...t){return e==="delete"?!1:this}}function om(){const e={get(n){return Ur(this,n)},get size(){return Gr(this)},has:kr,add:Eh,set:bh,delete:Th,clear:wh,forEach:Hr(!1,!1)},t={get(n){return Ur(this,n,!1,!0)},get size(){return Gr(this)},has:kr,add:Eh,set:bh,delete:Th,clear:wh,forEach:Hr(!1,!0)},s={get(n){return Ur(this,n,!0)},get size(){return Gr(this,!0)},has(n){return kr.call(this,n,!0)},add:Es("add"),set:Es("set"),delete:Es("delete"),clear:Es("clear"),forEach:Hr(!0,!1)},i={get(n){return Ur(this,n,!0,!0)},get size(){return Gr(this,!0)},has(n){return kr.call(this,n,!0)},add:Es("add"),set:Es("set"),delete:Es("delete"),clear:Es("clear"),forEach:Hr(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(n=>{e[n]=$r(n,!1,!1),s[n]=$r(n,!0,!1),t[n]=$r(n,!1,!0),i[n]=$r(n,!0,!0)}),[e,s,t,i]}const[am,lm,hm,cm]=om();function Ol(e,t){const s=t?e?cm:hm:e?lm:am;return(i,r,n)=>r==="__v_isReactive"?!e:r==="__v_isReadonly"?e:r==="__v_raw"?i:Reflect.get(wt(s,r)&&r in i?s:i,r,n)}const um={get:Ol(!1,!1)},dm={get:Ol(!1,!0)},fm={get:Ol(!0,!1)},Gu=new WeakMap,Hu=new WeakMap,$u=new WeakMap,pm=new WeakMap;function mm(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function gm(e){return e.__v_skip||!Object.isExtensible(e)?0:mm(Np(e))}function Bl(e){return Fi(e)?e:Ll(e,!1,ku,um,Gu)}function _m(e){return Ll(e,!1,nm,dm,Hu)}function Dl(e){return Ll(e,!0,rm,fm,$u)}function Ll(e,t,s,i,r){if(!kt(e)||e.__v_raw&&!(t&&e.__v_isReactive))return e;const n=r.get(e);if(n)return n;const o=gm(e);if(o===0)return e;const a=new Proxy(e,o===2?i:s);return r.set(e,a),a}function Ci(e){return Fi(e)?Ci(e.__v_raw):!!(e&&e.__v_isReactive)}function Fi(e){return!!(e&&e.__v_isReadonly)}function Mn(e){return!!(e&&e.__v_isShallow)}function Wu(e){return Ci(e)||Fi(e)}function It(e){const t=e&&e.__v_raw;return t?It(t):e}function Xu(e){return Pn(e,"__v_skip",!0),e}const vr=e=>kt(e)?Bl(e):e,Fl=e=>kt(e)?Dl(e):e;function zu(e){Rs&&Be&&(e=It(e),Fu(e.dep||(e.dep=Il())))}function ju(e,t){e=It(e);const s=e.dep;s&&wa(s)}function oe(e){return!!(e&&e.__v_isRef===!0)}function dr(e){return Vu(e,!1)}function xm(e){return Vu(e,!0)}function Vu(e,t){return oe(e)?e:new vm(e,t)}class vm{constructor(t,s){this.__v_isShallow=s,this.dep=void 0,this.__v_isRef=!0,this._rawValue=s?t:It(t),this._value=s?t:vr(t)}get value(){return zu(this),this._value}set value(t){const s=this.__v_isShallow||Mn(t)||Fi(t);t=s?t:It(t),xr(t,this._rawValue)&&(this._rawValue=t,this._value=s?t:vr(t),ju(this))}}function Yu(e){return oe(e)?e.value:e}const ym={get:(e,t,s)=>Yu(Reflect.get(e,t,s)),set:(e,t,s,i)=>{const r=e[t];return oe(r)&&!oe(s)?(r.value=s,!0):Reflect.set(e,t,s,i)}};function Ku(e){return Ci(e)?e:new Proxy(e,ym)}var qu;class Em{constructor(t,s,i,r){this._setter=s,this.dep=void 0,this.__v_isRef=!0,this[qu]=!1,this._dirty=!0,this.effect=new Rl(t,()=>{this._dirty||(this._dirty=!0,ju(this))}),this.effect.computed=this,this.effect.active=this._cacheable=!r,this.__v_isReadonly=i}get value(){const t=It(this);return zu(t),(t._dirty||!t._cacheable)&&(t._dirty=!1,t._value=t.effect.run()),t._value}set value(t){this._setter(t)}}qu="__v_isReadonly";function bm(e,t,s=!1){let i,r;const n=gt(e);return n?(i=e,r=Fe):(i=e.get,r=e.set),new Em(i,r,n||!r,s)}function Ps(e,t,s,i){let r;try{r=i?e(...i):e()}catch(n){Mr(n,t,s)}return r}function we(e,t,s,i){if(gt(e)){const n=Ps(e,t,s,i);return n&&Iu(n)&&n.catch(o=>{Mr(o,t,s)}),n}const r=[];for(let n=0;n<e.length;n++)r.push(we(e[n],t,s,i));return r}function Mr(e,t,s,i=!0){const r=t?t.vnode:null;if(t){let n=t.parent;const o=t.proxy,a=s;for(;n;){const h=n.ec;if(h){for(let c=0;c<h.length;c++)if(h[c](e,o,a)===!1)return}n=n.parent}const l=t.appContext.config.errorHandler;if(l){Ps(l,null,10,[e,o,a]);return}}Tm(e,s,r,i)}function Tm(e,t,s,i=!0){console.error(e)}let yr=!1,Sa=!1;const ne=[];let Ze=0;const Ii=[];let cs=null,Ys=0;const Zu=Promise.resolve();let Nl=null;function Ul(e){const t=Nl||Zu;return e?t.then(this?e.bind(this):e):t}function wm(e){let t=Ze+1,s=ne.length;for(;t<s;){const i=t+s>>>1;Er(ne[i])<e?t=i+1:s=i}return t}function io(e){(!ne.length||!ne.includes(e,yr&&e.allowRecurse?Ze+1:Ze))&&(e.id==null?ne.push(e):ne.splice(wm(e.id),0,e),Ju())}function Ju(){!yr&&!Sa&&(Sa=!0,Nl=Zu.then(td))}function Sm(e){const t=ne.indexOf(e);t>Ze&&ne.splice(t,1)}function Am(e){mt(e)?Ii.push(...e):(!cs||!cs.includes(e,e.allowRecurse?Ys+1:Ys))&&Ii.push(e),Ju()}function Sh(e,t=yr?Ze+1:0){for(;t<ne.length;t++){const s=ne[t];s&&s.pre&&(ne.splice(t,1),t--,s())}}function Qu(e){if(Ii.length){const t=[...new Set(Ii)];if(Ii.length=0,cs){cs.push(...t);return}for(cs=t,cs.sort((s,i)=>Er(s)-Er(i)),Ys=0;Ys<cs.length;Ys++)cs[Ys]();cs=null,Ys=0}}const Er=e=>e.id==null?1/0:e.id,Cm=(e,t)=>{const s=Er(e)-Er(t);if(s===0){if(e.pre&&!t.pre)return-1;if(t.pre&&!e.pre)return 1}return s};function td(e){Sa=!1,yr=!0,ne.sort(Cm);const t=Fe;try{for(Ze=0;Ze<ne.length;Ze++){const s=ne[Ze];s&&s.active!==!1&&Ps(s,null,14)}}finally{Ze=0,ne.length=0,Qu(),yr=!1,Nl=null,(ne.length||Ii.length)&&td()}}function Im(e,t,...s){if(e.isUnmounted)return;const i=e.vnode.props||Nt;let r=s;const n=t.startsWith("update:"),o=n&&t.slice(7);if(o&&o in i){const c=`${o==="modelValue"?"model":o}Modifiers`,{number:u,trim:d}=i[c]||Nt;d&&(r=s.map(p=>Yt(p)?p.trim():p)),u&&(r=s.map(Gp))}let a,l=i[a=Mo(t)]||i[a=Mo(ss(t))];!l&&n&&(l=i[a=Mo(Wi(t))]),l&&we(l,e,6,r);const h=i[a+"Once"];if(h){if(!e.emitted)e.emitted={};else if(e.emitted[a])return;e.emitted[a]=!0,we(h,e,6,r)}}function ed(e,t,s=!1){const i=t.emitsCache,r=i.get(e);if(r!==void 0)return r;const n=e.emits;let o={},a=!1;if(!gt(e)){const l=h=>{const c=ed(h,t,!0);c&&(a=!0,le(o,c))};!s&&t.mixins.length&&t.mixins.forEach(l),e.extends&&l(e.extends),e.mixins&&e.mixins.forEach(l)}return!n&&!a?(kt(e)&&i.set(e,null),null):(mt(n)?n.forEach(l=>o[l]=null):le(o,n),kt(e)&&i.set(e,o),o)}function ro(e,t){return!e||!Jn(t)?!1:(t=t.slice(2).replace(/Once$/,""),wt(e,t[0].toLowerCase()+t.slice(1))||wt(e,Wi(t))||wt(e,t))}let ve=null,no=null;function On(e){const t=ve;return ve=e,no=e&&e.type.__scopeId||null,t}function Aw(e){no=e}function Cw(){no=null}function Rm(e,t=ve,s){if(!t||e._n)return e;const i=(...r)=>{i._d&&Lh(-1);const n=On(t);let o;try{o=e(...r)}finally{On(n),i._d&&Lh(1)}return o};return i._n=!0,i._c=!0,i._d=!0,i}function Bo(e){const{type:t,vnode:s,proxy:i,withProxy:r,props:n,propsOptions:[o],slots:a,attrs:l,emit:h,render:c,renderCache:u,data:d,setupState:p,ctx:f,inheritAttrs:m}=e;let _,v;const b=On(e);try{if(s.shapeFlag&4){const E=r||i;_=Ve(c.call(E,E,u,n,p,d,f)),v=l}else{const E=t;_=Ve(E.length>1?E(n,{attrs:l,slots:a,emit:h}):E(n,null)),v=t.props?l:Pm(l)}}catch(E){mr.length=0,Mr(E,e,1),_=ie(Ne)}let g=_;if(v&&m!==!1){const E=Object.keys(v),{shapeFlag:S}=g;E.length&&S&7&&(o&&E.some(wl)&&(v=Mm(v,o)),g=Bs(g,v))}return s.dirs&&(g=Bs(g),g.dirs=g.dirs?g.dirs.concat(s.dirs):s.dirs),s.transition&&(g.transition=s.transition),_=g,On(b),_}const Pm=e=>{let t;for(const s in e)(s==="class"||s==="style"||Jn(s))&&((t||(t={}))[s]=e[s]);return t},Mm=(e,t)=>{const s={};for(const i in e)(!wl(i)||!(i.slice(9)in t))&&(s[i]=e[i]);return s};function Om(e,t,s){const{props:i,children:r,component:n}=e,{props:o,children:a,patchFlag:l}=t,h=n.emitsOptions;if(t.dirs||t.transition)return!0;if(s&&l>=0){if(l&1024)return!0;if(l&16)return i?Ah(i,o,h):!!o;if(l&8){const c=t.dynamicProps;for(let u=0;u<c.length;u++){const d=c[u];if(o[d]!==i[d]&&!ro(h,d))return!0}}}else return(r||a)&&(!a||!a.$stable)?!0:i===o?!1:i?o?Ah(i,o,h):!0:!!o;return!1}function Ah(e,t,s){const i=Object.keys(t);if(i.length!==Object.keys(e).length)return!0;for(let r=0;r<i.length;r++){const n=i[r];if(t[n]!==e[n]&&!ro(s,n))return!0}return!1}function Bm({vnode:e,parent:t},s){for(;t&&t.subTree===e;)(e=t.vnode).el=s,t=t.parent}const Dm=e=>e.__isSuspense;function Lm(e,t){t&&t.pendingBranch?mt(e)?t.effects.push(...e):t.effects.push(e):Am(e)}function Fm(e,t){if(Xt){let s=Xt.provides;const i=Xt.parent&&Xt.parent.provides;i===s&&(s=Xt.provides=Object.create(i)),s[e]=t}}function _n(e,t,s=!1){const i=Xt||ve;if(i){const r=i.parent==null?i.vnode.appContext&&i.vnode.appContext.provides:i.parent.provides;if(r&&e in r)return r[e];if(arguments.length>1)return s&&gt(t)?t.call(i.proxy):t}}const Wr={};function fr(e,t,s){return sd(e,t,s)}function sd(e,t,{immediate:s,deep:i,flush:r,onTrack:n,onTrigger:o}=Nt){const a=Ou()===(Xt==null?void 0:Xt.scope)?Xt:null;let l,h=!1,c=!1;if(oe(e)?(l=()=>e.value,h=Mn(e)):Ci(e)?(l=()=>e,i=!0):mt(e)?(c=!0,h=e.some(g=>Ci(g)||Mn(g)),l=()=>e.map(g=>{if(oe(g))return g.value;if(Ci(g))return Zs(g);if(gt(g))return Ps(g,a,2)})):gt(e)?t?l=()=>Ps(e,a,2):l=()=>{if(!(a&&a.isUnmounted))return u&&u(),we(e,a,3,[d])}:l=Fe,t&&i){const g=l;l=()=>Zs(g())}let u,d=g=>{u=v.onStop=()=>{Ps(g,a,4)}},p;if(Ui)if(d=Fe,t?s&&we(t,a,3,[l(),c?[]:void 0,d]):l(),r==="sync"){const g=Bg();p=g.__watcherHandles||(g.__watcherHandles=[])}else return Fe;let f=c?new Array(e.length).fill(Wr):Wr;const m=()=>{if(v.active)if(t){const g=v.run();(i||h||(c?g.some((E,S)=>xr(E,f[S])):xr(g,f)))&&(u&&u(),we(t,a,3,[g,f===Wr?void 0:c&&f[0]===Wr?[]:f,d]),f=g)}else v.run()};m.allowRecurse=!!t;let _;r==="sync"?_=m:r==="post"?_=()=>ce(m,a&&a.suspense):(m.pre=!0,a&&(m.id=a.uid),_=()=>io(m));const v=new Rl(l,_);t?s?m():f=v.run():r==="post"?ce(v.run.bind(v),a&&a.suspense):v.run();const b=()=>{v.stop(),a&&a.scope&&Sl(a.scope.effects,v)};return p&&p.push(b),b}function Nm(e,t,s){const i=this.proxy,r=Yt(e)?e.includes(".")?id(i,e):()=>i[e]:e.bind(i,i);let n;gt(t)?n=t:(n=t.handler,s=t);const o=Xt;Ni(this);const a=sd(r,n.bind(i),s);return o?Ni(o):ti(),a}function id(e,t){const s=t.split(".");return()=>{let i=e;for(let r=0;r<s.length&&i;r++)i=i[s[r]];return i}}function Zs(e,t){if(!kt(e)||e.__v_skip||(t=t||new Set,t.has(e)))return e;if(t.add(e),oe(e))Zs(e.value,t);else if(mt(e))for(let s=0;s<e.length;s++)Zs(e[s],t);else if(Cu(e)||Ai(e))e.forEach(s=>{Zs(s,t)});else if(Pu(e))for(const s in e)Zs(e[s],t);return e}function Um(){const e={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return kl(()=>{e.isMounted=!0}),ad(()=>{e.isUnmounting=!0}),e}const ye=[Function,Array],km={name:"BaseTransition",props:{mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:ye,onEnter:ye,onAfterEnter:ye,onEnterCancelled:ye,onBeforeLeave:ye,onLeave:ye,onAfterLeave:ye,onLeaveCancelled:ye,onBeforeAppear:ye,onAppear:ye,onAfterAppear:ye,onAppearCancelled:ye},setup(e,{slots:t}){const s=bd(),i=Um();let r;return()=>{const n=t.default&&nd(t.default(),!0);if(!n||!n.length)return;let o=n[0];if(n.length>1){for(const m of n)if(m.type!==Ne){o=m;break}}const a=It(e),{mode:l}=a;if(i.isLeaving)return Do(o);const h=Ch(o);if(!h)return Do(o);const c=Aa(h,a,i,s);Ca(h,c);const u=s.subTree,d=u&&Ch(u);let p=!1;const{getTransitionKey:f}=h.type;if(f){const m=f();r===void 0?r=m:m!==r&&(r=m,p=!0)}if(d&&d.type!==Ne&&(!Ks(h,d)||p)){const m=Aa(d,a,i,s);if(Ca(d,m),l==="out-in")return i.isLeaving=!0,m.afterLeave=()=>{i.isLeaving=!1,s.update.active!==!1&&s.update()},Do(o);l==="in-out"&&h.type!==Ne&&(m.delayLeave=(_,v,b)=>{const g=rd(i,d);g[String(d.key)]=d,_._leaveCb=()=>{v(),_._leaveCb=void 0,delete c.delayedLeave},c.delayedLeave=b})}return o}}},Gm=km;function rd(e,t){const{leavingVNodes:s}=e;let i=s.get(t.type);return i||(i=Object.create(null),s.set(t.type,i)),i}function Aa(e,t,s,i){const{appear:r,mode:n,persisted:o=!1,onBeforeEnter:a,onEnter:l,onAfterEnter:h,onEnterCancelled:c,onBeforeLeave:u,onLeave:d,onAfterLeave:p,onLeaveCancelled:f,onBeforeAppear:m,onAppear:_,onAfterAppear:v,onAppearCancelled:b}=t,g=String(e.key),E=rd(s,e),S=(y,I)=>{y&&we(y,i,9,I)},C=(y,I)=>{const B=I[1];S(y,I),mt(y)?y.every(F=>F.length<=1)&&B():y.length<=1&&B()},T={mode:n,persisted:o,beforeEnter(y){let I=a;if(!s.isMounted)if(r)I=m||a;else return;y._leaveCb&&y._leaveCb(!0);const B=E[g];B&&Ks(e,B)&&B.el._leaveCb&&B.el._leaveCb(),S(I,[y])},enter(y){let I=l,B=h,F=c;if(!s.isMounted)if(r)I=_||l,B=v||h,F=b||c;else return;let z=!1;const L=y._enterCb=P=>{z||(z=!0,P?S(F,[y]):S(B,[y]),T.delayedLeave&&T.delayedLeave(),y._enterCb=void 0)};I?C(I,[y,L]):L()},leave(y,I){const B=String(e.key);if(y._enterCb&&y._enterCb(!0),s.isUnmounting)return I();S(u,[y]);let F=!1;const z=y._leaveCb=L=>{F||(F=!0,I(),L?S(f,[y]):S(p,[y]),y._leaveCb=void 0,E[B]===e&&delete E[B])};E[B]=e,d?C(d,[y,z]):z()},clone(y){return Aa(y,t,s,i)}};return T}function Do(e){if(Or(e))return e=Bs(e),e.children=null,e}function Ch(e){return Or(e)?e.children?e.children[0]:void 0:e}function Ca(e,t){e.shapeFlag&6&&e.component?Ca(e.component.subTree,t):e.shapeFlag&128?(e.ssContent.transition=t.clone(e.ssContent),e.ssFallback.transition=t.clone(e.ssFallback)):e.transition=t}function nd(e,t=!1,s){let i=[],r=0;for(let n=0;n<e.length;n++){let o=e[n];const a=s==null?o.key:String(s)+String(o.key!=null?o.key:n);o.type===je?(o.patchFlag&128&&r++,i=i.concat(nd(o.children,t,a))):(t||o.type!==Ne)&&i.push(a!=null?Bs(o,{key:a}):o)}if(r>1)for(let n=0;n<i.length;n++)i[n].patchFlag=-2;return i}function Hm(e){return gt(e)?{setup:e,name:e.name}:e}const xn=e=>!!e.type.__asyncLoader;function Iw(e){gt(e)&&(e={loader:e});const{loader:t,loadingComponent:s,errorComponent:i,delay:r=200,timeout:n,suspensible:o=!0,onError:a}=e;let l=null,h,c=0;const u=()=>(c++,l=null,d()),d=()=>{let p;return l||(p=l=t().catch(f=>{if(f=f instanceof Error?f:new Error(String(f)),a)return new Promise((m,_)=>{a(f,()=>m(u()),()=>_(f),c+1)});throw f}).then(f=>p!==l&&l?l:(f&&(f.__esModule||f[Symbol.toStringTag]==="Module")&&(f=f.default),h=f,f)))};return Hm({name:"AsyncComponentWrapper",__asyncLoader:d,get __asyncResolved(){return h},setup(){const p=Xt;if(h)return()=>Lo(h,p);const f=b=>{l=null,Mr(b,p,13,!i)};if(o&&p.suspense||Ui)return d().then(b=>()=>Lo(b,p)).catch(b=>(f(b),()=>i?ie(i,{error:b}):null));const m=dr(!1),_=dr(),v=dr(!!r);return r&&setTimeout(()=>{v.value=!1},r),n!=null&&setTimeout(()=>{if(!m.value&&!_.value){const b=new Error(`Async component timed out after ${n}ms.`);f(b),_.value=b}},n),d().then(()=>{m.value=!0,p.parent&&Or(p.parent.vnode)&&io(p.parent.update)}).catch(b=>{f(b),_.value=b}),()=>{if(m.value&&h)return Lo(h,p);if(_.value&&i)return ie(i,{error:_.value});if(s&&!v.value)return ie(s)}}})}function Lo(e,t){const{ref:s,props:i,children:r,ce:n}=t.vnode,o=ie(e,i,r);return o.ref=s,o.ce=n,delete t.vnode.ce,o}const Or=e=>e.type.__isKeepAlive;function $m(e,t){od(e,"a",t)}function Wm(e,t){od(e,"da",t)}function od(e,t,s=Xt){const i=e.__wdc||(e.__wdc=()=>{let r=s;for(;r;){if(r.isDeactivated)return;r=r.parent}return e()});if(oo(t,i,s),s){let r=s.parent;for(;r&&r.parent;)Or(r.parent.vnode)&&Xm(i,t,s,r),r=r.parent}}function Xm(e,t,s,i){const r=oo(t,e,i,!0);ld(()=>{Sl(i[t],r)},s)}function oo(e,t,s=Xt,i=!1){if(s){const r=s[e]||(s[e]=[]),n=t.__weh||(t.__weh=(...o)=>{if(s.isUnmounted)return;Xi(),Ni(s);const a=we(t,s,e,o);return ti(),zi(),a});return i?r.unshift(n):r.push(n),n}}const _s=e=>(t,s=Xt)=>(!Ui||e==="sp")&&oo(e,(...i)=>t(...i),s),zm=_s("bm"),kl=_s("m"),jm=_s("bu"),Vm=_s("u"),ad=_s("bum"),ld=_s("um"),Ym=_s("sp"),Km=_s("rtg"),qm=_s("rtc");function Zm(e,t=Xt){oo("ec",e,t)}function Rw(e,t){const s=ve;if(s===null)return e;const i=ho(s)||s.proxy,r=e.dirs||(e.dirs=[]);for(let n=0;n<t.length;n++){let[o,a,l,h=Nt]=t[n];o&&(gt(o)&&(o={mounted:o,updated:o}),o.deep&&Zs(a),r.push({dir:o,instance:i,value:a,oldValue:void 0,arg:l,modifiers:h}))}return e}function ks(e,t,s,i){const r=e.dirs,n=t&&t.dirs;for(let o=0;o<r.length;o++){const a=r[o];n&&(a.oldValue=n[o].value);let l=a.dir[i];l&&(Xi(),we(l,s,8,[e.el,a,e,t]),zi())}}const Gl="components";function Pw(e,t){return cd(Gl,e,!0,t)||e}const hd=Symbol();function Mw(e){return Yt(e)?cd(Gl,e,!1)||e:e||hd}function cd(e,t,s=!0,i=!1){const r=ve||Xt;if(r){const n=r.type;if(e===Gl){const a=Rg(n,!1);if(a&&(a===t||a===ss(t)||a===eo(ss(t))))return n}const o=Ih(r[e]||n[e],t)||Ih(r.appContext[e],t);return!o&&i?n:o}}function Ih(e,t){return e&&(e[t]||e[ss(t)]||e[eo(ss(t))])}function Ow(e,t,s,i){let r;const n=s&&s[i];if(mt(e)||Yt(e)){r=new Array(e.length);for(let o=0,a=e.length;o<a;o++)r[o]=t(e[o],o,void 0,n&&n[o])}else if(typeof e=="number"){r=new Array(e);for(let o=0;o<e;o++)r[o]=t(o+1,o,void 0,n&&n[o])}else if(kt(e))if(e[Symbol.iterator])r=Array.from(e,(o,a)=>t(o,a,void 0,n&&n[a]));else{const o=Object.keys(e);r=new Array(o.length);for(let a=0,l=o.length;a<l;a++){const h=o[a];r[a]=t(e[h],h,a,n&&n[a])}}else r=[];return s&&(s[i]=r),r}const Ia=e=>e?Td(e)?ho(e)||e.proxy:Ia(e.parent):null,pr=le(Object.create(null),{$:e=>e,$el:e=>e.vnode.el,$data:e=>e.data,$props:e=>e.props,$attrs:e=>e.attrs,$slots:e=>e.slots,$refs:e=>e.refs,$parent:e=>Ia(e.parent),$root:e=>Ia(e.root),$emit:e=>e.emit,$options:e=>Hl(e),$forceUpdate:e=>e.f||(e.f=()=>io(e.update)),$nextTick:e=>e.n||(e.n=Ul.bind(e.proxy)),$watch:e=>Nm.bind(e)}),Fo=(e,t)=>e!==Nt&&!e.__isScriptSetup&&wt(e,t),Jm={get({_:e},t){const{ctx:s,setupState:i,data:r,props:n,accessCache:o,type:a,appContext:l}=e;let h;if(t[0]!=="$"){const p=o[t];if(p!==void 0)switch(p){case 1:return i[t];case 2:return r[t];case 4:return s[t];case 3:return n[t]}else{if(Fo(i,t))return o[t]=1,i[t];if(r!==Nt&&wt(r,t))return o[t]=2,r[t];if((h=e.propsOptions[0])&&wt(h,t))return o[t]=3,n[t];if(s!==Nt&&wt(s,t))return o[t]=4,s[t];Ra&&(o[t]=0)}}const c=pr[t];let u,d;if(c)return t==="$attrs"&&de(e,"get",t),c(e);if((u=a.__cssModules)&&(u=u[t]))return u;if(s!==Nt&&wt(s,t))return o[t]=4,s[t];if(d=l.config.globalProperties,wt(d,t))return d[t]},set({_:e},t,s){const{data:i,setupState:r,ctx:n}=e;return Fo(r,t)?(r[t]=s,!0):i!==Nt&&wt(i,t)?(i[t]=s,!0):wt(e.props,t)||t[0]==="$"&&t.slice(1)in e?!1:(n[t]=s,!0)},has({_:{data:e,setupState:t,accessCache:s,ctx:i,appContext:r,propsOptions:n}},o){let a;return!!s[o]||e!==Nt&&wt(e,o)||Fo(t,o)||(a=n[0])&&wt(a,o)||wt(i,o)||wt(pr,o)||wt(r.config.globalProperties,o)},defineProperty(e,t,s){return s.get!=null?e._.accessCache[t]=0:wt(s,"value")&&this.set(e,t,s.value,null),Reflect.defineProperty(e,t,s)}};let Ra=!0;function Qm(e){const t=Hl(e),s=e.proxy,i=e.ctx;Ra=!1,t.beforeCreate&&Rh(t.beforeCreate,e,"bc");const{data:r,computed:n,methods:o,watch:a,provide:l,inject:h,created:c,beforeMount:u,mounted:d,beforeUpdate:p,updated:f,activated:m,deactivated:_,beforeDestroy:v,beforeUnmount:b,destroyed:g,unmounted:E,render:S,renderTracked:C,renderTriggered:T,errorCaptured:y,serverPrefetch:I,expose:B,inheritAttrs:F,components:z,directives:L,filters:P}=t;if(h&&tg(h,i,null,e.appContext.config.unwrapInjectedRef),o)for(const G in o){const st=o[G];gt(st)&&(i[G]=st.bind(s))}if(r){const G=r.call(s,s);kt(G)&&(e.data=Bl(G))}if(Ra=!0,n)for(const G in n){const st=n[G],Ct=gt(st)?st.bind(s,s):gt(st.get)?st.get.bind(s,s):Fe,N=!gt(st)&&gt(st.set)?st.set.bind(s):Fe,U=Mg({get:Ct,set:N});Object.defineProperty(i,G,{enumerable:!0,configurable:!0,get:()=>U.value,set:Y=>U.value=Y})}if(a)for(const G in a)ud(a[G],i,s,G);if(l){const G=gt(l)?l.call(s):l;Reflect.ownKeys(G).forEach(st=>{Fm(st,G[st])})}c&&Rh(c,e,"c");function nt(G,st){mt(st)?st.forEach(Ct=>G(Ct.bind(s))):st&&G(st.bind(s))}if(nt(zm,u),nt(kl,d),nt(jm,p),nt(Vm,f),nt($m,m),nt(Wm,_),nt(Zm,y),nt(qm,C),nt(Km,T),nt(ad,b),nt(ld,E),nt(Ym,I),mt(B))if(B.length){const G=e.exposed||(e.exposed={});B.forEach(st=>{Object.defineProperty(G,st,{get:()=>s[st],set:Ct=>s[st]=Ct})})}else e.exposed||(e.exposed={});S&&e.render===Fe&&(e.render=S),F!=null&&(e.inheritAttrs=F),z&&(e.components=z),L&&(e.directives=L)}function tg(e,t,s=Fe,i=!1){mt(e)&&(e=Pa(e));for(const r in e){const n=e[r];let o;kt(n)?"default"in n?o=_n(n.from||r,n.default,!0):o=_n(n.from||r):o=_n(n),oe(o)&&i?Object.defineProperty(t,r,{enumerable:!0,configurable:!0,get:()=>o.value,set:a=>o.value=a}):t[r]=o}}function Rh(e,t,s){we(mt(e)?e.map(i=>i.bind(t.proxy)):e.bind(t.proxy),t,s)}function ud(e,t,s,i){const r=i.includes(".")?id(s,i):()=>s[i];if(Yt(e)){const n=t[e];gt(n)&&fr(r,n)}else if(gt(e))fr(r,e.bind(s));else if(kt(e))if(mt(e))e.forEach(n=>ud(n,t,s,i));else{const n=gt(e.handler)?e.handler.bind(s):t[e.handler];gt(n)&&fr(r,n,e)}}function Hl(e){const t=e.type,{mixins:s,extends:i}=t,{mixins:r,optionsCache:n,config:{optionMergeStrategies:o}}=e.appContext,a=n.get(t);let l;return a?l=a:!r.length&&!s&&!i?l=t:(l={},r.length&&r.forEach(h=>Bn(l,h,o,!0)),Bn(l,t,o)),kt(t)&&n.set(t,l),l}function Bn(e,t,s,i=!1){const{mixins:r,extends:n}=t;n&&Bn(e,n,s,!0),r&&r.forEach(o=>Bn(e,o,s,!0));for(const o in t)if(!(i&&o==="expose")){const a=eg[o]||s&&s[o];e[o]=a?a(e[o],t[o]):t[o]}return e}const eg={data:Ph,props:Ws,emits:Ws,methods:Ws,computed:Ws,beforeCreate:he,created:he,beforeMount:he,mounted:he,beforeUpdate:he,updated:he,beforeDestroy:he,beforeUnmount:he,destroyed:he,unmounted:he,activated:he,deactivated:he,errorCaptured:he,serverPrefetch:he,components:Ws,directives:Ws,watch:ig,provide:Ph,inject:sg};function Ph(e,t){return t?e?function(){return le(gt(e)?e.call(this,this):e,gt(t)?t.call(this,this):t)}:t:e}function sg(e,t){return Ws(Pa(e),Pa(t))}function Pa(e){if(mt(e)){const t={};for(let s=0;s<e.length;s++)t[e[s]]=e[s];return t}return e}function he(e,t){return e?[...new Set([].concat(e,t))]:t}function Ws(e,t){return e?le(le(Object.create(null),e),t):t}function ig(e,t){if(!e)return t;if(!t)return e;const s=le(Object.create(null),e);for(const i in t)s[i]=he(e[i],t[i]);return s}function rg(e,t,s,i=!1){const r={},n={};Pn(n,lo,1),e.propsDefaults=Object.create(null),dd(e,t,r,n);for(const o in e.propsOptions[0])o in r||(r[o]=void 0);s?e.props=i?r:_m(r):e.type.props?e.props=r:e.props=n,e.attrs=n}function ng(e,t,s,i){const{props:r,attrs:n,vnode:{patchFlag:o}}=e,a=It(r),[l]=e.propsOptions;let h=!1;if((i||o>0)&&!(o&16)){if(o&8){const c=e.vnode.dynamicProps;for(let u=0;u<c.length;u++){let d=c[u];if(ro(e.emitsOptions,d))continue;const p=t[d];if(l)if(wt(n,d))p!==n[d]&&(n[d]=p,h=!0);else{const f=ss(d);r[f]=Ma(l,a,f,p,e,!1)}else p!==n[d]&&(n[d]=p,h=!0)}}}else{dd(e,t,r,n)&&(h=!0);let c;for(const u in a)(!t||!wt(t,u)&&((c=Wi(u))===u||!wt(t,c)))&&(l?s&&(s[u]!==void 0||s[c]!==void 0)&&(r[u]=Ma(l,a,u,void 0,e,!0)):delete r[u]);if(n!==a)for(const u in n)(!t||!wt(t,u))&&(delete n[u],h=!0)}h&&ms(e,"set","$attrs")}function dd(e,t,s,i){const[r,n]=e.propsOptions;let o=!1,a;if(t)for(let l in t){if(gn(l))continue;const h=t[l];let c;r&&wt(r,c=ss(l))?!n||!n.includes(c)?s[c]=h:(a||(a={}))[c]=h:ro(e.emitsOptions,l)||(!(l in i)||h!==i[l])&&(i[l]=h,o=!0)}if(n){const l=It(s),h=a||Nt;for(let c=0;c<n.length;c++){const u=n[c];s[u]=Ma(r,l,u,h[u],e,!wt(h,u))}}return o}function Ma(e,t,s,i,r,n){const o=e[s];if(o!=null){const a=wt(o,"default");if(a&&i===void 0){const l=o.default;if(o.type!==Function&&gt(l)){const{propsDefaults:h}=r;s in h?i=h[s]:(Ni(r),i=h[s]=l.call(null,t),ti())}else i=l}o[0]&&(n&&!a?i=!1:o[1]&&(i===""||i===Wi(s))&&(i=!0))}return i}function fd(e,t,s=!1){const i=t.propsCache,r=i.get(e);if(r)return r;const n=e.props,o={},a=[];let l=!1;if(!gt(e)){const c=u=>{l=!0;const[d,p]=fd(u,t,!0);le(o,d),p&&a.push(...p)};!s&&t.mixins.length&&t.mixins.forEach(c),e.extends&&c(e.extends),e.mixins&&e.mixins.forEach(c)}if(!n&&!l)return kt(e)&&i.set(e,Si),Si;if(mt(n))for(let c=0;c<n.length;c++){const u=ss(n[c]);Mh(u)&&(o[u]=Nt)}else if(n)for(const c in n){const u=ss(c);if(Mh(u)){const d=n[c],p=o[u]=mt(d)||gt(d)?{type:d}:Object.assign({},d);if(p){const f=Dh(Boolean,p.type),m=Dh(String,p.type);p[0]=f>-1,p[1]=m<0||f<m,(f>-1||wt(p,"default"))&&a.push(u)}}}const h=[o,a];return kt(e)&&i.set(e,h),h}function Mh(e){return e[0]!=="$"}function Oh(e){const t=e&&e.toString().match(/^\s*(function|class) (\w+)/);return t?t[2]:e===null?"null":""}function Bh(e,t){return Oh(e)===Oh(t)}function Dh(e,t){return mt(t)?t.findIndex(s=>Bh(s,e)):gt(t)&&Bh(t,e)?0:-1}const pd=e=>e[0]==="_"||e==="$stable",$l=e=>mt(e)?e.map(Ve):[Ve(e)],og=(e,t,s)=>{if(t._n)return t;const i=Rm((...r)=>$l(t(...r)),s);return i._c=!1,i},md=(e,t,s)=>{const i=e._ctx;for(const r in e){if(pd(r))continue;const n=e[r];if(gt(n))t[r]=og(r,n,i);else if(n!=null){const o=$l(n);t[r]=()=>o}}},gd=(e,t)=>{const s=$l(t);e.slots.default=()=>s},ag=(e,t)=>{if(e.vnode.shapeFlag&32){const s=t._;s?(e.slots=It(t),Pn(t,"_",s)):md(t,e.slots={})}else e.slots={},t&&gd(e,t);Pn(e.slots,lo,1)},lg=(e,t,s)=>{const{vnode:i,slots:r}=e;let n=!0,o=Nt;if(i.shapeFlag&32){const a=t._;a?s&&a===1?n=!1:(le(r,t),!s&&a===1&&delete r._):(n=!t.$stable,md(t,r)),o=t}else t&&(gd(e,t),o={default:1});if(n)for(const a in r)!pd(a)&&!(a in o)&&delete r[a]};function _d(){return{app:null,config:{isNativeTag:Dp,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let hg=0;function cg(e,t){return function(i,r=null){gt(i)||(i=Object.assign({},i)),r!=null&&!kt(r)&&(r=null);const n=_d(),o=new Set;let a=!1;const l=n.app={_uid:hg++,_component:i,_props:r,_container:null,_context:n,_instance:null,version:Dg,get config(){return n.config},set config(h){},use(h,...c){return o.has(h)||(h&&gt(h.install)?(o.add(h),h.install(l,...c)):gt(h)&&(o.add(h),h(l,...c))),l},mixin(h){return n.mixins.includes(h)||n.mixins.push(h),l},component(h,c){return c?(n.components[h]=c,l):n.components[h]},directive(h,c){return c?(n.directives[h]=c,l):n.directives[h]},mount(h,c,u){if(!a){const d=ie(i,r);return d.appContext=n,c&&t?t(d,h):e(d,h,u),a=!0,l._container=h,h.__vue_app__=l,ho(d.component)||d.component.proxy}},unmount(){a&&(e(null,l._container),delete l._container.__vue_app__)},provide(h,c){return n.provides[h]=c,l}};return l}}function Oa(e,t,s,i,r=!1){if(mt(e)){e.forEach((d,p)=>Oa(d,t&&(mt(t)?t[p]:t),s,i,r));return}if(xn(i)&&!r)return;const n=i.shapeFlag&4?ho(i.component)||i.component.proxy:i.el,o=r?null:n,{i:a,r:l}=e,h=t&&t.r,c=a.refs===Nt?a.refs={}:a.refs,u=a.setupState;if(h!=null&&h!==l&&(Yt(h)?(c[h]=null,wt(u,h)&&(u[h]=null)):oe(h)&&(h.value=null)),gt(l))Ps(l,a,12,[o,c]);else{const d=Yt(l),p=oe(l);if(d||p){const f=()=>{if(e.f){const m=d?wt(u,l)?u[l]:c[l]:l.value;r?mt(m)&&Sl(m,n):mt(m)?m.includes(n)||m.push(n):d?(c[l]=[n],wt(u,l)&&(u[l]=c[l])):(l.value=[n],e.k&&(c[e.k]=l.value))}else d?(c[l]=o,wt(u,l)&&(u[l]=o)):p&&(l.value=o,e.k&&(c[e.k]=o))};o?(f.id=-1,ce(f,s)):f()}}}const ce=Lm;function ug(e){return dg(e)}function dg(e,t){const s=Hp();s.__VUE__=!0;const{insert:i,remove:r,patchProp:n,createElement:o,createText:a,createComment:l,setText:h,setElementText:c,parentNode:u,nextSibling:d,setScopeId:p=Fe,insertStaticContent:f}=e,m=(x,w,A,M=null,D=null,H=null,K=!1,$=null,j=!!w.dynamicChildren)=>{if(x===w)return;x&&!Ks(x,w)&&(M=ht(x),Y(x,D,H,!0),x=null),w.patchFlag===-2&&(j=!1,w.dynamicChildren=null);const{type:k,ref:ot,shapeFlag:tt}=w;switch(k){case ao:_(x,w,A,M);break;case Ne:v(x,w,A,M);break;case No:x==null&&b(w,A,M,K);break;case je:z(x,w,A,M,D,H,K,$,j);break;default:tt&1?S(x,w,A,M,D,H,K,$,j):tt&6?L(x,w,A,M,D,H,K,$,j):(tt&64||tt&128)&&k.process(x,w,A,M,D,H,K,$,j,Lt)}ot!=null&&D&&Oa(ot,x&&x.ref,H,w||x,!w)},_=(x,w,A,M)=>{if(x==null)i(w.el=a(w.children),A,M);else{const D=w.el=x.el;w.children!==x.children&&h(D,w.children)}},v=(x,w,A,M)=>{x==null?i(w.el=l(w.children||""),A,M):w.el=x.el},b=(x,w,A,M)=>{[x.el,x.anchor]=f(x.children,w,A,M,x.el,x.anchor)},g=({el:x,anchor:w},A,M)=>{let D;for(;x&&x!==w;)D=d(x),i(x,A,M),x=D;i(w,A,M)},E=({el:x,anchor:w})=>{let A;for(;x&&x!==w;)A=d(x),r(x),x=A;r(w)},S=(x,w,A,M,D,H,K,$,j)=>{K=K||w.type==="svg",x==null?C(w,A,M,D,H,K,$,j):I(x,w,D,H,K,$,j)},C=(x,w,A,M,D,H,K,$)=>{let j,k;const{type:ot,props:tt,shapeFlag:at,transition:ft,dirs:yt}=x;if(j=x.el=o(x.type,H,tt&&tt.is,tt),at&8?c(j,x.children):at&16&&y(x.children,j,null,M,D,H&&ot!=="foreignObject",K,$),yt&&ks(x,null,M,"created"),T(j,x,x.scopeId,K,M),tt){for(const Bt in tt)Bt!=="value"&&!gn(Bt)&&n(j,Bt,null,tt[Bt],H,x.children,M,D,_t);"value"in tt&&n(j,"value",null,tt.value),(k=tt.onVnodeBeforeMount)&&We(k,M,x)}yt&&ks(x,null,M,"beforeMount");const Ft=(!D||D&&!D.pendingBranch)&&ft&&!ft.persisted;Ft&&ft.beforeEnter(j),i(j,w,A),((k=tt&&tt.onVnodeMounted)||Ft||yt)&&ce(()=>{k&&We(k,M,x),Ft&&ft.enter(j),yt&&ks(x,null,M,"mounted")},D)},T=(x,w,A,M,D)=>{if(A&&p(x,A),M)for(let H=0;H<M.length;H++)p(x,M[H]);if(D){let H=D.subTree;if(w===H){const K=D.vnode;T(x,K,K.scopeId,K.slotScopeIds,D.parent)}}},y=(x,w,A,M,D,H,K,$,j=0)=>{for(let k=j;k<x.length;k++){const ot=x[k]=$?ws(x[k]):Ve(x[k]);m(null,ot,w,A,M,D,H,K,$)}},I=(x,w,A,M,D,H,K)=>{const $=w.el=x.el;let{patchFlag:j,dynamicChildren:k,dirs:ot}=w;j|=x.patchFlag&16;const tt=x.props||Nt,at=w.props||Nt;let ft;A&&Gs(A,!1),(ft=at.onVnodeBeforeUpdate)&&We(ft,A,w,x),ot&&ks(w,x,A,"beforeUpdate"),A&&Gs(A,!0);const yt=D&&w.type!=="foreignObject";if(k?B(x.dynamicChildren,k,$,A,M,yt,H):K||st(x,w,$,null,A,M,yt,H,!1),j>0){if(j&16)F($,w,tt,at,A,M,D);else if(j&2&&tt.class!==at.class&&n($,"class",null,at.class,D),j&4&&n($,"style",tt.style,at.style,D),j&8){const Ft=w.dynamicProps;for(let Bt=0;Bt<Ft.length;Bt++){const zt=Ft[Bt],Ae=tt[zt],di=at[zt];(di!==Ae||zt==="value")&&n($,zt,Ae,di,D,x.children,A,M,_t)}}j&1&&x.children!==w.children&&c($,w.children)}else!K&&k==null&&F($,w,tt,at,A,M,D);((ft=at.onVnodeUpdated)||ot)&&ce(()=>{ft&&We(ft,A,w,x),ot&&ks(w,x,A,"updated")},M)},B=(x,w,A,M,D,H,K)=>{for(let $=0;$<w.length;$++){const j=x[$],k=w[$],ot=j.el&&(j.type===je||!Ks(j,k)||j.shapeFlag&70)?u(j.el):A;m(j,k,ot,null,M,D,H,K,!0)}},F=(x,w,A,M,D,H,K)=>{if(A!==M){if(A!==Nt)for(const $ in A)!gn($)&&!($ in M)&&n(x,$,A[$],null,K,w.children,D,H,_t);for(const $ in M){if(gn($))continue;const j=M[$],k=A[$];j!==k&&$!=="value"&&n(x,$,k,j,K,w.children,D,H,_t)}"value"in M&&n(x,"value",A.value,M.value)}},z=(x,w,A,M,D,H,K,$,j)=>{const k=w.el=x?x.el:a(""),ot=w.anchor=x?x.anchor:a("");let{patchFlag:tt,dynamicChildren:at,slotScopeIds:ft}=w;ft&&($=$?$.concat(ft):ft),x==null?(i(k,A,M),i(ot,A,M),y(w.children,A,ot,D,H,K,$,j)):tt>0&&tt&64&&at&&x.dynamicChildren?(B(x.dynamicChildren,at,A,D,H,K,$),(w.key!=null||D&&w===D.subTree)&&xd(x,w,!0)):st(x,w,A,ot,D,H,K,$,j)},L=(x,w,A,M,D,H,K,$,j)=>{w.slotScopeIds=$,x==null?w.shapeFlag&512?D.ctx.activate(w,A,M,K,j):P(w,A,M,D,H,K,j):ut(x,w,j)},P=(x,w,A,M,D,H,K)=>{const $=x.component=wg(x,M,D);if(Or(x)&&($.ctx.renderer=Lt),Sg($),$.asyncDep){if(D&&D.registerDep($,nt),!x.el){const j=$.subTree=ie(Ne);v(null,j,w,A)}return}nt($,x,w,A,D,H,K)},ut=(x,w,A)=>{const M=w.component=x.component;if(Om(x,w,A))if(M.asyncDep&&!M.asyncResolved){G(M,w,A);return}else M.next=w,Sm(M.update),M.update();else w.el=x.el,M.vnode=w},nt=(x,w,A,M,D,H,K)=>{const $=()=>{if(x.isMounted){let{next:ot,bu:tt,u:at,parent:ft,vnode:yt}=x,Ft=ot,Bt;Gs(x,!1),ot?(ot.el=yt.el,G(x,ot,K)):ot=yt,tt&&Oo(tt),(Bt=ot.props&&ot.props.onVnodeBeforeUpdate)&&We(Bt,ft,ot,yt),Gs(x,!0);const zt=Bo(x),Ae=x.subTree;x.subTree=zt,m(Ae,zt,u(Ae.el),ht(Ae),x,D,H),ot.el=zt.el,Ft===null&&Bm(x,zt.el),at&&ce(at,D),(Bt=ot.props&&ot.props.onVnodeUpdated)&&ce(()=>We(Bt,ft,ot,yt),D)}else{let ot;const{el:tt,props:at}=w,{bm:ft,m:yt,parent:Ft}=x,Bt=xn(w);if(Gs(x,!1),ft&&Oo(ft),!Bt&&(ot=at&&at.onVnodeBeforeMount)&&We(ot,Ft,w),Gs(x,!0),tt&&Pt){const zt=()=>{x.subTree=Bo(x),Pt(tt,x.subTree,x,D,null)};Bt?w.type.__asyncLoader().then(()=>!x.isUnmounted&&zt()):zt()}else{const zt=x.subTree=Bo(x);m(null,zt,A,M,x,D,H),w.el=zt.el}if(yt&&ce(yt,D),!Bt&&(ot=at&&at.onVnodeMounted)){const zt=w;ce(()=>We(ot,Ft,zt),D)}(w.shapeFlag&256||Ft&&xn(Ft.vnode)&&Ft.vnode.shapeFlag&256)&&x.a&&ce(x.a,D),x.isMounted=!0,w=A=M=null}},j=x.effect=new Rl($,()=>io(k),x.scope),k=x.update=()=>j.run();k.id=x.uid,Gs(x,!0),k()},G=(x,w,A)=>{w.component=x;const M=x.vnode.props;x.vnode=w,x.next=null,ng(x,w.props,M,A),lg(x,w.children,A),Xi(),Sh(),zi()},st=(x,w,A,M,D,H,K,$,j=!1)=>{const k=x&&x.children,ot=x?x.shapeFlag:0,tt=w.children,{patchFlag:at,shapeFlag:ft}=w;if(at>0){if(at&128){N(k,tt,A,M,D,H,K,$,j);return}else if(at&256){Ct(k,tt,A,M,D,H,K,$,j);return}}ft&8?(ot&16&&_t(k,D,H),tt!==k&&c(A,tt)):ot&16?ft&16?N(k,tt,A,M,D,H,K,$,j):_t(k,D,H,!0):(ot&8&&c(A,""),ft&16&&y(tt,A,M,D,H,K,$,j))},Ct=(x,w,A,M,D,H,K,$,j)=>{x=x||Si,w=w||Si;const k=x.length,ot=w.length,tt=Math.min(k,ot);let at;for(at=0;at<tt;at++){const ft=w[at]=j?ws(w[at]):Ve(w[at]);m(x[at],ft,A,null,D,H,K,$,j)}k>ot?_t(x,D,H,!0,!1,tt):y(w,A,M,D,H,K,$,j,tt)},N=(x,w,A,M,D,H,K,$,j)=>{let k=0;const ot=w.length;let tt=x.length-1,at=ot-1;for(;k<=tt&&k<=at;){const ft=x[k],yt=w[k]=j?ws(w[k]):Ve(w[k]);if(Ks(ft,yt))m(ft,yt,A,null,D,H,K,$,j);else break;k++}for(;k<=tt&&k<=at;){const ft=x[tt],yt=w[at]=j?ws(w[at]):Ve(w[at]);if(Ks(ft,yt))m(ft,yt,A,null,D,H,K,$,j);else break;tt--,at--}if(k>tt){if(k<=at){const ft=at+1,yt=ft<ot?w[ft].el:M;for(;k<=at;)m(null,w[k]=j?ws(w[k]):Ve(w[k]),A,yt,D,H,K,$,j),k++}}else if(k>at)for(;k<=tt;)Y(x[k],D,H,!0),k++;else{const ft=k,yt=k,Ft=new Map;for(k=yt;k<=at;k++){const pe=w[k]=j?ws(w[k]):Ve(w[k]);pe.key!=null&&Ft.set(pe.key,k)}let Bt,zt=0;const Ae=at-yt+1;let di=!1,ph=0;const Yi=new Array(Ae);for(k=0;k<Ae;k++)Yi[k]=0;for(k=ft;k<=tt;k++){const pe=x[k];if(zt>=Ae){Y(pe,D,H,!0);continue}let $e;if(pe.key!=null)$e=Ft.get(pe.key);else for(Bt=yt;Bt<=at;Bt++)if(Yi[Bt-yt]===0&&Ks(pe,w[Bt])){$e=Bt;break}$e===void 0?Y(pe,D,H,!0):(Yi[$e-yt]=k+1,$e>=ph?ph=$e:di=!0,m(pe,w[$e],A,null,D,H,K,$,j),zt++)}const mh=di?fg(Yi):Si;for(Bt=mh.length-1,k=Ae-1;k>=0;k--){const pe=yt+k,$e=w[pe],gh=pe+1<ot?w[pe+1].el:M;Yi[k]===0?m(null,$e,A,gh,D,H,K,$,j):di&&(Bt<0||k!==mh[Bt]?U($e,A,gh,2):Bt--)}}},U=(x,w,A,M,D=null)=>{const{el:H,type:K,transition:$,children:j,shapeFlag:k}=x;if(k&6){U(x.component.subTree,w,A,M);return}if(k&128){x.suspense.move(w,A,M);return}if(k&64){K.move(x,w,A,Lt);return}if(K===je){i(H,w,A);for(let tt=0;tt<j.length;tt++)U(j[tt],w,A,M);i(x.anchor,w,A);return}if(K===No){g(x,w,A);return}if(M!==2&&k&1&&$)if(M===0)$.beforeEnter(H),i(H,w,A),ce(()=>$.enter(H),D);else{const{leave:tt,delayLeave:at,afterLeave:ft}=$,yt=()=>i(H,w,A),Ft=()=>{tt(H,()=>{yt(),ft&&ft()})};at?at(H,yt,Ft):Ft()}else i(H,w,A)},Y=(x,w,A,M=!1,D=!1)=>{const{type:H,props:K,ref:$,children:j,dynamicChildren:k,shapeFlag:ot,patchFlag:tt,dirs:at}=x;if($!=null&&Oa($,null,A,x,!0),ot&256){w.ctx.deactivate(x);return}const ft=ot&1&&at,yt=!xn(x);let Ft;if(yt&&(Ft=K&&K.onVnodeBeforeUnmount)&&We(Ft,w,x),ot&6)dt(x.component,A,M);else{if(ot&128){x.suspense.unmount(A,M);return}ft&&ks(x,null,w,"beforeUnmount"),ot&64?x.type.remove(x,w,A,D,Lt,M):k&&(H!==je||tt>0&&tt&64)?_t(k,w,A,!1,!0):(H===je&&tt&384||!D&&ot&16)&&_t(j,w,A),M&&it(x)}(yt&&(Ft=K&&K.onVnodeUnmounted)||ft)&&ce(()=>{Ft&&We(Ft,w,x),ft&&ks(x,null,w,"unmounted")},A)},it=x=>{const{type:w,el:A,anchor:M,transition:D}=x;if(w===je){Q(A,M);return}if(w===No){E(x);return}const H=()=>{r(A),D&&!D.persisted&&D.afterLeave&&D.afterLeave()};if(x.shapeFlag&1&&D&&!D.persisted){const{leave:K,delayLeave:$}=D,j=()=>K(A,H);$?$(x.el,H,j):j()}else H()},Q=(x,w)=>{let A;for(;x!==w;)A=d(x),r(x),x=A;r(w)},dt=(x,w,A)=>{const{bum:M,scope:D,update:H,subTree:K,um:$}=x;M&&Oo(M),D.stop(),H&&(H.active=!1,Y(K,x,w,A)),$&&ce($,w),ce(()=>{x.isUnmounted=!0},w),w&&w.pendingBranch&&!w.isUnmounted&&x.asyncDep&&!x.asyncResolved&&x.suspenseId===w.pendingId&&(w.deps--,w.deps===0&&w.resolve())},_t=(x,w,A,M=!1,D=!1,H=0)=>{for(let K=H;K<x.length;K++)Y(x[K],w,A,M,D)},ht=x=>x.shapeFlag&6?ht(x.component.subTree):x.shapeFlag&128?x.suspense.next():d(x.anchor||x.el),vt=(x,w,A)=>{x==null?w._vnode&&Y(w._vnode,null,null,!0):m(w._vnode||null,x,w,null,null,null,A),Sh(),Qu(),w._vnode=x},Lt={p:m,um:Y,m:U,r:it,mt:P,mc:y,pc:st,pbc:B,n:ht,o:e};let Rt,Pt;return t&&([Rt,Pt]=t(Lt)),{render:vt,hydrate:Rt,createApp:cg(vt,Rt)}}function Gs({effect:e,update:t},s){e.allowRecurse=t.allowRecurse=s}function xd(e,t,s=!1){const i=e.children,r=t.children;if(mt(i)&&mt(r))for(let n=0;n<i.length;n++){const o=i[n];let a=r[n];a.shapeFlag&1&&!a.dynamicChildren&&((a.patchFlag<=0||a.patchFlag===32)&&(a=r[n]=ws(r[n]),a.el=o.el),s||xd(o,a)),a.type===ao&&(a.el=o.el)}}function fg(e){const t=e.slice(),s=[0];let i,r,n,o,a;const l=e.length;for(i=0;i<l;i++){const h=e[i];if(h!==0){if(r=s[s.length-1],e[r]<h){t[i]=r,s.push(i);continue}for(n=0,o=s.length-1;n<o;)a=n+o>>1,e[s[a]]<h?n=a+1:o=a;h<e[s[n]]&&(n>0&&(t[i]=s[n-1]),s[n]=i)}}for(n=s.length,o=s[n-1];n-- >0;)s[n]=o,o=t[o];return s}const pg=e=>e.__isTeleport,je=Symbol(void 0),ao=Symbol(void 0),Ne=Symbol(void 0),No=Symbol(void 0),mr=[];let De=null;function mg(e=!1){mr.push(De=e?null:[])}function gg(){mr.pop(),De=mr[mr.length-1]||null}let br=1;function Lh(e){br+=e}function vd(e){return e.dynamicChildren=br>0?De||Si:null,gg(),br>0&&De&&De.push(e),e}function Bw(e,t,s,i,r,n){return vd(Ed(e,t,s,i,r,n,!0))}function _g(e,t,s,i,r){return vd(ie(e,t,s,i,r,!0))}function Ba(e){return e?e.__v_isVNode===!0:!1}function Ks(e,t){return e.type===t.type&&e.key===t.key}const lo="__vInternal",yd=({key:e})=>e??null,vn=({ref:e,ref_key:t,ref_for:s})=>e!=null?Yt(e)||oe(e)||gt(e)?{i:ve,r:e,k:t,f:!!s}:e:null;function Ed(e,t=null,s=null,i=0,r=null,n=e===je?0:1,o=!1,a=!1){const l={__v_isVNode:!0,__v_skip:!0,type:e,props:t,key:t&&yd(t),ref:t&&vn(t),scopeId:no,slotScopeIds:null,children:s,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:n,patchFlag:i,dynamicProps:r,dynamicChildren:null,appContext:null,ctx:ve};return a?(Wl(l,s),n&128&&e.normalize(l)):s&&(l.shapeFlag|=Yt(s)?8:16),br>0&&!o&&De&&(l.patchFlag>0||n&6)&&l.patchFlag!==32&&De.push(l),l}const ie=xg;function xg(e,t=null,s=null,i=0,r=null,n=!1){if((!e||e===hd)&&(e=Ne),Ba(e)){const a=Bs(e,t,!0);return s&&Wl(a,s),br>0&&!n&&De&&(a.shapeFlag&6?De[De.indexOf(e)]=a:De.push(a)),a.patchFlag|=-2,a}if(Pg(e)&&(e=e.__vccOpts),t){t=vg(t);let{class:a,style:l}=t;a&&!Yt(a)&&(t.class=Tl(a)),kt(l)&&(Wu(l)&&!mt(l)&&(l=le({},l)),t.style=bl(l))}const o=Yt(e)?1:Dm(e)?128:pg(e)?64:kt(e)?4:gt(e)?2:0;return Ed(e,t,s,i,r,o,n,!0)}function vg(e){return e?Wu(e)||lo in e?le({},e):e:null}function Bs(e,t,s=!1){const{props:i,ref:r,patchFlag:n,children:o}=e,a=t?Eg(i||{},t):i;return{__v_isVNode:!0,__v_skip:!0,type:e.type,props:a,key:a&&yd(a),ref:t&&t.ref?s&&r?mt(r)?r.concat(vn(t)):[r,vn(t)]:vn(t):r,scopeId:e.scopeId,slotScopeIds:e.slotScopeIds,children:o,target:e.target,targetAnchor:e.targetAnchor,staticCount:e.staticCount,shapeFlag:e.shapeFlag,patchFlag:t&&e.type!==je?n===-1?16:n|16:n,dynamicProps:e.dynamicProps,dynamicChildren:e.dynamicChildren,appContext:e.appContext,dirs:e.dirs,transition:e.transition,component:e.component,suspense:e.suspense,ssContent:e.ssContent&&Bs(e.ssContent),ssFallback:e.ssFallback&&Bs(e.ssFallback),el:e.el,anchor:e.anchor,ctx:e.ctx,ce:e.ce}}function yg(e=" ",t=0){return ie(ao,null,e,t)}function Dw(e="",t=!1){return t?(mg(),_g(Ne,null,e)):ie(Ne,null,e)}function Ve(e){return e==null||typeof e=="boolean"?ie(Ne):mt(e)?ie(je,null,e.slice()):typeof e=="object"?ws(e):ie(ao,null,String(e))}function ws(e){return e.el===null&&e.patchFlag!==-1||e.memo?e:Bs(e)}function Wl(e,t){let s=0;const{shapeFlag:i}=e;if(t==null)t=null;else if(mt(t))s=16;else if(typeof t=="object")if(i&65){const r=t.default;r&&(r._c&&(r._d=!1),Wl(e,r()),r._c&&(r._d=!0));return}else{s=32;const r=t._;!r&&!(lo in t)?t._ctx=ve:r===3&&ve&&(ve.slots._===1?t._=1:(t._=2,e.patchFlag|=1024))}else gt(t)?(t={default:t,_ctx:ve},s=32):(t=String(t),i&64?(s=16,t=[yg(t)]):s=8);e.children=t,e.shapeFlag|=s}function Eg(...e){const t={};for(let s=0;s<e.length;s++){const i=e[s];for(const r in i)if(r==="class")t.class!==i.class&&(t.class=Tl([t.class,i.class]));else if(r==="style")t.style=bl([t.style,i.style]);else if(Jn(r)){const n=t[r],o=i[r];o&&n!==o&&!(mt(n)&&n.includes(o))&&(t[r]=n?[].concat(n,o):o)}else r!==""&&(t[r]=i[r])}return t}function We(e,t,s,i=null){we(e,t,7,[s,i])}const bg=_d();let Tg=0;function wg(e,t,s){const i=e.type,r=(t?t.appContext:e.appContext)||bg,n={uid:Tg++,vnode:e,type:i,parent:t,appContext:r,root:null,next:null,subTree:null,effect:null,update:null,scope:new Mu(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:t?t.provides:Object.create(r.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:fd(i,r),emitsOptions:ed(i,r),emit:null,emitted:null,propsDefaults:Nt,inheritAttrs:i.inheritAttrs,ctx:Nt,data:Nt,props:Nt,attrs:Nt,slots:Nt,refs:Nt,setupState:Nt,setupContext:null,suspense:s,suspenseId:s?s.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return n.ctx={_:n},n.root=t?t.root:n,n.emit=Im.bind(null,n),e.ce&&e.ce(n),n}let Xt=null;const bd=()=>Xt||ve,Ni=e=>{Xt=e,e.scope.on()},ti=()=>{Xt&&Xt.scope.off(),Xt=null};function Td(e){return e.vnode.shapeFlag&4}let Ui=!1;function Sg(e,t=!1){Ui=t;const{props:s,children:i}=e.vnode,r=Td(e);rg(e,s,r,t),ag(e,i);const n=r?Ag(e,t):void 0;return Ui=!1,n}function Ag(e,t){const s=e.type;e.accessCache=Object.create(null),e.proxy=Xu(new Proxy(e.ctx,Jm));const{setup:i}=s;if(i){const r=e.setupContext=i.length>1?Ig(e):null;Ni(e),Xi();const n=Ps(i,e,0,[e.props,r]);if(zi(),ti(),Iu(n)){if(n.then(ti,ti),t)return n.then(o=>{Fh(e,o,t)}).catch(o=>{Mr(o,e,0)});e.asyncDep=n}else Fh(e,n,t)}else wd(e,t)}function Fh(e,t,s){gt(t)?e.type.__ssrInlineRender?e.ssrRender=t:e.render=t:kt(t)&&(e.setupState=Ku(t)),wd(e,s)}let Nh;function wd(e,t,s){const i=e.type;if(!e.render){if(!t&&Nh&&!i.render){const r=i.template||Hl(e).template;if(r){const{isCustomElement:n,compilerOptions:o}=e.appContext.config,{delimiters:a,compilerOptions:l}=i,h=le(le({isCustomElement:n,delimiters:a},o),l);i.render=Nh(r,h)}}e.render=i.render||Fe}Ni(e),Xi(),Qm(e),zi(),ti()}function Cg(e){return new Proxy(e.attrs,{get(t,s){return de(e,"get","$attrs"),t[s]}})}function Ig(e){const t=i=>{e.exposed=i||{}};let s;return{get attrs(){return s||(s=Cg(e))},slots:e.slots,emit:e.emit,expose:t}}function ho(e){if(e.exposed)return e.exposeProxy||(e.exposeProxy=new Proxy(Ku(Xu(e.exposed)),{get(t,s){if(s in t)return t[s];if(s in pr)return pr[s](e)},has(t,s){return s in t||s in pr}}))}function Rg(e,t=!0){return gt(e)?e.displayName||e.name:e.name||t&&e.__name}function Pg(e){return gt(e)&&"__vccOpts"in e}const Mg=(e,t)=>bm(e,t,Ui);function Lw(e,t,s){const i=arguments.length;return i===2?kt(t)&&!mt(t)?Ba(t)?ie(e,null,[t]):ie(e,t):ie(e,null,t):(i>3?s=Array.prototype.slice.call(arguments,2):i===3&&Ba(s)&&(s=[s]),ie(e,t,s))}const Og=Symbol(""),Bg=()=>_n(Og),Dg="3.2.47",Lg="http://www.w3.org/2000/svg",qs=typeof document<"u"?document:null,Uh=qs&&qs.createElement("template"),Fg={insert:(e,t,s)=>{t.insertBefore(e,s||null)},remove:e=>{const t=e.parentNode;t&&t.removeChild(e)},createElement:(e,t,s,i)=>{const r=t?qs.createElementNS(Lg,e):qs.createElement(e,s?{is:s}:void 0);return e==="select"&&i&&i.multiple!=null&&r.setAttribute("multiple",i.multiple),r},createText:e=>qs.createTextNode(e),createComment:e=>qs.createComment(e),setText:(e,t)=>{e.nodeValue=t},setElementText:(e,t)=>{e.textContent=t},parentNode:e=>e.parentNode,nextSibling:e=>e.nextSibling,querySelector:e=>qs.querySelector(e),setScopeId(e,t){e.setAttribute(t,"")},insertStaticContent(e,t,s,i,r,n){const o=s?s.previousSibling:t.lastChild;if(r&&(r===n||r.nextSibling))for(;t.insertBefore(r.cloneNode(!0),s),!(r===n||!(r=r.nextSibling)););else{Uh.innerHTML=i?`<svg>${e}</svg>`:e;const a=Uh.content;if(i){const l=a.firstChild;for(;l.firstChild;)a.appendChild(l.firstChild);a.removeChild(l)}t.insertBefore(a,s)}return[o?o.nextSibling:t.firstChild,s?s.previousSibling:t.lastChild]}};function Ng(e,t,s){const i=e._vtc;i&&(t=(t?[t,...i]:[...i]).join(" ")),t==null?e.removeAttribute("class"):s?e.setAttribute("class",t):e.className=t}function Ug(e,t,s){const i=e.style,r=Yt(s);if(s&&!r){if(t&&!Yt(t))for(const n in t)s[n]==null&&Da(i,n,"");for(const n in s)Da(i,n,s[n])}else{const n=i.display;r?t!==s&&(i.cssText=s):t&&e.removeAttribute("style"),"_vod"in e&&(i.display=n)}}const kh=/\s*!important$/;function Da(e,t,s){if(mt(s))s.forEach(i=>Da(e,t,i));else if(s==null&&(s=""),t.startsWith("--"))e.setProperty(t,s);else{const i=kg(e,t);kh.test(s)?e.setProperty(Wi(i),s.replace(kh,""),"important"):e[i]=s}}const Gh=["Webkit","Moz","ms"],Uo={};function kg(e,t){const s=Uo[t];if(s)return s;let i=ss(t);if(i!=="filter"&&i in e)return Uo[t]=i;i=eo(i);for(let r=0;r<Gh.length;r++){const n=Gh[r]+i;if(n in e)return Uo[t]=n}return t}const Hh="http://www.w3.org/1999/xlink";function Gg(e,t,s,i,r){if(i&&t.startsWith("xlink:"))s==null?e.removeAttributeNS(Hh,t.slice(6,t.length)):e.setAttributeNS(Hh,t,s);else{const n=Bp(t);s==null||n&&!Su(s)?e.removeAttribute(t):e.setAttribute(t,n?"":s)}}function Hg(e,t,s,i,r,n,o){if(t==="innerHTML"||t==="textContent"){i&&o(i,r,n),e[t]=s??"";return}if(t==="value"&&e.tagName!=="PROGRESS"&&!e.tagName.includes("-")){e._value=s;const l=s??"";(e.value!==l||e.tagName==="OPTION")&&(e.value=l),s==null&&e.removeAttribute(t);return}let a=!1;if(s===""||s==null){const l=typeof e[t];l==="boolean"?s=Su(s):s==null&&l==="string"?(s="",a=!0):l==="number"&&(s=0,a=!0)}try{e[t]=s}catch{}a&&e.removeAttribute(t)}function $g(e,t,s,i){e.addEventListener(t,s,i)}function Wg(e,t,s,i){e.removeEventListener(t,s,i)}function Xg(e,t,s,i,r=null){const n=e._vei||(e._vei={}),o=n[t];if(i&&o)o.value=i;else{const[a,l]=zg(t);if(i){const h=n[t]=Yg(i,r);$g(e,a,h,l)}else o&&(Wg(e,a,o,l),n[t]=void 0)}}const $h=/(?:Once|Passive|Capture)$/;function zg(e){let t;if($h.test(e)){t={};let i;for(;i=e.match($h);)e=e.slice(0,e.length-i[0].length),t[i[0].toLowerCase()]=!0}return[e[2]===":"?e.slice(3):Wi(e.slice(2)),t]}let ko=0;const jg=Promise.resolve(),Vg=()=>ko||(jg.then(()=>ko=0),ko=Date.now());function Yg(e,t){const s=i=>{if(!i._vts)i._vts=Date.now();else if(i._vts<=s.attached)return;we(Kg(i,s.value),t,5,[i])};return s.value=e,s.attached=Vg(),s}function Kg(e,t){if(mt(t)){const s=e.stopImmediatePropagation;return e.stopImmediatePropagation=()=>{s.call(e),e._stopped=!0},t.map(i=>r=>!r._stopped&&i&&i(r))}else return t}const Wh=/^on[a-z]/,qg=(e,t,s,i,r=!1,n,o,a,l)=>{t==="class"?Ng(e,i,r):t==="style"?Ug(e,s,i):Jn(t)?wl(t)||Xg(e,t,s,i,o):(t[0]==="."?(t=t.slice(1),!0):t[0]==="^"?(t=t.slice(1),!1):Zg(e,t,i,r))?Hg(e,t,i,n,o,a,l):(t==="true-value"?e._trueValue=i:t==="false-value"&&(e._falseValue=i),Gg(e,t,i,r))};function Zg(e,t,s,i){return i?!!(t==="innerHTML"||t==="textContent"||t in e&&Wh.test(t)&&gt(s)):t==="spellcheck"||t==="draggable"||t==="translate"||t==="form"||t==="list"&&e.tagName==="INPUT"||t==="type"&&e.tagName==="TEXTAREA"||Wh.test(t)&&Yt(s)?!1:t in e}const Jg={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String};Gm.props;const Qg=["ctrl","shift","alt","meta"],t_={stop:e=>e.stopPropagation(),prevent:e=>e.preventDefault(),self:e=>e.target!==e.currentTarget,ctrl:e=>!e.ctrlKey,shift:e=>!e.shiftKey,alt:e=>!e.altKey,meta:e=>!e.metaKey,left:e=>"button"in e&&e.button!==0,middle:e=>"button"in e&&e.button!==1,right:e=>"button"in e&&e.button!==2,exact:(e,t)=>Qg.some(s=>e[`${s}Key`]&&!t.includes(s))},Fw=(e,t)=>(s,...i)=>{for(let r=0;r<t.length;r++){const n=t_[t[r]];if(n&&n(s,t))return}return e(s,...i)},Nw={beforeMount(e,{value:t},{transition:s}){e._vod=e.style.display==="none"?"":e.style.display,s&&t?s.beforeEnter(e):Ki(e,t)},mounted(e,{value:t},{transition:s}){s&&t&&s.enter(e)},updated(e,{value:t,oldValue:s},{transition:i}){!t!=!s&&(i?t?(i.beforeEnter(e),Ki(e,!0),i.enter(e)):i.leave(e,()=>{Ki(e,!1)}):Ki(e,t))},beforeUnmount(e,{value:t}){Ki(e,t)}};function Ki(e,t){e.style.display=t?e._vod:"none"}const e_=le({patchProp:qg},Fg);let Xh;function s_(){return Xh||(Xh=ug(e_))}const Uw=(...e)=>{const t=s_().createApp(...e),{mount:s}=t;return t.mount=i=>{const r=i_(i);if(!r)return;const n=t._component;!gt(n)&&!n.render&&!n.template&&(n.template=r.innerHTML),r.innerHTML="";const o=s(r,!1,r instanceof SVGElement);return r instanceof Element&&(r.removeAttribute("v-cloak"),r.setAttribute("data-v-app","")),o},t};function i_(e){return Yt(e)?document.querySelector(e):e}function r_(e){return Ou()?(Xp(e),!0):!1}function kw(e){let t=!1,s;const i=$p(!0);return(...r)=>(t||(s=i.run(()=>e(...r)),t=!0),s)}function Xl(e){return typeof e=="function"?e():Yu(e)}const n_=typeof window<"u",o_=()=>{};function a_(e,t){function s(...i){return new Promise((r,n)=>{Promise.resolve(e(()=>t.apply(this,i),{fn:t,thisArg:this,args:i})).then(r).catch(n)})}return s}const Sd=e=>e();function l_(e=Sd){const t=dr(!0);function s(){t.value=!1}function i(){t.value=!0}const r=(...n)=>{t.value&&e(...n)};return{isActive:Dl(t),pause:s,resume:i,eventFilter:r}}function Gw(e,t=!0){bd()?kl(e):t?e():Ul(e)}var zh=Object.getOwnPropertySymbols,h_=Object.prototype.hasOwnProperty,c_=Object.prototype.propertyIsEnumerable,u_=(e,t)=>{var s={};for(var i in e)h_.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(e!=null&&zh)for(var i of zh(e))t.indexOf(i)<0&&c_.call(e,i)&&(s[i]=e[i]);return s};function d_(e,t,s={}){const i=s,{eventFilter:r=Sd}=i,n=u_(i,["eventFilter"]);return fr(e,a_(r,t),n)}var f_=Object.defineProperty,p_=Object.defineProperties,m_=Object.getOwnPropertyDescriptors,Dn=Object.getOwnPropertySymbols,Ad=Object.prototype.hasOwnProperty,Cd=Object.prototype.propertyIsEnumerable,jh=(e,t,s)=>t in e?f_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,g_=(e,t)=>{for(var s in t||(t={}))Ad.call(t,s)&&jh(e,s,t[s]);if(Dn)for(var s of Dn(t))Cd.call(t,s)&&jh(e,s,t[s]);return e},__=(e,t)=>p_(e,m_(t)),x_=(e,t)=>{var s={};for(var i in e)Ad.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(e!=null&&Dn)for(var i of Dn(e))t.indexOf(i)<0&&Cd.call(e,i)&&(s[i]=e[i]);return s};function v_(e,t,s={}){const i=s,{eventFilter:r}=i,n=x_(i,["eventFilter"]),{eventFilter:o,pause:a,resume:l,isActive:h}=l_(r);return{stop:d_(e,t,__(g_({},n),{eventFilter:o})),pause:a,resume:l,isActive:h}}function y_(e){var t;const s=Xl(e);return(t=s==null?void 0:s.$el)!=null?t:s}const Ln=n_?window:void 0;function Vh(...e){let t,s,i,r;if(typeof e[0]=="string"||Array.isArray(e[0])?([s,i,r]=e,t=Ln):[t,s,i,r]=e,!t)return o_;Array.isArray(s)||(s=[s]),Array.isArray(i)||(i=[i]);const n=[],o=()=>{n.forEach(c=>c()),n.length=0},a=(c,u,d,p)=>(c.addEventListener(u,d,p),()=>c.removeEventListener(u,d,p)),l=fr(()=>[y_(t),Xl(r)],([c,u])=>{o(),c&&n.push(...s.flatMap(d=>i.map(p=>a(c,d,p,u))))},{immediate:!0,flush:"post"}),h=()=>{l(),o()};return r_(h),h}const Xr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},zr="__vueuse_ssr_handlers__",E_=b_();function b_(){return zr in Xr||(Xr[zr]=Xr[zr]||{}),Xr[zr]}function T_(e,t){return E_[e]||t}function w_(e){return e==null?"any":e instanceof Set?"set":e instanceof Map?"map":e instanceof Date?"date":typeof e=="boolean"?"boolean":typeof e=="string"?"string":typeof e=="object"?"object":Number.isNaN(e)?"any":"number"}var S_=Object.defineProperty,Yh=Object.getOwnPropertySymbols,A_=Object.prototype.hasOwnProperty,C_=Object.prototype.propertyIsEnumerable,Kh=(e,t,s)=>t in e?S_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,qh=(e,t)=>{for(var s in t||(t={}))A_.call(t,s)&&Kh(e,s,t[s]);if(Yh)for(var s of Yh(t))C_.call(t,s)&&Kh(e,s,t[s]);return e};const I_={boolean:{read:e=>e==="true",write:e=>String(e)},object:{read:e=>JSON.parse(e),write:e=>JSON.stringify(e)},number:{read:e=>Number.parseFloat(e),write:e=>String(e)},any:{read:e=>e,write:e=>String(e)},string:{read:e=>e,write:e=>String(e)},map:{read:e=>new Map(JSON.parse(e)),write:e=>JSON.stringify(Array.from(e.entries()))},set:{read:e=>new Set(JSON.parse(e)),write:e=>JSON.stringify(Array.from(e))},date:{read:e=>new Date(e),write:e=>e.toISOString()}},Zh="vueuse-storage";function R_(e,t,s,i={}){var r;const{flush:n="pre",deep:o=!0,listenToStorageChanges:a=!0,writeDefaults:l=!0,mergeDefaults:h=!1,shallow:c,window:u=Ln,eventFilter:d,onError:p=y=>{console.error(y)}}=i,f=(c?xm:dr)(t);if(!s)try{s=T_("getDefaultStorage",()=>{var y;return(y=Ln)==null?void 0:y.localStorage})()}catch(y){p(y)}if(!s)return f;const m=Xl(t),_=w_(m),v=(r=i.serializer)!=null?r:I_[_],{pause:b,resume:g}=v_(f,()=>E(f.value),{flush:n,deep:o,eventFilter:d});return u&&a&&(Vh(u,"storage",T),Vh(u,Zh,C)),T(),f;function E(y){try{if(y==null)s.removeItem(e);else{const I=v.write(y),B=s.getItem(e);B!==I&&(s.setItem(e,I),u&&u.dispatchEvent(new CustomEvent(Zh,{detail:{key:e,oldValue:B,newValue:I,storageArea:s}})))}}catch(I){p(I)}}function S(y){const I=y?y.newValue:s.getItem(e);if(I==null)return l&&m!==null&&s.setItem(e,v.write(m)),m;if(!y&&h){const B=v.read(I);return typeof h=="function"?h(B,m):_==="object"&&!Array.isArray(B)?qh(qh({},m),B):B}else return typeof I!="string"?I:v.read(I)}function C(y){T(y.detail)}function T(y){if(!(y&&y.storageArea!==s)){if(y&&y.key==null){f.value=m;return}if(!(y&&y.key!==e)){b();try{f.value=S(y)}catch(I){p(I)}finally{y?Ul(g):g()}}}}}function Hw(e,t,s={}){const{window:i=Ln}=s;return R_(e,t,i==null?void 0:i.sessionStorage,s)}var li=(e=>(e[e.WEBGL_LEGACY=0]="WEBGL_LEGACY",e[e.WEBGL=1]="WEBGL",e[e.WEBGL2=2]="WEBGL2",e))(li||{}),Id=(e=>(e[e.UNKNOWN=0]="UNKNOWN",e[e.WEBGL=1]="WEBGL",e[e.CANVAS=2]="CANVAS",e))(Id||{}),La=(e=>(e[e.COLOR=16384]="COLOR",e[e.DEPTH=256]="DEPTH",e[e.STENCIL=1024]="STENCIL",e))(La||{}),ct=(e=>(e[e.NORMAL=0]="NORMAL",e[e.ADD=1]="ADD",e[e.MULTIPLY=2]="MULTIPLY",e[e.SCREEN=3]="SCREEN",e[e.OVERLAY=4]="OVERLAY",e[e.DARKEN=5]="DARKEN",e[e.LIGHTEN=6]="LIGHTEN",e[e.COLOR_DODGE=7]="COLOR_DODGE",e[e.COLOR_BURN=8]="COLOR_BURN",e[e.HARD_LIGHT=9]="HARD_LIGHT",e[e.SOFT_LIGHT=10]="SOFT_LIGHT",e[e.DIFFERENCE=11]="DIFFERENCE",e[e.EXCLUSION=12]="EXCLUSION",e[e.HUE=13]="HUE",e[e.SATURATION=14]="SATURATION",e[e.COLOR=15]="COLOR",e[e.LUMINOSITY=16]="LUMINOSITY",e[e.NORMAL_NPM=17]="NORMAL_NPM",e[e.ADD_NPM=18]="ADD_NPM",e[e.SCREEN_NPM=19]="SCREEN_NPM",e[e.NONE=20]="NONE",e[e.SRC_OVER=0]="SRC_OVER",e[e.SRC_IN=21]="SRC_IN",e[e.SRC_OUT=22]="SRC_OUT",e[e.SRC_ATOP=23]="SRC_ATOP",e[e.DST_OVER=24]="DST_OVER",e[e.DST_IN=25]="DST_IN",e[e.DST_OUT=26]="DST_OUT",e[e.DST_ATOP=27]="DST_ATOP",e[e.ERASE=26]="ERASE",e[e.SUBTRACT=28]="SUBTRACT",e[e.XOR=29]="XOR",e))(ct||{}),Je=(e=>(e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e))(Je||{}),X=(e=>(e[e.RGBA=6408]="RGBA",e[e.RGB=6407]="RGB",e[e.RG=33319]="RG",e[e.RED=6403]="RED",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.ALPHA=6406]="ALPHA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e))(X||{}),Ri=(e=>(e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e))(Ri||{}),lt=(e=>(e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.BYTE=5120]="BYTE",e[e.SHORT=5122]="SHORT",e[e.INT=5124]="INT",e[e.FLOAT=5126]="FLOAT",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",e[e.HALF_FLOAT=36193]="HALF_FLOAT",e))(lt||{}),Fa=(e=>(e[e.FLOAT=0]="FLOAT",e[e.INT=1]="INT",e[e.UINT=2]="UINT",e))(Fa||{}),us=(e=>(e[e.NEAREST=0]="NEAREST",e[e.LINEAR=1]="LINEAR",e))(us||{}),Ms=(e=>(e[e.CLAMP=33071]="CLAMP",e[e.REPEAT=10497]="REPEAT",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e))(Ms||{}),is=(e=>(e[e.OFF=0]="OFF",e[e.POW2=1]="POW2",e[e.ON=2]="ON",e[e.ON_MANUAL=3]="ON_MANUAL",e))(is||{}),He=(e=>(e[e.NPM=0]="NPM",e[e.UNPACK=1]="UNPACK",e[e.PMA=2]="PMA",e[e.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",e[e.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",e[e.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",e))(He||{}),Ye=(e=>(e[e.NO=0]="NO",e[e.YES=1]="YES",e[e.AUTO=2]="AUTO",e[e.BLEND=0]="BLEND",e[e.CLEAR=1]="CLEAR",e[e.BLIT=2]="BLIT",e))(Ye||{}),co=(e=>(e[e.AUTO=0]="AUTO",e[e.MANUAL=1]="MANUAL",e))(co||{}),be=(e=>(e.LOW="lowp",e.MEDIUM="mediump",e.HIGH="highp",e))(be||{}),Kt=(e=>(e[e.NONE=0]="NONE",e[e.SCISSOR=1]="SCISSOR",e[e.STENCIL=2]="STENCIL",e[e.SPRITE=3]="SPRITE",e[e.COLOR=4]="COLOR",e))(Kt||{}),jt=(e=>(e[e.NONE=0]="NONE",e[e.LOW=2]="LOW",e[e.MEDIUM=4]="MEDIUM",e[e.HIGH=8]="HIGH",e))(jt||{}),ts=(e=>(e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e))(ts||{});const P_={createCanvas:(e,t)=>{const s=document.createElement("canvas");return s.width=e,s.height=t,s},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(e,t)=>fetch(e,t),parseXML:e=>new DOMParser().parseFromString(e,"text/xml")},q={ADAPTER:P_,RESOLUTION:1,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var Go=/iPhone/i,Jh=/iPod/i,Qh=/iPad/i,tc=/\biOS-universal(?:.+)Mac\b/i,Ho=/\bAndroid(?:.+)Mobile\b/i,ec=/Android/i,fi=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,jr=/Silk/i,os=/Windows Phone/i,sc=/\bWindows(?:.+)ARM\b/i,ic=/BlackBerry/i,rc=/BB10/i,nc=/Opera Mini/i,oc=/\b(CriOS|Chrome)(?:.+)Mobile/i,ac=/Mobile(?:.+)Firefox\b/i,lc=function(e){return typeof e<"u"&&e.platform==="MacIntel"&&typeof e.maxTouchPoints=="number"&&e.maxTouchPoints>1&&typeof MSStream>"u"};function M_(e){return function(t){return t.test(e)}}function hc(e){var t={userAgent:"",platform:"",maxTouchPoints:0};!e&&typeof navigator<"u"?t={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof e=="string"?t.userAgent=e:e&&e.userAgent&&(t={userAgent:e.userAgent,platform:e.platform,maxTouchPoints:e.maxTouchPoints||0});var s=t.userAgent,i=s.split("[FBAN");typeof i[1]<"u"&&(s=i[0]),i=s.split("Twitter"),typeof i[1]<"u"&&(s=i[0]);var r=M_(s),n={apple:{phone:r(Go)&&!r(os),ipod:r(Jh),tablet:!r(Go)&&(r(Qh)||lc(t))&&!r(os),universal:r(tc),device:(r(Go)||r(Jh)||r(Qh)||r(tc)||lc(t))&&!r(os)},amazon:{phone:r(fi),tablet:!r(fi)&&r(jr),device:r(fi)||r(jr)},android:{phone:!r(os)&&r(fi)||!r(os)&&r(Ho),tablet:!r(os)&&!r(fi)&&!r(Ho)&&(r(jr)||r(ec)),device:!r(os)&&(r(fi)||r(jr)||r(Ho)||r(ec))||r(/\bokhttp\b/i)},windows:{phone:r(os),tablet:r(sc),device:r(os)||r(sc)},other:{blackberry:r(ic),blackberry10:r(rc),opera:r(nc),firefox:r(ac),chrome:r(oc),device:r(ic)||r(rc)||r(nc)||r(ac)||r(oc)},any:!1,phone:!1,tablet:!1};return n.any=n.apple.device||n.android.device||n.windows.device||n.other.device,n.phone=n.apple.phone||n.android.phone||n.windows.phone,n.tablet=n.apple.tablet||n.android.tablet||n.windows.tablet,n}const O_=hc.default??hc,ds=O_(globalThis.navigator);q.RETINA_PREFIX=/@([0-9\.]+)x/;q.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var $o=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},ii={},B_={get exports(){return ii},set exports(e){ii=e}};(function(e){var t=Object.prototype.hasOwnProperty,s="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(s=!1));function r(l,h,c){this.fn=l,this.context=h,this.once=c||!1}function n(l,h,c,u,d){if(typeof c!="function")throw new TypeError("The listener must be a function");var p=new r(c,u||l,d),f=s?s+h:h;return l._events[f]?l._events[f].fn?l._events[f]=[l._events[f],p]:l._events[f].push(p):(l._events[f]=p,l._eventsCount++),l}function o(l,h){--l._eventsCount===0?l._events=new i:delete l._events[h]}function a(){this._events=new i,this._eventsCount=0}a.prototype.eventNames=function(){var h=[],c,u;if(this._eventsCount===0)return h;for(u in c=this._events)t.call(c,u)&&h.push(s?u.slice(1):u);return Object.getOwnPropertySymbols?h.concat(Object.getOwnPropertySymbols(c)):h},a.prototype.listeners=function(h){var c=s?s+h:h,u=this._events[c];if(!u)return[];if(u.fn)return[u.fn];for(var d=0,p=u.length,f=new Array(p);d<p;d++)f[d]=u[d].fn;return f},a.prototype.listenerCount=function(h){var c=s?s+h:h,u=this._events[c];return u?u.fn?1:u.length:0},a.prototype.emit=function(h,c,u,d,p,f){var m=s?s+h:h;if(!this._events[m])return!1;var _=this._events[m],v=arguments.length,b,g;if(_.fn){switch(_.once&&this.removeListener(h,_.fn,void 0,!0),v){case 1:return _.fn.call(_.context),!0;case 2:return _.fn.call(_.context,c),!0;case 3:return _.fn.call(_.context,c,u),!0;case 4:return _.fn.call(_.context,c,u,d),!0;case 5:return _.fn.call(_.context,c,u,d,p),!0;case 6:return _.fn.call(_.context,c,u,d,p,f),!0}for(g=1,b=new Array(v-1);g<v;g++)b[g-1]=arguments[g];_.fn.apply(_.context,b)}else{var E=_.length,S;for(g=0;g<E;g++)switch(_[g].once&&this.removeListener(h,_[g].fn,void 0,!0),v){case 1:_[g].fn.call(_[g].context);break;case 2:_[g].fn.call(_[g].context,c);break;case 3:_[g].fn.call(_[g].context,c,u);break;case 4:_[g].fn.call(_[g].context,c,u,d);break;default:if(!b)for(S=1,b=new Array(v-1);S<v;S++)b[S-1]=arguments[S];_[g].fn.apply(_[g].context,b)}}return!0},a.prototype.on=function(h,c,u){return n(this,h,c,u,!1)},a.prototype.once=function(h,c,u){return n(this,h,c,u,!0)},a.prototype.removeListener=function(h,c,u,d){var p=s?s+h:h;if(!this._events[p])return this;if(!c)return o(this,p),this;var f=this._events[p];if(f.fn)f.fn===c&&(!d||f.once)&&(!u||f.context===u)&&o(this,p);else{for(var m=0,_=[],v=f.length;m<v;m++)(f[m].fn!==c||d&&!f[m].once||u&&f[m].context!==u)&&_.push(f[m]);_.length?this._events[p]=_.length===1?_[0]:_:o(this,p)}return this},a.prototype.removeAllListeners=function(h){var c;return h?(c=s?s+h:h,this._events[c]&&o(this,c)):(this._events=new i,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=s,a.EventEmitter=a,e.exports=a})(B_);var Fn={},D_={get exports(){return Fn},set exports(e){Fn=e}};D_.exports=uo;Fn.default=uo;function uo(e,t,s){s=s||2;var i=t&&t.length,r=i?t[0]*s:e.length,n=Rd(e,0,r,s,!0),o=[];if(!n||n.next===n.prev)return o;var a,l,h,c,u,d,p;if(i&&(n=k_(e,t,n,s)),e.length>80*s){a=h=e[0],l=c=e[1];for(var f=s;f<r;f+=s)u=e[f],d=e[f+1],u<a&&(a=u),d<l&&(l=d),u>h&&(h=u),d>c&&(c=d);p=Math.max(h-a,c-l),p=p!==0?32767/p:0}return Tr(n,o,s,a,l,p,0),o}function Rd(e,t,s,i,r){var n,o;if(r===ka(e,t,s,i)>0)for(n=t;n<s;n+=i)o=cc(n,e[n],e[n+1],o);else for(n=s-i;n>=t;n-=i)o=cc(n,e[n],e[n+1],o);return o&&fo(o,o.next)&&(Sr(o),o=o.next),o}function ri(e,t){if(!e)return e;t||(t=e);var s=e,i;do if(i=!1,!s.steiner&&(fo(s,s.next)||$t(s.prev,s,s.next)===0)){if(Sr(s),s=t=s.prev,s===s.next)break;i=!0}else s=s.next;while(i||s!==t);return t}function Tr(e,t,s,i,r,n,o){if(e){!o&&n&&X_(e,i,r,n);for(var a=e,l,h;e.prev!==e.next;){if(l=e.prev,h=e.next,n?F_(e,i,r,n):L_(e)){t.push(l.i/s|0),t.push(e.i/s|0),t.push(h.i/s|0),Sr(e),e=h.next,a=h.next;continue}if(e=h,e===a){o?o===1?(e=N_(ri(e),t,s),Tr(e,t,s,i,r,n,2)):o===2&&U_(e,t,s,i,r,n):Tr(ri(e),t,s,i,r,n,1);break}}}}function L_(e){var t=e.prev,s=e,i=e.next;if($t(t,s,i)>=0)return!1;for(var r=t.x,n=s.x,o=i.x,a=t.y,l=s.y,h=i.y,c=r<n?r<o?r:o:n<o?n:o,u=a<l?a<h?a:h:l<h?l:h,d=r>n?r>o?r:o:n>o?n:o,p=a>l?a>h?a:h:l>h?l:h,f=i.next;f!==t;){if(f.x>=c&&f.x<=d&&f.y>=u&&f.y<=p&&bi(r,a,n,l,o,h,f.x,f.y)&&$t(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function F_(e,t,s,i){var r=e.prev,n=e,o=e.next;if($t(r,n,o)>=0)return!1;for(var a=r.x,l=n.x,h=o.x,c=r.y,u=n.y,d=o.y,p=a<l?a<h?a:h:l<h?l:h,f=c<u?c<d?c:d:u<d?u:d,m=a>l?a>h?a:h:l>h?l:h,_=c>u?c>d?c:d:u>d?u:d,v=Na(p,f,t,s,i),b=Na(m,_,t,s,i),g=e.prevZ,E=e.nextZ;g&&g.z>=v&&E&&E.z<=b;){if(g.x>=p&&g.x<=m&&g.y>=f&&g.y<=_&&g!==r&&g!==o&&bi(a,c,l,u,h,d,g.x,g.y)&&$t(g.prev,g,g.next)>=0||(g=g.prevZ,E.x>=p&&E.x<=m&&E.y>=f&&E.y<=_&&E!==r&&E!==o&&bi(a,c,l,u,h,d,E.x,E.y)&&$t(E.prev,E,E.next)>=0))return!1;E=E.nextZ}for(;g&&g.z>=v;){if(g.x>=p&&g.x<=m&&g.y>=f&&g.y<=_&&g!==r&&g!==o&&bi(a,c,l,u,h,d,g.x,g.y)&&$t(g.prev,g,g.next)>=0)return!1;g=g.prevZ}for(;E&&E.z<=b;){if(E.x>=p&&E.x<=m&&E.y>=f&&E.y<=_&&E!==r&&E!==o&&bi(a,c,l,u,h,d,E.x,E.y)&&$t(E.prev,E,E.next)>=0)return!1;E=E.nextZ}return!0}function N_(e,t,s){var i=e;do{var r=i.prev,n=i.next.next;!fo(r,n)&&Pd(r,i,i.next,n)&&wr(r,n)&&wr(n,r)&&(t.push(r.i/s|0),t.push(i.i/s|0),t.push(n.i/s|0),Sr(i),Sr(i.next),i=e=n),i=i.next}while(i!==e);return ri(i)}function U_(e,t,s,i,r,n){var o=e;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&V_(o,a)){var l=Md(o,a);o=ri(o,o.next),l=ri(l,l.next),Tr(o,t,s,i,r,n,0),Tr(l,t,s,i,r,n,0);return}a=a.next}o=o.next}while(o!==e)}function k_(e,t,s,i){var r=[],n,o,a,l,h;for(n=0,o=t.length;n<o;n++)a=t[n]*i,l=n<o-1?t[n+1]*i:e.length,h=Rd(e,a,l,i,!1),h===h.next&&(h.steiner=!0),r.push(j_(h));for(r.sort(G_),n=0;n<r.length;n++)s=H_(r[n],s);return s}function G_(e,t){return e.x-t.x}function H_(e,t){var s=$_(e,t);if(!s)return t;var i=Md(s,e);return ri(i,i.next),ri(s,s.next)}function $_(e,t){var s=t,i=e.x,r=e.y,n=-1/0,o;do{if(r<=s.y&&r>=s.next.y&&s.next.y!==s.y){var a=s.x+(r-s.y)*(s.next.x-s.x)/(s.next.y-s.y);if(a<=i&&a>n&&(n=a,o=s.x<s.next.x?s:s.next,a===i))return o}s=s.next}while(s!==t);if(!o)return null;var l=o,h=o.x,c=o.y,u=1/0,d;s=o;do i>=s.x&&s.x>=h&&i!==s.x&&bi(r<c?i:n,r,h,c,r<c?n:i,r,s.x,s.y)&&(d=Math.abs(r-s.y)/(i-s.x),wr(s,e)&&(d<u||d===u&&(s.x>o.x||s.x===o.x&&W_(o,s)))&&(o=s,u=d)),s=s.next;while(s!==l);return o}function W_(e,t){return $t(e.prev,e,t.prev)<0&&$t(t.next,e,e.next)<0}function X_(e,t,s,i){var r=e;do r.z===0&&(r.z=Na(r.x,r.y,t,s,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,z_(r)}function z_(e){var t,s,i,r,n,o,a,l,h=1;do{for(s=e,e=null,n=null,o=0;s;){for(o++,i=s,a=0,t=0;t<h&&(a++,i=i.nextZ,!!i);t++);for(l=h;a>0||l>0&&i;)a!==0&&(l===0||!i||s.z<=i.z)?(r=s,s=s.nextZ,a--):(r=i,i=i.nextZ,l--),n?n.nextZ=r:e=r,r.prevZ=n,n=r;s=i}n.nextZ=null,h*=2}while(o>1);return e}function Na(e,t,s,i,r){return e=(e-s)*r|0,t=(t-i)*r|0,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e|t<<1}function j_(e){var t=e,s=e;do(t.x<s.x||t.x===s.x&&t.y<s.y)&&(s=t),t=t.next;while(t!==e);return s}function bi(e,t,s,i,r,n,o,a){return(r-o)*(t-a)>=(e-o)*(n-a)&&(e-o)*(i-a)>=(s-o)*(t-a)&&(s-o)*(n-a)>=(r-o)*(i-a)}function V_(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!Y_(e,t)&&(wr(e,t)&&wr(t,e)&&K_(e,t)&&($t(e.prev,e,t.prev)||$t(e,t.prev,t))||fo(e,t)&&$t(e.prev,e,e.next)>0&&$t(t.prev,t,t.next)>0)}function $t(e,t,s){return(t.y-e.y)*(s.x-t.x)-(t.x-e.x)*(s.y-t.y)}function fo(e,t){return e.x===t.x&&e.y===t.y}function Pd(e,t,s,i){var r=Yr($t(e,t,s)),n=Yr($t(e,t,i)),o=Yr($t(s,i,e)),a=Yr($t(s,i,t));return!!(r!==n&&o!==a||r===0&&Vr(e,s,t)||n===0&&Vr(e,i,t)||o===0&&Vr(s,e,i)||a===0&&Vr(s,t,i))}function Vr(e,t,s){return t.x<=Math.max(e.x,s.x)&&t.x>=Math.min(e.x,s.x)&&t.y<=Math.max(e.y,s.y)&&t.y>=Math.min(e.y,s.y)}function Yr(e){return e>0?1:e<0?-1:0}function Y_(e,t){var s=e;do{if(s.i!==e.i&&s.next.i!==e.i&&s.i!==t.i&&s.next.i!==t.i&&Pd(s,s.next,e,t))return!0;s=s.next}while(s!==e);return!1}function wr(e,t){return $t(e.prev,e,e.next)<0?$t(e,t,e.next)>=0&&$t(e,e.prev,t)>=0:$t(e,t,e.prev)<0||$t(e,e.next,t)<0}function K_(e,t){var s=e,i=!1,r=(e.x+t.x)/2,n=(e.y+t.y)/2;do s.y>n!=s.next.y>n&&s.next.y!==s.y&&r<(s.next.x-s.x)*(n-s.y)/(s.next.y-s.y)+s.x&&(i=!i),s=s.next;while(s!==e);return i}function Md(e,t){var s=new Ua(e.i,e.x,e.y),i=new Ua(t.i,t.x,t.y),r=e.next,n=t.prev;return e.next=t,t.prev=e,s.next=r,r.prev=s,i.next=s,s.prev=i,n.next=i,i.prev=n,i}function cc(e,t,s,i){var r=new Ua(e,t,s);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function Sr(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Ua(e,t,s){this.i=e,this.x=t,this.y=s,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}uo.deviation=function(e,t,s,i){var r=t&&t.length,n=r?t[0]*s:e.length,o=Math.abs(ka(e,0,n,s));if(r)for(var a=0,l=t.length;a<l;a++){var h=t[a]*s,c=a<l-1?t[a+1]*s:e.length;o-=Math.abs(ka(e,h,c,s))}var u=0;for(a=0;a<i.length;a+=3){var d=i[a]*s,p=i[a+1]*s,f=i[a+2]*s;u+=Math.abs((e[d]-e[f])*(e[p+1]-e[d+1])-(e[d]-e[p])*(e[f+1]-e[d+1]))}return o===0&&u===0?0:Math.abs((u-o)/o)};function ka(e,t,s,i){for(var r=0,n=t,o=s-i;n<s;n+=i)r+=(e[o]-e[n])*(e[n+1]+e[o+1]),o=n;return r}uo.flatten=function(e){for(var t=e[0][0].length,s={vertices:[],holes:[],dimensions:t},i=0,r=0;r<e.length;r++){for(var n=0;n<e[r].length;n++)for(var o=0;o<t;o++)s.vertices.push(e[r][n][o]);r>0&&(i+=e[r-1].length,s.holes.push(i))}return s};var Nn={},q_={get exports(){return Nn},set exports(e){Nn=e}};(function(e,t){(function(s){var i=t&&!t.nodeType&&t,r=e&&!e.nodeType&&e,n=typeof $o=="object"&&$o;(n.global===n||n.window===n||n.self===n)&&(s=n);var o,a=2147483647,l=36,h=1,c=26,u=38,d=700,p=72,f=128,m="-",_=/^xn--/,v=/[^\x20-\x7E]/,b=/[\x2E\u3002\uFF0E\uFF61]/g,g={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},E=l-h,S=Math.floor,C=String.fromCharCode,T;function y(N){throw RangeError(g[N])}function I(N,U){for(var Y=N.length,it=[];Y--;)it[Y]=U(N[Y]);return it}function B(N,U){var Y=N.split("@"),it="";Y.length>1&&(it=Y[0]+"@",N=Y[1]),N=N.replace(b,".");var Q=N.split("."),dt=I(Q,U).join(".");return it+dt}function F(N){for(var U=[],Y=0,it=N.length,Q,dt;Y<it;)Q=N.charCodeAt(Y++),Q>=55296&&Q<=56319&&Y<it?(dt=N.charCodeAt(Y++),(dt&64512)==56320?U.push(((Q&1023)<<10)+(dt&1023)+65536):(U.push(Q),Y--)):U.push(Q);return U}function z(N){return I(N,function(U){var Y="";return U>65535&&(U-=65536,Y+=C(U>>>10&1023|55296),U=56320|U&1023),Y+=C(U),Y}).join("")}function L(N){return N-48<10?N-22:N-65<26?N-65:N-97<26?N-97:l}function P(N,U){return N+22+75*(N<26)-((U!=0)<<5)}function ut(N,U,Y){var it=0;for(N=Y?S(N/d):N>>1,N+=S(N/U);N>E*c>>1;it+=l)N=S(N/E);return S(it+(E+1)*N/(N+u))}function nt(N){var U=[],Y=N.length,it,Q=0,dt=f,_t=p,ht,vt,Lt,Rt,Pt,x,w,A,M;for(ht=N.lastIndexOf(m),ht<0&&(ht=0),vt=0;vt<ht;++vt)N.charCodeAt(vt)>=128&&y("not-basic"),U.push(N.charCodeAt(vt));for(Lt=ht>0?ht+1:0;Lt<Y;){for(Rt=Q,Pt=1,x=l;Lt>=Y&&y("invalid-input"),w=L(N.charCodeAt(Lt++)),(w>=l||w>S((a-Q)/Pt))&&y("overflow"),Q+=w*Pt,A=x<=_t?h:x>=_t+c?c:x-_t,!(w<A);x+=l)M=l-A,Pt>S(a/M)&&y("overflow"),Pt*=M;it=U.length+1,_t=ut(Q-Rt,it,Rt==0),S(Q/it)>a-dt&&y("overflow"),dt+=S(Q/it),Q%=it,U.splice(Q++,0,dt)}return z(U)}function G(N){var U,Y,it,Q,dt,_t,ht,vt,Lt,Rt,Pt,x=[],w,A,M,D;for(N=F(N),w=N.length,U=f,Y=0,dt=p,_t=0;_t<w;++_t)Pt=N[_t],Pt<128&&x.push(C(Pt));for(it=Q=x.length,Q&&x.push(m);it<w;){for(ht=a,_t=0;_t<w;++_t)Pt=N[_t],Pt>=U&&Pt<ht&&(ht=Pt);for(A=it+1,ht-U>S((a-Y)/A)&&y("overflow"),Y+=(ht-U)*A,U=ht,_t=0;_t<w;++_t)if(Pt=N[_t],Pt<U&&++Y>a&&y("overflow"),Pt==U){for(vt=Y,Lt=l;Rt=Lt<=dt?h:Lt>=dt+c?c:Lt-dt,!(vt<Rt);Lt+=l)D=vt-Rt,M=l-Rt,x.push(C(P(Rt+D%M,0))),vt=S(D/M);x.push(C(P(vt,0))),dt=ut(Y,A,it==Q),Y=0,++it}++Y,++U}return x.join("")}function st(N){return B(N,function(U){return _.test(U)?nt(U.slice(4).toLowerCase()):U})}function Ct(N){return B(N,function(U){return v.test(U)?"xn--"+G(U):U})}if(o={version:"1.3.2",ucs2:{decode:F,encode:z},decode:nt,encode:G,toASCII:Ct,toUnicode:st},i&&r)if(e.exports==i)r.exports=o;else for(T in o)o.hasOwnProperty(T)&&(i[T]=o[T]);else s.punycode=o})($o)})(q_,Nn);var Z_={isString:function(e){return typeof e=="string"},isObject:function(e){return typeof e=="object"&&e!==null},isNull:function(e){return e===null},isNullOrUndefined:function(e){return e==null}},Ar={};function J_(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var Q_=function(e,t,s,i){t=t||"&",s=s||"=";var r={};if(typeof e!="string"||e.length===0)return r;var n=/\+/g;e=e.split(t);var o=1e3;i&&typeof i.maxKeys=="number"&&(o=i.maxKeys);var a=e.length;o>0&&a>o&&(a=o);for(var l=0;l<a;++l){var h=e[l].replace(n,"%20"),c=h.indexOf(s),u,d,p,f;c>=0?(u=h.substr(0,c),d=h.substr(c+1)):(u=h,d=""),p=decodeURIComponent(u),f=decodeURIComponent(d),J_(r,p)?Array.isArray(r[p])?r[p].push(f):r[p]=[r[p],f]:r[p]=f}return r},qi=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}},tx=function(e,t,s,i){return t=t||"&",s=s||"=",e===null&&(e=void 0),typeof e=="object"?Object.keys(e).map(function(r){var n=encodeURIComponent(qi(r))+s;return Array.isArray(e[r])?e[r].map(function(o){return n+encodeURIComponent(qi(o))}).join(t):n+encodeURIComponent(qi(e[r]))}).join(t):i?encodeURIComponent(qi(i))+s+encodeURIComponent(qi(e)):""};Ar.decode=Ar.parse=Q_;Ar.encode=Ar.stringify=tx;var ex=Nn,Ke=Z_,sx=po,ix=px,rx=fx;function Ue(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var nx=/^([a-z0-9.+-]+:)/i,ox=/:[0-9]*$/,ax=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,lx=["<",">",'"',"`"," ","\r",`
`,"	"],hx=["{","}","|","\\","^","`"].concat(lx),Ga=["'"].concat(hx),uc=["%","/","?",";","#"].concat(Ga),dc=["/","?","#"],cx=255,fc=/^[+a-z0-9A-Z_-]{0,63}$/,ux=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,dx={javascript:!0,"javascript:":!0},Ha={javascript:!0,"javascript:":!0},Pi={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},$a=Ar;function po(e,t,s){if(e&&Ke.isObject(e)&&e instanceof Ue)return e;var i=new Ue;return i.parse(e,t,s),i}Ue.prototype.parse=function(e,t,s){if(!Ke.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var i=e.indexOf("?"),r=i!==-1&&i<e.indexOf("#")?"?":"#",n=e.split(r),o=/\\/g;n[0]=n[0].replace(o,"/"),e=n.join(r);var a=e;if(a=a.trim(),!s&&e.split("#").length===1){var l=ax.exec(a);if(l)return this.path=a,this.href=a,this.pathname=l[1],l[2]?(this.search=l[2],t?this.query=$a.parse(this.search.substr(1)):this.query=this.search.substr(1)):t&&(this.search="",this.query={}),this}var h=nx.exec(a);if(h){h=h[0];var c=h.toLowerCase();this.protocol=c,a=a.substr(h.length)}if(s||h||a.match(/^\/\/[^@\/]+@[^@\/]+/)){var u=a.substr(0,2)==="//";u&&!(h&&Ha[h])&&(a=a.substr(2),this.slashes=!0)}if(!Ha[h]&&(u||h&&!Pi[h])){for(var d=-1,p=0;p<dc.length;p++){var f=a.indexOf(dc[p]);f!==-1&&(d===-1||f<d)&&(d=f)}var m,_;d===-1?_=a.lastIndexOf("@"):_=a.lastIndexOf("@",d),_!==-1&&(m=a.slice(0,_),a=a.slice(_+1),this.auth=decodeURIComponent(m)),d=-1;for(var p=0;p<uc.length;p++){var f=a.indexOf(uc[p]);f!==-1&&(d===-1||f<d)&&(d=f)}d===-1&&(d=a.length),this.host=a.slice(0,d),a=a.slice(d),this.parseHost(),this.hostname=this.hostname||"";var v=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!v)for(var b=this.hostname.split(/\./),p=0,g=b.length;p<g;p++){var E=b[p];if(E&&!E.match(fc)){for(var S="",C=0,T=E.length;C<T;C++)E.charCodeAt(C)>127?S+="x":S+=E[C];if(!S.match(fc)){var y=b.slice(0,p),I=b.slice(p+1),B=E.match(ux);B&&(y.push(B[1]),I.unshift(B[2])),I.length&&(a="/"+I.join(".")+a),this.hostname=y.join(".");break}}}this.hostname.length>cx?this.hostname="":this.hostname=this.hostname.toLowerCase(),v||(this.hostname=ex.toASCII(this.hostname));var F=this.port?":"+this.port:"",z=this.hostname||"";this.host=z+F,this.href+=this.host,v&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),a[0]!=="/"&&(a="/"+a))}if(!dx[c])for(var p=0,g=Ga.length;p<g;p++){var L=Ga[p];if(a.indexOf(L)!==-1){var P=encodeURIComponent(L);P===L&&(P=escape(L)),a=a.split(L).join(P)}}var ut=a.indexOf("#");ut!==-1&&(this.hash=a.substr(ut),a=a.slice(0,ut));var nt=a.indexOf("?");if(nt!==-1?(this.search=a.substr(nt),this.query=a.substr(nt+1),t&&(this.query=$a.parse(this.query)),a=a.slice(0,nt)):t&&(this.search="",this.query={}),a&&(this.pathname=a),Pi[c]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var F=this.pathname||"",G=this.search||"";this.path=F+G}return this.href=this.format(),this};function fx(e){return Ke.isString(e)&&(e=po(e)),e instanceof Ue?e.format():Ue.prototype.format.call(e)}Ue.prototype.format=function(){var e=this.auth||"";e&&(e=encodeURIComponent(e),e=e.replace(/%3A/i,":"),e+="@");var t=this.protocol||"",s=this.pathname||"",i=this.hash||"",r=!1,n="";this.host?r=e+this.host:this.hostname&&(r=e+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(r+=":"+this.port)),this.query&&Ke.isObject(this.query)&&Object.keys(this.query).length&&(n=$a.stringify(this.query));var o=this.search||n&&"?"+n||"";return t&&t.substr(-1)!==":"&&(t+=":"),this.slashes||(!t||Pi[t])&&r!==!1?(r="//"+(r||""),s&&s.charAt(0)!=="/"&&(s="/"+s)):r||(r=""),i&&i.charAt(0)!=="#"&&(i="#"+i),o&&o.charAt(0)!=="?"&&(o="?"+o),s=s.replace(/[?#]/g,function(a){return encodeURIComponent(a)}),o=o.replace("#","%23"),t+r+s+o+i};function px(e,t){return po(e,!1,!0).resolve(t)}Ue.prototype.resolve=function(e){return this.resolveObject(po(e,!1,!0)).format()};Ue.prototype.resolveObject=function(e){if(Ke.isString(e)){var t=new Ue;t.parse(e,!1,!0),e=t}for(var s=new Ue,i=Object.keys(this),r=0;r<i.length;r++){var n=i[r];s[n]=this[n]}if(s.hash=e.hash,e.href==="")return s.href=s.format(),s;if(e.slashes&&!e.protocol){for(var o=Object.keys(e),a=0;a<o.length;a++){var l=o[a];l!=="protocol"&&(s[l]=e[l])}return Pi[s.protocol]&&s.hostname&&!s.pathname&&(s.path=s.pathname="/"),s.href=s.format(),s}if(e.protocol&&e.protocol!==s.protocol){if(!Pi[e.protocol]){for(var h=Object.keys(e),c=0;c<h.length;c++){var u=h[c];s[u]=e[u]}return s.href=s.format(),s}if(s.protocol=e.protocol,!e.host&&!Ha[e.protocol]){for(var g=(e.pathname||"").split("/");g.length&&!(e.host=g.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),g[0]!==""&&g.unshift(""),g.length<2&&g.unshift(""),s.pathname=g.join("/")}else s.pathname=e.pathname;if(s.search=e.search,s.query=e.query,s.host=e.host||"",s.auth=e.auth,s.hostname=e.hostname||e.host,s.port=e.port,s.pathname||s.search){var d=s.pathname||"",p=s.search||"";s.path=d+p}return s.slashes=s.slashes||e.slashes,s.href=s.format(),s}var f=s.pathname&&s.pathname.charAt(0)==="/",m=e.host||e.pathname&&e.pathname.charAt(0)==="/",_=m||f||s.host&&e.pathname,v=_,b=s.pathname&&s.pathname.split("/")||[],g=e.pathname&&e.pathname.split("/")||[],E=s.protocol&&!Pi[s.protocol];if(E&&(s.hostname="",s.port=null,s.host&&(b[0]===""?b[0]=s.host:b.unshift(s.host)),s.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(g[0]===""?g[0]=e.host:g.unshift(e.host)),e.host=null),_=_&&(g[0]===""||b[0]==="")),m)s.host=e.host||e.host===""?e.host:s.host,s.hostname=e.hostname||e.hostname===""?e.hostname:s.hostname,s.search=e.search,s.query=e.query,b=g;else if(g.length)b||(b=[]),b.pop(),b=b.concat(g),s.search=e.search,s.query=e.query;else if(!Ke.isNullOrUndefined(e.search)){if(E){s.hostname=s.host=b.shift();var S=s.host&&s.host.indexOf("@")>0?s.host.split("@"):!1;S&&(s.auth=S.shift(),s.host=s.hostname=S.shift())}return s.search=e.search,s.query=e.query,(!Ke.isNull(s.pathname)||!Ke.isNull(s.search))&&(s.path=(s.pathname?s.pathname:"")+(s.search?s.search:"")),s.href=s.format(),s}if(!b.length)return s.pathname=null,s.search?s.path="/"+s.search:s.path=null,s.href=s.format(),s;for(var C=b.slice(-1)[0],T=(s.host||e.host||b.length>1)&&(C==="."||C==="..")||C==="",y=0,I=b.length;I>=0;I--)C=b[I],C==="."?b.splice(I,1):C===".."?(b.splice(I,1),y++):y&&(b.splice(I,1),y--);if(!_&&!v)for(;y--;y)b.unshift("..");_&&b[0]!==""&&(!b[0]||b[0].charAt(0)!=="/")&&b.unshift(""),T&&b.join("/").substr(-1)!=="/"&&b.push("");var B=b[0]===""||b[0]&&b[0].charAt(0)==="/";if(E){s.hostname=s.host=B?"":b.length?b.shift():"";var S=s.host&&s.host.indexOf("@")>0?s.host.split("@"):!1;S&&(s.auth=S.shift(),s.host=s.hostname=S.shift())}return _=_||s.host&&b.length,_&&!B&&b.unshift(""),b.length?s.pathname=b.join("/"):(s.pathname=null,s.path=null),(!Ke.isNull(s.pathname)||!Ke.isNull(s.search))&&(s.path=(s.pathname?s.pathname:"")+(s.search?s.search:"")),s.auth=e.auth||s.auth,s.slashes=s.slashes||e.slashes,s.href=s.format(),s};Ue.prototype.parseHost=function(){var e=this.host,t=ox.exec(e);t&&(t=t[0],t!==":"&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)};const mx={parse:sx,format:rx,resolve:ix};function Ce(e){if(typeof e!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(e)}`)}function Zi(e){return e.split("?")[0].split("#")[0]}function gx(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function _x(e,t,s){return e.replace(new RegExp(gx(t),"g"),s)}function xx(e,t){let s="",i=0,r=-1,n=0,o=-1;for(let a=0;a<=e.length;++a){if(a<e.length)o=e.charCodeAt(a);else{if(o===47)break;o=47}if(o===47){if(!(r===a-1||n===1))if(r!==a-1&&n===2){if(s.length<2||i!==2||s.charCodeAt(s.length-1)!==46||s.charCodeAt(s.length-2)!==46){if(s.length>2){const l=s.lastIndexOf("/");if(l!==s.length-1){l===-1?(s="",i=0):(s=s.slice(0,l),i=s.length-1-s.lastIndexOf("/")),r=a,n=0;continue}}else if(s.length===2||s.length===1){s="",i=0,r=a,n=0;continue}}t&&(s.length>0?s+="/..":s="..",i=2)}else s.length>0?s+=`/${e.slice(r+1,a)}`:s=e.slice(r+1,a),i=a-r-1;r=a,n=0}else o===46&&n!==-1?++n:n=-1}return s}const ae={toPosix(e){return _x(e,"\\","/")},isUrl(e){return/^https?:/.test(this.toPosix(e))},isDataUrl(e){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(e)},hasProtocol(e){return/^[^/:]+:\//.test(this.toPosix(e))},getProtocol(e){Ce(e),e=this.toPosix(e);let t="";const s=/^file:\/\/\//.exec(e),i=/^[^/:]+:\/\//.exec(e),r=/^[^/:]+:\//.exec(e);if(s||i||r){const n=(s==null?void 0:s[0])||(i==null?void 0:i[0])||(r==null?void 0:r[0]);t=n,e=e.slice(n.length)}return t},toAbsolute(e,t,s){if(this.isDataUrl(e))return e;const i=Zi(this.toPosix(t??q.ADAPTER.getBaseUrl())),r=Zi(this.toPosix(s??this.rootname(i)));return Ce(e),e=this.toPosix(e),e.startsWith("/")?ae.join(r,e.slice(1)):this.isAbsolute(e)?e:this.join(i,e)},normalize(e){if(e=this.toPosix(e),Ce(e),e.length===0)return".";let t="";const s=e.startsWith("/");this.hasProtocol(e)&&(t=this.rootname(e),e=e.slice(t.length));const i=e.endsWith("/");return e=xx(e,!1),e.length>0&&i&&(e+="/"),s?`/${e}`:t+e},isAbsolute(e){return Ce(e),e=this.toPosix(e),this.hasProtocol(e)?!0:e.startsWith("/")},join(...e){if(e.length===0)return".";let t;for(let s=0;s<e.length;++s){const i=e[s];if(Ce(i),i.length>0)if(t===void 0)t=i;else{const r=e[s-1]??"";this.extname(r)?t+=`/../${i}`:t+=`/${i}`}}return t===void 0?".":this.normalize(t)},dirname(e){if(Ce(e),e.length===0)return".";e=this.toPosix(e);let t=e.charCodeAt(0);const s=t===47;let i=-1,r=!0;const n=this.getProtocol(e),o=e;e=e.slice(n.length);for(let a=e.length-1;a>=1;--a)if(t=e.charCodeAt(a),t===47){if(!r){i=a;break}}else r=!1;return i===-1?s?"/":this.isUrl(o)?n+e:n:s&&i===1?"//":n+e.slice(0,i)},rootname(e){Ce(e),e=this.toPosix(e);let t="";if(e.startsWith("/")?t="/":t=this.getProtocol(e),this.isUrl(e)){const s=e.indexOf("/",t.length);s!==-1?t=e.slice(0,s):t=e,t.endsWith("/")||(t+="/")}return t},basename(e,t){Ce(e),t&&Ce(t),e=Zi(this.toPosix(e));let s=0,i=-1,r=!0,n;if(t!==void 0&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";let o=t.length-1,a=-1;for(n=e.length-1;n>=0;--n){const l=e.charCodeAt(n);if(l===47){if(!r){s=n+1;break}}else a===-1&&(r=!1,a=n+1),o>=0&&(l===t.charCodeAt(o)?--o===-1&&(i=n):(o=-1,i=a))}return s===i?i=a:i===-1&&(i=e.length),e.slice(s,i)}for(n=e.length-1;n>=0;--n)if(e.charCodeAt(n)===47){if(!r){s=n+1;break}}else i===-1&&(r=!1,i=n+1);return i===-1?"":e.slice(s,i)},extname(e){Ce(e),e=Zi(this.toPosix(e));let t=-1,s=0,i=-1,r=!0,n=0;for(let o=e.length-1;o>=0;--o){const a=e.charCodeAt(o);if(a===47){if(!r){s=o+1;break}continue}i===-1&&(r=!1,i=o+1),a===46?t===-1?t=o:n!==1&&(n=1):t!==-1&&(n=-1)}return t===-1||i===-1||n===0||n===1&&t===i-1&&t===s+1?"":e.slice(t,i)},parse(e){Ce(e);const t={root:"",dir:"",base:"",ext:"",name:""};if(e.length===0)return t;e=Zi(this.toPosix(e));let s=e.charCodeAt(0);const i=this.isAbsolute(e);let r;t.root=this.rootname(e),i||this.hasProtocol(e)?r=1:r=0;let n=-1,o=0,a=-1,l=!0,h=e.length-1,c=0;for(;h>=r;--h){if(s=e.charCodeAt(h),s===47){if(!l){o=h+1;break}continue}a===-1&&(l=!1,a=h+1),s===46?n===-1?n=h:c!==1&&(c=1):n!==-1&&(c=-1)}return n===-1||a===-1||c===0||c===1&&n===a-1&&n===o+1?a!==-1&&(o===0&&i?t.base=t.name=e.slice(1,a):t.base=t.name=e.slice(o,a)):(o===0&&i?(t.name=e.slice(1,n),t.base=e.slice(1,a)):(t.name=e.slice(o,n),t.base=e.slice(o,a)),t.ext=e.slice(n,a)),t.dir=this.dirname(e),t},sep:"/",delimiter:":"},pc={};function Et(e,t,s=3){if(pc[t])return;let i=new Error().stack;typeof i>"u"?console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${e}`):(i=i.split(`
`).splice(s).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${t}
Deprecated since v${e}`),console.warn(i),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${e}`),console.warn(i))),pc[t]=!0}let Wo;function vx(){return typeof Wo>"u"&&(Wo=function(){var s;const t={stencil:!0,failIfMajorPerformanceCaveat:q.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!q.ADAPTER.getWebGLRenderingContext())return!1;const i=q.ADAPTER.createCanvas();let r=i.getContext("webgl",t)||i.getContext("experimental-webgl",t);const n=!!((s=r==null?void 0:r.getContextAttributes())!=null&&s.stencil);if(r){const o=r.getExtension("WEBGL_lose_context");o&&o.loseContext()}return r=null,n}catch{return!1}}()),Wo}var yx={grad:.9,turn:360,rad:360/(2*Math.PI)},as=function(e){return typeof e=="string"?e.length>0:typeof e=="number"},Jt=function(e,t,s){return t===void 0&&(t=0),s===void 0&&(s=Math.pow(10,t)),Math.round(s*e)/s+0},Te=function(e,t,s){return t===void 0&&(t=0),s===void 0&&(s=1),e>s?s:e>t?e:t},Od=function(e){return(e=isFinite(e)?e%360:0)>0?e:e+360},mc=function(e){return{r:Te(e.r,0,255),g:Te(e.g,0,255),b:Te(e.b,0,255),a:Te(e.a)}},Xo=function(e){return{r:Jt(e.r),g:Jt(e.g),b:Jt(e.b),a:Jt(e.a,3)}},Ex=/^#([0-9a-f]{3,8})$/i,Kr=function(e){var t=e.toString(16);return t.length<2?"0"+t:t},Bd=function(e){var t=e.r,s=e.g,i=e.b,r=e.a,n=Math.max(t,s,i),o=n-Math.min(t,s,i),a=o?n===t?(s-i)/o:n===s?2+(i-t)/o:4+(t-s)/o:0;return{h:60*(a<0?a+6:a),s:n?o/n*100:0,v:n/255*100,a:r}},Dd=function(e){var t=e.h,s=e.s,i=e.v,r=e.a;t=t/360*6,s/=100,i/=100;var n=Math.floor(t),o=i*(1-s),a=i*(1-(t-n)*s),l=i*(1-(1-t+n)*s),h=n%6;return{r:255*[i,a,o,o,l,i][h],g:255*[l,i,i,a,o,o][h],b:255*[o,o,l,i,i,a][h],a:r}},gc=function(e){return{h:Od(e.h),s:Te(e.s,0,100),l:Te(e.l,0,100),a:Te(e.a)}},_c=function(e){return{h:Jt(e.h),s:Jt(e.s),l:Jt(e.l),a:Jt(e.a,3)}},xc=function(e){return Dd((s=(t=e).s,{h:t.h,s:(s*=((i=t.l)<50?i:100-i)/100)>0?2*s/(i+s)*100:0,v:i+s,a:t.a}));var t,s,i},gr=function(e){return{h:(t=Bd(e)).h,s:(r=(200-(s=t.s))*(i=t.v)/100)>0&&r<200?s*i/100/(r<=100?r:200-r)*100:0,l:r/2,a:t.a};var t,s,i,r},bx=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Tx=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,wx=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Sx=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Wa={string:[[function(e){var t=Ex.exec(e);return t?(e=t[1]).length<=4?{r:parseInt(e[0]+e[0],16),g:parseInt(e[1]+e[1],16),b:parseInt(e[2]+e[2],16),a:e.length===4?Jt(parseInt(e[3]+e[3],16)/255,2):1}:e.length===6||e.length===8?{r:parseInt(e.substr(0,2),16),g:parseInt(e.substr(2,2),16),b:parseInt(e.substr(4,2),16),a:e.length===8?Jt(parseInt(e.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(e){var t=wx.exec(e)||Sx.exec(e);return t?t[2]!==t[4]||t[4]!==t[6]?null:mc({r:Number(t[1])/(t[2]?100/255:1),g:Number(t[3])/(t[4]?100/255:1),b:Number(t[5])/(t[6]?100/255:1),a:t[7]===void 0?1:Number(t[7])/(t[8]?100:1)}):null},"rgb"],[function(e){var t=bx.exec(e)||Tx.exec(e);if(!t)return null;var s,i,r=gc({h:(s=t[1],i=t[2],i===void 0&&(i="deg"),Number(s)*(yx[i]||1)),s:Number(t[3]),l:Number(t[4]),a:t[5]===void 0?1:Number(t[5])/(t[6]?100:1)});return xc(r)},"hsl"]],object:[[function(e){var t=e.r,s=e.g,i=e.b,r=e.a,n=r===void 0?1:r;return as(t)&&as(s)&&as(i)?mc({r:Number(t),g:Number(s),b:Number(i),a:Number(n)}):null},"rgb"],[function(e){var t=e.h,s=e.s,i=e.l,r=e.a,n=r===void 0?1:r;if(!as(t)||!as(s)||!as(i))return null;var o=gc({h:Number(t),s:Number(s),l:Number(i),a:Number(n)});return xc(o)},"hsl"],[function(e){var t=e.h,s=e.s,i=e.v,r=e.a,n=r===void 0?1:r;if(!as(t)||!as(s)||!as(i))return null;var o=function(a){return{h:Od(a.h),s:Te(a.s,0,100),v:Te(a.v,0,100),a:Te(a.a)}}({h:Number(t),s:Number(s),v:Number(i),a:Number(n)});return Dd(o)},"hsv"]]},vc=function(e,t){for(var s=0;s<t.length;s++){var i=t[s][0](e);if(i)return[i,t[s][1]]}return[null,void 0]},Ax=function(e){return typeof e=="string"?vc(e.trim(),Wa.string):typeof e=="object"&&e!==null?vc(e,Wa.object):[null,void 0]},zo=function(e,t){var s=gr(e);return{h:s.h,s:Te(s.s+100*t,0,100),l:s.l,a:s.a}},jo=function(e){return(299*e.r+587*e.g+114*e.b)/1e3/255},yc=function(e,t){var s=gr(e);return{h:s.h,s:s.s,l:Te(s.l+100*t,0,100),a:s.a}},Xa=function(){function e(t){this.parsed=Ax(t)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return e.prototype.isValid=function(){return this.parsed!==null},e.prototype.brightness=function(){return Jt(jo(this.rgba),2)},e.prototype.isDark=function(){return jo(this.rgba)<.5},e.prototype.isLight=function(){return jo(this.rgba)>=.5},e.prototype.toHex=function(){return t=Xo(this.rgba),s=t.r,i=t.g,r=t.b,o=(n=t.a)<1?Kr(Jt(255*n)):"","#"+Kr(s)+Kr(i)+Kr(r)+o;var t,s,i,r,n,o},e.prototype.toRgb=function(){return Xo(this.rgba)},e.prototype.toRgbString=function(){return t=Xo(this.rgba),s=t.r,i=t.g,r=t.b,(n=t.a)<1?"rgba("+s+", "+i+", "+r+", "+n+")":"rgb("+s+", "+i+", "+r+")";var t,s,i,r,n},e.prototype.toHsl=function(){return _c(gr(this.rgba))},e.prototype.toHslString=function(){return t=_c(gr(this.rgba)),s=t.h,i=t.s,r=t.l,(n=t.a)<1?"hsla("+s+", "+i+"%, "+r+"%, "+n+")":"hsl("+s+", "+i+"%, "+r+"%)";var t,s,i,r,n},e.prototype.toHsv=function(){return t=Bd(this.rgba),{h:Jt(t.h),s:Jt(t.s),v:Jt(t.v),a:Jt(t.a,3)};var t},e.prototype.invert=function(){return Xe({r:255-(t=this.rgba).r,g:255-t.g,b:255-t.b,a:t.a});var t},e.prototype.saturate=function(t){return t===void 0&&(t=.1),Xe(zo(this.rgba,t))},e.prototype.desaturate=function(t){return t===void 0&&(t=.1),Xe(zo(this.rgba,-t))},e.prototype.grayscale=function(){return Xe(zo(this.rgba,-1))},e.prototype.lighten=function(t){return t===void 0&&(t=.1),Xe(yc(this.rgba,t))},e.prototype.darken=function(t){return t===void 0&&(t=.1),Xe(yc(this.rgba,-t))},e.prototype.rotate=function(t){return t===void 0&&(t=15),this.hue(this.hue()+t)},e.prototype.alpha=function(t){return typeof t=="number"?Xe({r:(s=this.rgba).r,g:s.g,b:s.b,a:t}):Jt(this.rgba.a,3);var s},e.prototype.hue=function(t){var s=gr(this.rgba);return typeof t=="number"?Xe({h:t,s:s.s,l:s.l,a:s.a}):Jt(s.h)},e.prototype.isEqual=function(t){return this.toHex()===Xe(t).toHex()},e}(),Xe=function(e){return e instanceof Xa?e:new Xa(e)},Ec=[],Cx=function(e){e.forEach(function(t){Ec.indexOf(t)<0&&(t(Xa,Wa),Ec.push(t))})};function Ix(e,t){var s={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},i={};for(var r in s)i[s[r]]=r;var n={};e.prototype.toName=function(o){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var a,l,h=i[this.toHex()];if(h)return h;if(o!=null&&o.closest){var c=this.toRgb(),u=1/0,d="black";if(!n.length)for(var p in s)n[p]=new e(s[p]).toRgb();for(var f in s){var m=(a=c,l=n[f],Math.pow(a.r-l.r,2)+Math.pow(a.g-l.g,2)+Math.pow(a.b-l.b,2));m<u&&(u=m,d=f)}return d}},t.string.push([function(o){var a=o.toLowerCase(),l=a==="transparent"?"#0000":s[a];return l?new e(l).toRgb():null},"name"])}Cx([Ix]);const Mi=class{constructor(e=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=e}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(e){return this.value=e,this}set value(e){if(e instanceof Mi)this._value=this.cloneSource(e._value),this._int=e._int,this._components.set(e._components);else{if(e===null)throw new Error("Cannot set PIXI.Color#value to null");(this._value===null||!this.isSourceEqual(this._value,e))&&(this.normalize(e),this._value=this.cloneSource(e))}}get value(){return this._value}cloneSource(e){return typeof e=="string"||typeof e=="number"||e instanceof Number||e===null?e:Array.isArray(e)||ArrayBuffer.isView(e)?e.slice(0):typeof e=="object"&&e!==null?{...e}:e}isSourceEqual(e,t){const s=typeof e;if(s!==typeof t)return!1;if(s==="number"||s==="string"||e instanceof Number)return e===t;if(Array.isArray(e)&&Array.isArray(t)||ArrayBuffer.isView(e)&&ArrayBuffer.isView(t))return e.length!==t.length?!1:e.every((r,n)=>r===t[n]);if(e!==null&&t!==null){const r=Object.keys(e),n=Object.keys(t);return r.length!==n.length?!1:r.every(o=>e[o]===t[o])}return e===t}toRgba(){const[e,t,s,i]=this._components;return{r:e,g:t,b:s,a:i}}toRgb(){const[e,t,s]=this._components;return{r:e,g:t,b:s}}toRgbaString(){const[e,t,s]=this.toUint8RgbArray();return`rgba(${e},${t},${s},${this.alpha})`}toUint8RgbArray(e){const[t,s,i]=this._components;return e=e??[],e[0]=Math.round(t*255),e[1]=Math.round(s*255),e[2]=Math.round(i*255),e}toRgbArray(e){e=e??[];const[t,s,i]=this._components;return e[0]=t,e[1]=s,e[2]=i,e}toNumber(){return this._int}toLittleEndianNumber(){const e=this._int;return(e>>16)+(e&65280)+((e&255)<<16)}multiply(e){const[t,s,i,r]=Mi.temp.setValue(e)._components;return this._components[0]*=t,this._components[1]*=s,this._components[2]*=i,this._components[3]*=r,this.refreshInt(),this._value=null,this}premultiply(e,t=!0){return t&&(this._components[0]*=e,this._components[1]*=e,this._components[2]*=e),this._components[3]=e,this.refreshInt(),this._value=null,this}toPremultiplied(e,t=!0){if(e===1)return(255<<24)+this._int;if(e===0)return t?0:this._int;let s=this._int>>16&255,i=this._int>>8&255,r=this._int&255;return t&&(s=s*e+.5|0,i=i*e+.5|0,r=r*e+.5|0),(e*255<<24)+(s<<16)+(i<<8)+r}toHex(){const e=this._int.toString(16);return`#${"000000".substring(0,6-e.length)+e}`}toHexa(){const t=Math.round(this._components[3]*255).toString(16);return this.toHex()+"00".substring(0,2-t.length)+t}setAlpha(e){return this._components[3]=this._clamp(e),this}round(e){const[t,s,i]=this._components;return this._components[0]=Math.round(t*e)/e,this._components[1]=Math.round(s*e)/e,this._components[2]=Math.round(i*e)/e,this.refreshInt(),this._value=null,this}toArray(e){e=e??[];const[t,s,i,r]=this._components;return e[0]=t,e[1]=s,e[2]=i,e[3]=r,e}normalize(e){let t,s,i,r;if((typeof e=="number"||e instanceof Number)&&e>=0&&e<=16777215){const n=e;t=(n>>16&255)/255,s=(n>>8&255)/255,i=(n&255)/255,r=1}else if((Array.isArray(e)||e instanceof Float32Array)&&e.length>=3&&e.length<=4)e=this._clamp(e),[t,s,i,r=1]=e;else if((e instanceof Uint8Array||e instanceof Uint8ClampedArray)&&e.length>=3&&e.length<=4)e=this._clamp(e,0,255),[t,s,i,r=255]=e,t/=255,s/=255,i/=255,r/=255;else if(typeof e=="string"||typeof e=="object"){if(typeof e=="string"){const o=Mi.HEX_PATTERN.exec(e);o&&(e=`#${o[2]}`)}const n=Xe(e);n.isValid()&&({r:t,g:s,b:i,a:r}=n.rgba,t/=255,s/=255,i/=255)}if(t!==void 0)this._components[0]=t,this._components[1]=s,this._components[2]=i,this._components[3]=r,this.refreshInt();else throw new Error(`Unable to convert color ${e}`)}refreshInt(){this._clamp(this._components);const[e,t,s]=this._components;this._int=(e*255<<16)+(t*255<<8)+(s*255|0)}_clamp(e,t=0,s=1){return typeof e=="number"?Math.min(Math.max(e,t),s):(e.forEach((i,r)=>{e[r]=Math.min(Math.max(i,t),s)}),e)}};let Dt=Mi;Dt.shared=new Mi;Dt.temp=new Mi;Dt.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;function Rx(e){return Et("7.2.0","utils.hex2string is deprecated, use Color#toHex instead"),Dt.shared.setValue(e).toHex()}function Px(e){return Et("7.2.0","utils.rgb2hex is deprecated, use Color#toNumber instead"),Dt.shared.setValue(e).toNumber()}function Mx(){const e=[],t=[];for(let i=0;i<32;i++)e[i]=i,t[i]=i;e[ct.NORMAL_NPM]=ct.NORMAL,e[ct.ADD_NPM]=ct.ADD,e[ct.SCREEN_NPM]=ct.SCREEN,t[ct.NORMAL]=ct.NORMAL_NPM,t[ct.ADD]=ct.ADD_NPM,t[ct.SCREEN]=ct.SCREEN_NPM;const s=[];return s.push(t),s.push(e),s}const Ld=Mx();function Fd(e,t){return Ld[t?1:0][e]}function Ox(e,t=null){const s=e*6;if(t=t||new Uint16Array(s),t.length!==s)throw new Error(`Out buffer length is incorrect, got ${t.length} and expected ${s}`);for(let i=0,r=0;i<s;i+=6,r+=4)t[i+0]=r+0,t[i+1]=r+1,t[i+2]=r+2,t[i+3]=r+0,t[i+4]=r+2,t[i+5]=r+3;return t}function Nd(e){if(e.BYTES_PER_ELEMENT===4)return e instanceof Float32Array?"Float32Array":e instanceof Uint32Array?"Uint32Array":"Int32Array";if(e.BYTES_PER_ELEMENT===2){if(e instanceof Uint16Array)return"Uint16Array"}else if(e.BYTES_PER_ELEMENT===1&&e instanceof Uint8Array)return"Uint8Array";return null}function Un(e){return e+=e===0?1:0,--e,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e+1}function bc(e){return!(e&e-1)&&!!e}function Tc(e){let t=(e>65535?1:0)<<4;e>>>=t;let s=(e>255?1:0)<<3;return e>>>=s,t|=s,s=(e>15?1:0)<<2,e>>>=s,t|=s,s=(e>3?1:0)<<1,e>>>=s,t|=s,t|e>>1}function Oi(e,t,s){const i=e.length;let r;if(t>=i||s===0)return;s=t+s>i?i-t:s;const n=i-s;for(r=t;r<n;++r)e[r]=e[r+s];e.length=n}function As(e){return e===0?0:e<0?-1:1}let Bx=0;function ni(){return++Bx}const Ud=class{constructor(e,t,s,i){this.left=e,this.top=t,this.right=s,this.bottom=i}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}};let za=Ud;za.EMPTY=new Ud(0,0,0,0);const wc={},ze=Object.create(null),bs=Object.create(null);class Dx{constructor(t,s,i){this._canvas=q.ADAPTER.createCanvas(),this._context=this._canvas.getContext("2d"),this.resolution=i||q.RESOLUTION,this.resize(t,s)}clear(){this._checkDestroyed(),this._context.setTransform(1,0,0,1,0,0),this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}resize(t,s){this._checkDestroyed(),this._canvas.width=Math.round(t*this.resolution),this._canvas.height=Math.round(s*this.resolution)}destroy(){this._context=null,this._canvas=null}get width(){return this._checkDestroyed(),this._canvas.width}set width(t){this._checkDestroyed(),this._canvas.width=Math.round(t)}get height(){return this._checkDestroyed(),this._canvas.height}set height(t){this._checkDestroyed(),this._canvas.height=Math.round(t)}get canvas(){return this._checkDestroyed(),this._canvas}get context(){return this._checkDestroyed(),this._context}_checkDestroyed(){if(this._canvas===null)throw new TypeError("The CanvasRenderTarget has already been destroyed")}}function Sc(e,t,s){for(let i=0,r=4*s*t;i<t;++i,r+=4)if(e[r+3]!==0)return!1;return!0}function Ac(e,t,s,i,r){const n=4*t;for(let o=i,a=i*n+4*s;o<=r;++o,a+=n)if(e[a+3]!==0)return!1;return!0}function Lx(e){const{width:t,height:s}=e,i=e.getContext("2d",{willReadFrequently:!0});if(i===null)throw new TypeError("Failed to get canvas 2D context");const n=i.getImageData(0,0,t,s).data;let o=0,a=0,l=t-1,h=s-1;for(;a<s&&Sc(n,t,a);)++a;if(a===s)return za.EMPTY;for(;Sc(n,t,h);)--h;for(;Ac(n,t,o,a,h);)++o;for(;Ac(n,t,l,a,h);)--l;return++l,++h,new za(o,a,l,h)}function Fx(e){const t=Lx(e),{width:s,height:i}=t;let r=null;if(!t.isEmpty()){const n=e.getContext("2d");if(n===null)throw new TypeError("Failed to get canvas 2D context");r=n.getImageData(t.left,t.top,s,i)}return{width:s,height:i,data:r}}let qr;function Nx(e,t=globalThis.location){if(e.startsWith("data:"))return"";t=t||globalThis.location,qr||(qr=document.createElement("a")),qr.href=e;const s=mx.parse(qr.href),i=!s.port&&t.port===""||s.port===t.port;return s.hostname!==t.hostname||!i||s.protocol!==t.protocol?"anonymous":""}function Ds(e,t=1){var i;const s=(i=q.RETINA_PREFIX)==null?void 0:i.exec(e);return s?parseFloat(s[1]):t}var Z=(e=>(e.Renderer="renderer",e.Application="application",e.RendererSystem="renderer-webgl-system",e.RendererPlugin="renderer-webgl-plugin",e.CanvasRendererSystem="renderer-canvas-system",e.CanvasRendererPlugin="renderer-canvas-plugin",e.Asset="asset",e.LoadParser="load-parser",e.ResolveParser="resolve-parser",e.CacheParser="cache-parser",e.DetectionParser="detection-parser",e))(Z||{});const ja=e=>{if(typeof e=="function"||typeof e=="object"&&e.extension){if(!e.extension)throw new Error("Extension class must have an extension object");e={...typeof e.extension!="object"?{type:e.extension}:e.extension,ref:e}}if(typeof e=="object")e={...e};else throw new Error("Invalid extension type");return typeof e.type=="string"&&(e.type=[e.type]),e},Cc=(e,t)=>ja(e).priority??t,rt={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...e){return e.map(ja).forEach(t=>{t.type.forEach(s=>{var i,r;return(r=(i=this._removeHandlers)[s])==null?void 0:r.call(i,t)})}),this},add(...e){return e.map(ja).forEach(t=>{t.type.forEach(s=>{const i=this._addHandlers,r=this._queue;i[s]?i[s](t):(r[s]=r[s]||[],r[s].push(t))})}),this},handle(e,t,s){const i=this._addHandlers,r=this._removeHandlers;if(i[e]||r[e])throw new Error(`Extension type ${e} already has a handler`);i[e]=t,r[e]=s;const n=this._queue;return n[e]&&(n[e].forEach(o=>t(o)),delete n[e]),this},handleByMap(e,t){return this.handle(e,s=>{t[s.name]=s.ref},s=>{delete t[s.name]})},handleByList(e,t,s=-1){return this.handle(e,i=>{t.includes(i.ref)||(t.push(i.ref),t.sort((r,n)=>Cc(n,s)-Cc(r,s)))},i=>{const r=t.indexOf(i.ref);r!==-1&&t.splice(r,1)})}};class Va{constructor(t){typeof t=="number"?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}}const Ux=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function kx(e){let t="";for(let s=0;s<e;++s)s>0&&(t+=`
else `),s<e-1&&(t+=`if(test == ${s}.0){}`);return t}function Gx(e,t){if(e===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const s=t.createShader(t.FRAGMENT_SHADER);for(;;){const i=Ux.replace(/%forloop%/gi,kx(e));if(t.shaderSource(s,i),t.compileShader(s),!t.getShaderParameter(s,t.COMPILE_STATUS))e=e/2|0;else break}return e}const Vo=0,Yo=1,Ko=2,qo=3,Zo=4,Jo=5;class xs{constructor(){this.data=0,this.blendMode=ct.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<Vo)}set blend(t){!!(this.data&1<<Vo)!==t&&(this.data^=1<<Vo)}get offsets(){return!!(this.data&1<<Yo)}set offsets(t){!!(this.data&1<<Yo)!==t&&(this.data^=1<<Yo)}get culling(){return!!(this.data&1<<Ko)}set culling(t){!!(this.data&1<<Ko)!==t&&(this.data^=1<<Ko)}get depthTest(){return!!(this.data&1<<qo)}set depthTest(t){!!(this.data&1<<qo)!==t&&(this.data^=1<<qo)}get depthMask(){return!!(this.data&1<<Jo)}set depthMask(t){!!(this.data&1<<Jo)!==t&&(this.data^=1<<Jo)}get clockwiseFrontFace(){return!!(this.data&1<<Zo)}set clockwiseFrontFace(t){!!(this.data&1<<Zo)!==t&&(this.data^=1<<Zo)}get blendMode(){return this._blendMode}set blendMode(t){this.blend=t!==ct.NONE,this._blendMode=t}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}toString(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`}static for2d(){const t=new xs;return t.depthTest=!1,t.blend=!0,t}}const Ya=[];function kd(e,t){if(!e)return null;let s="";if(typeof e=="string"){const i=/\.(\w{3,4})(?:$|\?|#)/i.exec(e);i&&(s=i[1].toLowerCase())}for(let i=Ya.length-1;i>=0;--i){const r=Ya[i];if(r.test&&r.test(e,s))return new r(e,t)}throw new Error("Unrecognized source type to auto-detect Resource")}class ke{constructor(t){this.items=[],this._name=t,this._aliasCount=0}emit(t,s,i,r,n,o,a,l){if(arguments.length>8)throw new Error("max arguments reached");const{name:h,items:c}=this;this._aliasCount++;for(let u=0,d=c.length;u<d;u++)c[u][h](t,s,i,r,n,o,a,l);return c===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this}remove(t){const s=this.items.indexOf(t);return s!==-1&&(this.ensureNonAliasedItems(),this.items.splice(s,1)),this}contains(t){return this.items.includes(t)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return this.items.length===0}get name(){return this._name}}Object.defineProperties(ke.prototype,{dispatch:{value:ke.prototype.emit},run:{value:ke.prototype.emit}});class Cr{constructor(t=0,s=0){this._width=t,this._height=s,this.destroyed=!1,this.internal=!1,this.onResize=new ke("setRealSize"),this.onUpdate=new ke("update"),this.onError=new ke("onError")}bind(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)}resize(t,s){(t!==this._width||s!==this._height)&&(this._width=t,this._height=s,this.onResize.emit(t,s))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(t,s,i){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(t,s){return!1}}class Br extends Cr{constructor(t,s){const{width:i,height:r}=s||{};if(!i||!r)throw new Error("BufferResource width or height invalid");super(i,r),this.data=t}upload(t,s,i){const r=t.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s.alphaMode===He.UNPACK);const n=s.realWidth,o=s.realHeight;return i.width===n&&i.height===o?r.texSubImage2D(s.target,0,0,0,n,o,s.format,i.type,this.data):(i.width=n,i.height=o,r.texImage2D(s.target,0,i.internalFormat,n,o,0,s.format,i.type,this.data)),!0}dispose(){this.data=null}static test(t){return t instanceof Float32Array||t instanceof Uint8Array||t instanceof Uint32Array}}const Hx={scaleMode:us.NEAREST,format:X.RGBA,alphaMode:He.NPM},_i=class extends ii{constructor(e=null,t=null){super(),t=Object.assign({},_i.defaultOptions,t);const{alphaMode:s,mipmap:i,anisotropicLevel:r,scaleMode:n,width:o,height:a,wrapMode:l,format:h,type:c,target:u,resolution:d,resourceOptions:p}=t;e&&!(e instanceof Cr)&&(e=kd(e,p),e.internal=!0),this.resolution=d||q.RESOLUTION,this.width=Math.round((o||0)*this.resolution)/this.resolution,this.height=Math.round((a||0)*this.resolution)/this.resolution,this._mipmap=i,this.anisotropicLevel=r,this._wrapMode=l,this._scaleMode=n,this.format=h,this.type=c,this.target=u,this.alphaMode=s,this.uid=ni(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=o>0&&a>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(e)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(e){this._mipmap!==e&&(this._mipmap=e,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(e){this._scaleMode!==e&&(this._scaleMode=e,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(e){this._wrapMode!==e&&(this._wrapMode=e,this.dirtyStyleId++)}setStyle(e,t){let s;return e!==void 0&&e!==this.scaleMode&&(this.scaleMode=e,s=!0),t!==void 0&&t!==this.mipmap&&(this.mipmap=t,s=!0),s&&this.dirtyStyleId++,this}setSize(e,t,s){return s=s||this.resolution,this.setRealSize(e*s,t*s,s)}setRealSize(e,t,s){return this.resolution=s||this.resolution,this.width=Math.round(e)/this.resolution,this.height=Math.round(t)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=bc(this.realWidth)&&bc(this.realHeight)}setResolution(e){const t=this.resolution;return t===e?this:(this.resolution=e,this.valid&&(this.width=Math.round(this.width*t)/e,this.height=Math.round(this.height*t)/e,this.emit("update",this)),this._refreshPOT(),this)}setResource(e){if(this.resource===e)return this;if(this.resource)throw new Error("Resource can be set only once");return e.bind(this),this.resource=e,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(e){this.emit("error",this,e)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete bs[this.cacheId],delete ze[this.cacheId],this.cacheId=null),this.dispose(),_i.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(e,t,s=q.STRICT_TEXTURE_CACHE){const i=typeof e=="string";let r=null;if(i)r=e;else{if(!e._pixiId){const o=(t==null?void 0:t.pixiIdPrefix)||"pixiid";e._pixiId=`${o}_${ni()}`}r=e._pixiId}let n=bs[r];if(i&&s&&!n)throw new Error(`The cacheId "${r}" does not exist in BaseTextureCache.`);return n||(n=new _i(e,t),n.cacheId=r,_i.addToCache(n,r)),n}static fromBuffer(e,t,s,i){e=e||new Float32Array(t*s*4);const r=new Br(e,{width:t,height:s}),n=e instanceof Float32Array?lt.FLOAT:lt.UNSIGNED_BYTE;return new _i(r,Object.assign({},Hx,{type:n},i))}static addToCache(e,t){t&&(e.textureCacheIds.includes(t)||e.textureCacheIds.push(t),bs[t]&&bs[t]!==e&&console.warn(`BaseTexture added to the cache with an id [${t}] that already had an entry`),bs[t]=e)}static removeFromCache(e){if(typeof e=="string"){const t=bs[e];if(t){const s=t.textureCacheIds.indexOf(e);return s>-1&&t.textureCacheIds.splice(s,1),delete bs[e],t}}else if(e!=null&&e.textureCacheIds){for(let t=0;t<e.textureCacheIds.length;++t)delete bs[e.textureCacheIds[t]];return e.textureCacheIds.length=0,e}return null}};let pt=_i;pt.defaultOptions={mipmap:is.POW2,anisotropicLevel:0,scaleMode:us.LINEAR,wrapMode:Ms.CLAMP,alphaMode:He.UNPACK,target:Ri.TEXTURE_2D,format:X.RGBA,type:lt.UNSIGNED_BYTE};pt._globalBatch=0;class Ka{constructor(){this.texArray=null,this.blend=0,this.type=Je.TRIANGLES,this.start=0,this.size=0,this.data=null}}let $x=0,qt=class Gd{constructor(t,s=!0,i=!1){this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=i,this.static=s,this.id=$x++,this.disposeRunner=new ke("disposeBuffer")}update(t){t instanceof Array&&(t=new Float32Array(t)),this.data=t||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(t){this.type=t?ts.ELEMENT_ARRAY_BUFFER:ts.ARRAY_BUFFER}get index(){return this.type===ts.ELEMENT_ARRAY_BUFFER}static from(t){return t instanceof Array&&(t=new Float32Array(t)),new Gd(t)}};class kn{constructor(t,s=0,i=!1,r=lt.FLOAT,n,o,a,l=1){this.buffer=t,this.size=s,this.normalized=i,this.type=r,this.stride=n,this.start=o,this.instance=a,this.divisor=l}destroy(){this.buffer=null}static from(t,s,i,r,n){return new kn(t,s,i,r,n)}}const Wx={Float32Array,Uint32Array,Int32Array,Uint8Array};function Xx(e,t){let s=0,i=0;const r={};for(let l=0;l<e.length;l++)i+=t[l],s+=e[l].length;const n=new ArrayBuffer(s*4);let o=null,a=0;for(let l=0;l<e.length;l++){const h=t[l],c=e[l],u=Nd(c);r[u]||(r[u]=new Wx[u](n)),o=r[u];for(let d=0;d<c.length;d++){const p=(d/h|0)*i+a,f=d%h;o[p+f]=c[d]}a+=h}return new Float32Array(n)}const Ic={5126:4,5123:2,5121:1};let zx=0;const jx={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array};class Ls{constructor(t=[],s={}){this.buffers=t,this.indexBuffer=null,this.attributes=s,this.glVertexArrayObjects={},this.id=zx++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new ke("disposeGeometry"),this.refCount=0}addAttribute(t,s,i=0,r=!1,n,o,a,l=!1){if(!s)throw new Error("You must pass a buffer when creating an attribute");s instanceof qt||(s instanceof Array&&(s=new Float32Array(s)),s=new qt(s));const h=t.split("|");if(h.length>1){for(let u=0;u<h.length;u++)this.addAttribute(h[u],s,i,r,n);return this}let c=this.buffers.indexOf(s);return c===-1&&(this.buffers.push(s),c=this.buffers.length-1),this.attributes[t]=new kn(c,i,r,n,o,a,l),this.instanced=this.instanced||l,this}getAttribute(t){return this.attributes[t]}getBuffer(t){return this.buffers[this.getAttribute(t).buffer]}addIndex(t){return t instanceof qt||(t instanceof Array&&(t=new Uint16Array(t)),t=new qt(t)),t.type=ts.ELEMENT_ARRAY_BUFFER,this.indexBuffer=t,this.buffers.includes(t)||this.buffers.push(t),this}getIndex(){return this.indexBuffer}interleave(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;const t=[],s=[],i=new qt;let r;for(r in this.attributes){const n=this.attributes[r],o=this.buffers[n.buffer];t.push(o.data),s.push(n.size*Ic[n.type]/4),n.buffer=0}for(i.data=Xx(t,s),r=0;r<this.buffers.length;r++)this.buffers[r]!==this.indexBuffer&&this.buffers[r].destroy();return this.buffers=[i],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const t in this.attributes){const s=this.attributes[t];return this.buffers[s.buffer].data.length/(s.stride/4||s.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const t=new Ls;for(let s=0;s<this.buffers.length;s++)t.buffers[s]=new qt(this.buffers[s].data.slice(0));for(const s in this.attributes){const i=this.attributes[s];t.attributes[s]=new kn(i.buffer,i.size,i.normalized,i.type,i.stride,i.start,i.instance)}return this.indexBuffer&&(t.indexBuffer=t.buffers[this.buffers.indexOf(this.indexBuffer)],t.indexBuffer.type=ts.ELEMENT_ARRAY_BUFFER),t}static merge(t){const s=new Ls,i=[],r=[],n=[];let o;for(let a=0;a<t.length;a++){o=t[a];for(let l=0;l<o.buffers.length;l++)r[l]=r[l]||0,r[l]+=o.buffers[l].data.length,n[l]=0}for(let a=0;a<o.buffers.length;a++)i[a]=new jx[Nd(o.buffers[a].data)](r[a]),s.buffers[a]=new qt(i[a]);for(let a=0;a<t.length;a++){o=t[a];for(let l=0;l<o.buffers.length;l++)i[l].set(o.buffers[l].data,n[l]),n[l]+=o.buffers[l].data.length}if(s.attributes=o.attributes,o.indexBuffer){s.indexBuffer=s.buffers[o.buffers.indexOf(o.indexBuffer)],s.indexBuffer.type=ts.ELEMENT_ARRAY_BUFFER;let a=0,l=0,h=0,c=0;for(let u=0;u<o.buffers.length;u++)if(o.buffers[u]!==o.indexBuffer){c=u;break}for(const u in o.attributes){const d=o.attributes[u];(d.buffer|0)===c&&(l+=d.size*Ic[d.type]/4)}for(let u=0;u<t.length;u++){const d=t[u].indexBuffer.data;for(let p=0;p<d.length;p++)s.indexBuffer.data[p+h]+=a;a+=t[u].buffers[c].data.length/l,h+=d.length}}return s}}class Hd extends Ls{constructor(t=!1){super(),this._buffer=new qt(null,t,!1),this._indexBuffer=new qt(null,t,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,lt.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,lt.FLOAT).addAttribute("aColor",this._buffer,4,!0,lt.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,lt.FLOAT).addIndex(this._indexBuffer)}}const Gn=Math.PI*2,Vx=180/Math.PI,Yx=Math.PI/180;var se=(e=>(e[e.POLY=0]="POLY",e[e.RECT=1]="RECT",e[e.CIRC=2]="CIRC",e[e.ELIP=3]="ELIP",e[e.RREC=4]="RREC",e))(se||{});class At{constructor(t=0,s=0){this.x=0,this.y=0,this.x=t,this.y=s}clone(){return new At(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,s=t){return this.x=t,this.y=s,this}toString(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`}}const Zr=[new At,new At,new At,new At];class xt{constructor(t=0,s=0,i=0,r=0){this.x=Number(t),this.y=Number(s),this.width=Number(i),this.height=Number(r),this.type=se.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new xt(0,0,0,0)}clone(){return new xt(this.x,this.y,this.width,this.height)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}contains(t,s){return this.width<=0||this.height<=0?!1:t>=this.x&&t<this.x+this.width&&s>=this.y&&s<this.y+this.height}intersects(t,s){if(!s){const y=this.x<t.x?t.x:this.x;if((this.right>t.right?t.right:this.right)<=y)return!1;const B=this.y<t.y?t.y:this.y;return(this.bottom>t.bottom?t.bottom:this.bottom)>B}const i=this.left,r=this.right,n=this.top,o=this.bottom;if(r<=i||o<=n)return!1;const a=Zr[0].set(t.left,t.top),l=Zr[1].set(t.left,t.bottom),h=Zr[2].set(t.right,t.top),c=Zr[3].set(t.right,t.bottom);if(h.x<=a.x||l.y<=a.y)return!1;const u=Math.sign(s.a*s.d-s.b*s.c);if(u===0||(s.apply(a,a),s.apply(l,l),s.apply(h,h),s.apply(c,c),Math.max(a.x,l.x,h.x,c.x)<=i||Math.min(a.x,l.x,h.x,c.x)>=r||Math.max(a.y,l.y,h.y,c.y)<=n||Math.min(a.y,l.y,h.y,c.y)>=o))return!1;const d=u*(l.y-a.y),p=u*(a.x-l.x),f=d*i+p*n,m=d*r+p*n,_=d*i+p*o,v=d*r+p*o;if(Math.max(f,m,_,v)<=d*a.x+p*a.y||Math.min(f,m,_,v)>=d*c.x+p*c.y)return!1;const b=u*(a.y-h.y),g=u*(h.x-a.x),E=b*i+g*n,S=b*r+g*n,C=b*i+g*o,T=b*r+g*o;return!(Math.max(E,S,C,T)<=b*a.x+g*a.y||Math.min(E,S,C,T)>=b*c.x+g*c.y)}pad(t=0,s=t){return this.x-=t,this.y-=s,this.width+=t*2,this.height+=s*2,this}fit(t){const s=Math.max(this.x,t.x),i=Math.min(this.x+this.width,t.x+t.width),r=Math.max(this.y,t.y),n=Math.min(this.y+this.height,t.y+t.height);return this.x=s,this.width=Math.max(i-s,0),this.y=r,this.height=Math.max(n-r,0),this}ceil(t=1,s=.001){const i=Math.ceil((this.x+this.width-s)*t)/t,r=Math.ceil((this.y+this.height-s)*t)/t;return this.x=Math.floor((this.x+s)*t)/t,this.y=Math.floor((this.y+s)*t)/t,this.width=i-this.x,this.height=r-this.y,this}enlarge(t){const s=Math.min(this.x,t.x),i=Math.max(this.x+this.width,t.x+t.width),r=Math.min(this.y,t.y),n=Math.max(this.y+this.height,t.y+t.height);return this.x=s,this.width=i-s,this.y=r,this.height=n-r,this}toString(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}class zl{constructor(t=0,s=0,i=0){this.x=t,this.y=s,this.radius=i,this.type=se.CIRC}clone(){return new zl(this.x,this.y,this.radius)}contains(t,s){if(this.radius<=0)return!1;const i=this.radius*this.radius;let r=this.x-t,n=this.y-s;return r*=r,n*=n,r+n<=i}getBounds(){return new xt(this.x-this.radius,this.y-this.radius,this.radius*2,this.radius*2)}toString(){return`[@pixi/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`}}class jl{constructor(t=0,s=0,i=0,r=0){this.x=t,this.y=s,this.width=i,this.height=r,this.type=se.ELIP}clone(){return new jl(this.x,this.y,this.width,this.height)}contains(t,s){if(this.width<=0||this.height<=0)return!1;let i=(t-this.x)/this.width,r=(s-this.y)/this.height;return i*=i,r*=r,i+r<=1}getBounds(){return new xt(this.x-this.width,this.y-this.height,this.width,this.height)}toString(){return`[@pixi/math:Ellipse x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}class Bi{constructor(...t){let s=Array.isArray(t[0])?t[0]:t;if(typeof s[0]!="number"){const i=[];for(let r=0,n=s.length;r<n;r++)i.push(s[r].x,s[r].y);s=i}this.points=s,this.type=se.POLY,this.closeStroke=!0}clone(){const t=this.points.slice(),s=new Bi(t);return s.closeStroke=this.closeStroke,s}contains(t,s){let i=!1;const r=this.points.length/2;for(let n=0,o=r-1;n<r;o=n++){const a=this.points[n*2],l=this.points[n*2+1],h=this.points[o*2],c=this.points[o*2+1];l>s!=c>s&&t<(h-a)*((s-l)/(c-l))+a&&(i=!i)}return i}toString(){return`[@pixi/math:PolygoncloseStroke=${this.closeStroke}points=${this.points.reduce((t,s)=>`${t}, ${s}`,"")}]`}}class Vl{constructor(t=0,s=0,i=0,r=0,n=20){this.x=t,this.y=s,this.width=i,this.height=r,this.radius=n,this.type=se.RREC}clone(){return new Vl(this.x,this.y,this.width,this.height,this.radius)}contains(t,s){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&s>=this.y&&s<=this.y+this.height){const i=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(s>=this.y+i&&s<=this.y+this.height-i||t>=this.x+i&&t<=this.x+this.width-i)return!0;let r=t-(this.x+i),n=s-(this.y+i);const o=i*i;if(r*r+n*n<=o||(r=t-(this.x+this.width-i),r*r+n*n<=o)||(n=s-(this.y+this.height-i),r*r+n*n<=o)||(r=t-(this.x+i),r*r+n*n<=o))return!0}return!1}toString(){return`[@pixi/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`}}class Ut{constructor(t=1,s=0,i=0,r=1,n=0,o=0){this.array=null,this.a=t,this.b=s,this.c=i,this.d=r,this.tx=n,this.ty=o}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,s,i,r,n,o){return this.a=t,this.b=s,this.c=i,this.d=r,this.tx=n,this.ty=o,this}toArray(t,s){this.array||(this.array=new Float32Array(9));const i=s||this.array;return t?(i[0]=this.a,i[1]=this.b,i[2]=0,i[3]=this.c,i[4]=this.d,i[5]=0,i[6]=this.tx,i[7]=this.ty,i[8]=1):(i[0]=this.a,i[1]=this.c,i[2]=this.tx,i[3]=this.b,i[4]=this.d,i[5]=this.ty,i[6]=0,i[7]=0,i[8]=1),i}apply(t,s){s=s||new At;const i=t.x,r=t.y;return s.x=this.a*i+this.c*r+this.tx,s.y=this.b*i+this.d*r+this.ty,s}applyInverse(t,s){s=s||new At;const i=1/(this.a*this.d+this.c*-this.b),r=t.x,n=t.y;return s.x=this.d*i*r+-this.c*i*n+(this.ty*this.c-this.tx*this.d)*i,s.y=this.a*i*n+-this.b*i*r+(-this.ty*this.a+this.tx*this.b)*i,s}translate(t,s){return this.tx+=t,this.ty+=s,this}scale(t,s){return this.a*=t,this.d*=s,this.c*=t,this.b*=s,this.tx*=t,this.ty*=s,this}rotate(t){const s=Math.cos(t),i=Math.sin(t),r=this.a,n=this.c,o=this.tx;return this.a=r*s-this.b*i,this.b=r*i+this.b*s,this.c=n*s-this.d*i,this.d=n*i+this.d*s,this.tx=o*s-this.ty*i,this.ty=o*i+this.ty*s,this}append(t){const s=this.a,i=this.b,r=this.c,n=this.d;return this.a=t.a*s+t.b*r,this.b=t.a*i+t.b*n,this.c=t.c*s+t.d*r,this.d=t.c*i+t.d*n,this.tx=t.tx*s+t.ty*r+this.tx,this.ty=t.tx*i+t.ty*n+this.ty,this}setTransform(t,s,i,r,n,o,a,l,h){return this.a=Math.cos(a+h)*n,this.b=Math.sin(a+h)*n,this.c=-Math.sin(a-l)*o,this.d=Math.cos(a-l)*o,this.tx=t-(i*this.a+r*this.c),this.ty=s-(i*this.b+r*this.d),this}prepend(t){const s=this.tx;if(t.a!==1||t.b!==0||t.c!==0||t.d!==1){const i=this.a,r=this.c;this.a=i*t.a+this.b*t.c,this.b=i*t.b+this.b*t.d,this.c=r*t.a+this.d*t.c,this.d=r*t.b+this.d*t.d}return this.tx=s*t.a+this.ty*t.c+t.tx,this.ty=s*t.b+this.ty*t.d+t.ty,this}decompose(t){const s=this.a,i=this.b,r=this.c,n=this.d,o=t.pivot,a=-Math.atan2(-r,n),l=Math.atan2(i,s),h=Math.abs(a+l);return h<1e-5||Math.abs(Gn-h)<1e-5?(t.rotation=l,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=a,t.skew.y=l),t.scale.x=Math.sqrt(s*s+i*i),t.scale.y=Math.sqrt(r*r+n*n),t.position.x=this.tx+(o.x*s+o.y*r),t.position.y=this.ty+(o.x*i+o.y*n),t}invert(){const t=this.a,s=this.b,i=this.c,r=this.d,n=this.tx,o=t*r-s*i;return this.a=r/o,this.b=-s/o,this.c=-i/o,this.d=t/o,this.tx=(i*this.ty-r*n)/o,this.ty=-(t*this.ty-s*n)/o,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const t=new Ut;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}toString(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`}static get IDENTITY(){return new Ut}static get TEMP_MATRIX(){return new Ut}}const Xs=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],zs=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],js=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],Vs=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],qa=[],$d=[],Jr=Math.sign;function Kx(){for(let e=0;e<16;e++){const t=[];qa.push(t);for(let s=0;s<16;s++){const i=Jr(Xs[e]*Xs[s]+js[e]*zs[s]),r=Jr(zs[e]*Xs[s]+Vs[e]*zs[s]),n=Jr(Xs[e]*js[s]+js[e]*Vs[s]),o=Jr(zs[e]*js[s]+Vs[e]*Vs[s]);for(let a=0;a<16;a++)if(Xs[a]===i&&zs[a]===r&&js[a]===n&&Vs[a]===o){t.push(a);break}}}for(let e=0;e<16;e++){const t=new Ut;t.set(Xs[e],zs[e],js[e],Vs[e],0,0),$d.push(t)}}Kx();const Gt={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:e=>Xs[e],uY:e=>zs[e],vX:e=>js[e],vY:e=>Vs[e],inv:e=>e&8?e&15:-e&7,add:(e,t)=>qa[e][t],sub:(e,t)=>qa[e][Gt.inv(t)],rotate180:e=>e^4,isVertical:e=>(e&3)===2,byDirection:(e,t)=>Math.abs(e)*2<=Math.abs(t)?t>=0?Gt.S:Gt.N:Math.abs(t)*2<=Math.abs(e)?e>0?Gt.E:Gt.W:t>0?e>0?Gt.SE:Gt.SW:e>0?Gt.NE:Gt.NW,matrixAppendRotationInv:(e,t,s=0,i=0)=>{const r=$d[Gt.inv(t)];r.tx=s,r.ty=i,e.append(r)}};class Cs{constructor(t,s,i=0,r=0){this._x=i,this._y=r,this.cb=t,this.scope=s}clone(t=this.cb,s=this.scope){return new Cs(t,s,this._x,this._y)}set(t=0,s=t){return(this._x!==t||this._y!==s)&&(this._x=t,this._y=s,this.cb.call(this.scope)),this}copyFrom(t){return(this._x!==t.x||this._y!==t.y)&&(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}toString(){return`[@pixi/math:ObservablePoint x=0 y=0 scope=${this.scope}]`}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))}}const Wd=class{constructor(){this.worldTransform=new Ut,this.localTransform=new Ut,this.position=new Cs(this.onChange,this,0,0),this.scale=new Cs(this.onChange,this,1,1),this.pivot=new Cs(this.onChange,this,0,0),this.skew=new Cs(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}toString(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`}updateLocalTransform(){const e=this.localTransform;this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(e){const t=this.localTransform;if(this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==e._worldID){const s=e.worldTransform,i=this.worldTransform;i.a=t.a*s.a+t.b*s.c,i.b=t.a*s.b+t.b*s.d,i.c=t.c*s.a+t.d*s.c,i.d=t.c*s.b+t.d*s.d,i.tx=t.tx*s.a+t.ty*s.c+s.tx,i.ty=t.tx*s.b+t.ty*s.d+s.ty,this._parentID=e._worldID,this._worldID++}}setFromMatrix(e){e.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(e){this._rotation!==e&&(this._rotation=e,this.updateSkew())}};let Yl=Wd;Yl.IDENTITY=new Wd;var qx=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`,Zx=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`;function Rc(e,t,s){const i=e.createShader(t);return e.shaderSource(i,s),e.compileShader(i),i}function Qo(e){const t=new Array(e);for(let s=0;s<t.length;s++)t[s]=!1;return t}function Xd(e,t){switch(e){case"float":return 0;case"vec2":return new Float32Array(2*t);case"vec3":return new Float32Array(3*t);case"vec4":return new Float32Array(4*t);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*t);case"ivec3":return new Int32Array(3*t);case"ivec4":return new Int32Array(4*t);case"uvec2":return new Uint32Array(2*t);case"uvec3":return new Uint32Array(3*t);case"uvec4":return new Uint32Array(4*t);case"bool":return!1;case"bvec2":return Qo(2*t);case"bvec3":return Qo(3*t);case"bvec4":return Qo(4*t);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const Di=[{test:e=>e.type==="float"&&e.size===1&&!e.isArray,code:e=>`
            if(uv["${e}"] !== ud["${e}"].value)
            {
                ud["${e}"].value = uv["${e}"]
                gl.uniform1f(ud["${e}"].location, uv["${e}"])
            }
            `},{test:(e,t)=>(e.type==="sampler2D"||e.type==="samplerCube"||e.type==="sampler2DArray")&&e.size===1&&!e.isArray&&(t==null||t.castToBaseTexture!==void 0),code:e=>`t = syncData.textureCount++;

            renderer.texture.bind(uv["${e}"], t);

            if(ud["${e}"].value !== t)
            {
                ud["${e}"].value = t;
                gl.uniform1i(ud["${e}"].location, t);
; // eslint-disable-line max-len
            }`},{test:(e,t)=>e.type==="mat3"&&e.size===1&&!e.isArray&&t.a!==void 0,code:e=>`
            gl.uniformMatrix3fv(ud["${e}"].location, false, uv["${e}"].toArray(true));
            `,codeUbo:e=>`
                var ${e}_matrix = uv.${e}.toArray(true);

                data[offset] = ${e}_matrix[0];
                data[offset+1] = ${e}_matrix[1];
                data[offset+2] = ${e}_matrix[2];
        
                data[offset + 4] = ${e}_matrix[3];
                data[offset + 5] = ${e}_matrix[4];
                data[offset + 6] = ${e}_matrix[5];
        
                data[offset + 8] = ${e}_matrix[6];
                data[offset + 9] = ${e}_matrix[7];
                data[offset + 10] = ${e}_matrix[8];
            `},{test:(e,t)=>e.type==="vec2"&&e.size===1&&!e.isArray&&t.x!==void 0,code:e=>`
                cv = ud["${e}"].value;
                v = uv["${e}"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["${e}"].location, v.x, v.y);
                }`,codeUbo:e=>`
                v = uv.${e};

                data[offset] = v.x;
                data[offset+1] = v.y;
            `},{test:e=>e.type==="vec2"&&e.size===1&&!e.isArray,code:e=>`
                cv = ud["${e}"].value;
                v = uv["${e}"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["${e}"].location, v[0], v[1]);
                }
            `},{test:(e,t)=>e.type==="vec4"&&e.size===1&&!e.isArray&&t.width!==void 0,code:e=>`
                cv = ud["${e}"].value;
                v = uv["${e}"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["${e}"].location, v.x, v.y, v.width, v.height)
                }`,codeUbo:e=>`
                    v = uv.${e};

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                    data[offset+2] = v.width;
                    data[offset+3] = v.height;
                `},{test:(e,t)=>e.type==="vec4"&&e.size===1&&!e.isArray&&t.red!==void 0,code:e=>`
                cv = ud["${e}"].value;
                v = uv["${e}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
                    cv[3] = v.alpha;
                    gl.uniform4f(ud["${e}"].location, v.red, v.green, v.blue, v.alpha)
                }`,codeUbo:e=>`
                    v = uv.${e};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                    data[offset+3] = v.alpha;
                `},{test:(e,t)=>e.type==="vec3"&&e.size===1&&!e.isArray&&t.red!==void 0,code:e=>`
                cv = ud["${e}"].value;
                v = uv["${e}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
    
                    gl.uniform3f(ud["${e}"].location, v.red, v.green, v.blue)
                }`,codeUbo:e=>`
                    v = uv.${e};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                `},{test:e=>e.type==="vec4"&&e.size===1&&!e.isArray,code:e=>`
                cv = ud["${e}"].value;
                v = uv["${e}"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["${e}"].location, v[0], v[1], v[2], v[3])
                }`}],Jx={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},Qx={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function t0(e,t){var i;const s=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(const r in e.uniforms){const n=t[r];if(!n){(i=e.uniforms[r])!=null&&i.group&&(e.uniforms[r].ubo?s.push(`
                        renderer.shader.syncUniformBufferGroup(uv.${r}, '${r}');
                    `):s.push(`
                        renderer.shader.syncUniformGroup(uv.${r}, syncData);
                    `));continue}const o=e.uniforms[r];let a=!1;for(let l=0;l<Di.length;l++)if(Di[l].test(n,o)){s.push(Di[l].code(r,o)),a=!0;break}if(!a){const h=(n.size===1&&!n.isArray?Jx:Qx)[n.type].replace("location",`ud["${r}"].location`);s.push(`
            cu = ud["${r}"];
            cv = cu.value;
            v = uv["${r}"];
            ${h};`)}}return new Function("ud","uv","renderer","syncData",s.join(`
`))}const zd={};let pi=zd;function e0(){if(pi===zd||pi!=null&&pi.isContextLost()){const e=q.ADAPTER.createCanvas();let t;q.PREFER_ENV>=li.WEBGL2&&(t=e.getContext("webgl2",{})),t||(t=e.getContext("webgl",{})||e.getContext("experimental-webgl",{}),t?t.getExtension("WEBGL_draw_buffers"):t=null),pi=t}return pi}let Qr;function s0(){if(!Qr){Qr=be.MEDIUM;const e=e0();e&&e.getShaderPrecisionFormat&&(Qr=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision?be.HIGH:be.MEDIUM)}return Qr}function Pc(e,t){const s=e.getShaderSource(t).split(`
`).map((h,c)=>`${c}: ${h}`),i=e.getShaderInfoLog(t),r=i.split(`
`),n={},o=r.map(h=>parseFloat(h.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(h=>h&&!n[h]?(n[h]=!0,!0):!1),a=[""];o.forEach(h=>{s[h-1]=`%c${s[h-1]}%c`,a.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});const l=s.join(`
`);a[0]=l,console.error(i),console.groupCollapsed("click to view full shader code"),console.warn(...a),console.groupEnd()}function i0(e,t,s,i){e.getProgramParameter(t,e.LINK_STATUS)||(e.getShaderParameter(s,e.COMPILE_STATUS)||Pc(e,s),e.getShaderParameter(i,e.COMPILE_STATUS)||Pc(e,i),console.error("PixiJS Error: Could not initialize shader."),e.getProgramInfoLog(t)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",e.getProgramInfoLog(t)))}const r0={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function jd(e){return r0[e]}let tn=null;const Mc={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function Vd(e,t){if(!tn){const s=Object.keys(Mc);tn={};for(let i=0;i<s.length;++i){const r=s[i];tn[e[r]]=Mc[r]}}return tn[t]}function Oc(e,t,s){if(e.substring(0,9)!=="precision"){let i=t;return t===be.HIGH&&s!==be.HIGH&&(i=be.MEDIUM),`precision ${i} float;
${e}`}else if(s!==be.HIGH&&e.substring(0,15)==="precision highp")return e.replace("precision highp","precision mediump");return e}let Ji;function n0(){if(typeof Ji=="boolean")return Ji;try{Ji=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{Ji=!1}return Ji}let o0=0;const en={},xi=class{constructor(e,t,s="pixi-shader",i={}){this.extra={},this.id=o0++,this.vertexSrc=e||xi.defaultVertexSrc,this.fragmentSrc=t||xi.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=i,this.vertexSrc.substring(0,8)!=="#version"&&(s=s.replace(/\s+/g,"-"),en[s]?(en[s]++,s+=`-${en[s]}`):en[s]=1,this.vertexSrc=`#define SHADER_NAME ${s}
${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${s}
${this.fragmentSrc}`,this.vertexSrc=Oc(this.vertexSrc,xi.defaultVertexPrecision,be.HIGH),this.fragmentSrc=Oc(this.fragmentSrc,xi.defaultFragmentPrecision,s0())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return Zx}static get defaultFragmentSrc(){return qx}static from(e,t,s){const i=e+t;let r=wc[i];return r||(wc[i]=r=new xi(e,t,s)),r}};let Le=xi;Le.defaultVertexPrecision=be.HIGH;Le.defaultFragmentPrecision=ds.apple.device?be.HIGH:be.MEDIUM;let a0=0;class Ge{constructor(t,s,i){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=a0++,this.static=!!s,this.ubo=!!i,t instanceof qt?(this.buffer=t,this.buffer.type=ts.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=t,this.ubo&&(this.buffer=new qt(new Float32Array(1)),this.buffer.type=ts.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(t,s,i){if(!this.ubo)this.uniforms[t]=new Ge(s,i);else throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them")}static from(t,s,i){return new Ge(t,s,i)}static uboFrom(t,s){return new Ge(t,s??!0,!0)}}class es{constructor(t,s){this.uniformBindCount=0,this.program=t,s?s instanceof Ge?this.uniformGroup=s:this.uniformGroup=new Ge(s):this.uniformGroup=new Ge({}),this.disposeRunner=new ke("disposeShader")}checkUniformExists(t,s){if(s.uniforms[t])return!0;for(const i in s.uniforms){const r=s.uniforms[i];if(r.group&&this.checkUniformExists(t,r))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(t,s,i){const r=Le.from(t,s);return new es(r,i)}}class l0{constructor(t,s){if(this.vertexSrc=t,this.fragTemplate=s,this.programCache={},this.defaultGroupCache={},!s.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!s.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(t){if(!this.programCache[t]){const i=new Int32Array(t);for(let n=0;n<t;n++)i[n]=n;this.defaultGroupCache[t]=Ge.from({uSamplers:i},!0);let r=this.fragTemplate;r=r.replace(/%count%/gi,`${t}`),r=r.replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new Le(this.vertexSrc,r)}const s={tint:new Float32Array([1,1,1,1]),translationMatrix:new Ut,default:this.defaultGroupCache[t]};return new es(this.programCache[t],s)}generateSampleSrc(t){let s="";s+=`
`,s+=`
`;for(let i=0;i<t;i++)i>0&&(s+=`
else `),i<t-1&&(s+=`if(vTextureId < ${i}.5)`),s+=`
{`,s+=`
	color = texture2D(uSamplers[${i}], vTextureCoord);`,s+=`
}`;return s+=`
`,s+=`
`,s}}class Za{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let t=0;t<this.count;t++)this.elements[t]=null;this.count=0}}function h0(){return!ds.apple.device}function c0(e){let t=!0;const s=q.ADAPTER.getNavigator();if(ds.tablet||ds.phone){if(ds.apple.device){const i=s.userAgent.match(/OS (\d+)_(\d+)?/);i&&parseInt(i[1],10)<11&&(t=!1)}if(ds.android.device){const i=s.userAgent.match(/Android\s([0-9.]*)/);i&&parseInt(i[1],10)<7&&(t=!1)}}return t?e:4}class mo{constructor(t){this.renderer=t}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(t){}}var u0=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`,d0=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`;const Re=class extends mo{constructor(e){super(e),this.setShaderGenerator(),this.geometryClass=Hd,this.vertexSize=6,this.state=xs.for2d(),this.size=Re.defaultBatchSize*4,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),e.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){return this._defaultMaxTextures=this._defaultMaxTextures??c0(32),this._defaultMaxTextures}static set defaultMaxTextures(e){this._defaultMaxTextures=e}static get canUploadSameBuffer(){return this._canUploadSameBuffer=this._canUploadSameBuffer??h0(),this._canUploadSameBuffer}static set canUploadSameBuffer(e){this._canUploadSameBuffer=e}get MAX_TEXTURES(){return Et("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return d0}static get defaultFragmentTemplate(){return u0}setShaderGenerator({vertex:e=Re.defaultVertexSrc,fragment:t=Re.defaultFragmentTemplate}={}){this.shaderGenerator=new l0(e,t)}contextChange(){const e=this.renderer.gl;q.PREFER_ENV===li.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),Re.defaultMaxTextures),this.maxTextures=Gx(this.maxTextures,e)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:e,_textureArrayPool:t}=Re,s=this.size/4,i=Math.floor(s/this.maxTextures)+1;for(;e.length<s;)e.push(new Ka);for(;t.length<i;)t.push(new Za);for(let r=0;r<this.maxTextures;r++)this._tempBoundTextures[r]=null}onPrerender(){this._flushId=0}render(e){e._texture.valid&&(this._vertexCount+e.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=e.vertexData.length/2,this._indexCount+=e.indices.length,this._bufferedTextures[this._bufferSize]=e._texture.baseTexture,this._bufferedElements[this._bufferSize++]=e)}buildTexturesAndDrawCalls(){const{_bufferedTextures:e,maxTextures:t}=this,s=Re._textureArrayPool,i=this.renderer.batch,r=this._tempBoundTextures,n=this.renderer.textureGC.count;let o=++pt._globalBatch,a=0,l=s[0],h=0;i.copyBoundTextures(r,t);for(let c=0;c<this._bufferSize;++c){const u=e[c];e[c]=null,u._batchEnabled!==o&&(l.count>=t&&(i.boundArray(l,r,o,t),this.buildDrawCalls(l,h,c),h=c,l=s[++a],++o),u._batchEnabled=o,u.touched=n,l.elements[l.count++]=u)}l.count>0&&(i.boundArray(l,r,o,t),this.buildDrawCalls(l,h,this._bufferSize),++a,++o);for(let c=0;c<r.length;c++)r[c]=null;pt._globalBatch=o}buildDrawCalls(e,t,s){const{_bufferedElements:i,_attributeBuffer:r,_indexBuffer:n,vertexSize:o}=this,a=Re._drawCallPool;let l=this._dcIndex,h=this._aIndex,c=this._iIndex,u=a[l];u.start=this._iIndex,u.texArray=e;for(let d=t;d<s;++d){const p=i[d],f=p._texture.baseTexture,m=Ld[f.alphaMode?1:0][p.blendMode];i[d]=null,t<d&&u.blend!==m&&(u.size=c-u.start,t=d,u=a[++l],u.texArray=e,u.start=c),this.packInterleavedGeometry(p,r,n,h,c),h+=p.vertexData.length/2*o,c+=p.indices.length,u.blend=m}t<s&&(u.size=c-u.start,++l),this._dcIndex=l,this._aIndex=h,this._iIndex=c}bindAndClearTexArray(e){const t=this.renderer.texture;for(let s=0;s<e.count;s++)t.bind(e.elements[s],e.ids[s]),e.elements[s]=null;e.count=0}updateGeometry(){const{_packedGeometries:e,_attributeBuffer:t,_indexBuffer:s}=this;Re.canUploadSameBuffer?(e[this._flushId]._buffer.update(t.rawBinaryData),e[this._flushId]._indexBuffer.update(s),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,e[this._flushId]=new this.geometryClass),e[this._flushId]._buffer.update(t.rawBinaryData),e[this._flushId]._indexBuffer.update(s),this.renderer.geometry.bind(e[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const e=this._dcIndex,{gl:t,state:s}=this.renderer,i=Re._drawCallPool;let r=null;for(let n=0;n<e;n++){const{texArray:o,type:a,size:l,start:h,blend:c}=i[n];r!==o&&(r=o,this.bindAndClearTexArray(o)),this.state.blendMode=c,s.set(this.state),t.drawElements(a,l,t.UNSIGNED_SHORT,h*2)}}flush(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),Re.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]&&this._packedGeometries[e].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(e){const t=Un(Math.ceil(e/8)),s=Tc(t),i=t*8;this._aBuffers.length<=s&&(this._iBuffers.length=s+1);let r=this._aBuffers[i];return r||(this._aBuffers[i]=r=new Va(i*this.vertexSize*4)),r}getIndexBuffer(e){const t=Un(Math.ceil(e/12)),s=Tc(t),i=t*12;this._iBuffers.length<=s&&(this._iBuffers.length=s+1);let r=this._iBuffers[s];return r||(this._iBuffers[s]=r=new Uint16Array(i)),r}packInterleavedGeometry(e,t,s,i,r){const{uint32View:n,float32View:o}=t,a=i/this.vertexSize,l=e.uvs,h=e.indices,c=e.vertexData,u=e._texture.baseTexture._batchLocation,d=Math.min(e.worldAlpha,1),p=Dt.shared.setValue(e._tintRGB).toPremultiplied(d,e._texture.baseTexture.alphaMode>0);for(let f=0;f<c.length;f+=2)o[i++]=c[f],o[i++]=c[f+1],o[i++]=l[f],o[i++]=l[f+1],n[i++]=p,o[i++]=u;for(let f=0;f<h.length;f++)s[r++]=a+h[f]}};let xe=Re;xe.defaultBatchSize=4096;xe.extension={name:"batch",type:Z.RendererPlugin};xe._drawCallPool=[];xe._textureArrayPool=[];rt.add(xe);var f0=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`,p0=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const rr=class extends es{constructor(e,t,s){const i=Le.from(e||rr.defaultVertexSrc,t||rr.defaultFragmentSrc);super(i,s),this.padding=0,this.resolution=rr.defaultResolution,this.multisample=rr.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new xs}apply(e,t,s,i,r){e.applyFilter(this,t,s,i)}get blendMode(){return this.state.blendMode}set blendMode(e){this.state.blendMode=e}get resolution(){return this._resolution}set resolution(e){this._resolution=e}static get defaultVertexSrc(){return p0}static get defaultFragmentSrc(){return f0}};let re=rr;re.defaultResolution=1;re.defaultMultisample=jt.NONE;class go{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new Dt(0),this.alpha=1}init(t){this.clearBeforeRender=t.clearBeforeRender;const{backgroundColor:s,background:i,backgroundAlpha:r}=t,n=i??s;n!==void 0&&(this.color=n),this.alpha=r}get color(){return this._backgroundColor.value}set color(t){this._backgroundColor.setValue(t)}get alpha(){return this._backgroundColor.alpha}set alpha(t){this._backgroundColor.setAlpha(t)}get backgroundColor(){return this._backgroundColor}destroy(){}}go.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0};go.extension={type:[Z.RendererSystem,Z.CanvasRendererSystem],name:"background"};rt.add(go);class Yd{constructor(t){this.renderer=t,this.emptyRenderer=new mo(t),this.currentRenderer=this.emptyRenderer}setObjectRenderer(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(t,s){const{boundTextures:i}=this.renderer.texture;for(let r=s-1;r>=0;--r)t[r]=i[r]||null,t[r]&&(t[r]._batchLocation=r)}boundArray(t,s,i,r){const{elements:n,ids:o,count:a}=t;let l=0;for(let h=0;h<a;h++){const c=n[h],u=c._batchLocation;if(u>=0&&u<r&&s[u]===c){o[h]=u;continue}for(;l<r;){const d=s[l];if(d&&d._batchEnabled===i&&d._batchLocation===l){l++;continue}o[h]=l,c._batchLocation=l,s[l]=c;break}}}destroy(){this.renderer=null}}Yd.extension={type:Z.RendererSystem,name:"batch"};rt.add(Yd);let Bc=0;class _o{constructor(t){this.renderer=t,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=Bc++}init(t){if(t.context)this.initFromContext(t.context);else{const s=this.renderer.background.alpha<1,i=t.premultipliedAlpha;this.preserveDrawingBuffer=t.preserveDrawingBuffer,this.useContextAlpha=t.useContextAlpha,this.powerPreference=t.powerPreference,this.initFromOptions({alpha:s,premultipliedAlpha:i,antialias:t.antialias,stencil:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,powerPreference:t.powerPreference})}}initFromContext(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=Bc++,this.renderer.runners.contextChange.emit(t);const s=this.renderer.view;s.addEventListener!==void 0&&(s.addEventListener("webglcontextlost",this.handleContextLost,!1),s.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(t){const s=this.createContext(this.renderer.view,t);this.initFromContext(s)}createContext(t,s){let i;if(q.PREFER_ENV>=li.WEBGL2&&(i=t.getContext("webgl2",s)),i)this.webGLVersion=2;else if(this.webGLVersion=1,i=t.getContext("webgl",s)||t.getContext("experimental-webgl",s),!i)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=i,this.getExtensions(),this.gl}getExtensions(){const{gl:t}=this,s={loseContext:t.getExtension("WEBGL_lose_context"),anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc")};this.webGLVersion===1?Object.assign(this.extensions,s,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,s,{colorBufferFloat:t.getExtension("EXT_color_buffer_float")})}handleContextLost(t){t.preventDefault(),setTimeout(()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()},0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const t=this.renderer.view;this.renderer=null,t.removeEventListener!==void 0&&(t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(t){const s=t.getContextAttributes(),i="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext;i&&(this.webGLVersion=2),s&&!s.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const r=i||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=r,r||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}}_o.defaultOptions={context:null,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"};_o.extension={type:Z.RendererSystem,name:"context"};rt.add(_o);class m0 extends Br{upload(t,s,i){const r=t.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s.alphaMode===He.UNPACK);const n=s.realWidth,o=s.realHeight;return i.width===n&&i.height===o?r.texSubImage2D(s.target,0,0,0,n,o,s.format,i.type,this.data):(i.width=n,i.height=o,r.texImage2D(s.target,0,i.internalFormat,n,o,0,s.format,i.type,this.data)),!0}}class Ja{constructor(t,s){this.width=Math.round(t||100),this.height=Math.round(s||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new ke("disposeFramebuffer"),this.multisample=jt.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(t=0,s){return this.colorTextures[t]=s||new pt(null,{scaleMode:us.NEAREST,resolution:1,mipmap:is.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(t){return this.depthTexture=t||new pt(new m0(null,{width:this.width,height:this.height}),{scaleMode:us.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:is.OFF,format:X.DEPTH_COMPONENT,type:lt.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(t,s){if(t=Math.round(t),s=Math.round(s),!(t===this.width&&s===this.height)){this.width=t,this.height=s,this.dirtyId++,this.dirtySize++;for(let i=0;i<this.colorTextures.length;i++){const r=this.colorTextures[i],n=r.resolution;r.setSize(t/n,s/n)}if(this.depthTexture){const i=this.depthTexture.resolution;this.depthTexture.setSize(t/i,s/i)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class Kd extends pt{constructor(t={}){if(typeof t=="number"){const s=arguments[0],i=arguments[1],r=arguments[2],n=arguments[3];t={width:s,height:i,scaleMode:r,resolution:n}}t.width=t.width||100,t.height=t.height||100,t.multisample??(t.multisample=jt.NONE),super(null,t),this.mipmap=is.OFF,this.valid=!0,this._clear=new Dt([0,0,0,0]),this.framebuffer=new Ja(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=t.multisample,this.maskStack=[],this.filterStack=[{}]}set clearColor(t){this._clear.setValue(t)}get clearColor(){return this._clear.value}get clear(){return this._clear}resize(t,s){this.framebuffer.resize(t*this.resolution,s*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class Fs extends Cr{constructor(t){const s=t,i=s.naturalWidth||s.videoWidth||s.width,r=s.naturalHeight||s.videoHeight||s.height;super(i,r),this.source=t,this.noSubImage=!1}static crossOrigin(t,s,i){i===void 0&&!s.startsWith("data:")?t.crossOrigin=Nx(s):i!==!1&&(t.crossOrigin=typeof i=="string"?i:"anonymous")}upload(t,s,i,r){const n=t.gl,o=s.realWidth,a=s.realHeight;if(r=r||this.source,typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement){if(!r.complete||r.naturalWidth===0)return!1}else if(typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement&&r.readyState<=1&&r.buffered.length===0)return!1;return n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s.alphaMode===He.UNPACK),!this.noSubImage&&s.target===n.TEXTURE_2D&&i.width===o&&i.height===a?n.texSubImage2D(n.TEXTURE_2D,0,0,0,s.format,i.type,r):(i.width=o,i.height=a,n.texImage2D(s.target,0,i.internalFormat,s.format,i.type,r)),!0}update(){if(this.destroyed)return;const t=this.source,s=t.naturalWidth||t.videoWidth||t.width,i=t.naturalHeight||t.videoHeight||t.height;this.resize(s,i),super.update()}dispose(){this.source=null}}class qd extends Fs{constructor(t,s){if(s=s||{},typeof t=="string"){const i=new Image;Fs.crossOrigin(i,t,s.crossorigin),i.src=t,t=i}super(t),!t.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=t.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(s.createBitmap??q.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode=typeof s.alphaMode=="number"?s.alphaMode:null,this.bitmap=null,this._load=null,s.autoLoad!==!1&&this.load()}load(t){return this._load?this._load:(t!==void 0&&(this.createBitmap=t),this._load=new Promise((s,i)=>{const r=this.source;this.url=r.src;const n=()=>{this.destroyed||(r.onload=null,r.onerror=null,this.resize(r.width,r.height),this._load=null,this.createBitmap?s(this.process()):s(this))};r.complete&&r.src?n():(r.onload=n,r.onerror=o=>{i(o),this.onError.emit(o)})}),this._load)}process(){const t=this.source;if(this._process!==null)return this._process;if(this.bitmap!==null||!globalThis.createImageBitmap)return Promise.resolve(this);const s=globalThis.createImageBitmap,i=!t.crossOrigin||t.crossOrigin==="anonymous";return this._process=fetch(t.src,{mode:i?"cors":"no-cors"}).then(r=>r.blob()).then(r=>s(r,0,0,t.width,t.height,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===He.UNPACK?"premultiply":"none"})).then(r=>this.destroyed?Promise.reject():(this.bitmap=r,this.update(),this._process=null,Promise.resolve(this))),this._process}upload(t,s,i){if(typeof this.alphaMode=="number"&&(s.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(t,s,i);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(t,s,i,this.bitmap),!this.preserveBitmap){let r=!0;const n=s._glTextures;for(const o in n){const a=n[o];if(a!==i&&a.dirtyId!==s.dirtyId){r=!1;break}}r&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(t){return typeof HTMLImageElement<"u"&&(typeof t=="string"||t instanceof HTMLImageElement)}}class Zd{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(t,s,i){const r=s.width,n=s.height;if(i){const o=t.width/2/r,a=t.height/2/n,l=t.x/r+o,h=t.y/n+a;i=Gt.add(i,Gt.NW),this.x0=l+o*Gt.uX(i),this.y0=h+a*Gt.uY(i),i=Gt.add(i,2),this.x1=l+o*Gt.uX(i),this.y1=h+a*Gt.uY(i),i=Gt.add(i,2),this.x2=l+o*Gt.uX(i),this.y2=h+a*Gt.uY(i),i=Gt.add(i,2),this.x3=l+o*Gt.uX(i),this.y3=h+a*Gt.uY(i)}else this.x0=t.x/r,this.y0=t.y/n,this.x1=(t.x+t.width)/r,this.y1=t.y/n,this.x2=(t.x+t.width)/r,this.y2=(t.y+t.height)/n,this.x3=t.x/r,this.y3=(t.y+t.height)/n;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}toString(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`}}const Dc=new Zd;function sn(e){e.destroy=function(){},e.on=function(){},e.once=function(){},e.emit=function(){}}class J extends ii{constructor(t,s,i,r,n,o,a){if(super(),this.noFrame=!1,s||(this.noFrame=!0,s=new xt(0,0,1,1)),t instanceof J&&(t=t.baseTexture),this.baseTexture=t,this._frame=s,this.trim=r,this.valid=!1,this._uvs=Dc,this.uvMatrix=null,this.orig=i||s,this._rotate=Number(n||0),n===!0)this._rotate=2;else if(this._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=o?new At(o.x,o.y):new At(0,0),this.defaultBorders=a,this._updateID=0,this.textureCacheIds=[],t.valid?this.noFrame?t.valid&&this.onBaseTextureUpdated(t):this.frame=s:t.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&t.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(t){if(this.baseTexture){if(t){const{resource:s}=this.baseTexture;s!=null&&s.url&&ze[s.url]&&J.removeFromCache(s.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,J.removeFromCache(this),this.textureCacheIds=null}clone(){var r;const t=this._frame.clone(),s=this._frame===this.orig?t:this.orig.clone(),i=new J(this.baseTexture,!this.noFrame&&t,s,(r=this.trim)==null?void 0:r.clone(),this.rotate,this.defaultAnchor,this.defaultBorders);return this.noFrame&&(i._frame=t),i}updateUvs(){this._uvs===Dc&&(this._uvs=new Zd),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(t,s={},i=q.STRICT_TEXTURE_CACHE){const r=typeof t=="string";let n=null;if(r)n=t;else if(t instanceof pt){if(!t.cacheId){const a=(s==null?void 0:s.pixiIdPrefix)||"pixiid";t.cacheId=`${a}-${ni()}`,pt.addToCache(t,t.cacheId)}n=t.cacheId}else{if(!t._pixiId){const a=(s==null?void 0:s.pixiIdPrefix)||"pixiid";t._pixiId=`${a}_${ni()}`}n=t._pixiId}let o=ze[n];if(r&&i&&!o)throw new Error(`The cacheId "${n}" does not exist in TextureCache.`);return!o&&!(t instanceof pt)?(s.resolution||(s.resolution=Ds(t)),o=new J(new pt(t,s)),o.baseTexture.cacheId=n,pt.addToCache(o.baseTexture,n),J.addToCache(o,n)):!o&&t instanceof pt&&(o=new J(t),J.addToCache(o,n)),o}static fromURL(t,s){const i=Object.assign({autoLoad:!1},s==null?void 0:s.resourceOptions),r=J.from(t,Object.assign({resourceOptions:i},s),!1),n=r.baseTexture.resource;return r.baseTexture.valid?Promise.resolve(r):n.load().then(()=>Promise.resolve(r))}static fromBuffer(t,s,i,r){return new J(pt.fromBuffer(t,s,i,r))}static fromLoader(t,s,i,r){const n=new pt(t,Object.assign({scaleMode:pt.defaultOptions.scaleMode,resolution:Ds(s)},r)),{resource:o}=n;o instanceof qd&&(o.url=s);const a=new J(n);return i||(i=s),pt.addToCache(a.baseTexture,i),J.addToCache(a,i),i!==s&&(pt.addToCache(a.baseTexture,s),J.addToCache(a,s)),a.baseTexture.valid?Promise.resolve(a):new Promise(l=>{a.baseTexture.once("loaded",()=>l(a))})}static addToCache(t,s){s&&(t.textureCacheIds.includes(s)||t.textureCacheIds.push(s),ze[s]&&ze[s]!==t&&console.warn(`Texture added to the cache with an id [${s}] that already had an entry`),ze[s]=t)}static removeFromCache(t){if(typeof t=="string"){const s=ze[t];if(s){const i=s.textureCacheIds.indexOf(t);return i>-1&&s.textureCacheIds.splice(i,1),delete ze[t],s}}else if(t!=null&&t.textureCacheIds){for(let s=0;s<t.textureCacheIds.length;++s)ze[t.textureCacheIds[s]]===t&&delete ze[t.textureCacheIds[s]];return t.textureCacheIds.length=0,t}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(t){this._frame=t,this.noFrame=!1;const{x:s,y:i,width:r,height:n}=t,o=s+r>this.baseTexture.width,a=i+n>this.baseTexture.height;if(o||a){const l=o&&a?"and":"or",h=`X: ${s} + ${r} = ${s+r} > ${this.baseTexture.width}`,c=`Y: ${i} + ${n} = ${i+n} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${h} ${l} ${c}`)}this.valid=r&&n&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=t),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(t){this._rotate=t,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return J._EMPTY||(J._EMPTY=new J(new pt),sn(J._EMPTY),sn(J._EMPTY.baseTexture)),J._EMPTY}static get WHITE(){if(!J._WHITE){const t=q.ADAPTER.createCanvas(16,16),s=t.getContext("2d");t.width=16,t.height=16,s.fillStyle="white",s.fillRect(0,0,16,16),J._WHITE=new J(pt.from(t)),sn(J._WHITE),sn(J._WHITE.baseTexture)}return J._WHITE}}class hi extends J{constructor(t,s){super(t,s),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,s,i=!0){const r=this.baseTexture.resolution,n=Math.round(t*r)/r,o=Math.round(s*r)/r;this.valid=n>0&&o>0,this._frame.width=this.orig.width=n,this._frame.height=this.orig.height=o,i&&this.baseTexture.resize(n,o),this.updateUvs()}setResolution(t){const{baseTexture:s}=this;s.resolution!==t&&(s.setResolution(t),this.resize(s.width,s.height,!1))}static create(t){return new hi(new Kd(t))}}class Jd{constructor(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(t,s,i=jt.NONE){const r=new Kd(Object.assign({width:t,height:s,resolution:1,multisample:i},this.textureOptions));return new hi(r)}getOptimalTexture(t,s,i=1,r=jt.NONE){let n;t=Math.ceil(t*i-1e-6),s=Math.ceil(s*i-1e-6),!this.enableFullScreen||t!==this._pixelsWidth||s!==this._pixelsHeight?(t=Un(t),s=Un(s),n=((t&65535)<<16|s&65535)>>>0,r>1&&(n+=r*4294967296)):n=r>1?-r:-1,this.texturePool[n]||(this.texturePool[n]=[]);let o=this.texturePool[n].pop();return o||(o=this.createTexture(t,s,r)),o.filterPoolKey=n,o.setResolution(i),o}getFilterTexture(t,s,i){const r=this.getOptimalTexture(t.width,t.height,s||t.resolution,i||jt.NONE);return r.filterFrame=t.filterFrame,r}returnTexture(t){const s=t.filterPoolKey;t.filterFrame=null,this.texturePool[s].push(t)}returnFilterTexture(t){this.returnTexture(t)}clear(t){if(t=t!==!1,t)for(const s in this.texturePool){const i=this.texturePool[s];if(i)for(let r=0;r<i.length;r++)i[r].destroy(!0)}this.texturePool={}}setScreenSize(t){if(!(t.width===this._pixelsWidth&&t.height===this._pixelsHeight)){this.enableFullScreen=t.width>0&&t.height>0;for(const s in this.texturePool){if(!(Number(s)<0))continue;const i=this.texturePool[s];if(i)for(let r=0;r<i.length;r++)i[r].destroy(!0);this.texturePool[s]=[]}this._pixelsWidth=t.width,this._pixelsHeight=t.height}}}Jd.SCREEN_KEY=-1;class g0 extends Ls{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}}class Qd extends Ls{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new qt(this.vertices),this.uvBuffer=new qt(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(t,s){let i=0,r=0;return this.uvs[0]=i,this.uvs[1]=r,this.uvs[2]=i+s.width/t.width,this.uvs[3]=r,this.uvs[4]=i+s.width/t.width,this.uvs[5]=r+s.height/t.height,this.uvs[6]=i,this.uvs[7]=r+s.height/t.height,i=s.x,r=s.y,this.vertices[0]=i,this.vertices[1]=r,this.vertices[2]=i+s.width,this.vertices[3]=r,this.vertices[4]=i+s.width,this.vertices[5]=r+s.height,this.vertices[6]=i,this.vertices[7]=r+s.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}class _0{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=jt.NONE,this.sourceFrame=new xt,this.destinationFrame=new xt,this.bindingSourceFrame=new xt,this.bindingDestinationFrame=new xt,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const rn=[new At,new At,new At,new At],ta=new Ut;class tf{constructor(t){this.renderer=t,this.defaultFilterStack=[{}],this.texturePool=new Jd,this.statePool=[],this.quad=new g0,this.quadUv=new Qd,this.tempRect=new xt,this.activeState={},this.globalUniforms=new Ge({outputFrame:new xt,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(t,s){const i=this.renderer,r=this.defaultFilterStack,n=this.statePool.pop()||new _0,o=this.renderer.renderTexture;let a=s[0].resolution,l=s[0].multisample,h=s[0].padding,c=s[0].autoFit,u=s[0].legacy??!0;for(let f=1;f<s.length;f++){const m=s[f];a=Math.min(a,m.resolution),l=Math.min(l,m.multisample),h=this.useMaxPadding?Math.max(h,m.padding):h+m.padding,c=c&&m.autoFit,u=u||(m.legacy??!0)}r.length===1&&(this.defaultFilterStack[0].renderTexture=o.current),r.push(n),n.resolution=a,n.multisample=l,n.legacy=u,n.target=t,n.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),n.sourceFrame.pad(h);const d=this.tempRect.copyFrom(o.sourceFrame);i.projection.transform&&this.transformAABB(ta.copyFrom(i.projection.transform).invert(),d),c?(n.sourceFrame.fit(d),(n.sourceFrame.width<=0||n.sourceFrame.height<=0)&&(n.sourceFrame.width=0,n.sourceFrame.height=0)):n.sourceFrame.intersects(d)||(n.sourceFrame.width=0,n.sourceFrame.height=0),this.roundFrame(n.sourceFrame,o.current?o.current.resolution:i.resolution,o.sourceFrame,o.destinationFrame,i.projection.transform),n.renderTexture=this.getOptimalFilterTexture(n.sourceFrame.width,n.sourceFrame.height,a,l),n.filters=s,n.destinationFrame.width=n.renderTexture.width,n.destinationFrame.height=n.renderTexture.height;const p=this.tempRect;p.x=0,p.y=0,p.width=n.sourceFrame.width,p.height=n.sourceFrame.height,n.renderTexture.filterFrame=n.sourceFrame,n.bindingSourceFrame.copyFrom(o.sourceFrame),n.bindingDestinationFrame.copyFrom(o.destinationFrame),n.transform=i.projection.transform,i.projection.transform=null,o.bind(n.renderTexture,n.sourceFrame,p),i.framebuffer.clear(0,0,0,0)}pop(){const t=this.defaultFilterStack,s=t.pop(),i=s.filters;this.activeState=s;const r=this.globalUniforms.uniforms;r.outputFrame=s.sourceFrame,r.resolution=s.resolution;const n=r.inputSize,o=r.inputPixel,a=r.inputClamp;if(n[0]=s.destinationFrame.width,n[1]=s.destinationFrame.height,n[2]=1/n[0],n[3]=1/n[1],o[0]=Math.round(n[0]*s.resolution),o[1]=Math.round(n[1]*s.resolution),o[2]=1/o[0],o[3]=1/o[1],a[0]=.5*o[2],a[1]=.5*o[3],a[2]=s.sourceFrame.width*n[2]-.5*o[2],a[3]=s.sourceFrame.height*n[3]-.5*o[3],s.legacy){const h=r.filterArea;h[0]=s.destinationFrame.width,h[1]=s.destinationFrame.height,h[2]=s.sourceFrame.x,h[3]=s.sourceFrame.y,r.filterClamp=r.inputClamp}this.globalUniforms.update();const l=t[t.length-1];if(this.renderer.framebuffer.blit(),i.length===1)i[0].apply(this,s.renderTexture,l.renderTexture,Ye.BLEND,s),this.returnFilterTexture(s.renderTexture);else{let h=s.renderTexture,c=this.getOptimalFilterTexture(h.width,h.height,s.resolution);c.filterFrame=h.filterFrame;let u=0;for(u=0;u<i.length-1;++u){u===1&&s.multisample>1&&(c=this.getOptimalFilterTexture(h.width,h.height,s.resolution),c.filterFrame=h.filterFrame),i[u].apply(this,h,c,Ye.CLEAR,s);const d=h;h=c,c=d}i[u].apply(this,h,l.renderTexture,Ye.BLEND,s),u>1&&s.multisample>1&&this.returnFilterTexture(s.renderTexture),this.returnFilterTexture(h),this.returnFilterTexture(c)}s.clear(),this.statePool.push(s)}bindAndClear(t,s=Ye.CLEAR){const{renderTexture:i,state:r}=this.renderer;if(t===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,t!=null&&t.filterFrame){const o=this.tempRect;o.x=0,o.y=0,o.width=t.filterFrame.width,o.height=t.filterFrame.height,i.bind(t,t.filterFrame,o)}else t!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?i.bind(t):this.renderer.renderTexture.bind(t,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const n=r.stateId&1||this.forceClear;(s===Ye.CLEAR||s===Ye.BLIT&&n)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(t,s,i,r){const n=this.renderer;n.state.set(t.state),this.bindAndClear(i,r),t.uniforms.uSampler=s,t.uniforms.filterGlobals=this.globalUniforms,n.shader.bind(t),t.legacy=!!t.program.attributeData.aTextureCoord,t.legacy?(this.quadUv.map(s._frame,s.filterFrame),n.geometry.bind(this.quadUv),n.geometry.draw(Je.TRIANGLES)):(n.geometry.bind(this.quad),n.geometry.draw(Je.TRIANGLE_STRIP))}calculateSpriteMatrix(t,s){const{sourceFrame:i,destinationFrame:r}=this.activeState,{orig:n}=s._texture,o=t.set(r.width,0,0,r.height,i.x,i.y),a=s.worldTransform.copyTo(Ut.TEMP_MATRIX);return a.invert(),o.prepend(a),o.scale(1/n.width,1/n.height),o.translate(s.anchor.x,s.anchor.y),o}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(t,s,i=1,r=jt.NONE){return this.texturePool.getOptimalTexture(t,s,i,r)}getFilterTexture(t,s,i){if(typeof t=="number"){const n=t;t=s,s=n}t=t||this.activeState.renderTexture;const r=this.texturePool.getOptimalTexture(t.width,t.height,s||t.resolution,i||jt.NONE);return r.filterFrame=t.filterFrame,r}returnFilterTexture(t){this.texturePool.returnTexture(t)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(t,s){const i=rn[0],r=rn[1],n=rn[2],o=rn[3];i.set(s.left,s.top),r.set(s.left,s.bottom),n.set(s.right,s.top),o.set(s.right,s.bottom),t.apply(i,i),t.apply(r,r),t.apply(n,n),t.apply(o,o);const a=Math.min(i.x,r.x,n.x,o.x),l=Math.min(i.y,r.y,n.y,o.y),h=Math.max(i.x,r.x,n.x,o.x),c=Math.max(i.y,r.y,n.y,o.y);s.x=a,s.y=l,s.width=h-a,s.height=c-l}roundFrame(t,s,i,r,n){if(!(t.width<=0||t.height<=0||i.width<=0||i.height<=0)){if(n){const{a:o,b:a,c:l,d:h}=n;if((Math.abs(a)>1e-4||Math.abs(l)>1e-4)&&(Math.abs(o)>1e-4||Math.abs(h)>1e-4))return}n=n?ta.copyFrom(n):ta.identity(),n.translate(-i.x,-i.y).scale(r.width/i.width,r.height/i.height).translate(r.x,r.y),this.transformAABB(n,t),t.ceil(s),this.transformAABB(n.invert(),t)}}}tf.extension={type:Z.RendererSystem,name:"filter"};rt.add(tf);class x0{constructor(t){this.framebuffer=t,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=jt.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const v0=new xt;class ef{constructor(t){this.renderer=t,this.managedFramebuffers=[],this.unknownFramebuffer=new Ja(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new xt,this.hasMRT=!0,this.writeDepthTexture=!0,this.renderer.context.webGLVersion===1){let s=this.renderer.context.extensions.drawBuffers,i=this.renderer.context.extensions.depthTexture;q.PREFER_ENV===li.WEBGL_LEGACY&&(s=null,i=null),s?t.drawBuffers=r=>s.drawBuffersWEBGL(r):(this.hasMRT=!1,t.drawBuffers=()=>{}),i||(this.writeDepthTexture=!1)}else this.msaaSamples=t.getInternalformatParameter(t.RENDERBUFFER,t.RGBA8,t.SAMPLES)}bind(t,s,i=0){const{gl:r}=this;if(t){const n=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,r.bindFramebuffer(r.FRAMEBUFFER,n.framebuffer)),n.mipLevel!==i&&(t.dirtyId++,t.dirtyFormat++,n.mipLevel=i),n.dirtyId!==t.dirtyId&&(n.dirtyId=t.dirtyId,n.dirtyFormat!==t.dirtyFormat?(n.dirtyFormat=t.dirtyFormat,n.dirtySize=t.dirtySize,this.updateFramebuffer(t,i)):n.dirtySize!==t.dirtySize&&(n.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(let o=0;o<t.colorTextures.length;o++){const a=t.colorTextures[o];this.renderer.texture.unbind(a.parentTextureArray||a)}if(t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),s){const o=s.width>>i,a=s.height>>i,l=o/s.width;this.setViewport(s.x*l,s.y*l,o,a)}else{const o=t.width>>i,a=t.height>>i;this.setViewport(0,0,o,a)}}else this.current&&(this.current=null,r.bindFramebuffer(r.FRAMEBUFFER,null)),s?this.setViewport(s.x,s.y,s.width,s.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(t,s,i,r){const n=this.viewport;t=Math.round(t),s=Math.round(s),i=Math.round(i),r=Math.round(r),(n.width!==i||n.height!==r||n.x!==t||n.y!==s)&&(n.x=t,n.y=s,n.width=i,n.height=r,this.gl.viewport(t,s,i,r))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(t,s,i,r,n=La.COLOR|La.DEPTH){const{gl:o}=this;o.clearColor(t,s,i,r),o.clear(n)}initFramebuffer(t){const{gl:s}=this,i=new x0(s.createFramebuffer());return i.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=i,this.managedFramebuffers.push(t),t.disposeRunner.add(this),i}resizeFramebuffer(t){const{gl:s}=this,i=t.glFramebuffers[this.CONTEXT_UID];i.stencil&&(s.bindRenderbuffer(s.RENDERBUFFER,i.stencil),i.msaaBuffer?s.renderbufferStorageMultisample(s.RENDERBUFFER,i.multisample,s.DEPTH24_STENCIL8,t.width,t.height):s.renderbufferStorage(s.RENDERBUFFER,s.DEPTH_STENCIL,t.width,t.height));const r=t.colorTextures;let n=r.length;s.drawBuffers||(n=Math.min(n,1));for(let o=0;o<n;o++){const a=r[o],l=a.parentTextureArray||a;this.renderer.texture.bind(l,0),o===0&&i.msaaBuffer&&(s.bindRenderbuffer(s.RENDERBUFFER,i.msaaBuffer),s.renderbufferStorageMultisample(s.RENDERBUFFER,i.multisample,l._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height))}t.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(t.depthTexture,0)}updateFramebuffer(t,s){const{gl:i}=this,r=t.glFramebuffers[this.CONTEXT_UID],n=t.colorTextures;let o=n.length;i.drawBuffers||(o=Math.min(o,1)),r.multisample>1&&this.canMultisampleFramebuffer(t)?r.msaaBuffer=r.msaaBuffer||i.createRenderbuffer():r.msaaBuffer&&(i.deleteRenderbuffer(r.msaaBuffer),r.msaaBuffer=null,r.blitFramebuffer&&(r.blitFramebuffer.dispose(),r.blitFramebuffer=null));const a=[];for(let l=0;l<o;l++){const h=n[l],c=h.parentTextureArray||h;this.renderer.texture.bind(c,0),l===0&&r.msaaBuffer?(i.bindRenderbuffer(i.RENDERBUFFER,r.msaaBuffer),i.renderbufferStorageMultisample(i.RENDERBUFFER,r.multisample,c._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.RENDERBUFFER,r.msaaBuffer)):(i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+l,h.target,c._glTextures[this.CONTEXT_UID].texture,s),a.push(i.COLOR_ATTACHMENT0+l))}if(a.length>1&&i.drawBuffers(a),t.depthTexture&&this.writeDepthTexture){const h=t.depthTexture;this.renderer.texture.bind(h,0),i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,h._glTextures[this.CONTEXT_UID].texture,s)}(t.stencil||t.depth)&&!(t.depthTexture&&this.writeDepthTexture)?(r.stencil=r.stencil||i.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,r.stencil),r.msaaBuffer?i.renderbufferStorageMultisample(i.RENDERBUFFER,r.multisample,i.DEPTH24_STENCIL8,t.width,t.height):i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,t.width,t.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,r.stencil)):r.stencil&&(i.deleteRenderbuffer(r.stencil),r.stencil=null)}canMultisampleFramebuffer(t){return this.renderer.context.webGLVersion!==1&&t.colorTextures.length<=1&&!t.depthTexture}detectSamples(t){const{msaaSamples:s}=this;let i=jt.NONE;if(t<=1||s===null)return i;for(let r=0;r<s.length;r++)if(s[r]<=t){i=s[r];break}return i===1&&(i=jt.NONE),i}blit(t,s,i){const{current:r,renderer:n,gl:o,CONTEXT_UID:a}=this;if(n.context.webGLVersion!==2||!r)return;const l=r.glFramebuffers[a];if(!l)return;if(!t){if(!l.msaaBuffer)return;const c=r.colorTextures[0];if(!c)return;l.blitFramebuffer||(l.blitFramebuffer=new Ja(r.width,r.height),l.blitFramebuffer.addColorTexture(0,c)),t=l.blitFramebuffer,t.colorTextures[0]!==c&&(t.colorTextures[0]=c,t.dirtyId++,t.dirtyFormat++),(t.width!==r.width||t.height!==r.height)&&(t.width=r.width,t.height=r.height,t.dirtyId++,t.dirtySize++)}s||(s=v0,s.width=r.width,s.height=r.height),i||(i=s);const h=s.width===i.width&&s.height===i.height;this.bind(t),o.bindFramebuffer(o.READ_FRAMEBUFFER,l.framebuffer),o.blitFramebuffer(s.left,s.top,s.right,s.bottom,i.left,i.top,i.right,i.bottom,o.COLOR_BUFFER_BIT,h?o.NEAREST:o.LINEAR),o.bindFramebuffer(o.READ_FRAMEBUFFER,t.glFramebuffers[this.CONTEXT_UID].framebuffer)}disposeFramebuffer(t,s){const i=t.glFramebuffers[this.CONTEXT_UID],r=this.gl;if(!i)return;delete t.glFramebuffers[this.CONTEXT_UID];const n=this.managedFramebuffers.indexOf(t);n>=0&&this.managedFramebuffers.splice(n,1),t.disposeRunner.remove(this),s||(r.deleteFramebuffer(i.framebuffer),i.msaaBuffer&&r.deleteRenderbuffer(i.msaaBuffer),i.stencil&&r.deleteRenderbuffer(i.stencil)),i.blitFramebuffer&&this.disposeFramebuffer(i.blitFramebuffer,s)}disposeAll(t){const s=this.managedFramebuffers;this.managedFramebuffers=[];for(let i=0;i<s.length;i++)this.disposeFramebuffer(s[i],t)}forceStencil(){const t=this.current;if(!t)return;const s=t.glFramebuffers[this.CONTEXT_UID];if(!s||s.stencil)return;t.stencil=!0;const i=t.width,r=t.height,n=this.gl,o=n.createRenderbuffer();n.bindRenderbuffer(n.RENDERBUFFER,o),s.msaaBuffer?n.renderbufferStorageMultisample(n.RENDERBUFFER,s.multisample,n.DEPTH24_STENCIL8,i,r):n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_STENCIL,i,r),s.stencil=o,n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,o)}reset(){this.current=this.unknownFramebuffer,this.viewport=new xt}destroy(){this.renderer=null}}ef.extension={type:Z.RendererSystem,name:"framebuffer"};rt.add(ef);const ea={5126:4,5123:2,5121:1};class sf{constructor(t){this.renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl,s=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,s.webGLVersion!==2){let i=this.renderer.context.extensions.vertexArrayObject;q.PREFER_ENV===li.WEBGL_LEGACY&&(i=null),i?(t.createVertexArray=()=>i.createVertexArrayOES(),t.bindVertexArray=r=>i.bindVertexArrayOES(r),t.deleteVertexArray=r=>i.deleteVertexArrayOES(r)):(this.hasVao=!1,t.createVertexArray=()=>null,t.bindVertexArray=()=>null,t.deleteVertexArray=()=>null)}if(s.webGLVersion!==2){const i=t.getExtension("ANGLE_instanced_arrays");i?(t.vertexAttribDivisor=(r,n)=>i.vertexAttribDivisorANGLE(r,n),t.drawElementsInstanced=(r,n,o,a,l)=>i.drawElementsInstancedANGLE(r,n,o,a,l),t.drawArraysInstanced=(r,n,o,a)=>i.drawArraysInstancedANGLE(r,n,o,a)):this.hasInstance=!1}this.canUseUInt32ElementIndex=s.webGLVersion===2||!!s.extensions.uint32ElementIndex}bind(t,s){s=s||this.renderer.shader.shader;const{gl:i}=this;let r=t.glVertexArrayObjects[this.CONTEXT_UID],n=!1;r||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=r={},n=!0);const o=r[s.program.id]||this.initGeometryVao(t,s,n);this._activeGeometry=t,this._activeVao!==o&&(this._activeVao=o,this.hasVao?i.bindVertexArray(o):this.activateVao(t,s.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const t=this._activeGeometry,s=this.renderer.buffer;for(let i=0;i<t.buffers.length;i++){const r=t.buffers[i];s.update(r)}}checkCompatibility(t,s){const i=t.attributes,r=s.attributeData;for(const n in r)if(!i[n])throw new Error(`shader and geometry incompatible, geometry missing the "${n}" attribute`)}getSignature(t,s){const i=t.attributes,r=s.attributeData,n=["g",t.id];for(const o in i)r[o]&&n.push(o,r[o].location);return n.join("-")}initGeometryVao(t,s,i=!0){const r=this.gl,n=this.CONTEXT_UID,o=this.renderer.buffer,a=s.program;a.glPrograms[n]||this.renderer.shader.generateProgram(s),this.checkCompatibility(t,a);const l=this.getSignature(t,a),h=t.glVertexArrayObjects[this.CONTEXT_UID];let c=h[l];if(c)return h[a.id]=c,c;const u=t.buffers,d=t.attributes,p={},f={};for(const m in u)p[m]=0,f[m]=0;for(const m in d)!d[m].size&&a.attributeData[m]?d[m].size=a.attributeData[m].size:d[m].size||console.warn(`PIXI Geometry attribute '${m}' size cannot be determined (likely the bound shader does not have the attribute)`),p[d[m].buffer]+=d[m].size*ea[d[m].type];for(const m in d){const _=d[m],v=_.size;_.stride===void 0&&(p[_.buffer]===v*ea[_.type]?_.stride=0:_.stride=p[_.buffer]),_.start===void 0&&(_.start=f[_.buffer],f[_.buffer]+=v*ea[_.type])}c=r.createVertexArray(),r.bindVertexArray(c);for(let m=0;m<u.length;m++){const _=u[m];o.bind(_),i&&_._glBuffers[n].refCount++}return this.activateVao(t,a),h[a.id]=c,h[l]=c,r.bindVertexArray(null),o.unbind(ts.ARRAY_BUFFER),c}disposeGeometry(t,s){var a;if(!this.managedGeometries[t.id])return;delete this.managedGeometries[t.id];const i=t.glVertexArrayObjects[this.CONTEXT_UID],r=this.gl,n=t.buffers,o=(a=this.renderer)==null?void 0:a.buffer;if(t.disposeRunner.remove(this),!!i){if(o)for(let l=0;l<n.length;l++){const h=n[l]._glBuffers[this.CONTEXT_UID];h&&(h.refCount--,h.refCount===0&&!s&&o.dispose(n[l],s))}if(!s){for(const l in i)if(l[0]==="g"){const h=i[l];this._activeVao===h&&this.unbind(),r.deleteVertexArray(h)}}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(t){const s=Object.keys(this.managedGeometries);for(let i=0;i<s.length;i++)this.disposeGeometry(this.managedGeometries[s[i]],t)}activateVao(t,s){const i=this.gl,r=this.CONTEXT_UID,n=this.renderer.buffer,o=t.buffers,a=t.attributes;t.indexBuffer&&n.bind(t.indexBuffer);let l=null;for(const h in a){const c=a[h],u=o[c.buffer],d=u._glBuffers[r];if(s.attributeData[h]){l!==d&&(n.bind(u),l=d);const p=s.attributeData[h].location;if(i.enableVertexAttribArray(p),i.vertexAttribPointer(p,c.size,c.type||i.FLOAT,c.normalized,c.stride,c.start),c.instance)if(this.hasInstance)i.vertexAttribDivisor(p,c.divisor);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}}draw(t,s,i,r){const{gl:n}=this,o=this._activeGeometry;if(o.indexBuffer){const a=o.indexBuffer.data.BYTES_PER_ELEMENT,l=a===2?n.UNSIGNED_SHORT:n.UNSIGNED_INT;a===2||a===4&&this.canUseUInt32ElementIndex?o.instanced?n.drawElementsInstanced(t,s||o.indexBuffer.data.length,l,(i||0)*a,r||1):n.drawElements(t,s||o.indexBuffer.data.length,l,(i||0)*a):console.warn("unsupported index buffer type: uint32")}else o.instanced?n.drawArraysInstanced(t,i,s||o.getSize(),r||1):n.drawArrays(t,i,s||o.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}sf.extension={type:Z.RendererSystem,name:"geometry"};rt.add(sf);const Lc=new Ut;class rf{constructor(t,s){this._texture=t,this.mapCoord=new Ut,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof s>"u"?.5:s,this.isSimple=!1}get texture(){return this._texture}set texture(t){this._texture=t,this._textureID=-1}multiplyUvs(t,s){s===void 0&&(s=t);const i=this.mapCoord;for(let r=0;r<t.length;r+=2){const n=t[r],o=t[r+1];s[r]=n*i.a+o*i.c+i.tx,s[r+1]=n*i.b+o*i.d+i.ty}return s}update(t){const s=this._texture;if(!s||!s.valid||!t&&this._textureID===s._updateID)return!1;this._textureID=s._updateID,this._updateID++;const i=s._uvs;this.mapCoord.set(i.x1-i.x0,i.y1-i.y0,i.x3-i.x0,i.y3-i.y0,i.x0,i.y0);const r=s.orig,n=s.trim;n&&(Lc.set(r.width/n.width,0,0,r.height/n.height,-n.x/n.width,-n.y/n.height),this.mapCoord.append(Lc));const o=s.baseTexture,a=this.uClampFrame,l=this.clampMargin/o.resolution,h=this.clampOffset;return a[0]=(s._frame.x+l+h)/o.width,a[1]=(s._frame.y+l+h)/o.height,a[2]=(s._frame.x+s._frame.width-l+h)/o.width,a[3]=(s._frame.y+s._frame.height-l+h)/o.height,this.uClampOffset[0]=h/o.realWidth,this.uClampOffset[1]=h/o.realHeight,this.isSimple=s._frame.width===o.width&&s._frame.height===o.height&&s.rotate===0,!0}}var y0=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`,E0=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`;class b0 extends re{constructor(t,s,i){let r=null;typeof t!="string"&&s===void 0&&i===void 0&&(r=t,t=void 0,s=void 0,i=void 0),super(t||E0,s||y0,i),this.maskSprite=r,this.maskMatrix=new Ut}get maskSprite(){return this._maskSprite}set maskSprite(t){this._maskSprite=t,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(t,s,i,r){const n=this._maskSprite,o=n._texture;o.valid&&(o.uvMatrix||(o.uvMatrix=new rf(o,0)),o.uvMatrix.update(),this.uniforms.npmAlpha=o.baseTexture.alphaMode?0:1,this.uniforms.mask=o,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,n).prepend(o.uvMatrix.mapCoord),this.uniforms.alpha=n.worldAlpha,this.uniforms.maskClamp=o.uvMatrix.uClampFrame,t.applyFilter(this,s,i,r))}}class T0{constructor(t=null){this.type=Kt.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=re.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(t){t?this._filters?this._filters[0]=t:this._filters=[t]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=Kt.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}class nf{constructor(t){this.renderer=t,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)}push(t,s){let i=s;if(!i.isMaskData){const n=this.maskDataPool.pop()||new T0;n.pooled=!0,n.maskObject=s,i=n}const r=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;if(i.copyCountersOrReset(r),i._colorMask=r?r._colorMask:15,i.autoDetect&&this.detect(i),i._target=t,i.type!==Kt.SPRITE&&this.maskStack.push(i),i.enabled)switch(i.type){case Kt.SCISSOR:this.renderer.scissor.push(i);break;case Kt.STENCIL:this.renderer.stencil.push(i);break;case Kt.SPRITE:i.copyCountersOrReset(null),this.pushSpriteMask(i);break;case Kt.COLOR:this.pushColorMask(i);break}i.type===Kt.SPRITE&&this.maskStack.push(i)}pop(t){const s=this.maskStack.pop();if(!(!s||s._target!==t)){if(s.enabled)switch(s.type){case Kt.SCISSOR:this.renderer.scissor.pop(s);break;case Kt.STENCIL:this.renderer.stencil.pop(s.maskObject);break;case Kt.SPRITE:this.popSpriteMask(s);break;case Kt.COLOR:this.popColorMask(s);break}if(s.reset(),s.pooled&&this.maskDataPool.push(s),this.maskStack.length!==0){const i=this.maskStack[this.maskStack.length-1];i.type===Kt.SPRITE&&i._filters&&(i._filters[0].maskSprite=i.maskObject)}}}detect(t){const s=t.maskObject;s?s.isSprite?t.type=Kt.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(t)?t.type=Kt.SCISSOR:t.type=Kt.STENCIL:t.type=Kt.COLOR}pushSpriteMask(t){const{maskObject:s}=t,i=t._target;let r=t._filters;r||(r=this.alphaMaskPool[this.alphaMaskIndex],r||(r=this.alphaMaskPool[this.alphaMaskIndex]=[new b0]));const n=this.renderer,o=n.renderTexture;let a,l;if(o.current){const c=o.current;a=t.resolution||c.resolution,l=t.multisample??c.multisample}else a=t.resolution||n.resolution,l=t.multisample??n.multisample;r[0].resolution=a,r[0].multisample=l,r[0].maskSprite=s;const h=i.filterArea;i.filterArea=s.getBounds(!0),n.filter.push(i,r),i.filterArea=h,t._filters||this.alphaMaskIndex++}popSpriteMask(t){this.renderer.filter.pop(),t._filters?t._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(t){const s=t._colorMask,i=t._colorMask=s&t.colorMask;i!==s&&this.renderer.gl.colorMask((i&1)!==0,(i&2)!==0,(i&4)!==0,(i&8)!==0)}popColorMask(t){const s=t._colorMask,i=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;i!==s&&this.renderer.gl.colorMask((i&1)!==0,(i&2)!==0,(i&4)!==0,(i&8)!==0)}destroy(){this.renderer=null}}nf.extension={type:Z.RendererSystem,name:"mask"};rt.add(nf);class of{constructor(t){this.renderer=t,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(t){const{gl:s}=this.renderer,i=this.getStackLength();this.maskStack=t;const r=this.getStackLength();r!==i&&(r===0?s.disable(this.glConst):(s.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const Fc=new Ut,Nc=[],yn=class extends of{constructor(e){super(e),this.glConst=q.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const e=this.maskStack[this.maskStack.length-1];return e?e._scissorCounter:0}calcScissorRect(e){if(e._scissorRectLocal)return;const t=e._scissorRect,{maskObject:s}=e,{renderer:i}=this,r=i.renderTexture,n=s.getBounds(!0,Nc.pop()??new xt);this.roundFrameToPixels(n,r.current?r.current.resolution:i.resolution,r.sourceFrame,r.destinationFrame,i.projection.transform),t&&n.fit(t),e._scissorRectLocal=n}static isMatrixRotated(e){if(!e)return!1;const{a:t,b:s,c:i,d:r}=e;return(Math.abs(s)>1e-4||Math.abs(i)>1e-4)&&(Math.abs(t)>1e-4||Math.abs(r)>1e-4)}testScissor(e){const{maskObject:t}=e;if(!t.isFastRect||!t.isFastRect()||yn.isMatrixRotated(t.worldTransform)||yn.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(e);const s=e._scissorRectLocal;return s.width>0&&s.height>0}roundFrameToPixels(e,t,s,i,r){yn.isMatrixRotated(r)||(r=r?Fc.copyFrom(r):Fc.identity(),r.translate(-s.x,-s.y).scale(i.width/s.width,i.height/s.height).translate(i.x,i.y),this.renderer.filter.transformAABB(r,e),e.fit(i),e.x=Math.round(e.x*t),e.y=Math.round(e.y*t),e.width=Math.round(e.width*t),e.height=Math.round(e.height*t))}push(e){e._scissorRectLocal||this.calcScissorRect(e);const{gl:t}=this.renderer;e._scissorRect||t.enable(t.SCISSOR_TEST),e._scissorCounter++,e._scissorRect=e._scissorRectLocal,this._useCurrent()}pop(e){const{gl:t}=this.renderer;e&&Nc.push(e._scissorRectLocal),this.getStackLength()>0?this._useCurrent():t.disable(t.SCISSOR_TEST)}_useCurrent(){const e=this.maskStack[this.maskStack.length-1]._scissorRect;let t;this.renderer.renderTexture.current?t=e.y:t=this.renderer.height-e.height-e.y,this.renderer.gl.scissor(e.x,t,e.width,e.height)}};let af=yn;af.extension={type:Z.RendererSystem,name:"scissor"};rt.add(af);class lf extends of{constructor(t){super(t),this.glConst=q.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0}push(t){const s=t.maskObject,{gl:i}=this.renderer,r=t._stencilCounter;r===0&&(this.renderer.framebuffer.forceStencil(),i.clearStencil(0),i.clear(i.STENCIL_BUFFER_BIT),i.enable(i.STENCIL_TEST)),t._stencilCounter++;const n=t._colorMask;n!==0&&(t._colorMask=0,i.colorMask(!1,!1,!1,!1)),i.stencilFunc(i.EQUAL,r,4294967295),i.stencilOp(i.KEEP,i.KEEP,i.INCR),s.renderable=!0,s.render(this.renderer),this.renderer.batch.flush(),s.renderable=!1,n!==0&&(t._colorMask=n,i.colorMask((n&1)!==0,(n&2)!==0,(n&4)!==0,(n&8)!==0)),this._useCurrent()}pop(t){const s=this.renderer.gl;if(this.getStackLength()===0)s.disable(s.STENCIL_TEST);else{const i=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null,r=i?i._colorMask:15;r!==0&&(i._colorMask=0,s.colorMask(!1,!1,!1,!1)),s.stencilOp(s.KEEP,s.KEEP,s.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,r!==0&&(i._colorMask=r,s.colorMask((r&1)!==0,(r&2)!==0,(r&4)!==0,(r&8)!==0)),this._useCurrent()}}_useCurrent(){const t=this.renderer.gl;t.stencilFunc(t.EQUAL,this.getStackLength(),4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)}}lf.extension={type:Z.RendererSystem,name:"stencil"};rt.add(lf);class hf{constructor(t){this.renderer=t,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get(){return Et("7.0.0","renderer.plugins.extract has moved to renderer.extract"),t.extract}},prepare:{enumerable:!1,get(){return Et("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),t.prepare}},interaction:{enumerable:!1,get(){return Et("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),t.events}}})}init(){const t=this.rendererPlugins;for(const s in t)this.plugins[s]=new t[s](this.renderer)}destroy(){for(const t in this.plugins)this.plugins[t].destroy(),this.plugins[t]=null}}hf.extension={type:[Z.RendererSystem,Z.CanvasRendererSystem],name:"_plugin"};rt.add(hf);class cf{constructor(t){this.renderer=t,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new Ut,this.transform=null}update(t,s,i,r){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=s||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,i,r),this.transform&&this.projectionMatrix.append(this.transform);const n=this.renderer;n.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,n.globalUniforms.update(),n.shader.shader&&n.shader.syncUniformGroup(n.shader.shader.uniforms.globals)}calculateProjection(t,s,i,r){const n=this.projectionMatrix,o=r?-1:1;n.identity(),n.a=1/s.width*2,n.d=o*(1/s.height*2),n.tx=-1-s.x*n.a,n.ty=-o-s.y*n.d}setTransform(t){}destroy(){this.renderer=null}}cf.extension={type:Z.RendererSystem,name:"projection"};rt.add(cf);const w0=new Yl;class uf{constructor(t){this.renderer=t,this._tempMatrix=new Ut}generateTexture(t,s){const{region:i,...r}=s||{},n=i||t.getLocalBounds(null,!0);n.width===0&&(n.width=1),n.height===0&&(n.height=1);const o=hi.create({width:n.width,height:n.height,...r});this._tempMatrix.tx=-n.x,this._tempMatrix.ty=-n.y;const a=t.transform;return t.transform=w0,this.renderer.render(t,{renderTexture:o,transform:this._tempMatrix,skipUpdateTransform:!!t.parent,blit:!0}),t.transform=a,o}destroy(){}}uf.extension={type:[Z.RendererSystem,Z.CanvasRendererSystem],name:"textureGenerator"};rt.add(uf);const Hs=new xt,Qi=new xt;class df{constructor(t){this.renderer=t,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new xt,this.destinationFrame=new xt,this.viewportFrame=new xt}contextChange(){var s;const t=(s=this.renderer)==null?void 0:s.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(t&&t.alpha&&t.premultipliedAlpha)}bind(t=null,s,i){const r=this.renderer;this.current=t;let n,o,a;t?(n=t.baseTexture,a=n.resolution,s||(Hs.width=t.frame.width,Hs.height=t.frame.height,s=Hs),i||(Qi.x=t.frame.x,Qi.y=t.frame.y,Qi.width=s.width,Qi.height=s.height,i=Qi),o=n.framebuffer):(a=r.resolution,s||(Hs.width=r._view.screen.width,Hs.height=r._view.screen.height,s=Hs),i||(i=Hs,i.width=s.width,i.height=s.height));const l=this.viewportFrame;l.x=i.x*a,l.y=i.y*a,l.width=i.width*a,l.height=i.height*a,t||(l.y=r.view.height-(l.y+l.height)),l.ceil(),this.renderer.framebuffer.bind(o,l),this.renderer.projection.update(i,s,a,!o),t?this.renderer.mask.setMaskStack(n.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(s),this.destinationFrame.copyFrom(i)}clear(t,s){const i=this.current?this.current.baseTexture.clear:this.renderer.background.backgroundColor,r=Dt.shared.setValue(t||i);(this.current&&this.current.baseTexture.alphaMode>0||!this.current&&this._rendererPremultipliedAlpha)&&r.premultiply(r.alpha);const n=this.destinationFrame,o=this.current?this.current.baseTexture:this.renderer._view.screen,a=n.width!==o.width||n.height!==o.height;if(a){let{x:l,y:h,width:c,height:u}=this.viewportFrame;l=Math.round(l),h=Math.round(h),c=Math.round(c),u=Math.round(u),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(l,h,c,u)}this.renderer.framebuffer.clear(r.red,r.green,r.blue,r.alpha,s),a&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}df.extension={type:Z.RendererSystem,name:"renderTexture"};rt.add(df);class S0{constructor(t,s){this.program=t,this.uniformData=s,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function A0(e,t){const s={},i=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let r=0;r<i;r++){const n=t.getActiveAttrib(e,r);if(n.name.startsWith("gl_"))continue;const o=Vd(t,n.type),a={type:o,name:n.name,size:jd(o),location:t.getAttribLocation(e,n.name)};s[n.name]=a}return s}function C0(e,t){const s={},i=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);for(let r=0;r<i;r++){const n=t.getActiveUniform(e,r),o=n.name.replace(/\[.*?\]$/,""),a=!!n.name.match(/\[.*?\]$/),l=Vd(t,n.type);s[o]={name:o,index:r,type:l,size:n.size,isArray:a,value:Xd(l,n.size)}}return s}function I0(e,t){var l;const s=Rc(e,e.VERTEX_SHADER,t.vertexSrc),i=Rc(e,e.FRAGMENT_SHADER,t.fragmentSrc),r=e.createProgram();e.attachShader(r,s),e.attachShader(r,i);const n=(l=t.extra)==null?void 0:l.transformFeedbackVaryings;if(n&&(typeof e.transformFeedbackVaryings!="function"?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):e.transformFeedbackVaryings(r,n.names,n.bufferMode==="separate"?e.SEPARATE_ATTRIBS:e.INTERLEAVED_ATTRIBS)),e.linkProgram(r),e.getProgramParameter(r,e.LINK_STATUS)||i0(e,r,s,i),t.attributeData=A0(r,e),t.uniformData=C0(r,e),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(t.vertexSrc)){const h=Object.keys(t.attributeData);h.sort((c,u)=>c>u?1:-1);for(let c=0;c<h.length;c++)t.attributeData[h[c]].location=c,e.bindAttribLocation(r,c,h[c]);e.linkProgram(r)}e.deleteShader(s),e.deleteShader(i);const o={};for(const h in t.uniformData){const c=t.uniformData[h];o[h]={location:e.getUniformLocation(r,h),value:Xd(c.type,c.size)}}return new S0(r,o)}function R0(e,t,s,i,r){s.buffer.update(r)}const P0={float:`
        data[offset] = v;
    `,vec2:`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,vec3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,vec4:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,mat2:`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,mat3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,mat4:`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `},ff={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:16*2,mat3:16*3,mat4:16*4};function M0(e){const t=e.map(n=>({data:n,offset:0,dataLen:0,dirty:0}));let s=0,i=0,r=0;for(let n=0;n<t.length;n++){const o=t[n];if(s=ff[o.data.type],o.data.size>1&&(s=Math.max(s,16)*o.data.size),o.dataLen=s,i%s!==0&&i<16){const a=i%s%16;i+=a,r+=a}i+s>16?(r=Math.ceil(r/16)*16,o.offset=r,r+=s,i=s):(o.offset=r,i+=s,r+=s)}return r=Math.ceil(r/16)*16,{uboElements:t,size:r}}function O0(e,t){const s=[];for(const i in e)t[i]&&s.push(t[i]);return s.sort((i,r)=>i.index-r.index),s}function B0(e,t){if(!e.autoManage)return{size:0,syncFunc:R0};const s=O0(e.uniforms,t),{uboElements:i,size:r}=M0(s),n=[`
    var v = null;
    var v2 = null;
    var cv = null;
    var t = 0;
    var gl = renderer.gl
    var index = 0;
    var data = buffer.data;
    `];for(let o=0;o<i.length;o++){const a=i[o],l=e.uniforms[a.data.name],h=a.data.name;let c=!1;for(let u=0;u<Di.length;u++){const d=Di[u];if(d.codeUbo&&d.test(a.data,l)){n.push(`offset = ${a.offset/4};`,Di[u].codeUbo(a.data.name,l)),c=!0;break}}if(!c)if(a.data.size>1){const u=jd(a.data.type),d=Math.max(ff[a.data.type]/16,1),p=u/d,f=(4-p%4)%4;n.push(`
                cv = ud.${h}.value;
                v = uv.${h};
                offset = ${a.offset/4};

                t = 0;

                for(var i=0; i < ${a.data.size*d}; i++)
                {
                    for(var j = 0; j < ${p}; j++)
                    {
                        data[offset++] = v[t++];
                    }
                    offset += ${f};
                }

                `)}else{const u=P0[a.data.type];n.push(`
                cv = ud.${h}.value;
                v = uv.${h};
                offset = ${a.offset/4};
                ${u};
                `)}}return n.push(`
       renderer.buffer.update(buffer);
    `),{size:r,syncFunc:new Function("ud","uv","renderer","syncData","buffer",n.join(`
`))}}let D0=0;const nn={textureCount:0,uboCount:0};class pf{constructor(t){this.destroyed=!1,this.renderer=t,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=D0++}systemCheck(){if(!n0())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(t){this.gl=t,this.reset()}bind(t,s){t.disposeRunner.add(this),t.uniforms.globals=this.renderer.globalUniforms;const i=t.program,r=i.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(t);return this.shader=t,this.program!==i&&(this.program=i,this.gl.useProgram(r.program)),s||(nn.textureCount=0,nn.uboCount=0,this.syncUniformGroup(t.uniformGroup,nn)),r}setUniforms(t){const s=this.shader.program,i=s.glPrograms[this.renderer.CONTEXT_UID];s.syncUniforms(i.uniformData,t,this.renderer)}syncUniformGroup(t,s){const i=this.getGlProgram();(!t.static||t.dirtyId!==i.uniformDirtyGroups[t.id])&&(i.uniformDirtyGroups[t.id]=t.dirtyId,this.syncUniforms(t,i,s))}syncUniforms(t,s,i){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(s.uniformData,t.uniforms,this.renderer,i)}createSyncGroups(t){const s=this.getSignature(t,this.shader.program.uniformData,"u");return this.cache[s]||(this.cache[s]=t0(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[s],t.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(t,s){const i=this.getGlProgram();if(!t.static||t.dirtyId!==0||!i.uniformGroups[t.id]){t.dirtyId=0;const r=i.uniformGroups[t.id]||this.createSyncBufferGroup(t,i,s);t.buffer.update(),r(i.uniformData,t.uniforms,this.renderer,nn,t.buffer)}this.renderer.buffer.bindBufferBase(t.buffer,i.uniformBufferBindings[s])}createSyncBufferGroup(t,s,i){const{gl:r}=this.renderer;this.renderer.buffer.bind(t.buffer);const n=this.gl.getUniformBlockIndex(s.program,i);s.uniformBufferBindings[i]=this.shader.uniformBindCount,r.uniformBlockBinding(s.program,n,this.shader.uniformBindCount),this.shader.uniformBindCount++;const o=this.getSignature(t,this.shader.program.uniformData,"ubo");let a=this._uboCache[o];if(a||(a=this._uboCache[o]=B0(t,this.shader.program.uniformData)),t.autoManage){const l=new Float32Array(a.size/4);t.buffer.update(l)}return s.uniformGroups[t.id]=a.syncFunc,s.uniformGroups[t.id]}getSignature(t,s,i){const r=t.uniforms,n=[`${i}-`];for(const o in r)n.push(o),s[o]&&n.push(s[o].type);return n.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(t){const s=this.gl,i=t.program,r=I0(s,i);return i.glPrograms[this.renderer.CONTEXT_UID]=r,r}reset(){this.program=null,this.shader=null}disposeShader(t){this.shader===t&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}pf.extension={type:Z.RendererSystem,name:"shader"};rt.add(pf);class xo{constructor(t){this.renderer=t}run(t){const{renderer:s}=this;s.runners.init.emit(s.options),t.hello&&console.log(`PixiJS 7.2.4 - ${s.rendererLogId} - https://pixijs.com`),s.resize(s.screen.width,s.screen.height)}destroy(){}}xo.defaultOptions={hello:!1};xo.extension={type:[Z.RendererSystem,Z.CanvasRendererSystem],name:"startup"};rt.add(xo);function L0(e,t=[]){return t[ct.NORMAL]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ct.ADD]=[e.ONE,e.ONE],t[ct.MULTIPLY]=[e.DST_COLOR,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ct.SCREEN]=[e.ONE,e.ONE_MINUS_SRC_COLOR,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ct.OVERLAY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ct.DARKEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ct.LIGHTEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ct.COLOR_DODGE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ct.COLOR_BURN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ct.HARD_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ct.SOFT_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ct.DIFFERENCE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ct.EXCLUSION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ct.HUE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ct.SATURATION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ct.COLOR]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ct.LUMINOSITY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ct.NONE]=[0,0],t[ct.NORMAL_NPM]=[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ct.ADD_NPM]=[e.SRC_ALPHA,e.ONE,e.ONE,e.ONE],t[ct.SCREEN_NPM]=[e.SRC_ALPHA,e.ONE_MINUS_SRC_COLOR,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ct.SRC_IN]=[e.DST_ALPHA,e.ZERO],t[ct.SRC_OUT]=[e.ONE_MINUS_DST_ALPHA,e.ZERO],t[ct.SRC_ATOP]=[e.DST_ALPHA,e.ONE_MINUS_SRC_ALPHA],t[ct.DST_OVER]=[e.ONE_MINUS_DST_ALPHA,e.ONE],t[ct.DST_IN]=[e.ZERO,e.SRC_ALPHA],t[ct.DST_OUT]=[e.ZERO,e.ONE_MINUS_SRC_ALPHA],t[ct.DST_ATOP]=[e.ONE_MINUS_DST_ALPHA,e.SRC_ALPHA],t[ct.XOR]=[e.ONE_MINUS_DST_ALPHA,e.ONE_MINUS_SRC_ALPHA],t[ct.SUBTRACT]=[e.ONE,e.ONE,e.ONE,e.ONE,e.FUNC_REVERSE_SUBTRACT,e.FUNC_ADD],t}const F0=0,N0=1,U0=2,k0=3,G0=4,H0=5,Qa=class{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=ct.NONE,this._blendEq=!1,this.map=[],this.map[F0]=this.setBlend,this.map[N0]=this.setOffset,this.map[U0]=this.setCullFace,this.map[k0]=this.setDepthTest,this.map[G0]=this.setFrontFace,this.map[H0]=this.setDepthMask,this.checks=[],this.defaultState=new xs,this.defaultState.blend=!0}contextChange(e){this.gl=e,this.blendModes=L0(e),this.set(this.defaultState),this.reset()}set(e){if(e=e||this.defaultState,this.stateId!==e.data){let t=this.stateId^e.data,s=0;for(;t;)t&1&&this.map[s].call(this,!!(e.data&1<<s)),t=t>>1,s++;this.stateId=e.data}for(let t=0;t<this.checks.length;t++)this.checks[t](this,e)}forceState(e){e=e||this.defaultState;for(let t=0;t<this.map.length;t++)this.map[t].call(this,!!(e.data&1<<t));for(let t=0;t<this.checks.length;t++)this.checks[t](this,e);this.stateId=e.data}setBlend(e){this.updateCheck(Qa.checkBlendMode,e),this.gl[e?"enable":"disable"](this.gl.BLEND)}setOffset(e){this.updateCheck(Qa.checkPolygonOffset,e),this.gl[e?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(e){this.gl[e?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(e){this.gl.depthMask(e)}setCullFace(e){this.gl[e?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(e){this.gl.frontFace(this.gl[e?"CW":"CCW"])}setBlendMode(e){if(e===this.blendMode)return;this.blendMode=e;const t=this.blendModes[e],s=this.gl;t.length===2?s.blendFunc(t[0],t[1]):s.blendFuncSeparate(t[0],t[1],t[2],t[3]),t.length===6?(this._blendEq=!0,s.blendEquationSeparate(t[4],t[5])):this._blendEq&&(this._blendEq=!1,s.blendEquationSeparate(s.FUNC_ADD,s.FUNC_ADD))}setPolygonOffset(e,t){this.gl.polygonOffset(e,t)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(e,t){const s=this.checks.indexOf(e);t&&s===-1?this.checks.push(e):!t&&s!==-1&&this.checks.splice(s,1)}static checkBlendMode(e,t){e.setBlendMode(t.blendMode)}static checkPolygonOffset(e,t){e.setPolygonOffset(1,t.polygonOffset)}destroy(){this.gl=null}};let mf=Qa;mf.extension={type:Z.RendererSystem,name:"state"};rt.add(mf);class $0 extends ii{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(t){this.addRunners(...t.runners);const s=(t.priority??[]).filter(r=>t.systems[r]),i=[...s,...Object.keys(t.systems).filter(r=>!s.includes(r))];for(const r of i)this.addSystem(t.systems[r],r)}addRunners(...t){t.forEach(s=>{this.runners[s]=new ke(s)})}addSystem(t,s){const i=new t(this);if(this[s])throw new Error(`Whoops! The name "${s}" is already in use`);this[s]=i,this._systemsHash[s]=i;for(const r in this.runners)this.runners[r].add(i);return this}emitWithCustomOptions(t,s){const i=Object.keys(this._systemsHash);t.items.forEach(r=>{const n=i.find(o=>this._systemsHash[o]===r);r[t.name](s[n])})}destroy(){Object.values(this.runners).forEach(t=>{t.destroy()}),this._systemsHash={}}}const En=class{constructor(e){this.renderer=e,this.count=0,this.checkCount=0,this.maxIdle=En.defaultMaxIdle,this.checkCountMax=En.defaultCheckCountMax,this.mode=En.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==co.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const e=this.renderer.texture,t=e.managedTextures;let s=!1;for(let i=0;i<t.length;i++){const r=t[i];!r.framebuffer&&this.count-r.touched>this.maxIdle&&(e.destroyTexture(r,!0),t[i]=null,s=!0)}if(s){let i=0;for(let r=0;r<t.length;r++)t[r]!==null&&(t[i++]=t[r]);t.length=i}}unload(e){const t=this.renderer.texture,s=e._texture;s&&!s.framebuffer&&t.destroyTexture(s);for(let i=e.children.length-1;i>=0;i--)this.unload(e.children[i])}destroy(){this.renderer=null}};let Ee=En;Ee.defaultMode=co.AUTO;Ee.defaultMaxIdle=60*60;Ee.defaultCheckCountMax=60*10;Ee.extension={type:Z.RendererSystem,name:"textureGC"};rt.add(Ee);class sa{constructor(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=lt.UNSIGNED_BYTE,this.internalFormat=X.RGBA,this.samplerType=0}}function W0(e){let t;return"WebGL2RenderingContext"in globalThis&&e instanceof globalThis.WebGL2RenderingContext?t={[lt.UNSIGNED_BYTE]:{[X.RGBA]:e.RGBA8,[X.RGB]:e.RGB8,[X.RG]:e.RG8,[X.RED]:e.R8,[X.RGBA_INTEGER]:e.RGBA8UI,[X.RGB_INTEGER]:e.RGB8UI,[X.RG_INTEGER]:e.RG8UI,[X.RED_INTEGER]:e.R8UI,[X.ALPHA]:e.ALPHA,[X.LUMINANCE]:e.LUMINANCE,[X.LUMINANCE_ALPHA]:e.LUMINANCE_ALPHA},[lt.BYTE]:{[X.RGBA]:e.RGBA8_SNORM,[X.RGB]:e.RGB8_SNORM,[X.RG]:e.RG8_SNORM,[X.RED]:e.R8_SNORM,[X.RGBA_INTEGER]:e.RGBA8I,[X.RGB_INTEGER]:e.RGB8I,[X.RG_INTEGER]:e.RG8I,[X.RED_INTEGER]:e.R8I},[lt.UNSIGNED_SHORT]:{[X.RGBA_INTEGER]:e.RGBA16UI,[X.RGB_INTEGER]:e.RGB16UI,[X.RG_INTEGER]:e.RG16UI,[X.RED_INTEGER]:e.R16UI,[X.DEPTH_COMPONENT]:e.DEPTH_COMPONENT16},[lt.SHORT]:{[X.RGBA_INTEGER]:e.RGBA16I,[X.RGB_INTEGER]:e.RGB16I,[X.RG_INTEGER]:e.RG16I,[X.RED_INTEGER]:e.R16I},[lt.UNSIGNED_INT]:{[X.RGBA_INTEGER]:e.RGBA32UI,[X.RGB_INTEGER]:e.RGB32UI,[X.RG_INTEGER]:e.RG32UI,[X.RED_INTEGER]:e.R32UI,[X.DEPTH_COMPONENT]:e.DEPTH_COMPONENT24},[lt.INT]:{[X.RGBA_INTEGER]:e.RGBA32I,[X.RGB_INTEGER]:e.RGB32I,[X.RG_INTEGER]:e.RG32I,[X.RED_INTEGER]:e.R32I},[lt.FLOAT]:{[X.RGBA]:e.RGBA32F,[X.RGB]:e.RGB32F,[X.RG]:e.RG32F,[X.RED]:e.R32F,[X.DEPTH_COMPONENT]:e.DEPTH_COMPONENT32F},[lt.HALF_FLOAT]:{[X.RGBA]:e.RGBA16F,[X.RGB]:e.RGB16F,[X.RG]:e.RG16F,[X.RED]:e.R16F},[lt.UNSIGNED_SHORT_5_6_5]:{[X.RGB]:e.RGB565},[lt.UNSIGNED_SHORT_4_4_4_4]:{[X.RGBA]:e.RGBA4},[lt.UNSIGNED_SHORT_5_5_5_1]:{[X.RGBA]:e.RGB5_A1},[lt.UNSIGNED_INT_2_10_10_10_REV]:{[X.RGBA]:e.RGB10_A2,[X.RGBA_INTEGER]:e.RGB10_A2UI},[lt.UNSIGNED_INT_10F_11F_11F_REV]:{[X.RGB]:e.R11F_G11F_B10F},[lt.UNSIGNED_INT_5_9_9_9_REV]:{[X.RGB]:e.RGB9_E5},[lt.UNSIGNED_INT_24_8]:{[X.DEPTH_STENCIL]:e.DEPTH24_STENCIL8},[lt.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[X.DEPTH_STENCIL]:e.DEPTH32F_STENCIL8}}:t={[lt.UNSIGNED_BYTE]:{[X.RGBA]:e.RGBA,[X.RGB]:e.RGB,[X.ALPHA]:e.ALPHA,[X.LUMINANCE]:e.LUMINANCE,[X.LUMINANCE_ALPHA]:e.LUMINANCE_ALPHA},[lt.UNSIGNED_SHORT_5_6_5]:{[X.RGB]:e.RGB},[lt.UNSIGNED_SHORT_4_4_4_4]:{[X.RGBA]:e.RGBA},[lt.UNSIGNED_SHORT_5_5_5_1]:{[X.RGBA]:e.RGBA}},t}class gf{constructor(t){this.renderer=t,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new pt,this.hasIntegerTextures=!1}contextChange(){const t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=W0(t);const s=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=s;for(let r=0;r<s;r++)this.boundTextures[r]=null;this.emptyTextures={};const i=new sa(t.createTexture());t.bindTexture(t.TEXTURE_2D,i.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=i,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new sa(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(let r=0;r<6;r++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+r,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(let r=0;r<this.boundTextures.length;r++)this.bind(null,r)}bind(t,s=0){const{gl:i}=this;if(t=t==null?void 0:t.castToBaseTexture(),t!=null&&t.valid&&!t.parentTextureArray){t.touched=this.renderer.textureGC.count;const r=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[s]!==t&&(this.currentLocation!==s&&(this.currentLocation=s,i.activeTexture(i.TEXTURE0+s)),i.bindTexture(t.target,r.texture)),r.dirtyId!==t.dirtyId?(this.currentLocation!==s&&(this.currentLocation=s,i.activeTexture(i.TEXTURE0+s)),this.updateTexture(t)):r.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(t),this.boundTextures[s]=t}else this.currentLocation!==s&&(this.currentLocation=s,i.activeTexture(i.TEXTURE0+s)),i.bindTexture(i.TEXTURE_2D,this.emptyTextures[i.TEXTURE_2D].texture),this.boundTextures[s]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture}unbind(t){const{gl:s,boundTextures:i}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let r=0;r<i.length;r++)i[r]===this.unknownTexture&&this.bind(null,r)}for(let r=0;r<i.length;r++)i[r]===t&&(this.currentLocation!==r&&(s.activeTexture(s.TEXTURE0+r),this.currentLocation=r),s.bindTexture(t.target,this.emptyTextures[t.target].texture),i[r]=null)}ensureSamplerType(t){const{boundTextures:s,hasIntegerTextures:i,CONTEXT_UID:r}=this;if(i)for(let n=t-1;n>=0;--n){const o=s[n];o&&o._glTextures[r].samplerType!==Fa.FLOAT&&this.renderer.texture.unbind(o)}}initTexture(t){const s=new sa(this.gl.createTexture());return s.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=s,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),s}initTextureType(t,s){var i;s.internalFormat=((i=this.internalFormats[t.type])==null?void 0:i[t.format])??t.format,this.webGLVersion===2&&t.type===lt.HALF_FLOAT?s.type=this.gl.HALF_FLOAT:s.type=t.type}updateTexture(t){var r;const s=t._glTextures[this.CONTEXT_UID];if(!s)return;const i=this.renderer;if(this.initTextureType(t,s),(r=t.resource)!=null&&r.upload(i,t,s))s.samplerType!==Fa.FLOAT&&(this.hasIntegerTextures=!0);else{const n=t.realWidth,o=t.realHeight,a=i.gl;(s.width!==n||s.height!==o||s.dirtyId<0)&&(s.width=n,s.height=o,a.texImage2D(t.target,0,s.internalFormat,n,o,0,t.format,s.type,null))}t.dirtyStyleId!==s.dirtyStyleId&&this.updateTextureStyle(t),s.dirtyId=t.dirtyId}destroyTexture(t,s){const{gl:i}=this;if(t=t.castToBaseTexture(),t._glTextures[this.CONTEXT_UID]&&(this.unbind(t),i.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!s)){const r=this.managedTextures.indexOf(t);r!==-1&&Oi(this.managedTextures,r,1)}}updateTextureStyle(t){var i;const s=t._glTextures[this.CONTEXT_UID];s&&((t.mipmap===is.POW2||this.webGLVersion!==2)&&!t.isPowerOfTwo?s.mipmap=!1:s.mipmap=t.mipmap>=1,this.webGLVersion!==2&&!t.isPowerOfTwo?s.wrapMode=Ms.CLAMP:s.wrapMode=t.wrapMode,(i=t.resource)!=null&&i.style(this.renderer,t,s)||this.setStyle(t,s),s.dirtyStyleId=t.dirtyStyleId)}setStyle(t,s){const i=this.gl;if(s.mipmap&&t.mipmap!==is.ON_MANUAL&&i.generateMipmap(t.target),i.texParameteri(t.target,i.TEXTURE_WRAP_S,s.wrapMode),i.texParameteri(t.target,i.TEXTURE_WRAP_T,s.wrapMode),s.mipmap){i.texParameteri(t.target,i.TEXTURE_MIN_FILTER,t.scaleMode===us.LINEAR?i.LINEAR_MIPMAP_LINEAR:i.NEAREST_MIPMAP_NEAREST);const r=this.renderer.context.extensions.anisotropicFiltering;if(r&&t.anisotropicLevel>0&&t.scaleMode===us.LINEAR){const n=Math.min(t.anisotropicLevel,i.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT));i.texParameterf(t.target,r.TEXTURE_MAX_ANISOTROPY_EXT,n)}}else i.texParameteri(t.target,i.TEXTURE_MIN_FILTER,t.scaleMode===us.LINEAR?i.LINEAR:i.NEAREST);i.texParameteri(t.target,i.TEXTURE_MAG_FILTER,t.scaleMode===us.LINEAR?i.LINEAR:i.NEAREST)}destroy(){this.renderer=null}}gf.extension={type:Z.RendererSystem,name:"texture"};rt.add(gf);class _f{constructor(t){this.renderer=t}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:s,CONTEXT_UID:i}=this,r=t._glTransformFeedbacks[i]||this.createGLTransformFeedback(t);s.bindTransformFeedback(s.TRANSFORM_FEEDBACK,r)}unbind(){const{gl:t}=this;t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(t,s){const{gl:i,renderer:r}=this;s&&r.shader.bind(s),i.beginTransformFeedback(t)}endTransformFeedback(){const{gl:t}=this;t.endTransformFeedback()}createGLTransformFeedback(t){const{gl:s,renderer:i,CONTEXT_UID:r}=this,n=s.createTransformFeedback();t._glTransformFeedbacks[r]=n,s.bindTransformFeedback(s.TRANSFORM_FEEDBACK,n);for(let o=0;o<t.buffers.length;o++){const a=t.buffers[o];a&&(i.buffer.update(a),a._glBuffers[r].refCount++,s.bindBufferBase(s.TRANSFORM_FEEDBACK_BUFFER,o,a._glBuffers[r].buffer||null))}return s.bindTransformFeedback(s.TRANSFORM_FEEDBACK,null),t.disposeRunner.add(this),n}disposeTransformFeedback(t,s){const i=t._glTransformFeedbacks[this.CONTEXT_UID],r=this.gl;t.disposeRunner.remove(this);const n=this.renderer.buffer;if(n)for(let o=0;o<t.buffers.length;o++){const a=t.buffers[o];if(!a)continue;const l=a._glBuffers[this.CONTEXT_UID];l&&(l.refCount--,l.refCount===0&&!s&&n.dispose(a,s))}i&&(s||r.deleteTransformFeedback(i),delete t._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}_f.extension={type:Z.RendererSystem,name:"transformFeedback"};rt.add(_f);class vo{constructor(t){this.renderer=t}init(t){this.screen=new xt(0,0,t.width,t.height),this.element=t.view||q.ADAPTER.createCanvas(),this.resolution=t.resolution||q.RESOLUTION,this.autoDensity=!!t.autoDensity}resizeView(t,s){this.element.width=Math.round(t*this.resolution),this.element.height=Math.round(s*this.resolution);const i=this.element.width/this.resolution,r=this.element.height/this.resolution;this.screen.width=i,this.screen.height=r,this.autoDensity&&(this.element.style.width=`${i}px`,this.element.style.height=`${r}px`),this.renderer.emit("resize",i,r),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(t){var s;t&&((s=this.element.parentNode)==null||s.removeChild(this.element)),this.renderer=null,this.element=null,this.screen=null}}vo.defaultOptions={width:800,height:600,resolution:q.RESOLUTION,autoDensity:!1};vo.extension={type:[Z.RendererSystem,Z.CanvasRendererSystem],name:"_view"};rt.add(vo);q.PREFER_ENV=li.WEBGL2;q.STRICT_TEXTURE_CACHE=!1;q.RENDER_OPTIONS={..._o.defaultOptions,...go.defaultOptions,...vo.defaultOptions,...xo.defaultOptions};Object.defineProperties(q,{WRAP_MODE:{get(){return pt.defaultOptions.wrapMode},set(e){Et("7.1.0","settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),pt.defaultOptions.wrapMode=e}},SCALE_MODE:{get(){return pt.defaultOptions.scaleMode},set(e){Et("7.1.0","settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),pt.defaultOptions.scaleMode=e}},MIPMAP_TEXTURES:{get(){return pt.defaultOptions.mipmap},set(e){Et("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),pt.defaultOptions.mipmap=e}},ANISOTROPIC_LEVEL:{get(){return pt.defaultOptions.anisotropicLevel},set(e){Et("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),pt.defaultOptions.anisotropicLevel=e}},FILTER_RESOLUTION:{get(){return Et("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),re.defaultResolution},set(e){re.defaultResolution=e}},FILTER_MULTISAMPLE:{get(){return Et("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),re.defaultMultisample},set(e){re.defaultMultisample=e}},SPRITE_MAX_TEXTURES:{get(){return xe.defaultMaxTextures},set(e){Et("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),xe.defaultMaxTextures=e}},SPRITE_BATCH_SIZE:{get(){return xe.defaultBatchSize},set(e){Et("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),xe.defaultBatchSize=e}},CAN_UPLOAD_SAME_BUFFER:{get(){return xe.canUploadSameBuffer},set(e){Et("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),xe.canUploadSameBuffer=e}},GC_MODE:{get(){return Ee.defaultMode},set(e){Et("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),Ee.defaultMode=e}},GC_MAX_IDLE:{get(){return Ee.defaultMaxIdle},set(e){Et("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),Ee.defaultMaxIdle=e}},GC_MAX_CHECK_COUNT:{get(){return Ee.defaultCheckCountMax},set(e){Et("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),Ee.defaultCheckCountMax=e}},PRECISION_VERTEX:{get(){return Le.defaultVertexPrecision},set(e){Et("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),Le.defaultVertexPrecision=e}},PRECISION_FRAGMENT:{get(){return Le.defaultFragmentPrecision},set(e){Et("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),Le.defaultFragmentPrecision=e}}});var Ns=(e=>(e[e.INTERACTION=50]="INTERACTION",e[e.HIGH=25]="HIGH",e[e.NORMAL=0]="NORMAL",e[e.LOW=-25]="LOW",e[e.UTILITY=-50]="UTILITY",e))(Ns||{});class ia{constructor(t,s=null,i=0,r=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=s,this.priority=i,this.once=r}match(t,s=null){return this.fn===t&&this.context===s}emit(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));const s=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),s}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const s=this.next;return this.next=t?null:s,this.previous=null,s}}const me=class{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new ia(null,null,1/0),this.deltaMS=1/me.targetFPMS,this.elapsedMS=1/me.targetFPMS,this._tick=e=>{this._requestId=null,this.started&&(this.update(e),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(e,t,s=Ns.NORMAL){return this._addListener(new ia(e,t,s))}addOnce(e,t,s=Ns.NORMAL){return this._addListener(new ia(e,t,s,!0))}_addListener(e){let t=this._head.next,s=this._head;if(!t)e.connect(s);else{for(;t;){if(e.priority>t.priority){e.connect(s);break}s=t,t=t.next}e.previous||e.connect(s)}return this._startIfPossible(),this}remove(e,t){let s=this._head.next;for(;s;)s.match(e,t)?s=s.destroy():s=s.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let e=0,t=this._head;for(;t=t.next;)e++;return e}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let e=this._head.next;for(;e;)e=e.destroy(!0);this._head.destroy(),this._head=null}}update(e=performance.now()){let t;if(e>this.lastTime){if(t=this.elapsedMS=e-this.lastTime,t>this._maxElapsedMS&&(t=this._maxElapsedMS),t*=this.speed,this._minElapsedMS){const r=e-this._lastFrame|0;if(r<this._minElapsedMS)return;this._lastFrame=e-r%this._minElapsedMS}this.deltaMS=t,this.deltaTime=this.deltaMS*me.targetFPMS;const s=this._head;let i=s.next;for(;i;)i=i.emit(this.deltaTime);s.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=e}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(e){const t=Math.min(this.maxFPS,e),s=Math.min(Math.max(0,t)/1e3,me.targetFPMS);this._maxElapsedMS=1/s}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(e){if(e===0)this._minElapsedMS=0;else{const t=Math.max(this.minFPS,e);this._minElapsedMS=1/(t/1e3)}}static get shared(){if(!me._shared){const e=me._shared=new me;e.autoStart=!0,e._protected=!0}return me._shared}static get system(){if(!me._system){const e=me._system=new me;e.autoStart=!0,e._protected=!0}return me._system}};let Vt=me;Vt.targetFPMS=.06;Object.defineProperties(q,{TARGET_FPMS:{get(){return Vt.targetFPMS},set(e){Et("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),Vt.targetFPMS=e}}});class xf{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set(s){this._ticker&&this._ticker.remove(this.render,this),this._ticker=s,s&&s.add(this.render,this,Ns.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?Vt.shared:new Vt,t.autoStart&&this.start()}static destroy(){if(this._ticker){const t=this._ticker;this.ticker=null,t.destroy()}}}xf.extension=Z.Application;rt.add(xf);const vf=[];rt.handleByList(Z.Renderer,vf);function X0(e){for(const t of vf)if(t.test(e))return new t(e);throw new Error("Unable to auto-detect a suitable renderer.")}var z0=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,j0=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const V0=z0,yf=j0;class Ef{constructor(t){this.renderer=t}contextChange(t){let s;if(this.renderer.context.webGLVersion===1){const i=t.getParameter(t.FRAMEBUFFER_BINDING);t.bindFramebuffer(t.FRAMEBUFFER,null),s=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.FRAMEBUFFER,i)}else{const i=t.getParameter(t.DRAW_FRAMEBUFFER_BINDING);t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),s=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,i)}s>=jt.HIGH?this.multisample=jt.HIGH:s>=jt.MEDIUM?this.multisample=jt.MEDIUM:s>=jt.LOW?this.multisample=jt.LOW:this.multisample=jt.NONE}destroy(){}}Ef.extension={type:Z.RendererSystem,name:"_multisample"};rt.add(Ef);class Y0{constructor(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class bf{constructor(t){this.renderer=t,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:s,CONTEXT_UID:i}=this,r=t._glBuffers[i]||this.createGLBuffer(t);s.bindBuffer(t.type,r.buffer)}unbind(t){const{gl:s}=this;s.bindBuffer(t,null)}bindBufferBase(t,s){const{gl:i,CONTEXT_UID:r}=this;if(this.boundBufferBases[s]!==t){const n=t._glBuffers[r]||this.createGLBuffer(t);this.boundBufferBases[s]=t,i.bindBufferBase(i.UNIFORM_BUFFER,s,n.buffer)}}bindBufferRange(t,s,i){const{gl:r,CONTEXT_UID:n}=this;i=i||0;const o=t._glBuffers[n]||this.createGLBuffer(t);r.bindBufferRange(r.UNIFORM_BUFFER,s||0,o.buffer,i*256,256)}update(t){const{gl:s,CONTEXT_UID:i}=this,r=t._glBuffers[i]||this.createGLBuffer(t);if(t._updateID!==r.updateID)if(r.updateID=t._updateID,s.bindBuffer(t.type,r.buffer),r.byteLength>=t.data.byteLength)s.bufferSubData(t.type,0,t.data);else{const n=t.static?s.STATIC_DRAW:s.DYNAMIC_DRAW;r.byteLength=t.data.byteLength,s.bufferData(t.type,t.data,n)}}dispose(t,s){if(!this.managedBuffers[t.id])return;delete this.managedBuffers[t.id];const i=t._glBuffers[this.CONTEXT_UID],r=this.gl;t.disposeRunner.remove(this),i&&(s||r.deleteBuffer(i.buffer),delete t._glBuffers[this.CONTEXT_UID])}disposeAll(t){const s=Object.keys(this.managedBuffers);for(let i=0;i<s.length;i++)this.dispose(this.managedBuffers[s[i]],t)}createGLBuffer(t){const{CONTEXT_UID:s,gl:i}=this;return t._glBuffers[s]=new Y0(i.createBuffer()),this.managedBuffers[t.id]=t,t.disposeRunner.add(this),t._glBuffers[s]}}bf.extension={type:Z.RendererSystem,name:"buffer"};rt.add(bf);class Tf{constructor(t){this.renderer=t}render(t,s){const i=this.renderer;let r,n,o,a;if(s&&(r=s.renderTexture,n=s.clear,o=s.transform,a=s.skipUpdateTransform),this.renderingToScreen=!r,i.runners.prerender.emit(),i.emit("prerender"),i.projection.transform=o,!i.context.isLost){if(r||(this.lastObjectRendered=t),!a){const l=t.enableTempParent();t.updateTransform(),t.disableTempParent(l)}i.renderTexture.bind(r),i.batch.currentRenderer.start(),(n??i.background.clearBeforeRender)&&i.renderTexture.clear(),t.render(i),i.batch.currentRenderer.flush(),r&&(s.blit&&i.framebuffer.blit(),r.baseTexture.update()),i.runners.postrender.emit(),i.projection.transform=null,i.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}Tf.extension={type:Z.RendererSystem,name:"objectRenderer"};rt.add(Tf);const tl=class extends $0{constructor(e){super(),this.type=Id.WEBGL,e=Object.assign({},q.RENDER_OPTIONS,e),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new Ge({projectionMatrix:new Ut},!0);const t={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:tl.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(t),"useContextAlpha"in e&&(Et("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),e.premultipliedAlpha=e.useContextAlpha&&e.useContextAlpha!=="notMultiplied",e.backgroundAlpha=e.useContextAlpha===!1?1:e.backgroundAlpha),this._plugin.rendererPlugins=tl.__plugins,this.options=e,this.startup.run(this.options)}static test(e){return e!=null&&e.forceCanvas?!1:vx()}render(e,t){this.objectRenderer.render(e,t)}resize(e,t){this._view.resizeView(e,t)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(e=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:e}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(e){this._view.resolution=e,this.runners.resolutionChange.emit(e)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return Et("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return Et("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return Et("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return Et("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(e){Et("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=e}get backgroundAlpha(){return Et("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha}set backgroundAlpha(e){Et("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=e}get powerPreference(){return Et("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(e,t){return this.textureGenerator.generateTexture(e,t)}};let ji=tl;ji.extension={type:Z.Renderer,priority:1};ji.__plugins={};ji.__systems={};rt.handleByMap(Z.RendererPlugin,ji.__plugins);rt.handleByMap(Z.RendererSystem,ji.__systems);rt.add(ji);class wf extends Cr{constructor(t,s){const{width:i,height:r}=s||{};super(i,r),this.items=[],this.itemDirtyIds=[];for(let n=0;n<t;n++){const o=new pt;this.items.push(o),this.itemDirtyIds.push(-2)}this.length=t,this._load=null,this.baseTexture=null}initFromArray(t,s){for(let i=0;i<this.length;i++)t[i]&&(t[i].castToBaseTexture?this.addBaseTextureAt(t[i].castToBaseTexture(),i):t[i]instanceof Cr?this.addResourceAt(t[i],i):this.addResourceAt(kd(t[i],s),i))}dispose(){for(let t=0,s=this.length;t<s;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(t,s){if(!this.items[s])throw new Error(`Index ${s} is out of bounds`);return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[s].setResource(t),this}bind(t){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");super.bind(t);for(let s=0;s<this.length;s++)this.items[s].parentTextureArray=t,this.items[s].on("update",t.update,t)}unbind(t){super.unbind(t);for(let s=0;s<this.length;s++)this.items[s].parentTextureArray=null,this.items[s].off("update",t.update,t)}load(){if(this._load)return this._load;const s=this.items.map(i=>i.resource).filter(i=>i).map(i=>i.load());return this._load=Promise.all(s).then(()=>{const{realWidth:i,realHeight:r}=this.items[0];return this.resize(i,r),Promise.resolve(this)}),this._load}}class K0 extends wf{constructor(t,s){const{width:i,height:r}=s||{};let n,o;Array.isArray(t)?(n=t,o=t.length):o=t,super(o,{width:i,height:r}),n&&this.initFromArray(n,s)}addBaseTextureAt(t,s){if(t.resource)this.addResourceAt(t.resource,s);else throw new Error("ArrayResource does not support RenderTexture");return this}bind(t){super.bind(t),t.target=Ri.TEXTURE_2D_ARRAY}upload(t,s,i){const{length:r,itemDirtyIds:n,items:o}=this,{gl:a}=t;i.dirtyId<0&&a.texImage3D(a.TEXTURE_2D_ARRAY,0,i.internalFormat,this._width,this._height,r,0,s.format,i.type,null);for(let l=0;l<r;l++){const h=o[l];n[l]<h.dirtyId&&(n[l]=h.dirtyId,h.valid&&a.texSubImage3D(a.TEXTURE_2D_ARRAY,0,0,0,l,h.resource.width,h.resource.height,1,s.format,i.type,h.resource.source))}return!0}}class q0 extends Fs{constructor(t){super(t)}static test(t){const{OffscreenCanvas:s}=globalThis;return s&&t instanceof s?!0:globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement}}const nr=class extends wf{constructor(e,t){const{width:s,height:i,autoLoad:r,linkBaseTexture:n}=t||{};if(e&&e.length!==nr.SIDES)throw new Error(`Invalid length. Got ${e.length}, expected 6`);super(6,{width:s,height:i});for(let o=0;o<nr.SIDES;o++)this.items[o].target=Ri.TEXTURE_CUBE_MAP_POSITIVE_X+o;this.linkBaseTexture=n!==!1,e&&this.initFromArray(e,t),r!==!1&&this.load()}bind(e){super.bind(e),e.target=Ri.TEXTURE_CUBE_MAP}addBaseTextureAt(e,t,s){if(s===void 0&&(s=this.linkBaseTexture),!this.items[t])throw new Error(`Index ${t} is out of bounds`);if(!this.linkBaseTexture||e.parentTextureArray||Object.keys(e._glTextures).length>0)if(e.resource)this.addResourceAt(e.resource,t);else throw new Error("CubeResource does not support copying of renderTexture.");else e.target=Ri.TEXTURE_CUBE_MAP_POSITIVE_X+t,e.parentTextureArray=this.baseTexture,this.items[t]=e;return e.valid&&!this.valid&&this.resize(e.realWidth,e.realHeight),this.items[t]=e,this}upload(e,t,s){const i=this.itemDirtyIds;for(let r=0;r<nr.SIDES;r++){const n=this.items[r];(i[r]<n.dirtyId||s.dirtyId<t.dirtyId)&&(n.valid&&n.resource?(n.resource.upload(e,n,s),i[r]=n.dirtyId):i[r]<-1&&(e.gl.texImage2D(n.target,0,s.internalFormat,t.realWidth,t.realHeight,0,t.format,s.type,null),i[r]=-1))}return!0}static test(e){return Array.isArray(e)&&e.length===nr.SIDES}};let Sf=nr;Sf.SIDES=6;class Ti extends Fs{constructor(t,s){s=s||{};let i,r;typeof t=="string"?(i=Ti.EMPTY,r=t):(i=t,r=null),super(i),this.url=r,this.crossOrigin=s.crossOrigin??!0,this.alphaMode=typeof s.alphaMode=="number"?s.alphaMode:null,this._load=null,s.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(async(t,s)=>{if(this.url===null){t(this);return}try{const i=await q.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;const r=await i.blob();if(this.destroyed)return;const n=await createImageBitmap(r,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===He.UNPACK?"premultiply":"none"});if(this.destroyed)return;this.source=n,this.update(),t(this)}catch(i){if(this.destroyed)return;s(i),this.onError.emit(i)}}),this._load)}upload(t,s,i){return this.source instanceof ImageBitmap?(typeof this.alphaMode=="number"&&(s.alphaMode=this.alphaMode),super.upload(t,s,i)):(this.load(),!1)}dispose(){this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(t){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&(typeof t=="string"||t instanceof ImageBitmap)}static get EMPTY(){return Ti._EMPTY=Ti._EMPTY??q.ADAPTER.createCanvas(0,0),Ti._EMPTY}}const bn=class extends Fs{constructor(e,t){t=t||{},super(q.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=e,this.scale=t.scale||1,this._overrideWidth=t.width,this._overrideHeight=t.height,this._resolve=null,this._crossorigin=t.crossorigin,this._load=null,t.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(e=>{if(this._resolve=()=>{this.resize(this.source.width,this.source.height),e(this)},bn.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}),this._load)}_loadSvg(){const e=new Image;Fs.crossOrigin(e,this.svg,this._crossorigin),e.src=this.svg,e.onerror=t=>{this._resolve&&(e.onerror=null,this.onError.emit(t))},e.onload=()=>{if(!this._resolve)return;const t=e.width,s=e.height;if(!t||!s)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let i=t*this.scale,r=s*this.scale;(this._overrideWidth||this._overrideHeight)&&(i=this._overrideWidth||this._overrideHeight/s*t,r=this._overrideHeight||this._overrideWidth/t*s),i=Math.round(i),r=Math.round(r);const n=this.source;n.width=i,n.height=r,n._pixiId=`canvas_${ni()}`,n.getContext("2d").drawImage(e,0,0,t,s,0,0,i,r),this._resolve(),this._resolve=null}}static getSize(e){const t=bn.SVG_SIZE.exec(e),s={};return t&&(s[t[1]]=Math.round(parseFloat(t[3])),s[t[5]]=Math.round(parseFloat(t[7]))),s}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(e,t){return t==="svg"||typeof e=="string"&&e.startsWith("data:image/svg+xml")||typeof e=="string"&&bn.SVG_XML.test(e)}};let Ir=bn;Ir.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m;Ir.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;const el=class extends Fs{constructor(e,t){if(t=t||{},!(e instanceof HTMLVideoElement)){const s=document.createElement("video");s.setAttribute("preload","auto"),s.setAttribute("webkit-playsinline",""),s.setAttribute("playsinline",""),typeof e=="string"&&(e=[e]);const i=e[0].src||e[0];Fs.crossOrigin(s,i,t.crossorigin);for(let r=0;r<e.length;++r){const n=document.createElement("source");let{src:o,mime:a}=e[r];o=o||e[r];const l=o.split("?").shift().toLowerCase(),h=l.slice(l.lastIndexOf(".")+1);a=a||el.MIME_TYPES[h]||`video/${h}`,n.src=o,n.type=a,s.appendChild(n)}e=s}super(e),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=t.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=t.autoPlay!==!1,this._load=null,this._resolve=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),t.autoLoad!==!1&&this.load()}update(e=0){if(!this.destroyed){const t=Vt.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-t),(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}load(){if(this._load)return this._load;const e=this.source;return(e.readyState===e.HAVE_ENOUGH_DATA||e.readyState===e.HAVE_FUTURE_DATA)&&e.width&&e.height&&(e.complete=!0),e.addEventListener("play",this._onPlayStart.bind(this)),e.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(e.addEventListener("canplay",this._onCanPlay),e.addEventListener("canplaythrough",this._onCanPlay),e.addEventListener("error",this._onError,!0)),this._load=new Promise(t=>{this.valid?t(this):(this._resolve=t,e.load())}),this._load}_onError(e){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(e)}_isSourcePlaying(){const e=this.source;return!e.paused&&!e.ended&&this._isSourceReady()}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this.autoUpdate&&!this._isConnectedToTicker&&(Vt.shared.add(this.update,this),this._isConnectedToTicker=!0)}_onPlayStop(){this._isConnectedToTicker&&(Vt.shared.remove(this.update,this),this._isConnectedToTicker=!1)}_onCanPlay(){const e=this.source;e.removeEventListener("canplay",this._onCanPlay),e.removeEventListener("canplaythrough",this._onCanPlay);const t=this.valid;this.resize(e.videoWidth,e.videoHeight),!t&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&e.play()}dispose(){this._isConnectedToTicker&&(Vt.shared.remove(this.update,this),this._isConnectedToTicker=!1);const e=this.source;e&&(e.removeEventListener("error",this._onError,!0),e.pause(),e.src="",e.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(e){e!==this._autoUpdate&&(this._autoUpdate=e,!this._autoUpdate&&this._isConnectedToTicker?(Vt.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()&&(Vt.shared.add(this.update,this),this._isConnectedToTicker=!0))}get updateFPS(){return this._updateFPS}set updateFPS(e){e!==this._updateFPS&&(this._updateFPS=e)}static test(e,t){return globalThis.HTMLVideoElement&&e instanceof HTMLVideoElement||el.TYPES.includes(t)}};let Kl=el;Kl.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"];Kl.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};Ya.push(Ti,qd,q0,Kl,Ir,Br,Sf,K0);class Hn{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(t){return this.minX>this.maxX||this.minY>this.maxY?xt.EMPTY:(t=t||new xt(0,0,1,1),t.x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)}addPoint(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)}addPointMatrix(t,s){const{a:i,b:r,c:n,d:o,tx:a,ty:l}=t,h=i*s.x+n*s.y+a,c=r*s.x+o*s.y+l;this.minX=Math.min(this.minX,h),this.maxX=Math.max(this.maxX,h),this.minY=Math.min(this.minY,c),this.maxY=Math.max(this.maxY,c)}addQuad(t){let s=this.minX,i=this.minY,r=this.maxX,n=this.maxY,o=t[0],a=t[1];s=o<s?o:s,i=a<i?a:i,r=o>r?o:r,n=a>n?a:n,o=t[2],a=t[3],s=o<s?o:s,i=a<i?a:i,r=o>r?o:r,n=a>n?a:n,o=t[4],a=t[5],s=o<s?o:s,i=a<i?a:i,r=o>r?o:r,n=a>n?a:n,o=t[6],a=t[7],s=o<s?o:s,i=a<i?a:i,r=o>r?o:r,n=a>n?a:n,this.minX=s,this.minY=i,this.maxX=r,this.maxY=n}addFrame(t,s,i,r,n){this.addFrameMatrix(t.worldTransform,s,i,r,n)}addFrameMatrix(t,s,i,r,n){const o=t.a,a=t.b,l=t.c,h=t.d,c=t.tx,u=t.ty;let d=this.minX,p=this.minY,f=this.maxX,m=this.maxY,_=o*s+l*i+c,v=a*s+h*i+u;d=_<d?_:d,p=v<p?v:p,f=_>f?_:f,m=v>m?v:m,_=o*r+l*i+c,v=a*r+h*i+u,d=_<d?_:d,p=v<p?v:p,f=_>f?_:f,m=v>m?v:m,_=o*s+l*n+c,v=a*s+h*n+u,d=_<d?_:d,p=v<p?v:p,f=_>f?_:f,m=v>m?v:m,_=o*r+l*n+c,v=a*r+h*n+u,d=_<d?_:d,p=v<p?v:p,f=_>f?_:f,m=v>m?v:m,this.minX=d,this.minY=p,this.maxX=f,this.maxY=m}addVertexData(t,s,i){let r=this.minX,n=this.minY,o=this.maxX,a=this.maxY;for(let l=s;l<i;l+=2){const h=t[l],c=t[l+1];r=h<r?h:r,n=c<n?c:n,o=h>o?h:o,a=c>a?c:a}this.minX=r,this.minY=n,this.maxX=o,this.maxY=a}addVertices(t,s,i,r){this.addVerticesMatrix(t.worldTransform,s,i,r)}addVerticesMatrix(t,s,i,r,n=0,o=n){const a=t.a,l=t.b,h=t.c,c=t.d,u=t.tx,d=t.ty;let p=this.minX,f=this.minY,m=this.maxX,_=this.maxY;for(let v=i;v<r;v+=2){const b=s[v],g=s[v+1],E=a*b+h*g+u,S=c*g+l*b+d;p=Math.min(p,E-n),m=Math.max(m,E+n),f=Math.min(f,S-o),_=Math.max(_,S+o)}this.minX=p,this.minY=f,this.maxX=m,this.maxY=_}addBounds(t){const s=this.minX,i=this.minY,r=this.maxX,n=this.maxY;this.minX=t.minX<s?t.minX:s,this.minY=t.minY<i?t.minY:i,this.maxX=t.maxX>r?t.maxX:r,this.maxY=t.maxY>n?t.maxY:n}addBoundsMask(t,s){const i=t.minX>s.minX?t.minX:s.minX,r=t.minY>s.minY?t.minY:s.minY,n=t.maxX<s.maxX?t.maxX:s.maxX,o=t.maxY<s.maxY?t.maxY:s.maxY;if(i<=n&&r<=o){const a=this.minX,l=this.minY,h=this.maxX,c=this.maxY;this.minX=i<a?i:a,this.minY=r<l?r:l,this.maxX=n>h?n:h,this.maxY=o>c?o:c}}addBoundsMatrix(t,s){this.addFrameMatrix(s,t.minX,t.minY,t.maxX,t.maxY)}addBoundsArea(t,s){const i=t.minX>s.x?t.minX:s.x,r=t.minY>s.y?t.minY:s.y,n=t.maxX<s.x+s.width?t.maxX:s.x+s.width,o=t.maxY<s.y+s.height?t.maxY:s.y+s.height;if(i<=n&&r<=o){const a=this.minX,l=this.minY,h=this.maxX,c=this.maxY;this.minX=i<a?i:a,this.minY=r<l?r:l,this.maxX=n>h?n:h,this.maxY=o>c?o:c}}pad(t=0,s=t){this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=s,this.maxY+=s)}addFramePad(t,s,i,r,n,o){t-=n,s-=o,i+=n,r+=o,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>i?this.maxX:i,this.minY=this.minY<s?this.minY:s,this.maxY=this.maxY>r?this.maxY:r}}class Wt extends ii{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new Yl,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new Hn,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(t){const s=Object.keys(t);for(let i=0;i<s.length;++i){const r=s[i];Object.defineProperty(Wt.prototype,r,Object.getOwnPropertyDescriptor(t,r))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(t,s){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),s||(this._boundsRect||(this._boundsRect=new xt),s=this._boundsRect),this._bounds.getRectangle(s)}getLocalBounds(t){t||(this._localBoundsRect||(this._localBoundsRect=new xt),t=this._localBoundsRect),this._localBounds||(this._localBounds=new Hn);const s=this.transform,i=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform;const r=this._bounds,n=this._boundsID;this._bounds=this._localBounds;const o=this.getBounds(!1,t);return this.parent=i,this.transform=s,this._bounds=r,this._bounds.updateID+=this._boundsID-n,o}toGlobal(t,s,i=!1){return i||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,s)}toLocal(t,s,i,r){return s&&(t=s.toGlobal(t,i,r)),r||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,i)}setParent(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t}removeFromParent(){var t;(t=this.parent)==null||t.removeChild(this)}setTransform(t=0,s=0,i=1,r=1,n=0,o=0,a=0,l=0,h=0){return this.position.x=t,this.position.y=s,this.scale.x=i||1,this.scale.y=r||1,this.rotation=n,this.skew.x=o,this.skew.y=a,this.pivot.x=l,this.pivot.y=h,this}destroy(t){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.eventMode="auto",this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return this.tempDisplayObjectParent===null&&(this.tempDisplayObjectParent=new Z0),this.tempDisplayObjectParent}enableTempParent(){const t=this.parent;return this.parent=this._tempDisplayObjectParent,t}disableTempParent(t){this.parent=t}get x(){return this.position.x}set x(t){this.transform.position.x=t}get y(){return this.position.y}set y(t){this.transform.position.y=t}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(t){this.transform.position.copyFrom(t)}get scale(){return this.transform.scale}set scale(t){this.transform.scale.copyFrom(t)}get pivot(){return this.transform.pivot}set pivot(t){this.transform.pivot.copyFrom(t)}get skew(){return this.transform.skew}set skew(t){this.transform.skew.copyFrom(t)}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}get angle(){return this.transform.rotation*Vx}set angle(t){this.transform.rotation=t*Yx}get zIndex(){return this._zIndex}set zIndex(t){this._zIndex=t,this.parent&&(this.parent.sortDirty=!0)}get worldVisible(){let t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}get mask(){return this._mask}set mask(t){if(this._mask!==t){if(this._mask){const s=this._mask.isMaskData?this._mask.maskObject:this._mask;s&&(s._maskRefCount--,s._maskRefCount===0&&(s.renderable=!0,s.isMask=!1))}if(this._mask=t,this._mask){const s=this._mask.isMaskData?this._mask.maskObject:this._mask;s&&(s._maskRefCount===0&&(s.renderable=!1,s.isMask=!0),s._maskRefCount++)}}}}class Z0 extends Wt{constructor(){super(...arguments),this.sortDirty=null}}Wt.prototype.displayObjectUpdateTransform=Wt.prototype.updateTransform;const J0=new Ut;function Q0(e,t){return e.zIndex===t.zIndex?e._lastSortedIndex-t._lastSortedIndex:e.zIndex-t.zIndex}const sl=class extends Wt{constructor(){super(),this.children=[],this.sortableChildren=sl.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(e){}addChild(...e){if(e.length>1)for(let t=0;t<e.length;t++)this.addChild(e[t]);else{const t=e[0];t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.push(t),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",t,this,this.children.length-1),t.emit("added",this)}return e[0]}addChildAt(e,t){if(t<0||t>this.children.length)throw new Error(`${e}addChildAt: The index ${t} supplied is out of bounds ${this.children.length}`);return e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.splice(t,0,e),this._boundsID++,this.onChildrenChange(t),e.emit("added",this),this.emit("childAdded",e,this,t),e}swapChildren(e,t){if(e===t)return;const s=this.getChildIndex(e),i=this.getChildIndex(t);this.children[s]=t,this.children[i]=e,this.onChildrenChange(s<i?s:i)}getChildIndex(e){const t=this.children.indexOf(e);if(t===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return t}setChildIndex(e,t){if(t<0||t>=this.children.length)throw new Error(`The index ${t} supplied is out of bounds ${this.children.length}`);const s=this.getChildIndex(e);Oi(this.children,s,1),this.children.splice(t,0,e),this.onChildrenChange(t)}getChildAt(e){if(e<0||e>=this.children.length)throw new Error(`getChildAt: Index (${e}) does not exist.`);return this.children[e]}removeChild(...e){if(e.length>1)for(let t=0;t<e.length;t++)this.removeChild(e[t]);else{const t=e[0],s=this.children.indexOf(t);if(s===-1)return null;t.parent=null,t.transform._parentID=-1,Oi(this.children,s,1),this._boundsID++,this.onChildrenChange(s),t.emit("removed",this),this.emit("childRemoved",t,this,s)}return e[0]}removeChildAt(e){const t=this.getChildAt(e);return t.parent=null,t.transform._parentID=-1,Oi(this.children,e,1),this._boundsID++,this.onChildrenChange(e),t.emit("removed",this),this.emit("childRemoved",t,this,e),t}removeChildren(e=0,t=this.children.length){const s=e,i=t,r=i-s;let n;if(r>0&&r<=i){n=this.children.splice(s,r);for(let o=0;o<n.length;++o)n[o].parent=null,n[o].transform&&(n[o].transform._parentID=-1);this._boundsID++,this.onChildrenChange(e);for(let o=0;o<n.length;++o)n[o].emit("removed",this),this.emit("childRemoved",n[o],this,o);return n}else if(r===0&&this.children.length===0)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let e=!1;for(let t=0,s=this.children.length;t<s;++t){const i=this.children[t];i._lastSortedIndex=t,!e&&i.zIndex!==0&&(e=!0)}e&&this.children.length>1&&this.children.sort(Q0),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let e=0,t=this.children.length;e<t;++e){const s=this.children[e];s.visible&&s.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let e=0;e<this.children.length;e++){const t=this.children[e];if(!(!t.visible||!t.renderable))if(t.calculateBounds(),t._mask){const s=t._mask.isMaskData?t._mask.maskObject:t._mask;s?(s.calculateBounds(),this._bounds.addBoundsMask(t._bounds,s._bounds)):this._bounds.addBounds(t._bounds)}else t.filterArea?this._bounds.addBoundsArea(t._bounds,t.filterArea):this._bounds.addBounds(t._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(e,t=!1){const s=super.getLocalBounds(e);if(!t)for(let i=0,r=this.children.length;i<r;++i){const n=this.children[i];n.visible&&n.updateTransform()}return s}_calculateBounds(){}_renderWithCulling(e){const t=e.renderTexture.sourceFrame;if(!(t.width>0&&t.height>0))return;let s,i;this.cullArea?(s=this.cullArea,i=this.worldTransform):this._render!==sl.prototype._render&&(s=this.getBounds(!0));const r=e.projection.transform;if(r&&(i?(i=J0.copyFrom(i),i.prepend(r)):i=r),s&&t.intersects(s,i))this._render(e);else if(this.cullArea)return;for(let n=0,o=this.children.length;n<o;++n){const a=this.children[n],l=a.cullable;a.cullable=l||!this.cullArea,a.render(e),a.cullable=l}}render(e){var t;if(!(!this.visible||this.worldAlpha<=0||!this.renderable))if(this._mask||(t=this.filters)!=null&&t.length)this.renderAdvanced(e);else if(this.cullable)this._renderWithCulling(e);else{this._render(e);for(let s=0,i=this.children.length;s<i;++s)this.children[s].render(e)}}renderAdvanced(e){var r,n,o;const t=this.filters,s=this._mask;if(t){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let a=0;a<t.length;a++)t[a].enabled&&this._enabledFilters.push(t[a])}const i=t&&((r=this._enabledFilters)==null?void 0:r.length)||s&&(!s.isMaskData||s.enabled&&(s.autoDetect||s.type!==Kt.NONE));if(i&&e.batch.flush(),t&&((n=this._enabledFilters)!=null&&n.length)&&e.filter.push(this,this._enabledFilters),s&&e.mask.push(this,this._mask),this.cullable)this._renderWithCulling(e);else{this._render(e);for(let a=0,l=this.children.length;a<l;++a)this.children[a].render(e)}i&&e.batch.flush(),s&&e.mask.pop(this),t&&((o=this._enabledFilters)!=null&&o.length)&&e.filter.pop()}_render(e){}destroy(e){super.destroy(),this.sortDirty=!1;const t=typeof e=="boolean"?e:e==null?void 0:e.children,s=this.removeChildren(0,this.children.length);if(t)for(let i=0;i<s.length;++i)s[i].destroy(e)}get width(){return this.scale.x*this.getLocalBounds().width}set width(e){const t=this.getLocalBounds().width;t!==0?this.scale.x=e/t:this.scale.x=1,this._width=e}get height(){return this.scale.y*this.getLocalBounds().height}set height(e){const t=this.getLocalBounds().height;t!==0?this.scale.y=e/t:this.scale.y=1,this._height=e}};let fe=sl;fe.defaultSortableChildren=!1;fe.prototype.containerUpdateTransform=fe.prototype.updateTransform;Object.defineProperties(q,{SORTABLE_CHILDREN:{get(){return fe.defaultSortableChildren},set(e){Et("7.1.0","settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),fe.defaultSortableChildren=e}}});const tr=new At,tv=new Uint16Array([0,1,2,0,2,3]);class ci extends fe{constructor(t){super(),this._anchor=new Cs(this._onAnchorUpdate,this,t?t.defaultAnchor.x:0,t?t.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tintColor=new Dt(16777215),this._tintRGB=null,this.tint=16777215,this.blendMode=ct.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=t||J.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=tv,this.pluginName="batch",this.isSprite=!0,this._roundPixels=q.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=As(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=As(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){const t=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===t._updateID)return;this._textureID!==t._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=t._updateID;const s=this.transform.worldTransform,i=s.a,r=s.b,n=s.c,o=s.d,a=s.tx,l=s.ty,h=this.vertexData,c=t.trim,u=t.orig,d=this._anchor;let p=0,f=0,m=0,_=0;if(c?(f=c.x-d._x*u.width,p=f+c.width,_=c.y-d._y*u.height,m=_+c.height):(f=-d._x*u.width,p=f+u.width,_=-d._y*u.height,m=_+u.height),h[0]=i*f+n*_+a,h[1]=o*_+r*f+l,h[2]=i*p+n*_+a,h[3]=o*_+r*p+l,h[4]=i*p+n*m+a,h[5]=o*m+r*p+l,h[6]=i*f+n*m+a,h[7]=o*m+r*f+l,this._roundPixels){const v=q.RESOLUTION;for(let b=0;b<h.length;++b)h[b]=Math.round(h[b]*v)/v}}calculateTrimmedVertices(){if(!this.vertexTrimmedData)this.vertexTrimmedData=new Float32Array(8);else if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return;this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;const t=this._texture,s=this.vertexTrimmedData,i=t.orig,r=this._anchor,n=this.transform.worldTransform,o=n.a,a=n.b,l=n.c,h=n.d,c=n.tx,u=n.ty,d=-r._x*i.width,p=d+i.width,f=-r._y*i.height,m=f+i.height;s[0]=o*d+l*f+c,s[1]=h*f+a*d+u,s[2]=o*p+l*f+c,s[3]=h*f+a*p+u,s[4]=o*p+l*m+c,s[5]=h*m+a*p+u,s[6]=o*d+l*m+c,s[7]=h*m+a*d+u}_render(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)}_calculateBounds(){const t=this._texture.trim,s=this._texture.orig;!t||t.width===s.width&&t.height===s.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(t){return this.children.length===0?(this._localBounds||(this._localBounds=new Hn),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new xt),t=this._localBoundsRect),this._localBounds.getRectangle(t)):super.getLocalBounds.call(this,t)}containsPoint(t){this.worldTransform.applyInverse(t,tr);const s=this._texture.orig.width,i=this._texture.orig.height,r=-s*this.anchor.x;let n=0;return tr.x>=r&&tr.x<r+s&&(n=-i*this.anchor.y,tr.y>=n&&tr.y<n+i)}destroy(t){if(super.destroy(t),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,typeof t=="boolean"?t:t==null?void 0:t.texture){const i=typeof t=="boolean"?t:t==null?void 0:t.baseTexture;this._texture.destroy(!!i)}this._texture=null}static from(t,s){const i=t instanceof J?t:J.from(t,s);return new ci(i)}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(t){const s=As(this.scale.x)||1;this.scale.x=s*t/this._texture.orig.width,this._width=t}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(t){const s=As(this.scale.y)||1;this.scale.y=s*t/this._texture.orig.height,this._height=t}get anchor(){return this._anchor}set anchor(t){this._anchor.copyFrom(t)}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber()}get tintValue(){return this._tintColor.toNumber()}get texture(){return this._texture}set texture(t){this._texture!==t&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=t||J.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))}}const Af=new Ut;Wt.prototype._cacheAsBitmap=!1;Wt.prototype._cacheData=null;Wt.prototype._cacheAsBitmapResolution=null;Wt.prototype._cacheAsBitmapMultisample=null;class ev{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}}Object.defineProperties(Wt.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(e){e!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=e,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(e){e!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=e,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(e){if(this._cacheAsBitmap===e)return;this._cacheAsBitmap=e;let t;e?(this._cacheData||(this._cacheData=new ev),t=this._cacheData,t.originalRender=this.render,t.originalRenderCanvas=this.renderCanvas,t.originalUpdateTransform=this.updateTransform,t.originalCalculateBounds=this.calculateBounds,t.originalGetLocalBounds=this.getLocalBounds,t.originalDestroy=this.destroy,t.originalContainsPoint=this.containsPoint,t.originalMask=this._mask,t.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(t=this._cacheData,t.sprite&&this._destroyCachedDisplayObject(),this.render=t.originalRender,this.renderCanvas=t.originalRenderCanvas,this.calculateBounds=t.originalCalculateBounds,this.getLocalBounds=t.originalGetLocalBounds,this.destroy=t.originalDestroy,this.updateTransform=t.originalUpdateTransform,this.containsPoint=t.originalContainsPoint,this._mask=t.originalMask,this.filterArea=t.originalFilterArea)}}});Wt.prototype._renderCached=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(t),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(t))};Wt.prototype._initCachedDisplayObject=function(t){var d,p;if((d=this._cacheData)!=null&&d.sprite)return;const s=this.alpha;this.alpha=1,t.batch.flush();const i=this.getLocalBounds(null,!0).clone();if((p=this.filters)!=null&&p.length){const f=this.filters[0].padding;i.pad(f)}i.ceil(q.RESOLUTION);const r=t.renderTexture.current,n=t.renderTexture.sourceFrame.clone(),o=t.renderTexture.destinationFrame.clone(),a=t.projection.transform,l=hi.create({width:i.width,height:i.height,resolution:this.cacheAsBitmapResolution||t.resolution,multisample:this.cacheAsBitmapMultisample??t.multisample}),h=`cacheAsBitmap_${ni()}`;this._cacheData.textureCacheId=h,pt.addToCache(l.baseTexture,h),J.addToCache(l,h);const c=this.transform.localTransform.copyTo(Af).invert().translate(-i.x,-i.y);this.render=this._cacheData.originalRender,t.render(this,{renderTexture:l,clear:!0,transform:c,skipUpdateTransform:!1}),t.framebuffer.blit(),t.projection.transform=a,t.renderTexture.bind(r,n,o),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=s;const u=new ci(l);u.transform.worldTransform=this.transform.worldTransform,u.anchor.x=-(i.x/i.width),u.anchor.y=-(i.y/i.height),u.alpha=s,u._bounds=this._bounds,this._cacheData.sprite=u,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=u.containsPoint.bind(u)};Wt.prototype._renderCachedCanvas=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(t),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(t))};Wt.prototype._initCachedDisplayObjectCanvas=function(t){var c;if((c=this._cacheData)!=null&&c.sprite)return;const s=this.getLocalBounds(null,!0),i=this.alpha;this.alpha=1;const r=t.canvasContext.activeContext,n=t._projTransform;s.ceil(q.RESOLUTION);const o=hi.create({width:s.width,height:s.height}),a=`cacheAsBitmap_${ni()}`;this._cacheData.textureCacheId=a,pt.addToCache(o.baseTexture,a),J.addToCache(o,a);const l=Af;this.transform.localTransform.copyTo(l),l.invert(),l.tx-=s.x,l.ty-=s.y,this.renderCanvas=this._cacheData.originalRenderCanvas,t.render(this,{renderTexture:o,clear:!0,transform:l,skipUpdateTransform:!1}),t.canvasContext.activeContext=r,t._projTransform=n,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=i;const h=new ci(o);h.transform.worldTransform=this.transform.worldTransform,h.anchor.x=-(s.x/s.width),h.anchor.y=-(s.y/s.height),h.alpha=i,h._bounds=this._bounds,this._cacheData.sprite=h,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=t._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=h.containsPoint.bind(h)};Wt.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID};Wt.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)};Wt.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,pt.removeFromCache(this._cacheData.textureCacheId),J.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null};Wt.prototype._cacheAsBitmapDestroy=function(t){this.cacheAsBitmap=!1,this.destroy(t)};Wt.prototype.name=null;fe.prototype.getChildByName=function(t,s){for(let i=0,r=this.children.length;i<r;i++)if(this.children[i].name===t)return this.children[i];if(s)for(let i=0,r=this.children.length;i<r;i++){const n=this.children[i];if(!n.getChildByName)continue;const o=n.getChildByName(t,!0);if(o)return o}return null};Wt.prototype.getGlobalPosition=function(t=new At,s=!1){return this.parent?this.parent.toGlobal(this.position,t,s):(t.x=this.position.x,t.y=this.position.y),t};var sv=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform float uAlpha;

void main(void)
{
   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;
}
`;class iv extends re{constructor(t=1){super(V0,sv,{uAlpha:1}),this.alpha=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}const rv={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},nv=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join(`
`);function ov(e){const t=rv[e],s=t.length;let i=nv,r="";const n="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;";let o;for(let a=0;a<e;a++){let l=n.replace("%index%",a.toString());o=a,a>=s&&(o=e-a-1),l=l.replace("%value%",t[o].toString()),r+=l,r+=`
`}return i=i.replace("%blur%",r),i=i.replace("%size%",e.toString()),i}const av=`
    attribute vec2 aVertexPosition;

    uniform mat3 projectionMatrix;

    uniform float strength;

    varying vec2 vBlurTexCoords[%size%];

    uniform vec4 inputSize;
    uniform vec4 outputFrame;

    vec4 filterVertexPosition( void )
    {
        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
    }

    vec2 filterTextureCoord( void )
    {
        return aVertexPosition * (outputFrame.zw * inputSize.zw);
    }

    void main(void)
    {
        gl_Position = filterVertexPosition();

        vec2 textureCoord = filterTextureCoord();
        %blur%
    }`;function lv(e,t){const s=Math.ceil(e/2);let i=av,r="",n;t?n="vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":n="vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(let o=0;o<e;o++){let a=n.replace("%index%",o.toString());a=a.replace("%sampleIndex%",`${o-(s-1)}.0`),r+=a,r+=`
`}return i=i.replace("%blur%",r),i=i.replace("%size%",e.toString()),i}class il extends re{constructor(t,s=8,i=4,r=re.defaultResolution,n=5){const o=lv(n,t),a=ov(n);super(o,a),this.horizontal=t,this.resolution=r,this._quality=0,this.quality=i,this.blur=s}apply(t,s,i,r){if(i?this.horizontal?this.uniforms.strength=1/i.width*(i.width/s.width):this.uniforms.strength=1/i.height*(i.height/s.height):this.horizontal?this.uniforms.strength=1/t.renderer.width*(t.renderer.width/s.width):this.uniforms.strength=1/t.renderer.height*(t.renderer.height/s.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,this.passes===1)t.applyFilter(this,s,i,r);else{const n=t.getFilterTexture(),o=t.renderer;let a=s,l=n;this.state.blend=!1,t.applyFilter(this,a,l,Ye.CLEAR);for(let h=1;h<this.passes-1;h++){t.bindAndClear(a,Ye.BLIT),this.uniforms.uSampler=l;const c=l;l=a,a=c,o.shader.bind(this),o.geometry.draw(5)}this.state.blend=!0,t.applyFilter(this,l,i,r),t.returnFilterTexture(n)}}get blur(){return this.strength}set blur(t){this.padding=1+Math.abs(t)*2,this.strength=t}get quality(){return this._quality}set quality(t){this._quality=t,this.passes=t}}class hv extends re{constructor(t=8,s=4,i=re.defaultResolution,r=5){super(),this._repeatEdgePixels=!1,this.blurXFilter=new il(!0,t,s,i,r),this.blurYFilter=new il(!1,t,s,i,r),this.resolution=i,this.quality=s,this.blur=t,this.repeatEdgePixels=!1}apply(t,s,i,r){const n=Math.abs(this.blurXFilter.strength),o=Math.abs(this.blurYFilter.strength);if(n&&o){const a=t.getFilterTexture();this.blurXFilter.apply(t,s,a,Ye.CLEAR),this.blurYFilter.apply(t,a,i,r),t.returnFilterTexture(a)}else o?this.blurYFilter.apply(t,s,i,r):this.blurXFilter.apply(t,s,i,r)}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))*2}get blur(){return this.blurXFilter.blur}set blur(t){this.blurXFilter.blur=this.blurYFilter.blur=t,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(t){this.blurXFilter.quality=this.blurYFilter.quality=t}get blurX(){return this.blurXFilter.blur}set blurX(t){this.blurXFilter.blur=t,this.updatePadding()}get blurY(){return this.blurYFilter.blur}set blurY(t){this.blurYFilter.blur=t,this.updatePadding()}get blendMode(){return this.blurYFilter.blendMode}set blendMode(t){this.blurYFilter.blendMode=t}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(t){this._repeatEdgePixels=t,this.updatePadding()}}var cv=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float m[20];
uniform float uAlpha;

void main(void)
{
    vec4 c = texture2D(uSampler, vTextureCoord);

    if (uAlpha == 0.0) {
        gl_FragColor = c;
        return;
    }

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (c.a > 0.0) {
      c.rgb /= c.a;
    }

    vec4 result;

    result.r = (m[0] * c.r);
        result.r += (m[1] * c.g);
        result.r += (m[2] * c.b);
        result.r += (m[3] * c.a);
        result.r += m[4];

    result.g = (m[5] * c.r);
        result.g += (m[6] * c.g);
        result.g += (m[7] * c.b);
        result.g += (m[8] * c.a);
        result.g += m[9];

    result.b = (m[10] * c.r);
       result.b += (m[11] * c.g);
       result.b += (m[12] * c.b);
       result.b += (m[13] * c.a);
       result.b += m[14];

    result.a = (m[15] * c.r);
       result.a += (m[16] * c.g);
       result.a += (m[17] * c.b);
       result.a += (m[18] * c.a);
       result.a += m[19];

    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);

    // Premultiply alpha again.
    rgb *= result.a;

    gl_FragColor = vec4(rgb, result.a);
}
`;class rl extends re{constructor(){const t={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(yf,cv,t),this.alpha=1}_loadMatrix(t,s=!1){let i=t;s&&(this._multiply(i,this.uniforms.m,t),i=this._colorMatrix(i)),this.uniforms.m=i}_multiply(t,s,i){return t[0]=s[0]*i[0]+s[1]*i[5]+s[2]*i[10]+s[3]*i[15],t[1]=s[0]*i[1]+s[1]*i[6]+s[2]*i[11]+s[3]*i[16],t[2]=s[0]*i[2]+s[1]*i[7]+s[2]*i[12]+s[3]*i[17],t[3]=s[0]*i[3]+s[1]*i[8]+s[2]*i[13]+s[3]*i[18],t[4]=s[0]*i[4]+s[1]*i[9]+s[2]*i[14]+s[3]*i[19]+s[4],t[5]=s[5]*i[0]+s[6]*i[5]+s[7]*i[10]+s[8]*i[15],t[6]=s[5]*i[1]+s[6]*i[6]+s[7]*i[11]+s[8]*i[16],t[7]=s[5]*i[2]+s[6]*i[7]+s[7]*i[12]+s[8]*i[17],t[8]=s[5]*i[3]+s[6]*i[8]+s[7]*i[13]+s[8]*i[18],t[9]=s[5]*i[4]+s[6]*i[9]+s[7]*i[14]+s[8]*i[19]+s[9],t[10]=s[10]*i[0]+s[11]*i[5]+s[12]*i[10]+s[13]*i[15],t[11]=s[10]*i[1]+s[11]*i[6]+s[12]*i[11]+s[13]*i[16],t[12]=s[10]*i[2]+s[11]*i[7]+s[12]*i[12]+s[13]*i[17],t[13]=s[10]*i[3]+s[11]*i[8]+s[12]*i[13]+s[13]*i[18],t[14]=s[10]*i[4]+s[11]*i[9]+s[12]*i[14]+s[13]*i[19]+s[14],t[15]=s[15]*i[0]+s[16]*i[5]+s[17]*i[10]+s[18]*i[15],t[16]=s[15]*i[1]+s[16]*i[6]+s[17]*i[11]+s[18]*i[16],t[17]=s[15]*i[2]+s[16]*i[7]+s[17]*i[12]+s[18]*i[17],t[18]=s[15]*i[3]+s[16]*i[8]+s[17]*i[13]+s[18]*i[18],t[19]=s[15]*i[4]+s[16]*i[9]+s[17]*i[14]+s[18]*i[19]+s[19],t}_colorMatrix(t){const s=new Float32Array(t);return s[4]/=255,s[9]/=255,s[14]/=255,s[19]/=255,s}brightness(t,s){const i=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(i,s)}tint(t,s){const[i,r,n]=Dt.shared.setValue(t).toArray(),o=[i,0,0,0,0,0,r,0,0,0,0,0,n,0,0,0,0,0,1,0];this._loadMatrix(o,s)}greyscale(t,s){const i=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(i,s)}blackAndWhite(t){const s=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(s,t)}hue(t,s){t=(t||0)/180*Math.PI;const i=Math.cos(t),r=Math.sin(t),n=Math.sqrt,o=1/3,a=n(o),l=i+(1-i)*o,h=o*(1-i)-a*r,c=o*(1-i)+a*r,u=o*(1-i)+a*r,d=i+o*(1-i),p=o*(1-i)-a*r,f=o*(1-i)-a*r,m=o*(1-i)+a*r,_=i+o*(1-i),v=[l,h,c,0,0,u,d,p,0,0,f,m,_,0,0,0,0,0,1,0];this._loadMatrix(v,s)}contrast(t,s){const i=(t||0)+1,r=-.5*(i-1),n=[i,0,0,0,r,0,i,0,0,r,0,0,i,0,r,0,0,0,1,0];this._loadMatrix(n,s)}saturate(t=0,s){const i=t*2/3+1,r=(i-1)*-.5,n=[i,r,r,0,0,r,i,r,0,0,r,r,i,0,0,0,0,0,1,0];this._loadMatrix(n,s)}desaturate(){this.saturate(-1)}negative(t){const s=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(s,t)}sepia(t){const s=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(s,t)}technicolor(t){const s=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(s,t)}polaroid(t){const s=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(s,t)}toBGR(t){const s=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(s,t)}kodachrome(t){const s=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(s,t)}browni(t){const s=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(s,t)}vintage(t){const s=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(s,t)}colorTone(t,s,i,r,n){t=t||.2,s=s||.15,i=i||16770432,r=r||3375104;const o=Dt.shared,[a,l,h]=o.setValue(i).toArray(),[c,u,d]=o.setValue(r).toArray(),p=[.3,.59,.11,0,0,a,l,h,t,0,c,u,d,s,0,a-c,l-u,h-d,0,0];this._loadMatrix(p,n)}night(t,s){t=t||.1;const i=[t*-2,-t,0,0,0,-t,0,t,0,0,0,t,t*2,0,0,0,0,0,1,0];this._loadMatrix(i,s)}predator(t,s){const i=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(i,s)}lsd(t){const s=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(s,t)}reset(){const t=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(t,!1)}get matrix(){return this.uniforms.m}set matrix(t){this.uniforms.m=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}rl.prototype.grayscale=rl.prototype.greyscale;var uv=`varying vec2 vFilterCoord;
varying vec2 vTextureCoord;

uniform vec2 scale;
uniform mat2 rotation;
uniform sampler2D uSampler;
uniform sampler2D mapSampler;

uniform highp vec4 inputSize;
uniform vec4 inputClamp;

void main(void)
{
  vec4 map =  texture2D(mapSampler, vFilterCoord);

  map -= 0.5;
  map.xy = scale * inputSize.zw * (rotation * map.xy);

  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));
}
`,dv=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;
uniform mat3 filterMatrix;

varying vec2 vTextureCoord;
varying vec2 vFilterCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
	gl_Position = filterVertexPosition();
	vTextureCoord = filterTextureCoord();
	vFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;
}
`;class fv extends re{constructor(t,s){const i=new Ut;t.renderable=!1,super(dv,uv,{mapSampler:t._texture,filterMatrix:i,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}),this.maskSprite=t,this.maskMatrix=i,s==null&&(s=20),this.scale=new At(s,s)}apply(t,s,i,r){this.uniforms.filterMatrix=t.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;const n=this.maskSprite.worldTransform,o=Math.sqrt(n.a*n.a+n.b*n.b),a=Math.sqrt(n.c*n.c+n.d*n.d);o!==0&&a!==0&&(this.uniforms.rotation[0]=n.a/o,this.uniforms.rotation[1]=n.b/o,this.uniforms.rotation[2]=n.c/a,this.uniforms.rotation[3]=n.d/a),t.applyFilter(this,s,i,r)}get map(){return this.uniforms.mapSampler}set map(t){this.uniforms.mapSampler=t}}var pv=`varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;
uniform sampler2D uSampler;
uniform highp vec4 inputSize;


/**
 Basic FXAA implementation based on the code on geeks3d.com with the
 modification that the texture2DLod stuff was removed since it's
 unsupported by WebGL.

 --

 From:
 https://github.com/mitsuhiko/webgl-meincraft

 Copyright (c) 2011 by Armin Ronacher.

 Some rights reserved.

 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions are
 met:

 * Redistributions of source code must retain the above copyright
 notice, this list of conditions and the following disclaimer.

 * Redistributions in binary form must reproduce the above
 copyright notice, this list of conditions and the following
 disclaimer in the documentation and/or other materials provided
 with the distribution.

 * The names of the contributors may not be used to endorse or
 promote products derived from this software without specific
 prior written permission.

 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

#ifndef FXAA_REDUCE_MIN
#define FXAA_REDUCE_MIN   (1.0/ 128.0)
#endif
#ifndef FXAA_REDUCE_MUL
#define FXAA_REDUCE_MUL   (1.0 / 8.0)
#endif
#ifndef FXAA_SPAN_MAX
#define FXAA_SPAN_MAX     8.0
#endif

//optimized version for mobile, where dependent
//texture reads can be a bottleneck
vec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,
          vec2 v_rgbNW, vec2 v_rgbNE,
          vec2 v_rgbSW, vec2 v_rgbSE,
          vec2 v_rgbM) {
    vec4 color;
    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;
    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;
    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;
    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;
    vec4 texColor = texture2D(tex, v_rgbM);
    vec3 rgbM  = texColor.xyz;
    vec3 luma = vec3(0.299, 0.587, 0.114);
    float lumaNW = dot(rgbNW, luma);
    float lumaNE = dot(rgbNE, luma);
    float lumaSW = dot(rgbSW, luma);
    float lumaSE = dot(rgbSE, luma);
    float lumaM  = dot(rgbM,  luma);
    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));

    mediump vec2 dir;
    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));

    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *
                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);

    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);
    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),
              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),
                  dir * rcpDirMin)) * inverseVP;

    vec3 rgbA = 0.5 * (
                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +
                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);
    vec3 rgbB = rgbA * 0.5 + 0.25 * (
                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +
                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);

    float lumaB = dot(rgbB, luma);
    if ((lumaB < lumaMin) || (lumaB > lumaMax))
        color = vec4(rgbA, texColor.a);
    else
        color = vec4(rgbB, texColor.a);
    return color;
}

void main() {

      vec4 color;

      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);

      gl_FragColor = color;
}
`,mv=`
attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

void texcoords(vec2 fragCoord, vec2 inverseVP,
               out vec2 v_rgbNW, out vec2 v_rgbNE,
               out vec2 v_rgbSW, out vec2 v_rgbSE,
               out vec2 v_rgbM) {
    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;
    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;
    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;
    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;
    v_rgbM = vec2(fragCoord * inverseVP);
}

void main(void) {

   gl_Position = filterVertexPosition();

   vFragCoord = aVertexPosition * outputFrame.zw;

   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);
}
`;class gv extends re{constructor(){super(mv,pv)}}var _v=`precision highp float;

varying vec2 vTextureCoord;
varying vec4 vColor;

uniform float uNoise;
uniform float uSeed;
uniform sampler2D uSampler;

float rand(vec2 co)
{
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

void main()
{
    vec4 color = texture2D(uSampler, vTextureCoord);
    float randomValue = rand(gl_FragCoord.xy * uSeed);
    float diff = (randomValue - 0.5) * uNoise;

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (color.a > 0.0) {
        color.rgb /= color.a;
    }

    color.r += diff;
    color.g += diff;
    color.b += diff;

    // Premultiply alpha again.
    color.rgb *= color.a;

    gl_FragColor = color;
}
`;class xv extends re{constructor(t=.5,s=Math.random()){super(yf,_v,{uNoise:0,uSeed:0}),this.noise=t,this.seed=s}get noise(){return this.uniforms.uNoise}set noise(t){this.uniforms.uNoise=t}get seed(){return this.uniforms.uSeed}set seed(t){this.uniforms.uSeed=t}}const Uc={AlphaFilter:iv,BlurFilter:hv,BlurFilterPass:il,ColorMatrixFilter:rl,DisplacementFilter:fv,FXAAFilter:gv,NoiseFilter:xv};Object.entries(Uc).forEach(([e,t])=>{Object.defineProperty(Uc,e,{get(){return Et("7.1.0",`filters.${e} has moved to ${e}`),t}})});class vv{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}init(t){this.removeTickerListener(),this.events=t,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(t){this._pauseUpdate=t}addTickerListener(){this.tickerAdded||!this.domElement||(Vt.system.add(this.tickerUpdate,this,Ns.INTERACTION),this.tickerAdded=!0)}removeTickerListener(){this.tickerAdded&&(Vt.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)}pointerMoved(){this._didMove=!0}update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove){this._didMove=!1;return}const t=this.events.rootPointerEvent;this.events.supportsTouchEvents&&t.pointerType==="touch"||globalThis.document.dispatchEvent(new PointerEvent("pointermove",{clientX:t.clientX,clientY:t.clientY}))}tickerUpdate(t){this._deltaTime+=t,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.update())}}const Ss=new vv;class Dr{constructor(t){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=Dr.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new At,this.page=new At,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=t}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(t,s,i){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(t,s,i,r,n){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class $n extends Dr{constructor(){super(...arguments),this.client=new At,this.movement=new At,this.offset=new At,this.global=new At,this.screen=new At}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(t,s,i){return t.worldTransform.applyInverse(i||this.global,s)}getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,s,i,r,n,o,a,l,h,c,u,d,p,f,m){throw new Error("Method not implemented.")}}class Pe extends $n{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return this.type==="pointermove"||this.type==="mousemove"||this.type==="touchmove"?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class ki extends $n{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}}ki.DOM_DELTA_PIXEL=0;ki.DOM_DELTA_LINE=1;ki.DOM_DELTA_PAGE=2;const yv=2048,Ev=new At,ra=new At;class bv{constructor(t){this.dispatch=new ii,this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this._allInteractiveElements=[],this._hitElements=[],this._isPointerMoveEvent=!1,this.rootTarget=t,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(t,s){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:s,priority:0}),this.mappingTable[t].sort((i,r)=>i.priority-r.priority)}dispatchEvent(t,s){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,s),this.dispatch.emit(s||t.type,t)}mapEvent(t){if(!this.rootTarget)return;const s=this.mappingTable[t.type];if(s)for(let i=0,r=s.length;i<r;i++)s[i].fn(t);else console.warn(`[EventBoundary]: Event mapping not defined for ${t.type}`)}hitTest(t,s){Ss.pauseUpdate=!0;const r=this._isPointerMoveEvent&&this.enableGlobalMoveEvents?"hitTestMoveRecursive":"hitTestRecursive",n=this[r](this.rootTarget,this.rootTarget.eventMode,Ev.set(t,s),this.hitTestFn,this.hitPruneFn);return n&&n[0]}propagate(t,s){if(!t.target)return;const i=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(let r=0,n=i.length-1;r<n;r++)if(t.currentTarget=i[r],this.notifyTarget(t,s),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,s),!(t.propagationStopped||t.propagationImmediatelyStopped)){t.eventPhase=t.BUBBLING_PHASE;for(let r=i.length-2;r>=0;r--)if(t.currentTarget=i[r],this.notifyTarget(t,s),t.propagationStopped||t.propagationImmediatelyStopped)return}}all(t,s,i=this._allInteractiveElements){if(i.length===0)return;t.eventPhase=t.BUBBLING_PHASE;const r=Array.isArray(s)?s:[s];for(let n=i.length-1;n>=0;n--)r.forEach(o=>{t.currentTarget=i[n],this.notifyTarget(t,o)})}propagationPath(t){const s=[t];for(let i=0;i<yv&&t!==this.rootTarget;i++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");s.push(t.parent),t=t.parent}return s.reverse(),s}hitTestMoveRecursive(t,s,i,r,n,o=!1){let a=!1;if(this._interactivePrune(t))return null;if((t.eventMode==="dynamic"||s==="dynamic")&&(Ss.pauseUpdate=!1),t.interactiveChildren&&t.children){const c=t.children;for(let u=c.length-1;u>=0;u--){const d=c[u],p=this.hitTestMoveRecursive(d,this._isInteractive(s)?s:d.eventMode,i,r,n,o||n(t,i));if(p){if(p.length>0&&!p[p.length-1].parent)continue;const f=t.isInteractive();(p.length>0||f)&&(f&&this._allInteractiveElements.push(t),p.push(t)),this._hitElements.length===0&&(this._hitElements=p),a=!0}}}const l=this._isInteractive(s),h=t.isInteractive();return h&&h&&this._allInteractiveElements.push(t),o||this._hitElements.length>0?null:a?this._hitElements:l&&!n(t,i)&&r(t,i)?h?[t]:[]:null}hitTestRecursive(t,s,i,r,n){if(this._interactivePrune(t)||n(t,i))return null;if((t.eventMode==="dynamic"||s==="dynamic")&&(Ss.pauseUpdate=!1),t.interactiveChildren&&t.children){const l=t.children;for(let h=l.length-1;h>=0;h--){const c=l[h],u=this.hitTestRecursive(c,this._isInteractive(s)?s:c.eventMode,i,r,n);if(u){if(u.length>0&&!u[u.length-1].parent)continue;const d=t.isInteractive();return(u.length>0||d)&&u.push(t),u}}}const o=this._isInteractive(s),a=t.isInteractive();return o&&r(t,i)?a?[t]:[]:null}_isInteractive(t){return t==="static"||t==="dynamic"}_interactivePrune(t){return!!(!t||t.isMask||!t.visible||!t.renderable||t.eventMode==="none"||t.eventMode==="passive"&&!t.interactiveChildren||t.isMask)}hitPruneFn(t,s){var i;if(t.hitArea&&(t.worldTransform.applyInverse(s,ra),!t.hitArea.contains(ra.x,ra.y)))return!0;if(t._mask){const r=t._mask.isMaskData?t._mask.maskObject:t._mask;if(r&&!((i=r.containsPoint)!=null&&i.call(r,s)))return!0}return!1}hitTestFn(t,s){return t.eventMode==="passive"?!1:t.hitArea?!0:t.containsPoint?t.containsPoint(s):!1}notifyTarget(t,s){var n,o;s=s??t.type;const i=`on${s}`;(o=(n=t.currentTarget)[i])==null||o.call(n,t);const r=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?`${s}capture`:s;this.notifyListeners(t,r),t.eventPhase===t.AT_TARGET&&this.notifyListeners(t,s)}mapPointerDown(t){if(!(t instanceof Pe)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const s=this.createPointerEvent(t);if(this.dispatchEvent(s,"pointerdown"),s.pointerType==="touch")this.dispatchEvent(s,"touchstart");else if(s.pointerType==="mouse"||s.pointerType==="pen"){const r=s.button===2;this.dispatchEvent(s,r?"rightdown":"mousedown")}const i=this.trackingData(t.pointerId);i.pressTargetsByButton[t.button]=s.composedPath(),this.freeEvent(s)}mapPointerMove(t){var l,h;if(!(t instanceof Pe)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}this._allInteractiveElements.length=0,this._hitElements.length=0,this._isPointerMoveEvent=!0;const s=this.createPointerEvent(t);this._isPointerMoveEvent=!1;const i=s.pointerType==="mouse"||s.pointerType==="pen",r=this.trackingData(t.pointerId),n=this.findMountedTarget(r.overTargets);if(((l=r.overTargets)==null?void 0:l.length)>0&&n!==s.target){const c=t.type==="mousemove"?"mouseout":"pointerout",u=this.createPointerEvent(t,c,n);if(this.dispatchEvent(u,"pointerout"),i&&this.dispatchEvent(u,"mouseout"),!s.composedPath().includes(n)){const d=this.createPointerEvent(t,"pointerleave",n);for(d.eventPhase=d.AT_TARGET;d.target&&!s.composedPath().includes(d.target);)d.currentTarget=d.target,this.notifyTarget(d),i&&this.notifyTarget(d,"mouseleave"),d.target=d.target.parent;this.freeEvent(d)}this.freeEvent(u)}if(n!==s.target){const c=t.type==="mousemove"?"mouseover":"pointerover",u=this.clonePointerEvent(s,c);this.dispatchEvent(u,"pointerover"),i&&this.dispatchEvent(u,"mouseover");let d=n==null?void 0:n.parent;for(;d&&d!==this.rootTarget.parent&&d!==s.target;)d=d.parent;if(!d||d===this.rootTarget.parent){const f=this.clonePointerEvent(s,"pointerenter");for(f.eventPhase=f.AT_TARGET;f.target&&f.target!==n&&f.target!==this.rootTarget.parent;)f.currentTarget=f.target,this.notifyTarget(f),i&&this.notifyTarget(f,"mouseenter"),f.target=f.target.parent;this.freeEvent(f)}this.freeEvent(u)}const o=[],a=this.enableGlobalMoveEvents??!0;this.moveOnAll?o.push("pointermove"):this.dispatchEvent(s,"pointermove"),a&&o.push("globalpointermove"),s.pointerType==="touch"&&(this.moveOnAll?o.splice(1,0,"touchmove"):this.dispatchEvent(s,"touchmove"),a&&o.push("globaltouchmove")),i&&(this.moveOnAll?o.splice(1,0,"mousemove"):this.dispatchEvent(s,"mousemove"),a&&o.push("globalmousemove"),this.cursor=(h=s.target)==null?void 0:h.cursor),o.length>0&&this.all(s,o),this._allInteractiveElements.length=0,this._hitElements.length=0,r.overTargets=s.composedPath(),this.freeEvent(s)}mapPointerOver(t){var o;if(!(t instanceof Pe)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const s=this.trackingData(t.pointerId),i=this.createPointerEvent(t),r=i.pointerType==="mouse"||i.pointerType==="pen";this.dispatchEvent(i,"pointerover"),r&&this.dispatchEvent(i,"mouseover"),i.pointerType==="mouse"&&(this.cursor=(o=i.target)==null?void 0:o.cursor);const n=this.clonePointerEvent(i,"pointerenter");for(n.eventPhase=n.AT_TARGET;n.target&&n.target!==this.rootTarget.parent;)n.currentTarget=n.target,this.notifyTarget(n),r&&this.notifyTarget(n,"mouseenter"),n.target=n.target.parent;s.overTargets=i.composedPath(),this.freeEvent(i),this.freeEvent(n)}mapPointerOut(t){if(!(t instanceof Pe)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const s=this.trackingData(t.pointerId);if(s.overTargets){const i=t.pointerType==="mouse"||t.pointerType==="pen",r=this.findMountedTarget(s.overTargets),n=this.createPointerEvent(t,"pointerout",r);this.dispatchEvent(n),i&&this.dispatchEvent(n,"mouseout");const o=this.createPointerEvent(t,"pointerleave",r);for(o.eventPhase=o.AT_TARGET;o.target&&o.target!==this.rootTarget.parent;)o.currentTarget=o.target,this.notifyTarget(o),i&&this.notifyTarget(o,"mouseleave"),o.target=o.target.parent;s.overTargets=null,this.freeEvent(n),this.freeEvent(o)}this.cursor=null}mapPointerUp(t){if(!(t instanceof Pe)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const s=performance.now(),i=this.createPointerEvent(t);if(this.dispatchEvent(i,"pointerup"),i.pointerType==="touch")this.dispatchEvent(i,"touchend");else if(i.pointerType==="mouse"||i.pointerType==="pen"){const a=i.button===2;this.dispatchEvent(i,a?"rightup":"mouseup")}const r=this.trackingData(t.pointerId),n=this.findMountedTarget(r.pressTargetsByButton[t.button]);let o=n;if(n&&!i.composedPath().includes(n)){let a=n;for(;a&&!i.composedPath().includes(a);){if(i.currentTarget=a,this.notifyTarget(i,"pointerupoutside"),i.pointerType==="touch")this.notifyTarget(i,"touchendoutside");else if(i.pointerType==="mouse"||i.pointerType==="pen"){const l=i.button===2;this.notifyTarget(i,l?"rightupoutside":"mouseupoutside")}a=a.parent}delete r.pressTargetsByButton[t.button],o=a}if(o){const a=this.clonePointerEvent(i,"click");a.target=o,a.path=null,r.clicksByButton[t.button]||(r.clicksByButton[t.button]={clickCount:0,target:a.target,timeStamp:s});const l=r.clicksByButton[t.button];if(l.target===a.target&&s-l.timeStamp<200?++l.clickCount:l.clickCount=1,l.target=a.target,l.timeStamp=s,a.detail=l.clickCount,a.pointerType==="mouse"){const h=a.button===2;this.dispatchEvent(a,h?"rightclick":"click")}else a.pointerType==="touch"&&this.dispatchEvent(a,"tap");this.dispatchEvent(a,"pointertap"),this.freeEvent(a)}this.freeEvent(i)}mapPointerUpOutside(t){if(!(t instanceof Pe)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const s=this.trackingData(t.pointerId),i=this.findMountedTarget(s.pressTargetsByButton[t.button]),r=this.createPointerEvent(t);if(i){let n=i;for(;n;)r.currentTarget=n,this.notifyTarget(r,"pointerupoutside"),r.pointerType==="touch"?this.notifyTarget(r,"touchendoutside"):(r.pointerType==="mouse"||r.pointerType==="pen")&&this.notifyTarget(r,r.button===2?"rightupoutside":"mouseupoutside"),n=n.parent;delete s.pressTargetsByButton[t.button]}this.freeEvent(r)}mapWheel(t){if(!(t instanceof ki)){console.warn("EventBoundary cannot map a non-wheel event as a wheel event");return}const s=this.createWheelEvent(t);this.dispatchEvent(s),this.freeEvent(s)}findMountedTarget(t){if(!t)return null;let s=t[0];for(let i=1;i<t.length&&t[i].parent===s;i++)s=t[i];return s}createPointerEvent(t,s,i){const r=this.allocateEvent(Pe);return this.copyPointerData(t,r),this.copyMouseData(t,r),this.copyData(t,r),r.nativeEvent=t.nativeEvent,r.originalEvent=t,r.target=i??this.hitTest(r.global.x,r.global.y)??this._hitElements[0],typeof s=="string"&&(r.type=s),r}createWheelEvent(t){const s=this.allocateEvent(ki);return this.copyWheelData(t,s),this.copyMouseData(t,s),this.copyData(t,s),s.nativeEvent=t.nativeEvent,s.originalEvent=t,s.target=this.hitTest(s.global.x,s.global.y),s}clonePointerEvent(t,s){const i=this.allocateEvent(Pe);return i.nativeEvent=t.nativeEvent,i.originalEvent=t.originalEvent,this.copyPointerData(t,i),this.copyMouseData(t,i),this.copyData(t,i),i.target=t.target,i.path=t.composedPath().slice(),i.type=s??i.type,i}copyWheelData(t,s){s.deltaMode=t.deltaMode,s.deltaX=t.deltaX,s.deltaY=t.deltaY,s.deltaZ=t.deltaZ}copyPointerData(t,s){t instanceof Pe&&s instanceof Pe&&(s.pointerId=t.pointerId,s.width=t.width,s.height=t.height,s.isPrimary=t.isPrimary,s.pointerType=t.pointerType,s.pressure=t.pressure,s.tangentialPressure=t.tangentialPressure,s.tiltX=t.tiltX,s.tiltY=t.tiltY,s.twist=t.twist)}copyMouseData(t,s){t instanceof $n&&s instanceof $n&&(s.altKey=t.altKey,s.button=t.button,s.buttons=t.buttons,s.client.copyFrom(t.client),s.ctrlKey=t.ctrlKey,s.metaKey=t.metaKey,s.movement.copyFrom(t.movement),s.screen.copyFrom(t.screen),s.shiftKey=t.shiftKey,s.global.copyFrom(t.global))}copyData(t,s){s.isTrusted=t.isTrusted,s.srcElement=t.srcElement,s.timeStamp=performance.now(),s.type=t.type,s.detail=t.detail,s.view=t.view,s.which=t.which,s.layer.copyFrom(t.layer),s.page.copyFrom(t.page)}trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]}allocateEvent(t){this.eventPool.has(t)||this.eventPool.set(t,[]);const s=this.eventPool.get(t).pop()||new t(this);return s.eventPhase=s.NONE,s.currentTarget=null,s.path=null,s.target=null,s}freeEvent(t){if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const s=t.constructor;this.eventPool.has(s)||this.eventPool.set(s,[]),this.eventPool.get(s).push(t)}notifyListeners(t,s){const i=t.currentTarget._events[s];if(i&&t.currentTarget.isInteractive())if("fn"in i)i.once&&t.currentTarget.removeListener(s,i.fn,void 0,!0),i.fn.call(i.context,t);else for(let r=0,n=i.length;r<n&&!t.propagationImmediatelyStopped;r++)i[r].once&&t.currentTarget.removeListener(s,i[r].fn,void 0,!0),i[r].fn.call(i[r].context,t)}}const Tv=1,wv={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},nl=class{constructor(e){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=e,this.rootBoundary=new bv(null),Ss.init(this),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new Pe(null),this.rootWheelEvent=new ki(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.features=new Proxy({...nl.defaultEventFeatures},{set:(t,s,i)=>(s==="globalMove"&&(this.rootBoundary.enableGlobalMoveEvents=i),t[s]=i,!0)}),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(e){const{view:t,resolution:s}=this.renderer;this.setTargetElement(t),this.resolution=s,nl._defaultEventMode=e.eventMode??"auto",Object.assign(this.features,e.eventFeatures??{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange(e){this.resolution=e}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(e){e=e||"default";let t=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(t=!1),this.currentCursor===e)return;this.currentCursor=e;const s=this.cursorStyles[e];if(s)switch(typeof s){case"string":t&&(this.domElement.style.cursor=s);break;case"function":s(e);break;case"object":t&&Object.assign(this.domElement.style,s);break}else t&&typeof e=="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,e)&&(this.domElement.style.cursor=e)}get pointer(){return this.rootPointerEvent}onPointerDown(e){if(!this.features.click||(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&e.pointerType==="touch"))return;const t=this.normalizeToPointerData(e);this.autoPreventDefault&&t[0].isNormalized&&(e.cancelable||!("cancelable"in e))&&e.preventDefault();for(let s=0,i=t.length;s<i;s++){const r=t[s],n=this.bootstrapEvent(this.rootPointerEvent,r);this.rootBoundary.mapEvent(n)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(e){if(!this.features.move||(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&e.pointerType==="touch"))return;Ss.pointerMoved();const t=this.normalizeToPointerData(e);for(let s=0,i=t.length;s<i;s++){const r=this.bootstrapEvent(this.rootPointerEvent,t[s]);this.rootBoundary.mapEvent(r)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(e){if(!this.features.click||(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&e.pointerType==="touch"))return;let t=e.target;e.composedPath&&e.composedPath().length>0&&(t=e.composedPath()[0]);const s=t!==this.domElement?"outside":"",i=this.normalizeToPointerData(e);for(let r=0,n=i.length;r<n;r++){const o=this.bootstrapEvent(this.rootPointerEvent,i[r]);o.type+=s,this.rootBoundary.mapEvent(o)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(e){if(!this.features.click||(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&e.pointerType==="touch"))return;const t=this.normalizeToPointerData(e);for(let s=0,i=t.length;s<i;s++){const r=this.bootstrapEvent(this.rootPointerEvent,t[s]);this.rootBoundary.mapEvent(r)}this.setCursor(this.rootBoundary.cursor)}onWheel(e){if(!this.features.wheel)return;const t=this.normalizeWheelEvent(e);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(t)}setTargetElement(e){this.removeEvents(),this.domElement=e,Ss.domElement=e,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;Ss.addTickerListener();const e=this.domElement.style;e&&(globalThis.navigator.msPointerEnabled?(e.msContentZooming="none",e.msTouchAction="none"):this.supportsPointerEvents&&(e.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0)),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;Ss.removeTickerListener();const e=this.domElement.style;globalThis.navigator.msPointerEnabled?(e.msContentZooming="",e.msTouchAction=""):this.supportsPointerEvents&&(e.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0)),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(e,t,s){let i;this.domElement.parentElement?i=this.domElement.getBoundingClientRect():i={x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0};const r=1/this.resolution;e.x=(t-i.left)*(this.domElement.width/i.width)*r,e.y=(s-i.top)*(this.domElement.height/i.height)*r}normalizeToPointerData(e){const t=[];if(this.supportsTouchEvents&&e instanceof TouchEvent)for(let s=0,i=e.changedTouches.length;s<i;s++){const r=e.changedTouches[s];typeof r.button>"u"&&(r.button=0),typeof r.buttons>"u"&&(r.buttons=1),typeof r.isPrimary>"u"&&(r.isPrimary=e.touches.length===1&&e.type==="touchstart"),typeof r.width>"u"&&(r.width=r.radiusX||1),typeof r.height>"u"&&(r.height=r.radiusY||1),typeof r.tiltX>"u"&&(r.tiltX=0),typeof r.tiltY>"u"&&(r.tiltY=0),typeof r.pointerType>"u"&&(r.pointerType="touch"),typeof r.pointerId>"u"&&(r.pointerId=r.identifier||0),typeof r.pressure>"u"&&(r.pressure=r.force||.5),typeof r.twist>"u"&&(r.twist=0),typeof r.tangentialPressure>"u"&&(r.tangentialPressure=0),typeof r.layerX>"u"&&(r.layerX=r.offsetX=r.clientX),typeof r.layerY>"u"&&(r.layerY=r.offsetY=r.clientY),r.isNormalized=!0,r.type=e.type,t.push(r)}else if(!globalThis.MouseEvent||e instanceof MouseEvent&&(!this.supportsPointerEvents||!(e instanceof globalThis.PointerEvent))){const s=e;typeof s.isPrimary>"u"&&(s.isPrimary=!0),typeof s.width>"u"&&(s.width=1),typeof s.height>"u"&&(s.height=1),typeof s.tiltX>"u"&&(s.tiltX=0),typeof s.tiltY>"u"&&(s.tiltY=0),typeof s.pointerType>"u"&&(s.pointerType="mouse"),typeof s.pointerId>"u"&&(s.pointerId=Tv),typeof s.pressure>"u"&&(s.pressure=.5),typeof s.twist>"u"&&(s.twist=0),typeof s.tangentialPressure>"u"&&(s.tangentialPressure=0),s.isNormalized=!0,t.push(s)}else t.push(e);return t}normalizeWheelEvent(e){const t=this.rootWheelEvent;return this.transferMouseData(t,e),t.deltaX=e.deltaX,t.deltaY=e.deltaY,t.deltaZ=e.deltaZ,t.deltaMode=e.deltaMode,this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.nativeEvent=e,t.type=e.type,t}bootstrapEvent(e,t){return e.originalEvent=null,e.nativeEvent=t,e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist,this.transferMouseData(e,t),this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.isTrusted=t.isTrusted,e.type==="pointerleave"&&(e.type="pointerout"),e.type.startsWith("mouse")&&(e.type=e.type.replace("mouse","pointer")),e.type.startsWith("touch")&&(e.type=wv[e.type]||e.type),e}transferMouseData(e,t){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.x=t.clientX,e.client.y=t.clientY,e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.x=t.movementX,e.movement.y=t.movementY,e.page.x=t.pageX,e.page.y=t.pageY,e.relatedTarget=null,e.shiftKey=t.shiftKey}};let Rr=nl;Rr.extension={name:"events",type:[Z.RendererSystem,Z.CanvasRendererSystem]};Rr.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0};rt.add(Rr);function kc(e){return e==="dynamic"||e==="static"}const Sv={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,_internalInteractive:void 0,get interactive(){return this._internalInteractive??kc(Rr.defaultEventMode)},set interactive(e){Et("7.2.0","Setting interactive is deprecated, use eventMode = 'none'/'passive'/'auto'/'static'/'dynamic' instead."),this._internalInteractive=e,this.eventMode=e?"static":"auto"},_internalEventMode:void 0,get eventMode(){return this._internalEventMode??Rr.defaultEventMode},set eventMode(e){this._internalInteractive=kc(e),this._internalEventMode=e},isInteractive(){return this.eventMode==="static"||this.eventMode==="dynamic"},interactiveChildren:!0,hitArea:null,addEventListener(e,t,s){const i=typeof s=="boolean"&&s||typeof s=="object"&&s.capture,r=typeof t=="function"?void 0:t;e=i?`${e}capture`:e,t=typeof t=="function"?t:t.handleEvent,this.on(e,t,r)},removeEventListener(e,t,s){const i=typeof s=="boolean"&&s||typeof s=="object"&&s.capture,r=typeof t=="function"?void 0:t;e=i?`${e}capture`:e,t=typeof t=="function"?t:t.handleEvent,this.off(e,t,r)},dispatchEvent(e){if(!(e instanceof Dr))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return e.defaultPrevented=!1,e.path=null,e.target=this,e.manager.dispatchEvent(e),!e.defaultPrevented}};Wt.mixin(Sv);const Av={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1};Wt.mixin(Av);const Cv=9,on=100,Iv=0,Rv=0,Gc=2,Hc=1,Pv=-1e3,Mv=-1e3,Ov=2;class Cf{constructor(t){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(ds.tablet||ds.phone)&&this.createTouchHook();const s=document.createElement("div");s.style.width=`${on}px`,s.style.height=`${on}px`,s.style.position="absolute",s.style.top=`${Iv}px`,s.style.left=`${Rv}px`,s.style.zIndex=Gc.toString(),this.div=s,this.renderer=t,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){const t=document.createElement("button");t.style.width=`${Hc}px`,t.style.height=`${Hc}px`,t.style.position="absolute",t.style.top=`${Pv}px`,t.style.left=`${Mv}px`,t.style.zIndex=Ov.toString(),t.style.backgroundColor="#FF0000",t.title="select to enable accessibility for this content",t.addEventListener("focus",()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()}),document.body.appendChild(t),this._hookDiv=t}destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){var t;this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),(t=this.renderer.view.parentNode)==null||t.appendChild(this.div))}deactivate(){var t;!this._isActive||this._isMobileAccessibility||(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),(t=this.div.parentNode)==null||t.removeChild(this.div))}updateAccessibleObjects(t){if(!t.visible||!t.accessibleChildren)return;t.accessible&&t.isInteractive()&&(t._accessibleActive||this.addChild(t),t.renderId=this.renderId);const s=t.children;if(s)for(let i=0;i<s.length;i++)this.updateAccessibleObjects(s[i])}update(){const t=performance.now();if(ds.android.device&&t<this.androidUpdateCount||(this.androidUpdateCount=t+this.androidUpdateFrequency,!this.renderer.renderingToScreen))return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);const{x:s,y:i,width:r,height:n}=this.renderer.view.getBoundingClientRect(),{width:o,height:a,resolution:l}=this.renderer,h=r/o*l,c=n/a*l;let u=this.div;u.style.left=`${s}px`,u.style.top=`${i}px`,u.style.width=`${o}px`,u.style.height=`${a}px`;for(let d=0;d<this.children.length;d++){const p=this.children[d];if(p.renderId!==this.renderId)p._accessibleActive=!1,Oi(this.children,d,1),this.div.removeChild(p._accessibleDiv),this.pool.push(p._accessibleDiv),p._accessibleDiv=null,d--;else{u=p._accessibleDiv;let f=p.hitArea;const m=p.worldTransform;p.hitArea?(u.style.left=`${(m.tx+f.x*m.a)*h}px`,u.style.top=`${(m.ty+f.y*m.d)*c}px`,u.style.width=`${f.width*m.a*h}px`,u.style.height=`${f.height*m.d*c}px`):(f=p.getBounds(),this.capHitArea(f),u.style.left=`${f.x*h}px`,u.style.top=`${f.y*c}px`,u.style.width=`${f.width*h}px`,u.style.height=`${f.height*c}px`,u.title!==p.accessibleTitle&&p.accessibleTitle!==null&&(u.title=p.accessibleTitle),u.getAttribute("aria-label")!==p.accessibleHint&&p.accessibleHint!==null&&u.setAttribute("aria-label",p.accessibleHint)),(p.accessibleTitle!==u.title||p.tabIndex!==u.tabIndex)&&(u.title=p.accessibleTitle,u.tabIndex=p.tabIndex,this.debug&&this.updateDebugHTML(u))}}this.renderId++}updateDebugHTML(t){t.innerHTML=`type: ${t.type}</br> title : ${t.title}</br> tabIndex: ${t.tabIndex}`}capHitArea(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0);const{width:s,height:i}=this.renderer;t.x+t.width>s&&(t.width=s-t.x),t.y+t.height>i&&(t.height=i-t.y)}addChild(t){let s=this.pool.pop();s||(s=document.createElement("button"),s.style.width=`${on}px`,s.style.height=`${on}px`,s.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",s.style.position="absolute",s.style.zIndex=Gc.toString(),s.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?s.setAttribute("aria-live","off"):s.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?s.setAttribute("aria-relevant","additions"):s.setAttribute("aria-relevant","text"),s.addEventListener("click",this._onClick.bind(this)),s.addEventListener("focus",this._onFocus.bind(this)),s.addEventListener("focusout",this._onFocusOut.bind(this))),s.style.pointerEvents=t.accessiblePointerEvents,s.type=t.accessibleType,t.accessibleTitle&&t.accessibleTitle!==null?s.title=t.accessibleTitle:(!t.accessibleHint||t.accessibleHint===null)&&(s.title=`displayObject ${t.tabIndex}`),t.accessibleHint&&t.accessibleHint!==null&&s.setAttribute("aria-label",t.accessibleHint),this.debug&&this.updateDebugHTML(s),t._accessibleActive=!0,t._accessibleDiv=s,s.displayObject=t,this.children.push(t),this.div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex}_dispatchEvent(t,s){const{displayObject:i}=t.target,r=this.renderer.events.rootBoundary,n=Object.assign(new Dr(r),{target:i});r.rootTarget=this.renderer.lastObjectRendered,s.forEach(o=>r.dispatchEvent(n,o))}_onClick(t){this._dispatchEvent(t,["click","pointertap","tap"])}_onFocus(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","assertive"),this._dispatchEvent(t,["mouseover"])}_onFocusOut(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","polite"),this._dispatchEvent(t,["mouseout"])}_onKeyDown(t){t.keyCode===Cv&&this.activate()}_onMouseMove(t){t.movementX===0&&t.movementY===0||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}}Cf.extension={name:"accessibility",type:[Z.RendererPlugin,Z.CanvasRendererPlugin]};rt.add(Cf);const ol=class{constructor(e){this.stage=new fe,e=Object.assign({forceCanvas:!1},e),this.renderer=X0(e),ol._plugins.forEach(t=>{t.init.call(this,e)})}render(){this.renderer.render(this.stage)}get view(){return this.renderer.view}get screen(){return this.renderer.screen}destroy(e,t){const s=ol._plugins.slice(0);s.reverse(),s.forEach(i=>{i.destroy.call(this)}),this.stage.destroy(t),this.stage=null,this.renderer.destroy(e),this.renderer=null}};let ql=ol;ql._plugins=[];rt.handleByList(Z.Application,ql._plugins);class If{static init(t){Object.defineProperty(this,"resizeTo",{set(s){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=s,s&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;this.cancelResize();let s,i;if(this._resizeTo===globalThis.window)s=globalThis.innerWidth,i=globalThis.innerHeight;else{const{clientWidth:r,clientHeight:n}=this._resizeTo;s=r,i=n}this.renderer.resize(s,i),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}If.extension=Z.Application;rt.add(If);const $c={loader:Z.LoadParser,resolver:Z.ResolveParser,cache:Z.CacheParser,detection:Z.DetectionParser};rt.handle(Z.Asset,e=>{const t=e.ref;Object.entries($c).filter(([s])=>!!t[s]).forEach(([s,i])=>rt.add(Object.assign(t[s],{extension:t[s].extension??i})))},e=>{const t=e.ref;Object.keys($c).filter(s=>!!t[s]).forEach(s=>rt.remove(t[s]))});class Bv{constructor(t,s=!1){this._loader=t,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=s}add(t){t.forEach(s=>{this._assetList.push(s)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const t=[],s=Math.min(this._assetList.length,this._maxConcurrent);for(let i=0;i<s;i++)t.push(this._assetList.pop());await this._loader.load(t),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(t){this._isActive!==t&&(this._isActive=t,t&&!this._isLoading&&this._next())}}function Lr(e,t){if(Array.isArray(t)){for(const s of t)if(e.startsWith(`data:${s}`))return!0;return!1}return e.startsWith(`data:${t}`)}function ui(e,t){const s=e.split("?")[0],i=ae.extname(s).toLowerCase();return Array.isArray(t)?t.includes(i):i===t}const fs=(e,t)=>(Array.isArray(e)||(e=[e]),t?e.map(s=>typeof s=="string"?t(s):s):e),al=(e,t)=>{const s=t.split("?")[1];return s&&(e+=`?${s}`),e};function Rf(e,t,s,i,r){const n=t[s];for(let o=0;o<n.length;o++){const a=n[o];s<t.length-1?Rf(e.replace(i[s],a),t,s+1,i,r):r.push(e.replace(i[s],a))}}function Dv(e){const t=/\{(.*?)\}/g,s=e.match(t),i=[];if(s){const r=[];s.forEach(n=>{const o=n.substring(1,n.length-1).split(",");r.push(o)}),Rf(e,r,0,s,i)}else i.push(e);return i}const Wn=e=>!Array.isArray(e);class Lv{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(t){return this._cache.has(t)}get(t){const s=this._cache.get(t);return s||console.warn(`[Assets] Asset id ${t} was not found in the Cache`),s}set(t,s){const i=fs(t);let r;for(let a=0;a<this.parsers.length;a++){const l=this.parsers[a];if(l.test(s)){r=l.getCacheableAssets(i,s);break}}r||(r={},i.forEach(a=>{r[a]=s}));const n=Object.keys(r),o={cacheKeys:n,keys:i};if(i.forEach(a=>{this._cacheMap.set(a,o)}),n.forEach(a=>{this._cache.has(a)&&this._cache.get(a)!==s&&console.warn("[Cache] already has key:",a),this._cache.set(a,r[a])}),s instanceof J){const a=s;i.forEach(l=>{a.baseTexture!==J.EMPTY.baseTexture&&pt.addToCache(a.baseTexture,l),J.addToCache(a,l)})}}remove(t){if(this._cacheMap.get(t),!this._cacheMap.has(t)){console.warn(`[Assets] Asset id ${t} was not found in the Cache`);return}const s=this._cacheMap.get(t);s.cacheKeys.forEach(r=>{this._cache.delete(r)}),s.keys.forEach(r=>{this._cacheMap.delete(r)})}get parsers(){return this._parsers}}const er=new Lv;class Fv{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(t,s,i)=>(this._parsersValidated=!1,t[s]=i,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(t,s){const i={promise:null,parser:null};return i.promise=(async()=>{var o,a;let r=null,n=null;if(s.loadParser&&(n=this._parserHash[s.loadParser],n||console.warn(`[Assets] specified load parser "${s.loadParser}" not found while loading ${t}`)),!n){for(let l=0;l<this.parsers.length;l++){const h=this.parsers[l];if(h.load&&((o=h.test)!=null&&o.call(h,t,s,this))){n=h;break}}if(!n)return console.warn(`[Assets] ${t} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}r=await n.load(t,s,this),i.parser=n;for(let l=0;l<this.parsers.length;l++){const h=this.parsers[l];h.parse&&h.parse&&await((a=h.testParse)==null?void 0:a.call(h,r,s,this))&&(r=await h.parse(r,s,this)||r,i.parser=h)}return r})(),i}async load(t,s){this._parsersValidated||this._validateParsers();let i=0;const r={},n=Wn(t),o=fs(t,h=>({src:h})),a=o.length,l=o.map(async h=>{const c=ae.toAbsolute(h.src);if(!r[h.src])try{this.promiseCache[c]||(this.promiseCache[c]=this._getLoadPromiseAndParser(c,h)),r[h.src]=await this.promiseCache[c].promise,s&&s(++i/a)}catch(u){throw delete this.promiseCache[c],delete r[h.src],new Error(`[Loader.load] Failed to load ${c}.
${u}`)}});return await Promise.all(l),n?r[o[0].src]:r}async unload(t){const i=fs(t,r=>({src:r})).map(async r=>{var a,l;const n=ae.toAbsolute(r.src),o=this.promiseCache[n];if(o){const h=await o.promise;(l=(a=o.parser)==null?void 0:a.unload)==null||l.call(a,h,r,this),delete this.promiseCache[n]}});await Promise.all(i)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter(t=>t.name).reduce((t,s)=>(t[s.name]&&console.warn(`[Assets] loadParser name conflict "${s.name}"`),{...t,[s.name]:s}),{})}}var ns=(e=>(e[e.Low=0]="Low",e[e.Normal=1]="Normal",e[e.High=2]="High",e))(ns||{});const Nv=".json",Uv="application/json",kv={extension:{type:Z.LoadParser,priority:ns.Low},name:"loadJson",test(e){return Lr(e,Uv)||ui(e,Nv)},async load(e){return await(await q.ADAPTER.fetch(e)).json()}};rt.add(kv);const Gv=".txt",Hv="text/plain",$v={name:"loadTxt",extension:{type:Z.LoadParser,priority:ns.Low},test(e){return Lr(e,Hv)||ui(e,Gv)},async load(e){return await(await q.ADAPTER.fetch(e)).text()}};rt.add($v);const Wv=["normal","bold","100","200","300","400","500","600","700","800","900"],Xv=[".ttf",".otf",".woff",".woff2"],zv=["font/ttf","font/otf","font/woff","font/woff2"],jv=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;function Vv(e){const t=ae.extname(e),r=ae.basename(e,t).replace(/(-|_)/g," ").toLowerCase().split(" ").map(a=>a.charAt(0).toUpperCase()+a.slice(1));let n=r.length>0;for(const a of r)if(!a.match(jv)){n=!1;break}let o=r.join(" ");return n||(o=`"${o.replace(/[\\"]/g,"\\$&")}"`),o}const Yv={extension:{type:Z.LoadParser,priority:ns.Low},name:"loadWebFont",test(e){return Lr(e,zv)||ui(e,Xv)},async load(e,t){var i,r,n;const s=q.ADAPTER.getFontFaceSet();if(s){const o=[],a=((i=t.data)==null?void 0:i.family)??Vv(e),l=((n=(r=t.data)==null?void 0:r.weights)==null?void 0:n.filter(c=>Wv.includes(c)))??["normal"],h=t.data??{};for(let c=0;c<l.length;c++){const u=l[c],d=new FontFace(a,`url(${encodeURI(e)})`,{...h,weight:u});await d.load(),s.add(d),o.push(d)}return o.length===1?o[0]:o}return console.warn("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(e){(Array.isArray(e)?e:[e]).forEach(t=>q.ADAPTER.getFontFaceSet().delete(t))}};rt.add(Yv);let Wc=0,na;const Kv="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=",qv={id:"checkImageBitmap",code:`
    async function checkImageBitmap()
    {
        try
        {
            if (typeof createImageBitmap !== 'function') return false;

            const response = await fetch('${Kv}');
            const imageBlob =  await response.blob();
            const imageBitmap = await createImageBitmap(imageBlob);

            return imageBitmap.width === 1 && imageBitmap.height === 1;
        }
        catch (e)
        {
            return false;
        }
    }
    checkImageBitmap().then((result) => { self.postMessage(result); });
    `},Zv={id:"loadImageBitmap",code:`
    async function loadImageBitmap(url)
    {
        const response = await fetch(url);

        if (!response.ok)
        {
            throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \`
                + \`\${response.status} \${response.statusText}\`);
        }

        const imageBlob =  await response.blob();
        const imageBitmap = await createImageBitmap(imageBlob);

        return imageBitmap;
    }
    self.onmessage = async (event) =>
    {
        try
        {
            const imageBitmap = await loadImageBitmap(event.data.data[0]);

            self.postMessage({
                data: imageBitmap,
                uuid: event.data.uuid,
                id: event.data.id,
            }, [imageBitmap]);
        }
        catch(e)
        {
            self.postMessage({
                error: e,
                uuid: event.data.uuid,
                id: event.data.id,
            });
        }
    };`};let oa;class Jv{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(t=>{const s=URL.createObjectURL(new Blob([qv.code],{type:"application/javascript"})),i=new Worker(s);i.addEventListener("message",r=>{i.terminate(),URL.revokeObjectURL(s),t(r.data)})}),this._isImageBitmapSupported)}loadImageBitmap(t){return this._run("loadImageBitmap",[t])}async _initWorkers(){this._initialized||(this._initialized=!0)}getWorker(){na===void 0&&(na=navigator.hardwareConcurrency||4);let t=this.workerPool.pop();return!t&&this._createdWorkers<na&&(oa||(oa=URL.createObjectURL(new Blob([Zv.code],{type:"application/javascript"}))),this._createdWorkers++,t=new Worker(oa),t.addEventListener("message",s=>{this.complete(s.data),this.returnWorker(s.target),this.next()})),t}returnWorker(t){this.workerPool.push(t)}complete(t){t.error!==void 0?this.resolveHash[t.uuid].reject(t.error):this.resolveHash[t.uuid].resolve(t.data),this.resolveHash[t.uuid]=null}async _run(t,s){await this._initWorkers();const i=new Promise((r,n)=>{this.queue.push({id:t,arguments:s,resolve:r,reject:n})});return this.next(),i}next(){if(!this.queue.length)return;const t=this.getWorker();if(!t)return;const s=this.queue.pop(),i=s.id;this.resolveHash[Wc]={resolve:s.resolve,reject:s.reject},t.postMessage({data:s.arguments,uuid:Wc++,id:i})}}const Xc=new Jv;function yo(e,t,s){const i=new J(e);return i.baseTexture.on("dispose",()=>{delete t.promiseCache[s]}),i}const Qv=[".jpeg",".jpg",".png",".webp",".avif"],ty=["image/jpeg","image/png","image/webp","image/avif"];async function ey(e){const t=await q.ADAPTER.fetch(e);if(!t.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${e}: ${t.status} ${t.statusText}`);const s=await t.blob();return await createImageBitmap(s)}const Eo={name:"loadTextures",extension:{type:Z.LoadParser,priority:ns.High},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test(e){return Lr(e,ty)||ui(e,Qv)},async load(e,t,s){let i=null;globalThis.createImageBitmap&&this.config.preferCreateImageBitmap?this.config.preferWorkers&&await Xc.isImageBitmapSupported()?i=await Xc.loadImageBitmap(e):i=await ey(e):i=await new Promise(n=>{i=new Image,i.crossOrigin=this.config.crossOrigin,i.src=e,i.complete?n(i):i.onload=()=>{n(i)}});const r=new pt(i,{resolution:Ds(e),...t.data});return r.resource.src=e,yo(r,s,e)},unload(e){e.destroy(!0)}};rt.add(Eo);const sy=".svg",iy="image/svg+xml",ry={extension:{type:Z.LoadParser,priority:ns.High},name:"loadSVG",test(e){return Lr(e,iy)||ui(e,sy)},async testParse(e){return Ir.test(e)},async parse(e,t,s){var o;const i=new Ir(e,(o=t==null?void 0:t.data)==null?void 0:o.resourceOptions);await i.load();const r=new pt(i,{resolution:Ds(e),...t==null?void 0:t.data});return r.resource.src=e,yo(r,s,e)},async load(e,t){return(await q.ADAPTER.fetch(e)).text()},unload:Eo.unload};rt.add(ry);class ny{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(t,s)=>`${t}${this._bundleIdConnector}${s}`,extractAssetIdFromBundle:(t,s)=>s.replace(`${t}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(t){if(this._bundleIdConnector=t.connector??this._bundleIdConnector,this._createBundleAssetId=t.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=t.extractAssetIdFromBundle??this._extractAssetIdFromBundle,this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar"))!=="bar")throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...t){t.forEach(s=>{this._preferredOrder.push(s),s.priority||(s.priority=Object.keys(s.params))}),this._resolverHash={}}set basePath(t){this._basePath=t}get basePath(){return this._basePath}set rootPath(t){this._rootPath=t}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(t){if(typeof t=="string")this._defaultSearchParams=t;else{const s=t;this._defaultSearchParams=Object.keys(s).map(i=>`${encodeURIComponent(i)}=${encodeURIComponent(s[i])}`).join("&")}}addManifest(t){this._manifest&&console.warn("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=t,t.bundles.forEach(s=>{this.addBundle(s.name,s.assets)})}addBundle(t,s){const i=[];Array.isArray(s)?s.forEach(r=>{if(typeof r.name=="string"){const n=this._createBundleAssetId(t,r.name);i.push(n),this.add([r.name,n],r.srcs,r.data)}else{const n=r.name.map(o=>this._createBundleAssetId(t,o));n.forEach(o=>{i.push(o)}),this.add([...r.name,...n],r.srcs)}}):Object.keys(s).forEach(r=>{i.push(this._createBundleAssetId(t,r)),this.add([r,this._createBundleAssetId(t,r)],s[r])}),this._bundles[t]=i}add(t,s,i){const r=fs(t);r.forEach(o=>{this.hasKey(o)&&console.warn(`[Resolver] already has key: ${o} overwriting`)}),Array.isArray(s)||(typeof s=="string"?s=Dv(s):s=[s]);const n=s.map(o=>{let a=o;if(typeof o=="string"){let l=!1;for(let h=0;h<this._parsers.length;h++){const c=this._parsers[h];if(c.test(o)){a=c.parse(o),l=!0;break}}l||(a={src:o})}return a.format||(a.format=a.src.split(".").pop()),a.alias||(a.alias=r),(this._basePath||this._rootPath)&&(a.src=ae.toAbsolute(a.src,this._basePath,this._rootPath)),a.src=this._appendDefaultSearchParams(a.src),a.data=a.data??i,a});r.forEach(o=>{this._assetMap[o]=n})}resolveBundle(t){const s=Wn(t);t=fs(t);const i={};return t.forEach(r=>{const n=this._bundles[r];if(n){const o=this.resolve(n),a={};for(const l in o){const h=o[l];a[this._extractAssetIdFromBundle(r,l)]=h}i[r]=a}}),s?i[t[0]]:i}resolveUrl(t){const s=this.resolve(t);if(typeof t!="string"){const i={};for(const r in s)i[r]=s[r].src;return i}return s.src}resolve(t){const s=Wn(t);t=fs(t);const i={};return t.forEach(r=>{if(!this._resolverHash[r])if(this._assetMap[r]){let n=this._assetMap[r];const o=this._getPreferredOrder(n),a=n[0];o==null||o.priority.forEach(l=>{o.params[l].forEach(h=>{const c=n.filter(u=>u[l]?u[l]===h:!1);c.length&&(n=c)})}),this._resolverHash[r]=n[0]??a}else{let n=r;(this._basePath||this._rootPath)&&(n=ae.toAbsolute(n,this._basePath,this._rootPath)),n=this._appendDefaultSearchParams(n),this._resolverHash[r]={src:n}}i[r]=this._resolverHash[r]}),s?i[t[0]]:i}hasKey(t){return!!this._assetMap[t]}hasBundle(t){return!!this._bundles[t]}_getPreferredOrder(t){for(let s=0;s<t.length;s++){const i=t[0],r=this._preferredOrder.find(n=>n.params.format.includes(i.format));if(r)return r}return this._preferredOrder[0]}_appendDefaultSearchParams(t){if(!this._defaultSearchParams)return t;const s=/\?/.test(t)?"&":"?";return`${t}${s}${this._defaultSearchParams}`}}class oy{constructor(){this._detections=[],this._initialized=!1,this.resolver=new ny,this.loader=new Fv,this.cache=er,this._backgroundLoader=new Bv(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(t={}){var n,o,a;if(this._initialized){console.warn("[Assets]AssetManager already initialized, did you load before calling this Asset.init()?");return}if(this._initialized=!0,t.defaultSearchParams&&this.resolver.setDefaultSearchParams(t.defaultSearchParams),t.basePath&&(this.resolver.basePath=t.basePath),t.bundleIdentifier&&this.resolver.setBundleIdentifier(t.bundleIdentifier),t.manifest){let l=t.manifest;typeof l=="string"&&(l=await this.load(l)),this.resolver.addManifest(l)}const s=((n=t.texturePreference)==null?void 0:n.resolution)??1,i=typeof s=="number"?[s]:s;let r=[];if((o=t.texturePreference)!=null&&o.format){const l=(a=t.texturePreference)==null?void 0:a.format;r=typeof l=="string"?[l]:l;for(const h of this._detections)await h.test()||(r=await h.remove(r))}else for(const l of this._detections)await l.test()&&(r=await l.add(r));this.resolver.prefer({params:{format:r,resolution:i}}),t.preferences&&this.setPreferences(t.preferences)}add(t,s,i){this.resolver.add(t,s,i)}async load(t,s){this._initialized||await this.init();const i=Wn(t),r=fs(t).map(a=>typeof a!="string"?(this.resolver.add(a.src,a),a.src):(this.resolver.hasKey(a)||this.resolver.add(a,a),a)),n=this.resolver.resolve(r),o=await this._mapLoadToResolve(n,s);return i?o[r[0]]:o}addBundle(t,s){this.resolver.addBundle(t,s)}async loadBundle(t,s){this._initialized||await this.init();let i=!1;typeof t=="string"&&(i=!0,t=[t]);const r=this.resolver.resolveBundle(t),n={},o=Object.keys(r);let a=0,l=0;const h=()=>{s==null||s(++a/l)},c=o.map(u=>{const d=r[u];return l+=Object.keys(d).length,this._mapLoadToResolve(d,h).then(p=>{n[u]=p})});return await Promise.all(c),i?n[t[0]]:n}async backgroundLoad(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const s=this.resolver.resolve(t);this._backgroundLoader.add(Object.values(s))}async backgroundLoadBundle(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const s=this.resolver.resolveBundle(t);Object.values(s).forEach(i=>{this._backgroundLoader.add(Object.values(i))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(t){if(typeof t=="string")return er.get(t);const s={};for(let i=0;i<t.length;i++)s[i]=er.get(t[i]);return s}async _mapLoadToResolve(t,s){const i=Object.values(t),r=Object.keys(t);this._backgroundLoader.active=!1;const n=await this.loader.load(i,s);this._backgroundLoader.active=!0;const o={};return i.forEach((a,l)=>{const h=n[a.src],c=[a.src];a.alias&&c.push(...a.alias),o[r[l]]=h,er.set(c,h)}),o}async unload(t){this._initialized||await this.init();const s=fs(t).map(r=>typeof r!="string"?r.src:r),i=this.resolver.resolve(s);await this._unloadFromResolved(i)}async unloadBundle(t){this._initialized||await this.init(),t=fs(t);const s=this.resolver.resolveBundle(t),i=Object.keys(s).map(r=>this._unloadFromResolved(s[r]));await Promise.all(i)}async _unloadFromResolved(t){const s=Object.values(t);s.forEach(i=>{er.remove(i.src)}),await this.loader.unload(s)}get detections(){return this._detections}get preferWorkers(){return Eo.config.preferWorkers}set preferWorkers(t){Et("7.2.0","Assets.prefersWorkers is deprecated, use Assets.setPreferences({ preferWorkers: true }) instead."),this.setPreferences({preferWorkers:t})}setPreferences(t){this.loader.parsers.forEach(s=>{s.config&&Object.keys(s.config).filter(i=>i in t).forEach(i=>{s.config[i]=t[i]})})}}const or=new oy;rt.handleByList(Z.LoadParser,or.loader.parsers).handleByList(Z.ResolveParser,or.resolver.parsers).handleByList(Z.CacheParser,or.cache.parsers).handleByList(Z.DetectionParser,or.detections);const ay={extension:Z.CacheParser,test:e=>Array.isArray(e)&&e.every(t=>t instanceof J),getCacheableAssets:(e,t)=>{const s={};return e.forEach(i=>{t.forEach((r,n)=>{s[i+(n===0?"":n+1)]=r})}),s}};rt.add(ay);const ly={extension:{type:Z.DetectionParser,priority:1},test:async()=>{if(!globalThis.createImageBitmap)return!1;const e="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A=",t=await q.ADAPTER.fetch(e).then(s=>s.blob());return createImageBitmap(t).then(()=>!0,()=>!1)},add:async e=>[...e,"avif"],remove:async e=>e.filter(t=>t!=="avif")};rt.add(ly);const hy={extension:{type:Z.DetectionParser,priority:0},test:async()=>{if(!globalThis.createImageBitmap)return!1;const e="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA=",t=await q.ADAPTER.fetch(e).then(s=>s.blob());return createImageBitmap(t).then(()=>!0,()=>!1)},add:async e=>[...e,"webp"],remove:async e=>e.filter(t=>t!=="webp")};rt.add(hy);const zc=["png","jpg","jpeg"],cy={extension:{type:Z.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async e=>[...e,...zc],remove:async e=>e.filter(t=>!zc.includes(t))};rt.add(cy);const uy={extension:Z.ResolveParser,test:Eo.test,parse:e=>{var t;return{resolution:parseFloat(((t=q.RETINA_PREFIX.exec(e))==null?void 0:t[1])??"1"),format:e.split(".").pop(),src:e}}};rt.add(uy);var _e=(e=>(e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",e[e.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",e[e.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",e[e.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",e))(_e||{});const Xn={[33776]:.5,[33777]:.5,[33778]:1,[33779]:1,[35916]:.5,[35917]:.5,[35918]:1,[35919]:1,[37488]:.5,[37489]:.5,[37490]:1,[37491]:1,[37492]:.5,[37496]:1,[37493]:.5,[37497]:1,[37494]:.5,[37495]:.5,[35840]:.5,[35842]:.5,[35841]:.25,[35843]:.25,[36196]:.5,[35986]:.5,[35986]:1,[34798]:1,[37808]:1};let ls,vi;function jc(){vi={s3tc:ls.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:ls.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:ls.getExtension("WEBGL_compressed_texture_etc"),etc1:ls.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:ls.getExtension("WEBGL_compressed_texture_pvrtc")||ls.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:ls.getExtension("WEBGL_compressed_texture_atc"),astc:ls.getExtension("WEBGL_compressed_texture_astc")}}const dy={extension:{type:Z.DetectionParser,priority:2},test:async()=>{const t=q.ADAPTER.createCanvas().getContext("webgl");return t?(ls=t,!0):(console.warn("WebGL not available for compressed textures."),!1)},add:async e=>{vi||jc();const t=[];for(const s in vi)vi[s]&&t.push(s);return[...t,...e]},remove:async e=>(vi||jc(),e.filter(t=>!(t in vi)))};rt.add(dy);class fy extends Br{constructor(t,s={width:1,height:1,autoLoad:!0}){let i,r;typeof t=="string"?(i=t,r=new Uint8Array):(i=null,r=t),super(r,s),this.origin=i,this.buffer=r?new Va(r):null,this._load=null,this.loaded=!1,this.origin!==null&&s.autoLoad!==!1&&this.load(),this.origin===null&&this.buffer&&(this._load=Promise.resolve(this),this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(t){}load(){return this._load?this._load:(this._load=fetch(this.origin).then(t=>t.blob()).then(t=>t.arrayBuffer()).then(t=>(this.data=new Uint32Array(t),this.buffer=new Va(t),this.loaded=!0,this.onBlobLoaded(t),this.update(),this)),this._load)}}class ei extends fy{constructor(t,s){super(t,s),this.format=s.format,this.levels=s.levels||1,this._width=s.width,this._height=s.height,this._extension=ei._formatToExtension(this.format),(s.levelBuffers||this.buffer)&&(this._levelBuffers=s.levelBuffers||ei._createLevelBuffers(t instanceof Uint8Array?t:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(t,s,i){const r=t.gl;if(!t.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;for(let o=0,a=this.levels;o<a;o++){const{levelID:l,levelWidth:h,levelHeight:c,levelBuffer:u}=this._levelBuffers[o];r.compressedTexImage2D(r.TEXTURE_2D,l,this.format,h,c,0,u)}return!0}onBlobLoaded(){this._levelBuffers=ei._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(t){if(t>=33776&&t<=33779)return"s3tc";if(t>=37488&&t<=37497)return"etc";if(t>=35840&&t<=35843)return"pvrtc";if(t>=36196)return"etc1";if(t>=35986&&t<=34798)return"atc";throw new Error("Invalid (compressed) texture format given!")}static _createLevelBuffers(t,s,i,r,n,o,a){const l=new Array(i);let h=t.byteOffset,c=o,u=a,d=c+r-1&~(r-1),p=u+n-1&~(n-1),f=d*p*Xn[s];for(let m=0;m<i;m++)l[m]={levelID:m,levelWidth:i>1?c:d,levelHeight:i>1?u:p,levelBuffer:new Uint8Array(t.buffer,h,f)},h+=f,c=c>>1||1,u=u>>1||1,d=c+r-1&~(r-1),p=u+n-1&~(n-1),f=d*p*Xn[s];return l}}const aa=4,an=124,py=32,Vc=20,my=542327876,ln={SIZE:1,FLAGS:2,HEIGHT:3,WIDTH:4,MIPMAP_COUNT:7,PIXEL_FORMAT:19},gy={SIZE:0,FLAGS:1,FOURCC:2,RGB_BITCOUNT:3,R_BIT_MASK:4,G_BIT_MASK:5,B_BIT_MASK:6,A_BIT_MASK:7},hn={DXGI_FORMAT:0,RESOURCE_DIMENSION:1,MISC_FLAG:2,ARRAY_SIZE:3,MISC_FLAGS2:4},_y=1,xy=2,vy=4,yy=64,Ey=512,by=131072,Ty=827611204,wy=861165636,Sy=894720068,Ay=808540228,Cy=4,Iy={[Ty]:_e.COMPRESSED_RGBA_S3TC_DXT1_EXT,[wy]:_e.COMPRESSED_RGBA_S3TC_DXT3_EXT,[Sy]:_e.COMPRESSED_RGBA_S3TC_DXT5_EXT},Ry={[70]:_e.COMPRESSED_RGBA_S3TC_DXT1_EXT,[71]:_e.COMPRESSED_RGBA_S3TC_DXT1_EXT,[73]:_e.COMPRESSED_RGBA_S3TC_DXT3_EXT,[74]:_e.COMPRESSED_RGBA_S3TC_DXT3_EXT,[76]:_e.COMPRESSED_RGBA_S3TC_DXT5_EXT,[77]:_e.COMPRESSED_RGBA_S3TC_DXT5_EXT,[72]:_e.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,[75]:_e.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,[78]:_e.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT};function Py(e){const t=new Uint32Array(e);if(t[0]!==my)throw new Error("Invalid DDS file magic word");const i=new Uint32Array(e,0,an/Uint32Array.BYTES_PER_ELEMENT),r=i[ln.HEIGHT],n=i[ln.WIDTH],o=i[ln.MIPMAP_COUNT],a=new Uint32Array(e,ln.PIXEL_FORMAT*Uint32Array.BYTES_PER_ELEMENT,py/Uint32Array.BYTES_PER_ELEMENT),l=a[_y];if(l&vy){const h=a[gy.FOURCC];if(h!==Ay){const g=Iy[h],E=aa+an,S=new Uint8Array(e,E);return[new ei(S,{format:g,width:n,height:r,levels:o})]}const c=aa+an,u=new Uint32Array(t.buffer,c,Vc/Uint32Array.BYTES_PER_ELEMENT),d=u[hn.DXGI_FORMAT],p=u[hn.RESOURCE_DIMENSION],f=u[hn.MISC_FLAG],m=u[hn.ARRAY_SIZE],_=Ry[d];if(_===void 0)throw new Error(`DDSParser cannot parse texture data with DXGI format ${d}`);if(f===Cy)throw new Error("DDSParser does not support cubemap textures");if(p===6)throw new Error("DDSParser does not supported 3D texture data");const v=new Array,b=aa+an+Vc;if(m===1)v.push(new Uint8Array(e,b));else{const g=Xn[_];let E=0,S=n,C=r;for(let y=0;y<o;y++){const I=Math.max(1,S+3&-4),B=Math.max(1,C+3&-4),F=I*B*g;E+=F,S=S>>>1,C=C>>>1}let T=b;for(let y=0;y<m;y++)v.push(new Uint8Array(e,T,E)),T+=E}return v.map(g=>new ei(g,{format:_,width:n,height:r,levels:o}))}throw l&yy?new Error("DDSParser does not support uncompressed texture data."):l&Ey?new Error("DDSParser does not supported YUV uncompressed texture data."):l&by?new Error("DDSParser does not support single-channel (lumninance) texture data!"):l&xy?new Error("DDSParser does not support single-channel (alpha) texture data!"):new Error("DDSParser failed to load a texture file due to an unknown reason!")}const Yc=[171,75,84,88,32,49,49,187,13,10,26,10],My=67305985,Ie={FILE_IDENTIFIER:0,ENDIANNESS:12,GL_TYPE:16,GL_TYPE_SIZE:20,GL_FORMAT:24,GL_INTERNAL_FORMAT:28,GL_BASE_INTERNAL_FORMAT:32,PIXEL_WIDTH:36,PIXEL_HEIGHT:40,PIXEL_DEPTH:44,NUMBER_OF_ARRAY_ELEMENTS:48,NUMBER_OF_FACES:52,NUMBER_OF_MIPMAP_LEVELS:56,BYTES_OF_KEY_VALUE_DATA:60},ll=64,Kc={[lt.UNSIGNED_BYTE]:1,[lt.UNSIGNED_SHORT]:2,[lt.INT]:4,[lt.UNSIGNED_INT]:4,[lt.FLOAT]:4,[lt.HALF_FLOAT]:8},Oy={[X.RGBA]:4,[X.RGB]:3,[X.RG]:2,[X.RED]:1,[X.LUMINANCE]:1,[X.LUMINANCE_ALPHA]:2,[X.ALPHA]:1},By={[lt.UNSIGNED_SHORT_4_4_4_4]:2,[lt.UNSIGNED_SHORT_5_5_5_1]:2,[lt.UNSIGNED_SHORT_5_6_5]:2};function Dy(e,t,s=!1){const i=new DataView(t);if(!Ly(e,i))return null;const r=i.getUint32(Ie.ENDIANNESS,!0)===My,n=i.getUint32(Ie.GL_TYPE,r),o=i.getUint32(Ie.GL_FORMAT,r),a=i.getUint32(Ie.GL_INTERNAL_FORMAT,r),l=i.getUint32(Ie.PIXEL_WIDTH,r),h=i.getUint32(Ie.PIXEL_HEIGHT,r)||1,c=i.getUint32(Ie.PIXEL_DEPTH,r)||1,u=i.getUint32(Ie.NUMBER_OF_ARRAY_ELEMENTS,r)||1,d=i.getUint32(Ie.NUMBER_OF_FACES,r),p=i.getUint32(Ie.NUMBER_OF_MIPMAP_LEVELS,r),f=i.getUint32(Ie.BYTES_OF_KEY_VALUE_DATA,r);if(h===0||c!==1)throw new Error("Only 2D textures are supported");if(d!==1)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(u!==1)throw new Error("WebGL does not support array textures");const m=4,_=4,v=l+3&-4,b=h+3&-4,g=new Array(u);let E=l*h;n===0&&(E=v*b);let S;if(n!==0?Kc[n]?S=Kc[n]*Oy[o]:S=By[n]:S=Xn[a],S===void 0)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");const C=s?Ny(i,f,r):null;let y=E*S,I=l,B=h,F=v,z=b,L=ll+f;for(let P=0;P<p;P++){const ut=i.getUint32(L,r);let nt=L+4;for(let G=0;G<u;G++){let st=g[G];st||(st=g[G]=new Array(p)),st[P]={levelID:P,levelWidth:p>1||n!==0?I:F,levelHeight:p>1||n!==0?B:z,levelBuffer:new Uint8Array(t,nt,y)},nt+=y}L+=ut+4,L=L%4!==0?L+4-L%4:L,I=I>>1||1,B=B>>1||1,F=I+m-1&~(m-1),z=B+_-1&~(_-1),y=F*z*S}return n!==0?{uncompressed:g.map(P=>{let ut=P[0].levelBuffer,nt=!1;return n===lt.FLOAT?ut=new Float32Array(P[0].levelBuffer.buffer,P[0].levelBuffer.byteOffset,P[0].levelBuffer.byteLength/4):n===lt.UNSIGNED_INT?(nt=!0,ut=new Uint32Array(P[0].levelBuffer.buffer,P[0].levelBuffer.byteOffset,P[0].levelBuffer.byteLength/4)):n===lt.INT&&(nt=!0,ut=new Int32Array(P[0].levelBuffer.buffer,P[0].levelBuffer.byteOffset,P[0].levelBuffer.byteLength/4)),{resource:new Br(ut,{width:P[0].levelWidth,height:P[0].levelHeight}),type:n,format:nt?Fy(o):o}}),kvData:C}:{compressed:g.map(P=>new ei(null,{format:a,width:l,height:h,levels:p,levelBuffers:P})),kvData:C}}function Ly(e,t){for(let s=0;s<Yc.length;s++)if(t.getUint8(s)!==Yc[s])return console.error(`${e} is not a valid *.ktx file!`),!1;return!0}function Fy(e){switch(e){case X.RGBA:return X.RGBA_INTEGER;case X.RGB:return X.RGB_INTEGER;case X.RG:return X.RG_INTEGER;case X.RED:return X.RED_INTEGER;default:return e}}function Ny(e,t,s){const i=new Map;let r=0;for(;r<t;){const n=e.getUint32(ll+r,s),o=ll+r+4,a=3-(n+3)%4;if(n===0||n>t-r){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}let l=0;for(;l<n&&e.getUint8(o+l)!==0;l++);if(l===-1){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}const h=new TextDecoder().decode(new Uint8Array(e.buffer,o,l)),c=new DataView(e.buffer,o+l+1,n-l-1);i.set(h,c),r+=4+n+a}return i}const Uy={extension:{type:Z.LoadParser,priority:ns.High},name:"loadDDS",test(e){return ui(e,".dds")},async load(e,t,s){const r=await(await q.ADAPTER.fetch(e)).arrayBuffer(),o=Py(r).map(a=>{const l=new pt(a,{mipmap:is.OFF,alphaMode:He.NO_PREMULTIPLIED_ALPHA,resolution:Ds(e),...t.data});return yo(l,s,e)});return o.length===1?o[0]:o},unload(e){Array.isArray(e)?e.forEach(t=>t.destroy(!0)):e.destroy(!0)}};rt.add(Uy);const ky={extension:{type:Z.LoadParser,priority:ns.High},name:"loadKTX",test(e){return ui(e,".ktx")},async load(e,t,s){const r=await(await q.ADAPTER.fetch(e)).arrayBuffer(),{compressed:n,uncompressed:o,kvData:a}=Dy(e,r),l=n??o,h={mipmap:is.OFF,alphaMode:He.NO_PREMULTIPLIED_ALPHA,resolution:Ds(e),...t.data},c=l.map(u=>{l===o&&Object.assign(h,{type:u.type,format:u.format});const d=new pt(u,h);return d.ktxKeyValueData=a,yo(d,s,e)});return c.length===1?c[0]:c},unload(e){Array.isArray(e)?e.forEach(t=>t.destroy(!0)):e.destroy(!0)}};rt.add(ky);const Gy={extension:Z.ResolveParser,test:e=>{const s=e.split("?")[0].split(".").pop();return["basis","ktx","dds"].includes(s)},parse:e=>{var i,r;if(e.split("?")[0].split(".").pop()==="ktx"){const n=[".s3tc.ktx",".s3tc_sRGB.ktx",".etc.ktx",".etc1.ktx",".pvrt.ktx",".atc.ktx",".astc.ktx"];if(n.some(o=>e.endsWith(o)))return{resolution:parseFloat(((i=q.RETINA_PREFIX.exec(e))==null?void 0:i[1])??"1"),format:n.find(o=>e.endsWith(o)),src:e}}return{resolution:parseFloat(((r=q.RETINA_PREFIX.exec(e))==null?void 0:r[1])??"1"),format:e.split(".").pop(),src:e}}};rt.add(Gy);const Hy=new xt,$y=4,ar=class{constructor(e){this.renderer=e}async image(e,t,s){const i=new Image;return i.src=await this.base64(e,t,s),i}async base64(e,t,s){const i=this.canvas(e);if(i.toBlob!==void 0)return new Promise((r,n)=>{i.toBlob(o=>{if(!o){n(new Error("ICanvas.toBlob failed!"));return}const a=new FileReader;a.onload=()=>r(a.result),a.onerror=n,a.readAsDataURL(o)},t,s)});if(i.toDataURL!==void 0)return i.toDataURL(t,s);if(i.convertToBlob!==void 0){const r=await i.convertToBlob({type:t,quality:s});return new Promise((n,o)=>{const a=new FileReader;a.onload=()=>n(a.result),a.onerror=o,a.readAsDataURL(r)})}throw new Error("Extract.base64() requires ICanvas.toDataURL, ICanvas.toBlob, or ICanvas.convertToBlob to be implemented")}canvas(e,t){const{pixels:s,width:i,height:r,flipY:n}=this._rawPixels(e,t);n&&ar._flipY(s,i,r),ar._unpremultiplyAlpha(s);const o=new Dx(i,r,1),a=new ImageData(new Uint8ClampedArray(s.buffer),i,r);return o.context.putImageData(a,0,0),o.canvas}pixels(e,t){const{pixels:s,width:i,height:r,flipY:n}=this._rawPixels(e,t);return n&&ar._flipY(s,i,r),ar._unpremultiplyAlpha(s),s}_rawPixels(e,t){const s=this.renderer;if(!s)throw new Error("The Extract has already been destroyed");let i,r=!1,n,o=!1;if(e&&(e instanceof hi?n=e:(n=s.generateTexture(e,{resolution:s.resolution,multisample:s.multisample}),o=!0)),n){if(i=n.baseTexture.resolution,t=t??n.frame,r=!1,!o){s.renderTexture.bind(n);const u=n.framebuffer.glFramebuffers[s.CONTEXT_UID];u.blitFramebuffer&&s.framebuffer.bind(u.blitFramebuffer)}}else i=s.resolution,t||(t=Hy,t.width=s.width/i,t.height=s.height/i),r=!0,s.renderTexture.bind();const a=Math.round(t.width*i),l=Math.round(t.height*i),h=new Uint8Array($y*a*l),c=s.gl;return c.readPixels(Math.round(t.x*i),Math.round(t.y*i),a,l,c.RGBA,c.UNSIGNED_BYTE,h),o&&(n==null||n.destroy(!0)),{pixels:h,width:a,height:l,flipY:r}}destroy(){this.renderer=null}static _flipY(e,t,s){const i=t<<2,r=s>>1,n=new Uint8Array(i);for(let o=0;o<r;o++){const a=o*i,l=(s-o-1)*i;n.set(e.subarray(a,a+i)),e.copyWithin(a,l,l+i),e.set(n,l)}}static _unpremultiplyAlpha(e){e instanceof Uint8ClampedArray&&(e=new Uint8Array(e.buffer));const t=e.length;for(let s=0;s<t;s+=4){const i=e[s+3];if(i!==0){const r=255.001/i;e[s]=e[s]*r+.5,e[s+1]=e[s+1]*r+.5,e[s+2]=e[s+2]*r+.5}}}};let Pf=ar;Pf.extension={name:"extract",type:Z.RendererSystem};rt.add(Pf);const zn={build(e){const t=e.points;let s,i,r,n,o,a;if(e.type===se.CIRC){const f=e.shape;s=f.x,i=f.y,o=a=f.radius,r=n=0}else if(e.type===se.ELIP){const f=e.shape;s=f.x,i=f.y,o=f.width,a=f.height,r=n=0}else{const f=e.shape,m=f.width/2,_=f.height/2;s=f.x+m,i=f.y+_,o=a=Math.max(0,Math.min(f.radius,Math.min(m,_))),r=m-o,n=_-a}if(!(o>=0&&a>=0&&r>=0&&n>=0)){t.length=0;return}const l=Math.ceil(2.3*Math.sqrt(o+a)),h=l*8+(r?4:0)+(n?4:0);if(t.length=h,h===0)return;if(l===0){t.length=8,t[0]=t[6]=s+r,t[1]=t[3]=i+n,t[2]=t[4]=s-r,t[5]=t[7]=i-n;return}let c=0,u=l*4+(r?2:0)+2,d=u,p=h;{const f=r+o,m=n,_=s+f,v=s-f,b=i+m;if(t[c++]=_,t[c++]=b,t[--u]=b,t[--u]=v,n){const g=i-m;t[d++]=v,t[d++]=g,t[--p]=g,t[--p]=_}}for(let f=1;f<l;f++){const m=Math.PI/2*(f/l),_=r+Math.cos(m)*o,v=n+Math.sin(m)*a,b=s+_,g=s-_,E=i+v,S=i-v;t[c++]=b,t[c++]=E,t[--u]=E,t[--u]=g,t[d++]=g,t[d++]=S,t[--p]=S,t[--p]=b}{const f=r,m=n+a,_=s+f,v=s-f,b=i+m,g=i-m;t[c++]=_,t[c++]=b,t[--p]=g,t[--p]=_,r&&(t[c++]=v,t[c++]=b,t[--p]=g,t[--p]=v)}},triangulate(e,t){const s=e.points,i=t.points,r=t.indices;if(s.length===0)return;let n=i.length/2;const o=n;let a,l;if(e.type!==se.RREC){const c=e.shape;a=c.x,l=c.y}else{const c=e.shape;a=c.x+c.width/2,l=c.y+c.height/2}const h=e.matrix;i.push(e.matrix?h.a*a+h.c*l+h.tx:a,e.matrix?h.b*a+h.d*l+h.ty:l),n++,i.push(s[0],s[1]);for(let c=2;c<s.length;c+=2)i.push(s[c],s[c+1]),r.push(n++,o,n);r.push(o+1,o,n)}};function qc(e,t=!1){const s=e.length;if(s<6)return;let i=0;for(let r=0,n=e[s-2],o=e[s-1];r<s;r+=2){const a=e[r],l=e[r+1];i+=(a-n)*(l+o),n=a,o=l}if(!t&&i>0||t&&i<=0){const r=s/2;for(let n=r+r%2;n<s;n+=2){const o=s-n-2,a=s-n-1,l=n,h=n+1;[e[o],e[l]]=[e[l],e[o]],[e[a],e[h]]=[e[h],e[a]]}}}const Mf={build(e){e.points=e.shape.points.slice()},triangulate(e,t){let s=e.points;const i=e.holes,r=t.points,n=t.indices;if(s.length>=6){qc(s,!1);const o=[];for(let h=0;h<i.length;h++){const c=i[h];qc(c.points,!0),o.push(s.length/2),s=s.concat(c.points)}const a=Fn(s,o,2);if(!a)return;const l=r.length/2;for(let h=0;h<a.length;h+=3)n.push(a[h]+l),n.push(a[h+1]+l),n.push(a[h+2]+l);for(let h=0;h<s.length;h++)r.push(s[h])}}},Wy={build(e){const t=e.shape,s=t.x,i=t.y,r=t.width,n=t.height,o=e.points;o.length=0,r>=0&&n>=0&&o.push(s,i,s+r,i,s+r,i+n,s,i+n)},triangulate(e,t){const s=e.points,i=t.points;if(s.length===0)return;const r=i.length/2;i.push(s[0],s[1],s[2],s[3],s[6],s[7],s[4],s[5]),t.indices.push(r,r+1,r+2,r+1,r+2,r+3)}},Xy={build(e){zn.build(e)},triangulate(e,t){zn.triangulate(e,t)}};var Oe=(e=>(e.MITER="miter",e.BEVEL="bevel",e.ROUND="round",e))(Oe||{}),Js=(e=>(e.BUTT="butt",e.ROUND="round",e.SQUARE="square",e))(Js||{});const Gi={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(e,t=20){if(!this.adaptive||!e||isNaN(e))return t;let s=Math.ceil(e/this.maxLength);return s<this.minSegments?s=this.minSegments:s>this.maxSegments&&(s=this.maxSegments),s}};class Zc{static curveTo(t,s,i,r,n,o){const a=o[o.length-2],h=o[o.length-1]-s,c=a-t,u=r-s,d=i-t,p=Math.abs(h*d-c*u);if(p<1e-8||n===0)return(o[o.length-2]!==t||o[o.length-1]!==s)&&o.push(t,s),null;const f=h*h+c*c,m=u*u+d*d,_=h*u+c*d,v=n*Math.sqrt(f)/p,b=n*Math.sqrt(m)/p,g=v*_/f,E=b*_/m,S=v*d+b*c,C=v*u+b*h,T=c*(b+g),y=h*(b+g),I=d*(v+E),B=u*(v+E),F=Math.atan2(y-C,T-S),z=Math.atan2(B-C,I-S);return{cx:S+t,cy:C+s,radius:n,startAngle:F,endAngle:z,anticlockwise:c*u>d*h}}static arc(t,s,i,r,n,o,a,l,h){const c=a-o,u=Gi._segmentsCount(Math.abs(c)*n,Math.ceil(Math.abs(c)/Gn)*40),d=c/(u*2),p=d*2,f=Math.cos(d),m=Math.sin(d),_=u-1,v=_%1/_;for(let b=0;b<=_;++b){const g=b+v*b,E=d+o+p*g,S=Math.cos(E),C=-Math.sin(E);h.push((f*S+m*C)*n+i,(f*-C+m*S)*n+r)}}}class zy{constructor(){this.reset()}begin(t,s,i){this.reset(),this.style=t,this.start=s,this.attribStart=i}end(t,s){this.attribSize=s-this.attribStart,this.size=t-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}}class Zl{static curveLength(t,s,i,r,n,o,a,l){let c=0,u=0,d=0,p=0,f=0,m=0,_=0,v=0,b=0,g=0,E=0,S=t,C=s;for(let T=1;T<=10;++T)u=T/10,d=u*u,p=d*u,f=1-u,m=f*f,_=m*f,v=_*t+3*m*u*i+3*f*d*n+p*a,b=_*s+3*m*u*r+3*f*d*o+p*l,g=S-v,E=C-b,S=v,C=b,c+=Math.sqrt(g*g+E*E);return c}static curveTo(t,s,i,r,n,o,a){const l=a[a.length-2],h=a[a.length-1];a.length-=2;const c=Gi._segmentsCount(Zl.curveLength(l,h,t,s,i,r,n,o));let u=0,d=0,p=0,f=0,m=0;a.push(l,h);for(let _=1,v=0;_<=c;++_)v=_/c,u=1-v,d=u*u,p=d*u,f=v*v,m=f*v,a.push(p*l+3*d*v*t+3*u*f*i+m*n,p*h+3*d*v*s+3*u*f*r+m*o)}}function Jc(e,t,s,i,r,n,o,a){const l=e-s*r,h=t-i*r,c=e+s*n,u=t+i*n;let d,p;o?(d=i,p=-s):(d=-i,p=s);const f=l+d,m=h+p,_=c+d,v=u+p;return a.push(f,m,_,v),2}function $s(e,t,s,i,r,n,o,a){const l=s-e,h=i-t;let c=Math.atan2(l,h),u=Math.atan2(r-e,n-t);a&&c<u?c+=Math.PI*2:!a&&c>u&&(u+=Math.PI*2);let d=c;const p=u-c,f=Math.abs(p),m=Math.sqrt(l*l+h*h),_=(15*f*Math.sqrt(m)/Math.PI>>0)+1,v=p/_;if(d+=v,a){o.push(e,t,s,i);for(let b=1,g=d;b<_;b++,g+=v)o.push(e,t,e+Math.sin(g)*m,t+Math.cos(g)*m);o.push(e,t,r,n)}else{o.push(s,i,e,t);for(let b=1,g=d;b<_;b++,g+=v)o.push(e+Math.sin(g)*m,t+Math.cos(g)*m,e,t);o.push(r,n,e,t)}return _*2}function jy(e,t){const s=e.shape;let i=e.points||s.points.slice();const r=t.closePointEps;if(i.length===0)return;const n=e.lineStyle,o=new At(i[0],i[1]),a=new At(i[i.length-2],i[i.length-1]),l=s.type!==se.POLY||s.closeStroke,h=Math.abs(o.x-a.x)<r&&Math.abs(o.y-a.y)<r;if(l){i=i.slice(),h&&(i.pop(),i.pop(),a.set(i[i.length-2],i[i.length-1]));const G=(o.x+a.x)*.5,st=(a.y+o.y)*.5;i.unshift(G,st),i.push(G,st)}const c=t.points,u=i.length/2;let d=i.length;const p=c.length/2,f=n.width/2,m=f*f,_=n.miterLimit*n.miterLimit;let v=i[0],b=i[1],g=i[2],E=i[3],S=0,C=0,T=-(b-E),y=v-g,I=0,B=0,F=Math.sqrt(T*T+y*y);T/=F,y/=F,T*=f,y*=f;const z=n.alignment,L=(1-z)*2,P=z*2;l||(n.cap===Js.ROUND?d+=$s(v-T*(L-P)*.5,b-y*(L-P)*.5,v-T*L,b-y*L,v+T*P,b+y*P,c,!0)+2:n.cap===Js.SQUARE&&(d+=Jc(v,b,T,y,L,P,!0,c))),c.push(v-T*L,b-y*L,v+T*P,b+y*P);for(let G=1;G<u-1;++G){v=i[(G-1)*2],b=i[(G-1)*2+1],g=i[G*2],E=i[G*2+1],S=i[(G+1)*2],C=i[(G+1)*2+1],T=-(b-E),y=v-g,F=Math.sqrt(T*T+y*y),T/=F,y/=F,T*=f,y*=f,I=-(E-C),B=g-S,F=Math.sqrt(I*I+B*B),I/=F,B/=F,I*=f,B*=f;const st=g-v,Ct=b-E,N=g-S,U=C-E,Y=st*N+Ct*U,it=Ct*N-U*st,Q=it<0;if(Math.abs(it)<.001*Math.abs(Y)){c.push(g-T*L,E-y*L,g+T*P,E+y*P),Y>=0&&(n.join===Oe.ROUND?d+=$s(g,E,g-T*L,E-y*L,g-I*L,E-B*L,c,!1)+4:d+=2,c.push(g-I*P,E-B*P,g+I*L,E+B*L));continue}const dt=(-T+v)*(-y+E)-(-T+g)*(-y+b),_t=(-I+S)*(-B+E)-(-I+g)*(-B+C),ht=(st*_t-N*dt)/it,vt=(U*dt-Ct*_t)/it,Lt=(ht-g)*(ht-g)+(vt-E)*(vt-E),Rt=g+(ht-g)*L,Pt=E+(vt-E)*L,x=g-(ht-g)*P,w=E-(vt-E)*P,A=Math.min(st*st+Ct*Ct,N*N+U*U),M=Q?L:P,D=A+M*M*m,H=Lt<=D;let K=n.join;if(K===Oe.MITER&&Lt/m>_&&(K=Oe.BEVEL),H)switch(K){case Oe.MITER:{c.push(Rt,Pt,x,w);break}case Oe.BEVEL:{Q?c.push(Rt,Pt,g+T*P,E+y*P,Rt,Pt,g+I*P,E+B*P):c.push(g-T*L,E-y*L,x,w,g-I*L,E-B*L,x,w),d+=2;break}case Oe.ROUND:{Q?(c.push(Rt,Pt,g+T*P,E+y*P),d+=$s(g,E,g+T*P,E+y*P,g+I*P,E+B*P,c,!0)+4,c.push(Rt,Pt,g+I*P,E+B*P)):(c.push(g-T*L,E-y*L,x,w),d+=$s(g,E,g-T*L,E-y*L,g-I*L,E-B*L,c,!1)+4,c.push(g-I*L,E-B*L,x,w));break}}else{switch(c.push(g-T*L,E-y*L,g+T*P,E+y*P),K){case Oe.MITER:{Q?c.push(x,w,x,w):c.push(Rt,Pt,Rt,Pt),d+=2;break}case Oe.ROUND:{Q?d+=$s(g,E,g+T*P,E+y*P,g+I*P,E+B*P,c,!0)+2:d+=$s(g,E,g-T*L,E-y*L,g-I*L,E-B*L,c,!1)+2;break}}c.push(g-I*L,E-B*L,g+I*P,E+B*P),d+=2}}v=i[(u-2)*2],b=i[(u-2)*2+1],g=i[(u-1)*2],E=i[(u-1)*2+1],T=-(b-E),y=v-g,F=Math.sqrt(T*T+y*y),T/=F,y/=F,T*=f,y*=f,c.push(g-T*L,E-y*L,g+T*P,E+y*P),l||(n.cap===Js.ROUND?d+=$s(g-T*(L-P)*.5,E-y*(L-P)*.5,g-T*L,E-y*L,g+T*P,E+y*P,c,!1)+2:n.cap===Js.SQUARE&&(d+=Jc(g,E,T,y,L,P,!1,c)));const ut=t.indices,nt=Gi.epsilon*Gi.epsilon;for(let G=p;G<d+p-2;++G)v=c[G*2],b=c[G*2+1],g=c[(G+1)*2],E=c[(G+1)*2+1],S=c[(G+2)*2],C=c[(G+2)*2+1],!(Math.abs(v*(E-C)+g*(C-b)+S*(b-E))<nt)&&ut.push(G,G+1,G+2)}function Vy(e,t){let s=0;const i=e.shape,r=e.points||i.points,n=i.type!==se.POLY||i.closeStroke;if(r.length===0)return;const o=t.points,a=t.indices,l=r.length/2,h=o.length/2;let c=h;for(o.push(r[0],r[1]),s=1;s<l;s++)o.push(r[s*2],r[s*2+1]),a.push(c,c+1),c++;n&&a.push(c,h)}function Qc(e,t){e.lineStyle.native?Vy(e,t):jy(e,t)}class Jl{static curveLength(t,s,i,r,n,o){const a=t-2*i+n,l=s-2*r+o,h=2*i-2*t,c=2*r-2*s,u=4*(a*a+l*l),d=4*(a*h+l*c),p=h*h+c*c,f=2*Math.sqrt(u+d+p),m=Math.sqrt(u),_=2*u*m,v=2*Math.sqrt(p),b=d/m;return(_*f+m*d*(f-v)+(4*p*u-d*d)*Math.log((2*m+b+f)/(b+v)))/(4*_)}static curveTo(t,s,i,r,n){const o=n[n.length-2],a=n[n.length-1],l=Gi._segmentsCount(Jl.curveLength(o,a,t,s,i,r));let h=0,c=0;for(let u=1;u<=l;++u){const d=u/l;h=o+(t-o)*d,c=a+(s-a)*d,n.push(h+(t+(i-t)*d-h)*d,c+(s+(r-s)*d-c)*d)}}}const la={[se.POLY]:Mf,[se.CIRC]:zn,[se.ELIP]:zn,[se.RECT]:Wy,[se.RREC]:Xy},tu=[],cn=[];class jn{constructor(t,s=null,i=null,r=null){this.points=[],this.holes=[],this.shape=t,this.lineStyle=i,this.fillStyle=s,this.matrix=r,this.type=t.type}clone(){return new jn(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}}const mi=new At,Of=class extends Hd{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new Hn,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let e=0;e<this.drawCalls.length;e++)this.drawCalls[e].texArray.clear(),cn.push(this.drawCalls[e]);this.drawCalls.length=0;for(let e=0;e<this.batches.length;e++){const t=this.batches[e];t.reset(),tu.push(t)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(e,t=null,s=null,i=null){const r=new jn(e,t,s,i);return this.graphicsData.push(r),this.dirty++,this}drawHole(e,t=null){if(!this.graphicsData.length)return null;const s=new jn(e,null,null,t),i=this.graphicsData[this.graphicsData.length-1];return s.lineStyle=i.lineStyle,i.holes.push(s),this.dirty++,this}destroy(){super.destroy();for(let e=0;e<this.graphicsData.length;++e)this.graphicsData[e].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(e){const t=this.graphicsData;for(let s=0;s<t.length;++s){const i=t[s];if(i.fillStyle.visible&&i.shape&&(i.matrix?i.matrix.applyInverse(e,mi):mi.copyFrom(e),i.shape.contains(mi.x,mi.y))){let r=!1;if(i.holes){for(let n=0;n<i.holes.length;n++)if(i.holes[n].shape.contains(mi.x,mi.y)){r=!0;break}}if(!r)return!0}}return!1}updateBatches(){if(!this.graphicsData.length){this.batchable=!0;return}if(!this.validateBatching())return;this.cacheDirty=this.dirty;const e=this.uvs,t=this.graphicsData;let s=null,i=null;this.batches.length>0&&(s=this.batches[this.batches.length-1],i=s.style);for(let a=this.shapeIndex;a<t.length;a++){this.shapeIndex++;const l=t[a],h=l.fillStyle,c=l.lineStyle;la[l.type].build(l),l.matrix&&this.transformPoints(l.points,l.matrix),(h.visible||c.visible)&&this.processHoles(l.holes);for(let d=0;d<2;d++){const p=d===0?h:c;if(!p.visible)continue;const f=p.texture.baseTexture,m=this.indices.length,_=this.points.length/2;f.wrapMode=Ms.REPEAT,d===0?this.processFill(l):this.processLine(l);const v=this.points.length/2-_;v!==0&&(s&&!this._compareStyles(i,p)&&(s.end(m,_),s=null),s||(s=tu.pop()||new zy,s.begin(p,m,_),this.batches.push(s),i=p),this.addUvs(this.points,e,p.texture,_,v,p.matrix))}}const r=this.indices.length,n=this.points.length/2;if(s&&s.end(r,n),this.batches.length===0){this.batchable=!0;return}const o=n>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&o===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=o?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(e,t){return!(!e||!t||e.texture.baseTexture!==t.texture.baseTexture||e.color+e.alpha!==t.color+t.alpha||!!e.native!=!!t.native)}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let e=0,t=this.graphicsData.length;e<t;e++){const s=this.graphicsData[e],i=s.fillStyle,r=s.lineStyle;if(i&&!i.texture.baseTexture.valid||r&&!r.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);const e=this.batches;for(let t=0,s=e.length;t<s;t++){const i=e[t];for(let r=0;r<i.size;r++){const n=i.start+r;this.indicesUint16[n]=this.indicesUint16[n]-i.attribStart}}}isBatchable(){if(this.points.length>65535*2)return!1;const e=this.batches;for(let t=0;t<e.length;t++)if(e[t].style.native)return!1;return this.points.length<Of.BATCHABLE_SIZE*2}buildDrawCalls(){let e=++pt._globalBatch;for(let c=0;c<this.drawCalls.length;c++)this.drawCalls[c].texArray.clear(),cn.push(this.drawCalls[c]);this.drawCalls.length=0;const t=this.colors,s=this.textureIds;let i=cn.pop();i||(i=new Ka,i.texArray=new Za),i.texArray.count=0,i.start=0,i.size=0,i.type=Je.TRIANGLES;let r=0,n=null,o=0,a=!1,l=Je.TRIANGLES,h=0;this.drawCalls.push(i);for(let c=0;c<this.batches.length;c++){const u=this.batches[c],d=8,p=u.style,f=p.texture.baseTexture;a!==!!p.native&&(a=!!p.native,l=a?Je.LINES:Je.TRIANGLES,n=null,r=d,e++),n!==f&&(n=f,f._batchEnabled!==e&&(r===d&&(e++,r=0,i.size>0&&(i=cn.pop(),i||(i=new Ka,i.texArray=new Za),this.drawCalls.push(i)),i.start=h,i.size=0,i.texArray.count=0,i.type=l),f.touched=1,f._batchEnabled=e,f._batchLocation=r,f.wrapMode=Ms.REPEAT,i.texArray.elements[i.texArray.count++]=f,r++)),i.size+=u.size,h+=u.size,o=f._batchLocation,this.addColors(t,p.color,p.alpha,u.attribSize,u.attribStart),this.addTextureIds(s,o,u.attribSize,u.attribStart)}pt._globalBatch=e,this.packAttributes()}packAttributes(){const e=this.points,t=this.uvs,s=this.colors,i=this.textureIds,r=new ArrayBuffer(e.length*3*4),n=new Float32Array(r),o=new Uint32Array(r);let a=0;for(let l=0;l<e.length/2;l++)n[a++]=e[l*2],n[a++]=e[l*2+1],n[a++]=t[l*2],n[a++]=t[l*2+1],o[a++]=s[l],n[a++]=i[l];this._buffer.update(r),this._indexBuffer.update(this.indicesUint16)}processFill(e){e.holes.length?Mf.triangulate(e,this):la[e.type].triangulate(e,this)}processLine(e){Qc(e,this);for(let t=0;t<e.holes.length;t++)Qc(e.holes[t],this)}processHoles(e){for(let t=0;t<e.length;t++){const s=e[t];la[s.type].build(s),s.matrix&&this.transformPoints(s.points,s.matrix)}}calculateBounds(){const e=this._bounds;e.clear(),e.addVertexData(this.points,0,this.points.length),e.pad(this.boundsPadding,this.boundsPadding)}transformPoints(e,t){for(let s=0;s<e.length/2;s++){const i=e[s*2],r=e[s*2+1];e[s*2]=t.a*i+t.c*r+t.tx,e[s*2+1]=t.b*i+t.d*r+t.ty}}addColors(e,t,s,i,r=0){const n=Dt.shared.setValue(t).toLittleEndianNumber(),o=Dt.shared.setValue(n).toPremultiplied(s);e.length=Math.max(e.length,r+i);for(let a=0;a<i;a++)e[r+a]=o}addTextureIds(e,t,s,i=0){e.length=Math.max(e.length,i+s);for(let r=0;r<s;r++)e[i+r]=t}addUvs(e,t,s,i,r,n=null){let o=0;const a=t.length,l=s.frame;for(;o<r;){let c=e[(i+o)*2],u=e[(i+o)*2+1];if(n){const d=n.a*c+n.c*u+n.tx;u=n.b*c+n.d*u+n.ty,c=d}o++,t.push(c/l.width,u/l.height)}const h=s.baseTexture;(l.width<h.width||l.height<h.height)&&this.adjustUvs(t,s,a,r)}adjustUvs(e,t,s,i){const r=t.baseTexture,n=1e-6,o=s+i*2,a=t.frame,l=a.width/r.width,h=a.height/r.height;let c=a.x/a.width,u=a.y/a.height,d=Math.floor(e[s]+n),p=Math.floor(e[s+1]+n);for(let f=s+2;f<o;f+=2)d=Math.min(d,Math.floor(e[f]+n)),p=Math.min(p,Math.floor(e[f+1]+n));c-=d,u-=p;for(let f=s;f<o;f+=2)e[f]=(e[f]+c)*l,e[f+1]=(e[f+1]+u)*h}};let Bf=Of;Bf.BATCHABLE_SIZE=100;class bo{constructor(){this.color=16777215,this.alpha=1,this.texture=J.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){const t=new bo;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t}reset(){this.color=16777215,this.alpha=1,this.texture=J.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}}class Ql extends bo{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=Js.BUTT,this.join=Oe.MITER,this.miterLimit=10}clone(){const t=new Ql;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t.width=this.width,t.alignment=this.alignment,t.native=this.native,t.cap=this.cap,t.join=this.join,t.miterLimit=this.miterLimit,t}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1}}const ha={},Tn=class extends fe{constructor(e=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new bo,this._lineStyle=new Ql,this._matrix=null,this._holeMode=!1,this.state=xs.for2d(),this._geometry=e||new Bf,this._geometry.refCount++,this._transformID=-1,this._tintColor=new Dt(16777215),this.blendMode=ct.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new Tn(this._geometry)}set blendMode(e){this.state.blendMode=e}get blendMode(){return this.state.blendMode}get tint(){return this._tintColor.value}set tint(e){this._tintColor.setValue(e)}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(e=null,t=0,s,i=.5,r=!1){return typeof e=="number"&&(e={width:e,color:t,alpha:s,alignment:i,native:r}),this.lineTextureStyle(e)}lineTextureStyle(e){const t={width:0,texture:J.WHITE,color:e!=null&&e.texture?16777215:0,matrix:null,alignment:.5,native:!1,cap:Js.BUTT,join:Oe.MITER,miterLimit:10};e=Object.assign(t,e),this.normalizeColor(e),this.currentPath&&this.startPoly();const s=e.width>0&&e.alpha>0;return s?(e.matrix&&(e.matrix=e.matrix.clone(),e.matrix.invert()),Object.assign(this._lineStyle,{visible:s},e)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){const e=this.currentPath.points,t=this.currentPath.points.length;t>2&&(this.drawShape(this.currentPath),this.currentPath=new Bi,this.currentPath.closeStroke=!1,this.currentPath.points.push(e[t-2],e[t-1]))}else this.currentPath=new Bi,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(e,t){return this.startPoly(),this.currentPath.points[0]=e,this.currentPath.points[1]=t,this}lineTo(e,t){this.currentPath||this.moveTo(0,0);const s=this.currentPath.points,i=s[s.length-2],r=s[s.length-1];return(i!==e||r!==t)&&s.push(e,t),this}_initCurve(e=0,t=0){this.currentPath?this.currentPath.points.length===0&&(this.currentPath.points=[e,t]):this.moveTo(e,t)}quadraticCurveTo(e,t,s,i){this._initCurve();const r=this.currentPath.points;return r.length===0&&this.moveTo(0,0),Jl.curveTo(e,t,s,i,r),this}bezierCurveTo(e,t,s,i,r,n){return this._initCurve(),Zl.curveTo(e,t,s,i,r,n,this.currentPath.points),this}arcTo(e,t,s,i,r){this._initCurve(e,t);const n=this.currentPath.points,o=Zc.curveTo(e,t,s,i,r,n);if(o){const{cx:a,cy:l,radius:h,startAngle:c,endAngle:u,anticlockwise:d}=o;this.arc(a,l,h,c,u,d)}return this}arc(e,t,s,i,r,n=!1){if(i===r)return this;if(!n&&r<=i?r+=Gn:n&&i<=r&&(i+=Gn),r-i===0)return this;const a=e+Math.cos(i)*s,l=t+Math.sin(i)*s,h=this._geometry.closePointEps;let c=this.currentPath?this.currentPath.points:null;if(c){const u=Math.abs(c[c.length-2]-a),d=Math.abs(c[c.length-1]-l);u<h&&d<h||c.push(a,l)}else this.moveTo(a,l),c=this.currentPath.points;return Zc.arc(a,l,e,t,s,i,r,n,c),this}beginFill(e=0,t){return this.beginTextureFill({texture:J.WHITE,color:e,alpha:t})}normalizeColor(e){const t=Dt.shared.setValue(e.color??0);e.color=t.toNumber(),e.alpha??(e.alpha=t.alpha)}beginTextureFill(e){const t={texture:J.WHITE,color:16777215,matrix:null};e=Object.assign(t,e),this.normalizeColor(e),this.currentPath&&this.startPoly();const s=e.alpha>0;return s?(e.matrix&&(e.matrix=e.matrix.clone(),e.matrix.invert()),Object.assign(this._fillStyle,{visible:s},e)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(e,t,s,i){return this.drawShape(new xt(e,t,s,i))}drawRoundedRect(e,t,s,i,r){return this.drawShape(new Vl(e,t,s,i,r))}drawCircle(e,t,s){return this.drawShape(new zl(e,t,s))}drawEllipse(e,t,s,i){return this.drawShape(new jl(e,t,s,i))}drawPolygon(...e){let t,s=!0;const i=e[0];i.points?(s=i.closeStroke,t=i.points):Array.isArray(e[0])?t=e[0]:t=e;const r=new Bi(t);return r.closeStroke=s,this.drawShape(r),this}drawShape(e){return this._holeMode?this._geometry.drawHole(e,this._matrix):this._geometry.drawShape(e,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){const e=this._geometry.graphicsData;return e.length===1&&e[0].shape.type===se.RECT&&!e[0].matrix&&!e[0].holes.length&&!(e[0].lineStyle.visible&&e[0].lineStyle.width)}_render(e){this.finishPoly();const t=this._geometry;t.updateBatches(),t.batchable?(this.batchDirty!==t.batchDirty&&this._populateBatches(),this._renderBatched(e)):(e.batch.flush(),this._renderDirect(e))}_populateBatches(){const e=this._geometry,t=this.blendMode,s=e.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=e.batchDirty,this.batches.length=s,this.vertexData=new Float32Array(e.points);for(let i=0;i<s;i++){const r=e.batches[i],n=r.style.color,o=new Float32Array(this.vertexData.buffer,r.attribStart*4*2,r.attribSize*2),a=new Float32Array(e.uvsFloat32.buffer,r.attribStart*4*2,r.attribSize*2),l=new Uint16Array(e.indicesUint16.buffer,r.start*2,r.size),h={vertexData:o,blendMode:t,indices:l,uvs:a,_batchRGB:Dt.shared.setValue(n).toRgbArray(),_tintRGB:n,_texture:r.style.texture,alpha:r.style.alpha,worldAlpha:1};this.batches[i]=h}}_renderBatched(e){if(this.batches.length){e.batch.setObjectRenderer(e.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let t=0,s=this.batches.length;t<s;t++){const i=this.batches[t];i.worldAlpha=this.worldAlpha*i.alpha,e.plugins[this.pluginName].render(i)}}}_renderDirect(e){const t=this._resolveDirectShader(e),s=this._geometry,i=this.worldAlpha,r=t.uniforms,n=s.drawCalls;r.translationMatrix=this.transform.worldTransform,Dt.shared.setValue(this._tintColor).premultiply(i).toArray(r.tint),e.shader.bind(t),e.geometry.bind(s,t),e.state.set(this.state);for(let o=0,a=n.length;o<a;o++)this._renderDrawCallDirect(e,s.drawCalls[o])}_renderDrawCallDirect(e,t){const{texArray:s,type:i,size:r,start:n}=t,o=s.count;for(let a=0;a<o;a++)e.texture.bind(s.elements[a],a);e.geometry.draw(i,r,n)}_resolveDirectShader(e){let t=this.shader;const s=this.pluginName;if(!t){if(!ha[s]){const{maxTextures:i}=e.plugins[s],r=new Int32Array(i);for(let a=0;a<i;a++)r[a]=a;const n={tint:new Float32Array([1,1,1,1]),translationMatrix:new Ut,default:Ge.from({uSamplers:r},!0)},o=e.plugins[s]._shader.program;ha[s]=new es(o,n)}t=ha[s]}return t}_calculateBounds(){this.finishPoly();const e=this._geometry;if(!e.graphicsData.length)return;const{minX:t,minY:s,maxX:i,maxY:r}=e.bounds;this._bounds.addFrame(this.transform,t,s,i,r)}containsPoint(e){return this.worldTransform.applyInverse(e,Tn._TEMP_POINT),this._geometry.containsPoint(Tn._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this._tintColor.toNumber();for(let e=0;e<this.batches.length;e++){const t=this.batches[e];t._tintRGB=Dt.shared.setValue(this._tintColor).multiply(t._batchRGB).toLittleEndianNumber()}}}calculateVertices(){const e=this.transform._worldID;if(this._transformID===e)return;this._transformID=e;const t=this.transform.worldTransform,s=t.a,i=t.b,r=t.c,n=t.d,o=t.tx,a=t.ty,l=this._geometry.points,h=this.vertexData;let c=0;for(let u=0;u<l.length;u+=2){const d=l[u],p=l[u+1];h[c++]=s*d+r*p+o,h[c++]=n*p+i*d+a}}closePath(){const e=this.currentPath;return e&&(e.closeStroke=!0,this.finishPoly()),this}setMatrix(e){return this._matrix=e,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(e){this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(e)}};let To=Tn;To.curves=Gi;To._TEMP_POINT=new At;class Yy{constructor(t,s){this.uvBuffer=t,this.uvMatrix=s,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(t){if(!t&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;const s=this.uvBuffer.data;(!this.data||this.data.length!==s.length)&&(this.data=new Float32Array(s.length)),this.uvMatrix.multiplyUvs(s,this.data),this._updateID++}}const ca=new At,eu=new Bi,Df=class extends fe{constructor(e,t,s,i=Je.TRIANGLES){super(),this.geometry=e,this.shader=t,this.state=s||xs.for2d(),this.drawMode=i,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=q.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(e){this._geometry!==e&&(this._geometry&&(this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose()),this._geometry=e,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(e){this.shader=e}get material(){return this.shader}set blendMode(e){this.state.blendMode=e}get blendMode(){return this.state.blendMode}set roundPixels(e){this._roundPixels!==e&&(this._transformID=-1),this._roundPixels=e}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(e){this.shader.tint=e}get tintValue(){return this.shader.tintValue}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(e){this.shader.texture=e}_render(e){const t=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===Je.TRIANGLES&&t.length<Df.BATCHABLE_SIZE*2?this._renderToBatch(e):this._renderDefault(e)}_renderDefault(e){const t=this.shader;t.alpha=this.worldAlpha,t.update&&t.update(),e.batch.flush(),t.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),e.shader.bind(t),e.state.set(this.state),e.geometry.bind(this.geometry,t),e.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(e){const t=this.geometry,s=this.shader;s.uvMatrix&&(s.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=t.indexBuffer.data,this._tintRGB=s._tintRGB,this._texture=s.texture;const i=this.material.pluginName;e.batch.setObjectRenderer(e.plugins[i]),e.plugins[i].render(this)}calculateVertices(){const t=this.geometry.buffers[0],s=t.data,i=t._updateID;if(i===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==s.length&&(this.vertexData=new Float32Array(s.length));const r=this.transform.worldTransform,n=r.a,o=r.b,a=r.c,l=r.d,h=r.tx,c=r.ty,u=this.vertexData;for(let d=0;d<u.length/2;d++){const p=s[d*2],f=s[d*2+1];u[d*2]=n*p+a*f+h,u[d*2+1]=o*p+l*f+c}if(this._roundPixels){const d=q.RESOLUTION;for(let p=0;p<u.length;++p)u[p]=Math.round(u[p]*d)/d}this.vertexDirty=i}calculateUvs(){const e=this.geometry.buffers[1],t=this.shader;t.uvMatrix.isSimple?this.uvs=e.data:(this.batchUvs||(this.batchUvs=new Yy(e,t.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(e){if(!this.getBounds().contains(e.x,e.y))return!1;this.worldTransform.applyInverse(e,ca);const t=this.geometry.getBuffer("aVertexPosition").data,s=eu.points,i=this.geometry.getIndex().data,r=i.length,n=this.drawMode===4?3:1;for(let o=0;o+2<r;o+=n){const a=i[o]*2,l=i[o+1]*2,h=i[o+2]*2;if(s[0]=t[a],s[1]=t[a+1],s[2]=t[l],s[3]=t[l+1],s[4]=t[h],s[5]=t[h+1],eu.contains(ca.x,ca.y))return!0}return!1}destroy(e){super.destroy(e),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}};let hl=Df;hl.BATCHABLE_SIZE=100;class Ky extends Ls{constructor(t,s,i){super();const r=new qt(t),n=new qt(s,!0),o=new qt(i,!0,!0);this.addAttribute("aVertexPosition",r,2,!1,lt.FLOAT).addAttribute("aTextureCoord",n,2,!1,lt.FLOAT).addIndex(o),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}}var qy=`varying vec2 vTextureCoord;
uniform vec4 uColor;

uniform sampler2D uSampler;

void main(void)
{
    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;
}
`,Zy=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTextureMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;
}
`;class su extends es{constructor(t,s){const i={uSampler:t,alpha:1,uTextureMatrix:Ut.IDENTITY,uColor:new Float32Array([1,1,1,1])};s=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},s),s.uniforms&&Object.assign(i,s.uniforms),super(s.program||Le.from(Zy,qy),i),this._colorDirty=!1,this.uvMatrix=new rf(t),this.batchable=s.program===void 0,this.pluginName=s.pluginName,this._tintColor=new Dt(s.tint),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0,this.alpha=s.alpha}get texture(){return this.uniforms.uSampler}set texture(t){this.uniforms.uSampler!==t&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!t.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=t,this.uvMatrix.texture=t)}set alpha(t){t!==this._alpha&&(this._alpha=t,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(t){t!==this.tint&&(this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0)}get tint(){return this._tintColor.value}get tintValue(){return this._tintColor.toNumber()}update(){if(this._colorDirty){this._colorDirty=!1;const s=this.texture.baseTexture.alphaMode;Dt.shared.setValue(this._tintColor).premultiply(this._alpha,s).toArray(this.uniforms.uColor)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}}class iu{constructor(t,s,i){this.geometry=new Ls,this.indexBuffer=null,this.size=i,this.dynamicProperties=[],this.staticProperties=[];for(let r=0;r<t.length;++r){let n=t[r];n={attributeName:n.attributeName,size:n.size,uploadFunction:n.uploadFunction,type:n.type||lt.FLOAT,offset:n.offset},s[r]?this.dynamicProperties.push(n):this.staticProperties.push(n)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){const t=this.geometry;let s=0;this.indexBuffer=new qt(Ox(this.size),!0,!0),t.addIndex(this.indexBuffer),this.dynamicStride=0;for(let o=0;o<this.dynamicProperties.length;++o){const a=this.dynamicProperties[o];a.offset=s,s+=a.size,this.dynamicStride+=a.size}const i=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(i),this.dynamicDataUint32=new Uint32Array(i),this.dynamicBuffer=new qt(this.dynamicData,!1,!1);let r=0;this.staticStride=0;for(let o=0;o<this.staticProperties.length;++o){const a=this.staticProperties[o];a.offset=r,r+=a.size,this.staticStride+=a.size}const n=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(n),this.staticDataUint32=new Uint32Array(n),this.staticBuffer=new qt(this.staticData,!0,!1);for(let o=0;o<this.dynamicProperties.length;++o){const a=this.dynamicProperties[o];t.addAttribute(a.attributeName,this.dynamicBuffer,0,a.type===lt.UNSIGNED_BYTE,a.type,this.dynamicStride*4,a.offset*4)}for(let o=0;o<this.staticProperties.length;++o){const a=this.staticProperties[o];t.addAttribute(a.attributeName,this.staticBuffer,0,a.type===lt.UNSIGNED_BYTE,a.type,this.staticStride*4,a.offset*4)}}uploadDynamic(t,s,i){for(let r=0;r<this.dynamicProperties.length;r++){const n=this.dynamicProperties[r];n.uploadFunction(t,s,i,n.type===lt.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,n.offset)}this.dynamicBuffer._updateID++}uploadStatic(t,s,i){for(let r=0;r<this.staticProperties.length;r++){const n=this.staticProperties[r];n.uploadFunction(t,s,i,n.type===lt.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,n.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}}var Jy=`varying vec2 vTextureCoord;
varying vec4 vColor;

uniform sampler2D uSampler;

void main(void){
    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;
    gl_FragColor = color;
}`,Qy=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;

attribute vec2 aPositionCoord;
attribute float aRotation;

uniform mat3 translationMatrix;
uniform vec4 uColor;

varying vec2 vTextureCoord;
varying vec4 vColor;

void main(void){
    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);
    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);

    vec2 v = vec2(x, y);
    v = v + aPositionCoord;

    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vColor = aColor * uColor;
}
`;class Lf extends mo{constructor(t){super(t),this.shader=null,this.properties=null,this.tempMatrix=new Ut,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:lt.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=es.from(Qy,Jy,{}),this.state=xs.for2d()}render(t){const s=t.children,i=t._maxSize,r=t._batchSize,n=this.renderer;let o=s.length;if(o===0)return;o>i&&!t.autoResize&&(o=i);let a=t._buffers;a||(a=t._buffers=this.generateBuffers(t));const l=s[0]._texture.baseTexture,h=l.alphaMode>0;this.state.blendMode=Fd(t.blendMode,h),n.state.set(this.state);const c=n.gl,u=t.worldTransform.copyTo(this.tempMatrix);u.prepend(n.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=u.toArray(!0),this.shader.uniforms.uColor=Dt.shared.setValue(t.tintRgb).premultiply(t.worldAlpha,h).toArray(this.shader.uniforms.uColor),this.shader.uniforms.uSampler=l,this.renderer.shader.bind(this.shader);let d=!1;for(let p=0,f=0;p<o;p+=r,f+=1){let m=o-p;m>r&&(m=r),f>=a.length&&a.push(this._generateOneMoreBuffer(t));const _=a[f];_.uploadDynamic(s,p,m);const v=t._bufferUpdateIDs[f]||0;d=d||_._updateID<v,d&&(_._updateID=t._updateID,_.uploadStatic(s,p,m)),n.geometry.bind(_.geometry),c.drawElements(c.TRIANGLES,m*6,c.UNSIGNED_SHORT,0)}}generateBuffers(t){const s=[],i=t._maxSize,r=t._batchSize,n=t._properties;for(let o=0;o<i;o+=r)s.push(new iu(this.properties,n,r));return s}_generateOneMoreBuffer(t){const s=t._batchSize,i=t._properties;return new iu(this.properties,i,s)}uploadVertices(t,s,i,r,n,o){let a=0,l=0,h=0,c=0;for(let u=0;u<i;++u){const d=t[s+u],p=d._texture,f=d.scale.x,m=d.scale.y,_=p.trim,v=p.orig;_?(l=_.x-d.anchor.x*v.width,a=l+_.width,c=_.y-d.anchor.y*v.height,h=c+_.height):(a=v.width*(1-d.anchor.x),l=v.width*-d.anchor.x,h=v.height*(1-d.anchor.y),c=v.height*-d.anchor.y),r[o]=l*f,r[o+1]=c*m,r[o+n]=a*f,r[o+n+1]=c*m,r[o+n*2]=a*f,r[o+n*2+1]=h*m,r[o+n*3]=l*f,r[o+n*3+1]=h*m,o+=n*4}}uploadPosition(t,s,i,r,n,o){for(let a=0;a<i;a++){const l=t[s+a].position;r[o]=l.x,r[o+1]=l.y,r[o+n]=l.x,r[o+n+1]=l.y,r[o+n*2]=l.x,r[o+n*2+1]=l.y,r[o+n*3]=l.x,r[o+n*3+1]=l.y,o+=n*4}}uploadRotation(t,s,i,r,n,o){for(let a=0;a<i;a++){const l=t[s+a].rotation;r[o]=l,r[o+n]=l,r[o+n*2]=l,r[o+n*3]=l,o+=n*4}}uploadUvs(t,s,i,r,n,o){for(let a=0;a<i;++a){const l=t[s+a]._texture._uvs;l?(r[o]=l.x0,r[o+1]=l.y0,r[o+n]=l.x1,r[o+n+1]=l.y1,r[o+n*2]=l.x2,r[o+n*2+1]=l.y2,r[o+n*3]=l.x3,r[o+n*3+1]=l.y3,o+=n*4):(r[o]=0,r[o+1]=0,r[o+n]=0,r[o+n+1]=0,r[o+n*2]=0,r[o+n*2+1]=0,r[o+n*3]=0,r[o+n*3+1]=0,o+=n*4)}}uploadTint(t,s,i,r,n,o){for(let a=0;a<i;++a){const l=t[s+a],h=Dt.shared.setValue(l._tintRGB).toPremultiplied(l.alpha,l.texture.baseTexture.alphaMode>0);r[o]=h,r[o+n]=h,r[o+n*2]=h,r[o+n*3]=h,o+=n*4}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}}Lf.extension={name:"particle",type:Z.RendererPlugin};rt.add(Lf);var wo=(e=>(e[e.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",e[e.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",e))(wo||{});const un={willReadFrequently:!0},et=class{static get experimentalLetterSpacingSupported(){let e=et._experimentalLetterSpacingSupported;if(e!==void 0){const t=q.ADAPTER.getCanvasRenderingContext2D().prototype;e=et._experimentalLetterSpacingSupported="letterSpacing"in t||"textLetterSpacing"in t}return e}constructor(e,t,s,i,r,n,o,a,l){this.text=e,this.style=t,this.width=s,this.height=i,this.lines=r,this.lineWidths=n,this.lineHeight=o,this.maxLineWidth=a,this.fontProperties=l}static measureText(e,t,s,i=et._canvas){s=s??t.wordWrap;const r=t.toFontString(),n=et.measureFont(r);n.fontSize===0&&(n.fontSize=t.fontSize,n.ascent=t.fontSize);const o=i.getContext("2d",un);o.font=r;const l=(s?et.wordWrap(e,t,i):e).split(/(?:\r\n|\r|\n)/),h=new Array(l.length);let c=0;for(let f=0;f<l.length;f++){const m=et._measureText(l[f],t.letterSpacing,o);h[f]=m,c=Math.max(c,m)}let u=c+t.strokeThickness;t.dropShadow&&(u+=t.dropShadowDistance);const d=t.lineHeight||n.fontSize+t.strokeThickness;let p=Math.max(d,n.fontSize+t.strokeThickness*2)+(l.length-1)*(d+t.leading);return t.dropShadow&&(p+=t.dropShadowDistance),new et(e,t,u,p,l,h,d+t.leading,c,n)}static _measureText(e,t,s){let i=!1;et.experimentalLetterSpacingSupported&&(et.experimentalLetterSpacing?(s.letterSpacing=`${t}px`,s.textLetterSpacing=`${t}px`,i=!0):(s.letterSpacing="0px",s.textLetterSpacing="0px"));let r=s.measureText(e).width;return r>0&&(i?r-=t:r+=(et.graphemeSegmenter(e).length-1)*t),r}static wordWrap(e,t,s=et._canvas){const i=s.getContext("2d",un);let r=0,n="",o="";const a=Object.create(null),{letterSpacing:l,whiteSpace:h}=t,c=et.collapseSpaces(h),u=et.collapseNewlines(h);let d=!c;const p=t.wordWrapWidth+l,f=et.tokenize(e);for(let m=0;m<f.length;m++){let _=f[m];if(et.isNewline(_)){if(!u){o+=et.addLine(n),d=!c,n="",r=0;continue}_=" "}if(c){const b=et.isBreakingSpace(_),g=et.isBreakingSpace(n[n.length-1]);if(b&&g)continue}const v=et.getFromCache(_,l,a,i);if(v>p)if(n!==""&&(o+=et.addLine(n),n="",r=0),et.canBreakWords(_,t.breakWords)){const b=et.wordWrapSplit(_);for(let g=0;g<b.length;g++){let E=b[g],S=E,C=1;for(;b[g+C];){const y=b[g+C];if(!et.canBreakChars(S,y,_,g,t.breakWords))E+=y;else break;S=y,C++}g+=C-1;const T=et.getFromCache(E,l,a,i);T+r>p&&(o+=et.addLine(n),d=!1,n="",r=0),n+=E,r+=T}}else{n.length>0&&(o+=et.addLine(n),n="",r=0);const b=m===f.length-1;o+=et.addLine(_,!b),d=!1,n="",r=0}else v+r>p&&(d=!1,o+=et.addLine(n),n="",r=0),(n.length>0||!et.isBreakingSpace(_)||d)&&(n+=_,r+=v)}return o+=et.addLine(n,!1),o}static addLine(e,t=!0){return e=et.trimRight(e),e=t?`${e}
`:e,e}static getFromCache(e,t,s,i){let r=s[e];return typeof r!="number"&&(r=et._measureText(e,t,i)+t,s[e]=r),r}static collapseSpaces(e){return e==="normal"||e==="pre-line"}static collapseNewlines(e){return e==="normal"}static trimRight(e){if(typeof e!="string")return"";for(let t=e.length-1;t>=0;t--){const s=e[t];if(!et.isBreakingSpace(s))break;e=e.slice(0,-1)}return e}static isNewline(e){return typeof e!="string"?!1:et._newlines.includes(e.charCodeAt(0))}static isBreakingSpace(e,t){return typeof e!="string"?!1:et._breakingSpaces.includes(e.charCodeAt(0))}static tokenize(e){const t=[];let s="";if(typeof e!="string")return t;for(let i=0;i<e.length;i++){const r=e[i],n=e[i+1];if(et.isBreakingSpace(r,n)||et.isNewline(r)){s!==""&&(t.push(s),s=""),t.push(r);continue}s+=r}return s!==""&&t.push(s),t}static canBreakWords(e,t){return t}static canBreakChars(e,t,s,i,r){return!0}static wordWrapSplit(e){return et.graphemeSegmenter(e)}static measureFont(e){if(et._fonts[e])return et._fonts[e];const t={ascent:0,descent:0,fontSize:0},s=et._canvas,i=et._context;i.font=e;const r=et.METRICS_STRING+et.BASELINE_SYMBOL,n=Math.ceil(i.measureText(r).width);let o=Math.ceil(i.measureText(et.BASELINE_SYMBOL).width);const a=Math.ceil(et.HEIGHT_MULTIPLIER*o);if(o=o*et.BASELINE_MULTIPLIER|0,n===0||a===0)return et._fonts[e]=t,t;s.width=n,s.height=a,i.fillStyle="#f00",i.fillRect(0,0,n,a),i.font=e,i.textBaseline="alphabetic",i.fillStyle="#000",i.fillText(r,0,o);const l=i.getImageData(0,0,n,a).data,h=l.length,c=n*4;let u=0,d=0,p=!1;for(u=0;u<o;++u){for(let f=0;f<c;f+=4)if(l[d+f]!==255){p=!0;break}if(!p)d+=c;else break}for(t.ascent=o-u,d=h-c,p=!1,u=a;u>o;--u){for(let f=0;f<c;f+=4)if(l[d+f]!==255){p=!0;break}if(!p)d-=c;else break}return t.descent=u-o,t.fontSize=t.ascent+t.descent,et._fonts[e]=t,t}static clearMetrics(e=""){e?delete et._fonts[e]:et._fonts={}}static get _canvas(){if(!et.__canvas){let e;try{const t=new OffscreenCanvas(0,0),s=t.getContext("2d",un);if(s!=null&&s.measureText)return et.__canvas=t,t;e=q.ADAPTER.createCanvas()}catch{e=q.ADAPTER.createCanvas()}e.width=e.height=10,et.__canvas=e}return et.__canvas}static get _context(){return et.__context||(et.__context=et._canvas.getContext("2d",un)),et.__context}};let ee=et;ee.METRICS_STRING="|q";ee.BASELINE_SYMBOL="M";ee.BASELINE_MULTIPLIER=1.4;ee.HEIGHT_MULTIPLIER=2;ee.graphemeSegmenter=(()=>{if(typeof(Intl==null?void 0:Intl.Segmenter)=="function"){const e=new Intl.Segmenter;return t=>[...e.segment(t)].map(s=>s.segment)}return e=>[...e]})();ee.experimentalLetterSpacing=!1;ee._fonts={};ee._newlines=[10,13];ee._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];const tE=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],lr=class{constructor(e){this.styleID=0,this.reset(),da(this,e,e)}clone(){const e={};return da(e,this,lr.defaultStyle),new lr(e)}reset(){da(this,lr.defaultStyle,lr.defaultStyle)}get align(){return this._align}set align(e){this._align!==e&&(this._align=e,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(e){this._breakWords!==e&&(this._breakWords=e,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(e){this._dropShadow!==e&&(this._dropShadow=e,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(e){this._dropShadowAlpha!==e&&(this._dropShadowAlpha=e,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(e){this._dropShadowAngle!==e&&(this._dropShadowAngle=e,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(e){this._dropShadowBlur!==e&&(this._dropShadowBlur=e,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(e){const t=ua(e);this._dropShadowColor!==t&&(this._dropShadowColor=t,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(e){this._dropShadowDistance!==e&&(this._dropShadowDistance=e,this.styleID++)}get fill(){return this._fill}set fill(e){const t=ua(e);this._fill!==t&&(this._fill=t,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(e){this._fillGradientType!==e&&(this._fillGradientType=e,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(e){eE(this._fillGradientStops,e)||(this._fillGradientStops=e,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(e){this.fontFamily!==e&&(this._fontFamily=e,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(e){this._fontSize!==e&&(this._fontSize=e,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(e){this._fontStyle!==e&&(this._fontStyle=e,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(e){this._fontVariant!==e&&(this._fontVariant=e,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(e){this._fontWeight!==e&&(this._fontWeight=e,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(e){this._letterSpacing!==e&&(this._letterSpacing=e,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(e){this._lineHeight!==e&&(this._lineHeight=e,this.styleID++)}get leading(){return this._leading}set leading(e){this._leading!==e&&(this._leading=e,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(e){this._lineJoin!==e&&(this._lineJoin=e,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(e){this._miterLimit!==e&&(this._miterLimit=e,this.styleID++)}get padding(){return this._padding}set padding(e){this._padding!==e&&(this._padding=e,this.styleID++)}get stroke(){return this._stroke}set stroke(e){const t=ua(e);this._stroke!==t&&(this._stroke=t,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(e){this._strokeThickness!==e&&(this._strokeThickness=e,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(e){this._textBaseline!==e&&(this._textBaseline=e,this.styleID++)}get trim(){return this._trim}set trim(e){this._trim!==e&&(this._trim=e,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(e){this._whiteSpace!==e&&(this._whiteSpace=e,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(e){this._wordWrap!==e&&(this._wordWrap=e,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(e){this._wordWrapWidth!==e&&(this._wordWrapWidth=e,this.styleID++)}toFontString(){const e=typeof this.fontSize=="number"?`${this.fontSize}px`:this.fontSize;let t=this.fontFamily;Array.isArray(this.fontFamily)||(t=this.fontFamily.split(","));for(let s=t.length-1;s>=0;s--){let i=t[s].trim();!/([\"\'])[^\'\"]+\1/.test(i)&&!tE.includes(i)&&(i=`"${i}"`),t[s]=i}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${e} ${t.join(",")}`}};let gs=lr;gs.defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:wo.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};function ua(e){const t=Dt.shared;return Array.isArray(e)?e.map(s=>t.setValue(s).toHex()):t.setValue(e).toHex()}function eE(e,t){if(!Array.isArray(e)||!Array.isArray(t)||e.length!==t.length)return!1;for(let s=0;s<e.length;++s)if(e[s]!==t[s])return!1;return!0}function da(e,t,s){for(const i in s)Array.isArray(t[i])?e[i]=t[i].slice():e[i]=t[i]}const sE={texture:!0,children:!1,baseTexture:!0},cl=class extends ci{constructor(e,t,s){let i=!1;s||(s=q.ADAPTER.createCanvas(),i=!0),s.width=3,s.height=3;const r=J.from(s);r.orig=new xt,r.trim=new xt,super(r),this._ownCanvas=i,this.canvas=s,this.context=s.getContext("2d",{willReadFrequently:!0}),this._resolution=cl.defaultResolution??q.RESOLUTION,this._autoResolution=cl.defaultAutoResolution,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=e,this.style=t,this.localStyleID=-1}static get experimentalLetterSpacing(){return ee.experimentalLetterSpacing}static set experimentalLetterSpacing(e){Et("7.1.0","Text.experimentalLetterSpacing is deprecated, use TextMetrics.experimentalLetterSpacing"),ee.experimentalLetterSpacing=e}updateText(e){const t=this._style;if(this.localStyleID!==t.styleID&&(this.dirty=!0,this.localStyleID=t.styleID),!this.dirty&&e)return;this._font=this._style.toFontString();const s=this.context,i=ee.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),r=i.width,n=i.height,o=i.lines,a=i.lineHeight,l=i.lineWidths,h=i.maxLineWidth,c=i.fontProperties;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,r)+t.padding*2)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,n)+t.padding*2)*this._resolution),s.scale(this._resolution,this._resolution),s.clearRect(0,0,this.canvas.width,this.canvas.height),s.font=this._font,s.lineWidth=t.strokeThickness,s.textBaseline=t.textBaseline,s.lineJoin=t.lineJoin,s.miterLimit=t.miterLimit;let u,d;const p=t.dropShadow?2:1;for(let f=0;f<p;++f){const m=t.dropShadow&&f===0,_=m?Math.ceil(Math.max(1,n)+t.padding*2):0,v=_*this._resolution;if(m){s.fillStyle="black",s.strokeStyle="black";const g=t.dropShadowColor,E=t.dropShadowBlur*this._resolution,S=t.dropShadowDistance*this._resolution;s.shadowColor=Dt.shared.setValue(g).setAlpha(t.dropShadowAlpha).toRgbaString(),s.shadowBlur=E,s.shadowOffsetX=Math.cos(t.dropShadowAngle)*S,s.shadowOffsetY=Math.sin(t.dropShadowAngle)*S+v}else s.fillStyle=this._generateFillStyle(t,o,i),s.strokeStyle=t.stroke,s.shadowColor="black",s.shadowBlur=0,s.shadowOffsetX=0,s.shadowOffsetY=0;let b=(a-c.fontSize)/2;a-c.fontSize<0&&(b=0);for(let g=0;g<o.length;g++)u=t.strokeThickness/2,d=t.strokeThickness/2+g*a+c.ascent+b,t.align==="right"?u+=h-l[g]:t.align==="center"&&(u+=(h-l[g])/2),t.stroke&&t.strokeThickness&&this.drawLetterSpacing(o[g],u+t.padding,d+t.padding-_,!0),t.fill&&this.drawLetterSpacing(o[g],u+t.padding,d+t.padding-_)}this.updateTexture()}drawLetterSpacing(e,t,s,i=!1){const n=this._style.letterSpacing;let o=!1;if(ee.experimentalLetterSpacingSupported&&(ee.experimentalLetterSpacing?(this.context.letterSpacing=`${n}px`,this.context.textLetterSpacing=`${n}px`,o=!0):(this.context.letterSpacing="0px",this.context.textLetterSpacing="0px")),n===0||o){i?this.context.strokeText(e,t,s):this.context.fillText(e,t,s);return}let a=t;const l=ee.graphemeSegmenter(e);let h=this.context.measureText(e).width,c=0;for(let u=0;u<l.length;++u){const d=l[u];i?this.context.strokeText(d,a,s):this.context.fillText(d,a,s);let p="";for(let f=u+1;f<l.length;++f)p+=l[f];c=this.context.measureText(p).width,a+=h-c+n,h=c}}updateTexture(){const e=this.canvas;if(this._style.trim){const n=Fx(e);n.data&&(e.width=n.width,e.height=n.height,this.context.putImageData(n.data,0,0))}const t=this._texture,s=this._style,i=s.trim?0:s.padding,r=t.baseTexture;t.trim.width=t._frame.width=e.width/this._resolution,t.trim.height=t._frame.height=e.height/this._resolution,t.trim.x=-i,t.trim.y=-i,t.orig.width=t._frame.width-i*2,t.orig.height=t._frame.height-i*2,this._onTextureUpdate(),r.setRealSize(e.width,e.height,this._resolution),t.updateUvs(),this.dirty=!1}_render(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),super._render(e)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(e,t){return this.updateText(!0),this._textureID===-1&&(e=!1),super.getBounds(e,t)}getLocalBounds(e){return this.updateText(!0),super.getLocalBounds.call(this,e)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(e,t,s){const i=e.fill;if(Array.isArray(i)){if(i.length===1)return i[0]}else return i;let r;const n=e.dropShadow?e.dropShadowDistance:0,o=e.padding||0,a=this.canvas.width/this._resolution-n-o*2,l=this.canvas.height/this._resolution-n-o*2,h=i.slice(),c=e.fillGradientStops.slice();if(!c.length){const u=h.length+1;for(let d=1;d<u;++d)c.push(d/u)}if(h.unshift(i[0]),c.unshift(0),h.push(i[i.length-1]),c.push(1),e.fillGradientType===wo.LINEAR_VERTICAL){r=this.context.createLinearGradient(a/2,o,a/2,l+o);const u=s.fontProperties.fontSize+e.strokeThickness;for(let d=0;d<t.length;d++){const p=s.lineHeight*(d-1)+u,f=s.lineHeight*d;let m=f;d>0&&p>f&&(m=(f+p)/2);const _=f+u,v=s.lineHeight*(d+1);let b=_;d+1<t.length&&v<_&&(b=(_+v)/2);const g=(b-m)/l;for(let E=0;E<h.length;E++){let S=0;typeof c[E]=="number"?S=c[E]:S=E/h.length;let C=Math.min(1,Math.max(0,m/l+S*g));C=Number(C.toFixed(5)),r.addColorStop(C,h[E])}}}else{r=this.context.createLinearGradient(o,l/2,a+o,l/2);const u=h.length+1;let d=1;for(let p=0;p<h.length;p++){let f;typeof c[p]=="number"?f=c[p]:f=d/u,r.addColorStop(f,h[p]),d++}}return r}destroy(e){typeof e=="boolean"&&(e={children:e}),e=Object.assign({},sE,e),super.destroy(e),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(e){this.updateText(!0);const t=As(this.scale.x)||1;this.scale.x=t*e/this._texture.orig.width,this._width=e}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(e){this.updateText(!0);const t=As(this.scale.y)||1;this.scale.y=t*e/this._texture.orig.height,this._height=e}get style(){return this._style}set style(e){e=e||{},e instanceof gs?this._style=e:this._style=new gs(e),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(e){e=String(e??""),this._text!==e&&(this._text=e,this.dirty=!0)}get resolution(){return this._resolution}set resolution(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)}};let th=cl;th.defaultAutoResolution=!0;class iE{constructor(t){this.maxItemsPerFrame=t,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}}function rE(e,t){var i;let s=!1;if((i=e==null?void 0:e._textures)!=null&&i.length){for(let r=0;r<e._textures.length;r++)if(e._textures[r]instanceof J){const n=e._textures[r].baseTexture;t.includes(n)||(t.push(n),s=!0)}}return s}function nE(e,t){if(e.baseTexture instanceof pt){const s=e.baseTexture;return t.includes(s)||t.push(s),!0}return!1}function oE(e,t){if(e._texture&&e._texture instanceof J){const s=e._texture.baseTexture;return t.includes(s)||t.push(s),!0}return!1}function aE(e,t){return t instanceof th?(t.updateText(!0),!0):!1}function lE(e,t){if(t instanceof gs){const s=t.toFontString();return ee.measureFont(s),!0}return!1}function hE(e,t){if(e instanceof th){t.includes(e.style)||t.push(e.style),t.includes(e)||t.push(e);const s=e._texture.baseTexture;return t.includes(s)||t.push(s),!0}return!1}function cE(e,t){return e instanceof gs?(t.includes(e)||t.push(e),!0):!1}const Ff=class{constructor(e){this.limiter=new iE(Ff.uploadsPerFrame),this.renderer=e,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{this.queue&&this.prepareItems()},this.registerFindHook(hE),this.registerFindHook(cE),this.registerFindHook(rE),this.registerFindHook(nE),this.registerFindHook(oE),this.registerUploadHook(aE),this.registerUploadHook(lE)}upload(e){return new Promise(t=>{e&&this.add(e),this.queue.length?(this.completes.push(t),this.ticking||(this.ticking=!0,Vt.system.addOnce(this.tick,this,Ns.UTILITY))):t()})}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){const e=this.queue[0];let t=!1;if(e&&!e._destroyed){for(let s=0,i=this.uploadHooks.length;s<i;s++)if(this.uploadHooks[s](this.uploadHookHelper,e)){this.queue.shift(),t=!0;break}}t||this.queue.shift()}if(this.queue.length)Vt.system.addOnce(this.tick,this,Ns.UTILITY);else{this.ticking=!1;const e=this.completes.slice(0);this.completes.length=0;for(let t=0,s=e.length;t<s;t++)e[t]()}}registerFindHook(e){return e&&this.addHooks.push(e),this}registerUploadHook(e){return e&&this.uploadHooks.push(e),this}add(e){for(let t=0,s=this.addHooks.length;t<s&&!this.addHooks[t](e,this.queue);t++);if(e instanceof fe)for(let t=e.children.length-1;t>=0;t--)this.add(e.children[t]);return this}destroy(){this.ticking&&Vt.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}};let Vn=Ff;Vn.uploadsPerFrame=4;Object.defineProperties(q,{UPLOADS_PER_FRAME:{get(){return Vn.uploadsPerFrame},set(e){Et("7.1.0","settings.UPLOADS_PER_FRAME is deprecated, use prepare.BasePrepare.uploadsPerFrame"),Vn.uploadsPerFrame=e}}});function Nf(e,t){return t instanceof pt?(t._glTextures[e.CONTEXT_UID]||e.texture.bind(t),!0):!1}function uE(e,t){if(!(t instanceof To))return!1;const{geometry:s}=t;t.finishPoly(),s.updateBatches();const{batches:i}=s;for(let r=0;r<i.length;r++){const{texture:n}=i[r].style;n&&Nf(e,n.baseTexture)}return s.batchable||e.geometry.bind(s,t._resolveDirectShader(e)),!0}function dE(e,t){return e instanceof To?(t.push(e),!0):!1}class Uf extends Vn{constructor(t){super(t),this.uploadHookHelper=this.renderer,this.registerFindHook(dE),this.registerUploadHook(Nf),this.registerUploadHook(uE)}}Uf.extension={name:"prepare",type:Z.RendererSystem};rt.add(Uf);class Yn extends ci{constructor(t,s=!0){super(t[0]instanceof J?t[0]:t[0].texture),this._textures=null,this._durations=null,this._autoUpdate=s,this._isConnectedToTicker=!1,this.animationSpeed=1,this.loop=!0,this.updateAnchor=!1,this.onComplete=null,this.onFrameChange=null,this.onLoop=null,this._currentTime=0,this._playing=!1,this._previousFrame=null,this.textures=t}stop(){this._playing&&(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(Vt.shared.remove(this.update,this),this._isConnectedToTicker=!1))}play(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(Vt.shared.add(this.update,this,Ns.HIGH),this._isConnectedToTicker=!0))}gotoAndStop(t){this.stop(),this.currentFrame=t}gotoAndPlay(t){this.currentFrame=t,this.play()}update(t){if(!this._playing)return;const s=this.animationSpeed*t,i=this.currentFrame;if(this._durations!==null){let r=this._currentTime%1*this._durations[this.currentFrame];for(r+=s/60*1e3;r<0;)this._currentTime--,r+=this._durations[this.currentFrame];const n=Math.sign(this.animationSpeed*t);for(this._currentTime=Math.floor(this._currentTime);r>=this._durations[this.currentFrame];)r-=this._durations[this.currentFrame]*n,this._currentTime+=n;this._currentTime+=r/this._durations[this.currentFrame]}else this._currentTime+=s;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):i!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<i||this.animationSpeed<0&&this.currentFrame>i)&&this.onLoop(),this.updateTexture())}updateTexture(){const t=this.currentFrame;this._previousFrame!==t&&(this._previousFrame=t,this._texture=this._textures[t],this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this.uvs=this._texture._uvs.uvsFloat32,this.updateAnchor&&this._anchor.copyFrom(this._texture.defaultAnchor),this.onFrameChange&&this.onFrameChange(this.currentFrame))}destroy(t){this.stop(),super.destroy(t),this.onComplete=null,this.onFrameChange=null,this.onLoop=null}static fromFrames(t){const s=[];for(let i=0;i<t.length;++i)s.push(J.from(t[i]));return new Yn(s)}static fromImages(t){const s=[];for(let i=0;i<t.length;++i)s.push(J.from(t[i]));return new Yn(s)}get totalFrames(){return this._textures.length}get textures(){return this._textures}set textures(t){if(t[0]instanceof J)this._textures=t,this._durations=null;else{this._textures=[],this._durations=[];for(let s=0;s<t.length;s++)this._textures.push(t[s].texture),this._durations.push(t[s].time)}this._previousFrame=null,this.gotoAndStop(0),this.updateTexture()}get currentFrame(){let t=Math.floor(this._currentTime)%this._textures.length;return t<0&&(t+=this._textures.length),t}set currentFrame(t){if(t<0||t>this.totalFrames-1)throw new Error(`[AnimatedSprite]: Invalid frame index value ${t}, expected to be between 0 and totalFrames ${this.totalFrames}.`);const s=this.currentFrame;this._currentTime=t,s!==this.currentFrame&&this.updateTexture()}get playing(){return this._playing}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(Vt.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(Vt.shared.add(this.update,this),this._isConnectedToTicker=!0))}}var fE=`#version 300 es
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

in vec2 vTextureCoord;

out vec4 fragmentColor;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0

    fragmentColor = texSample * uColor;
}
`,pE=`#version 300 es
#define SHADER_NAME Tiling-Sprite-300

precision lowp float;

in vec2 aVertexPosition;
in vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

out vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,mE=`#version 100
#ifdef GL_EXT_shader_texture_lod
    #extension GL_EXT_shader_texture_lod : enable
#endif
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    #ifdef GL_EXT_shader_texture_lod
        vec4 texSample = unclamped == coord
            ? texture2D(uSampler, coord) 
            : texture2DLodEXT(uSampler, coord, 0);
    #else
        vec4 texSample = texture2D(uSampler, coord);
    #endif

    gl_FragColor = texSample * uColor;
}
`,ru=`#version 100
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,gE=`#version 100
#define SHADER_NAME Tiling-Sprite-Simple-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;

void main(void)
{
    vec4 texSample = texture2D(uSampler, vTextureCoord);
    gl_FragColor = texSample * uColor;
}
`;const dn=new Ut;class kf extends mo{constructor(t){super(t),t.runners.contextChange.add(this),this.quad=new Qd,this.state=xs.for2d()}contextChange(){const t=this.renderer,s={globals:t.globalUniforms};this.simpleShader=es.from(ru,gE,s),this.shader=t.context.webGLVersion>1?es.from(pE,fE,s):es.from(ru,mE,s)}render(t){const s=this.renderer,i=this.quad;let r=i.vertices;r[0]=r[6]=t._width*-t.anchor.x,r[1]=r[3]=t._height*-t.anchor.y,r[2]=r[4]=t._width*(1-t.anchor.x),r[5]=r[7]=t._height*(1-t.anchor.y);const n=t.uvRespectAnchor?t.anchor.x:0,o=t.uvRespectAnchor?t.anchor.y:0;r=i.uvs,r[0]=r[6]=-n,r[1]=r[3]=-o,r[2]=r[4]=1-n,r[5]=r[7]=1-o,i.invalidate();const a=t._texture,l=a.baseTexture,h=l.alphaMode>0,c=t.tileTransform.localTransform,u=t.uvMatrix;let d=l.isPowerOfTwo&&a.frame.width===l.width&&a.frame.height===l.height;d&&(l._glTextures[s.CONTEXT_UID]?d=l.wrapMode!==Ms.CLAMP:l.wrapMode===Ms.CLAMP&&(l.wrapMode=Ms.REPEAT));const p=d?this.simpleShader:this.shader,f=a.width,m=a.height,_=t._width,v=t._height;dn.set(c.a*f/_,c.b*f/v,c.c*m/_,c.d*m/v,c.tx/_,c.ty/v),dn.invert(),d?dn.prepend(u.mapCoord):(p.uniforms.uMapCoord=u.mapCoord.toArray(!0),p.uniforms.uClampFrame=u.uClampFrame,p.uniforms.uClampOffset=u.uClampOffset),p.uniforms.uTransform=dn.toArray(!0),p.uniforms.uColor=Dt.shared.setValue(t.tint).premultiply(t.worldAlpha,h).toArray(p.uniforms.uColor),p.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),p.uniforms.uSampler=a,s.shader.bind(p),s.geometry.bind(i),this.state.blendMode=Fd(t.blendMode,h),s.state.set(this.state),s.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}}kf.extension={name:"tilingSprite",type:Z.RendererPlugin};rt.add(kf);const hr=class{constructor(e,t,s=null){this.linkedSheets=[],this._texture=e instanceof J?e:null,this.baseTexture=e instanceof pt?e:this._texture.baseTexture,this.textures={},this.animations={},this.data=t;const i=this.baseTexture.resource;this.resolution=this._updateResolution(s||(i?i.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(e=null){const{scale:t}=this.data.meta;let s=Ds(e,null);return s===null&&(s=parseFloat(t??"1")),s!==1&&this.baseTexture.setResolution(s),s}parse(){return new Promise(e=>{this._callback=e,this._batchIndex=0,this._frameKeys.length<=hr.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(e){let t=e;const s=hr.BATCH_SIZE;for(;t-e<s&&t<this._frameKeys.length;){const i=this._frameKeys[t],r=this._frames[i],n=r.frame;if(n){let o=null,a=null;const l=r.trimmed!==!1&&r.sourceSize?r.sourceSize:r.frame,h=new xt(0,0,Math.floor(l.w)/this.resolution,Math.floor(l.h)/this.resolution);r.rotated?o=new xt(Math.floor(n.x)/this.resolution,Math.floor(n.y)/this.resolution,Math.floor(n.h)/this.resolution,Math.floor(n.w)/this.resolution):o=new xt(Math.floor(n.x)/this.resolution,Math.floor(n.y)/this.resolution,Math.floor(n.w)/this.resolution,Math.floor(n.h)/this.resolution),r.trimmed!==!1&&r.spriteSourceSize&&(a=new xt(Math.floor(r.spriteSourceSize.x)/this.resolution,Math.floor(r.spriteSourceSize.y)/this.resolution,Math.floor(n.w)/this.resolution,Math.floor(n.h)/this.resolution)),this.textures[i]=new J(this.baseTexture,o,h,a,r.rotated?2:0,r.anchor,r.borders),J.addToCache(this.textures[i],i)}t++}}_processAnimations(){const e=this.data.animations||{};for(const t in e){this.animations[t]=[];for(let s=0;s<e[t].length;s++){const i=e[t][s];this.animations[t].push(this.textures[i])}}}_parseComplete(){const e=this._callback;this._callback=null,this._batchIndex=0,e.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*hr.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*hr.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(e=!1){var t;for(const s in this.textures)this.textures[s].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,e&&((t=this._texture)==null||t.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};let ul=hr;ul.BATCH_SIZE=1e3;const _E=["jpg","png","jpeg","avif","webp"];function Gf(e,t,s){const i={};if(e.forEach(r=>{i[r]=t}),Object.keys(t.textures).forEach(r=>{i[r]=t.textures[r]}),!s){const r=ae.dirname(e[0]);t.linkedSheets.forEach((n,o)=>{const a=Gf([`${r}/${t.data.meta.related_multi_packs[o]}`],n,!0);Object.assign(i,a)})}return i}const xE={extension:Z.Asset,cache:{test:e=>e instanceof ul,getCacheableAssets:(e,t)=>Gf(e,t,!1)},resolver:{test:e=>{const s=e.split("?")[0].split("."),i=s.pop(),r=s.pop();return i==="json"&&_E.includes(r)},parse:e=>{var s;const t=e.split(".");return{resolution:parseFloat(((s=q.RETINA_PREFIX.exec(e))==null?void 0:s[1])??"1"),format:t[t.length-2],src:e}}},loader:{name:"spritesheetLoader",extension:{type:Z.LoadParser,priority:ns.Normal},async testParse(e,t){return ae.extname(t.src).toLowerCase()===".json"&&!!e.frames},async parse(e,t,s){var h,c;let i=ae.dirname(t.src);i&&i.lastIndexOf("/")!==i.length-1&&(i+="/");let r=i+e.meta.image;r=al(r,t.src);const o=(await s.load([r]))[r],a=new ul(o.baseTexture,e,t.src);await a.parse();const l=(h=e==null?void 0:e.meta)==null?void 0:h.related_multi_packs;if(Array.isArray(l)){const u=[];for(const p of l){if(typeof p!="string")continue;let f=i+p;(c=t.data)!=null&&c.ignoreMultiPack||(f=al(f,t.src),u.push(s.load({src:f,data:{ignoreMultiPack:!0}})))}const d=await Promise.all(u);a.linkedSheets=d,d.forEach(p=>{p.linkedSheets=[a].concat(a.linkedSheets.filter(f=>f!==p))})}return a},unload(e){e.destroy(!0)}}};rt.add(xE);class Kn{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}}class wn{static test(t){return typeof t=="string"&&t.startsWith("info face=")}static parse(t){const s=t.match(/^[a-z]+\s+.+$/gm),i={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const n in s){const o=s[n].match(/^[a-z]+/gm)[0],a=s[n].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),l={};for(const h in a){const c=a[h].split("="),u=c[0],d=c[1].replace(/"/gm,""),p=parseFloat(d),f=isNaN(p)?d:p;l[u]=f}i[o].push(l)}const r=new Kn;return i.info.forEach(n=>r.info.push({face:n.face,size:parseInt(n.size,10)})),i.common.forEach(n=>r.common.push({lineHeight:parseInt(n.lineHeight,10)})),i.page.forEach(n=>r.page.push({id:parseInt(n.id,10),file:n.file})),i.char.forEach(n=>r.char.push({id:parseInt(n.id,10),page:parseInt(n.page,10),x:parseInt(n.x,10),y:parseInt(n.y,10),width:parseInt(n.width,10),height:parseInt(n.height,10),xoffset:parseInt(n.xoffset,10),yoffset:parseInt(n.yoffset,10),xadvance:parseInt(n.xadvance,10)})),i.kerning.forEach(n=>r.kerning.push({first:parseInt(n.first,10),second:parseInt(n.second,10),amount:parseInt(n.amount,10)})),i.distanceField.forEach(n=>r.distanceField.push({distanceRange:parseInt(n.distanceRange,10),fieldType:n.fieldType})),r}}class dl{static test(t){const s=t;return"getElementsByTagName"in s&&s.getElementsByTagName("page").length&&s.getElementsByTagName("info")[0].getAttribute("face")!==null}static parse(t){const s=new Kn,i=t.getElementsByTagName("info"),r=t.getElementsByTagName("common"),n=t.getElementsByTagName("page"),o=t.getElementsByTagName("char"),a=t.getElementsByTagName("kerning"),l=t.getElementsByTagName("distanceField");for(let h=0;h<i.length;h++)s.info.push({face:i[h].getAttribute("face"),size:parseInt(i[h].getAttribute("size"),10)});for(let h=0;h<r.length;h++)s.common.push({lineHeight:parseInt(r[h].getAttribute("lineHeight"),10)});for(let h=0;h<n.length;h++)s.page.push({id:parseInt(n[h].getAttribute("id"),10)||0,file:n[h].getAttribute("file")});for(let h=0;h<o.length;h++){const c=o[h];s.char.push({id:parseInt(c.getAttribute("id"),10),page:parseInt(c.getAttribute("page"),10)||0,x:parseInt(c.getAttribute("x"),10),y:parseInt(c.getAttribute("y"),10),width:parseInt(c.getAttribute("width"),10),height:parseInt(c.getAttribute("height"),10),xoffset:parseInt(c.getAttribute("xoffset"),10),yoffset:parseInt(c.getAttribute("yoffset"),10),xadvance:parseInt(c.getAttribute("xadvance"),10)})}for(let h=0;h<a.length;h++)s.kerning.push({first:parseInt(a[h].getAttribute("first"),10),second:parseInt(a[h].getAttribute("second"),10),amount:parseInt(a[h].getAttribute("amount"),10)});for(let h=0;h<l.length;h++)s.distanceField.push({fieldType:l[h].getAttribute("fieldType"),distanceRange:parseInt(l[h].getAttribute("distanceRange"),10)});return s}}class fl{static test(t){return typeof t=="string"&&t.includes("<font>")?dl.test(q.ADAPTER.parseXML(t)):!1}static parse(t){return dl.parse(q.ADAPTER.parseXML(t))}}const fa=[wn,dl,fl];function vE(e){for(let t=0;t<fa.length;t++)if(fa[t].test(e))return fa[t];return null}function yE(e,t,s,i,r,n){const o=s.fill;if(Array.isArray(o)){if(o.length===1)return o[0]}else return o;let a;const l=s.dropShadow?s.dropShadowDistance:0,h=s.padding||0,c=e.width/i-l-h*2,u=e.height/i-l-h*2,d=o.slice(),p=s.fillGradientStops.slice();if(!p.length){const f=d.length+1;for(let m=1;m<f;++m)p.push(m/f)}if(d.unshift(o[0]),p.unshift(0),d.push(o[o.length-1]),p.push(1),s.fillGradientType===wo.LINEAR_VERTICAL){a=t.createLinearGradient(c/2,h,c/2,u+h);let f=0;const _=(n.fontProperties.fontSize+s.strokeThickness)/u;for(let v=0;v<r.length;v++){const b=n.lineHeight*v;for(let g=0;g<d.length;g++){let E=0;typeof p[g]=="number"?E=p[g]:E=g/d.length;const S=b/u+E*_;let C=Math.max(f,S);C=Math.min(C,1),a.addColorStop(C,d[g]),f=C}}}else{a=t.createLinearGradient(h,u/2,c+h,u/2);const f=d.length+1;let m=1;for(let _=0;_<d.length;_++){let v;typeof p[_]=="number"?v=p[_]:v=m/f,a.addColorStop(v,d[_]),m++}}return a}function EE(e,t,s,i,r,n,o){const a=s.text,l=s.fontProperties;t.translate(i,r),t.scale(n,n);const h=o.strokeThickness/2,c=-(o.strokeThickness/2);if(t.font=o.toFontString(),t.lineWidth=o.strokeThickness,t.textBaseline=o.textBaseline,t.lineJoin=o.lineJoin,t.miterLimit=o.miterLimit,t.fillStyle=yE(e,t,o,n,[a],s),t.strokeStyle=o.stroke,o.dropShadow){const u=o.dropShadowColor,d=o.dropShadowBlur*n,p=o.dropShadowDistance*n;t.shadowColor=Dt.shared.setValue(u).setAlpha(o.dropShadowAlpha).toRgbaString(),t.shadowBlur=d,t.shadowOffsetX=Math.cos(o.dropShadowAngle)*p,t.shadowOffsetY=Math.sin(o.dropShadowAngle)*p}else t.shadowColor="black",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0;o.stroke&&o.strokeThickness&&t.strokeText(a,h,c+s.lineHeight-l.descent),o.fill&&t.fillText(a,h,c+s.lineHeight-l.descent),t.setTransform(1,0,0,1,0,0),t.fillStyle="rgba(0, 0, 0, 0)"}function Sn(e){return e.codePointAt?e.codePointAt(0):e.charCodeAt(0)}function Hf(e){return Array.from?Array.from(e):e.split("")}function bE(e){typeof e=="string"&&(e=[e]);const t=[];for(let s=0,i=e.length;s<i;s++){const r=e[s];if(Array.isArray(r)){if(r.length!==2)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${r.length}.`);const n=r[0].charCodeAt(0),o=r[1].charCodeAt(0);if(o<n)throw new Error("[BitmapFont]: Invalid character range.");for(let a=n,l=o;a<=l;a++)t.push(String.fromCharCode(a))}else t.push(...Hf(r))}if(t.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return t}const Me=class{constructor(e,t,s){var h;const[i]=e.info,[r]=e.common,[n]=e.page,[o]=e.distanceField,a=Ds(n.file),l={};this._ownsTextures=s,this.font=i.face,this.size=i.size,this.lineHeight=r.lineHeight/a,this.chars={},this.pageTextures=l;for(let c=0;c<e.page.length;c++){const{id:u,file:d}=e.page[c];l[u]=t instanceof Array?t[c]:t[d],o!=null&&o.fieldType&&o.fieldType!=="none"&&(l[u].baseTexture.alphaMode=He.NO_PREMULTIPLIED_ALPHA,l[u].baseTexture.mipmap=is.OFF)}for(let c=0;c<e.char.length;c++){const{id:u,page:d}=e.char[c];let{x:p,y:f,width:m,height:_,xoffset:v,yoffset:b,xadvance:g}=e.char[c];p/=a,f/=a,m/=a,_/=a,v/=a,b/=a,g/=a;const E=new xt(p+l[d].frame.x/a,f+l[d].frame.y/a,m,_);this.chars[u]={xOffset:v,yOffset:b,xAdvance:g,kerning:{},texture:new J(l[d].baseTexture,E),page:d}}for(let c=0;c<e.kerning.length;c++){let{first:u,second:d,amount:p}=e.kerning[c];u/=a,d/=a,p/=a,this.chars[d]&&(this.chars[d].kerning[u]=p)}this.distanceFieldRange=o==null?void 0:o.distanceRange,this.distanceFieldType=((h=o==null?void 0:o.fieldType)==null?void 0:h.toLowerCase())??"none"}destroy(){for(const e in this.chars)this.chars[e].texture.destroy(),this.chars[e].texture=null;for(const e in this.pageTextures)this._ownsTextures&&this.pageTextures[e].destroy(!0),this.pageTextures[e]=null;this.chars=null,this.pageTextures=null}static install(e,t,s){let i;if(e instanceof Kn)i=e;else{const n=vE(e);if(!n)throw new Error("Unrecognized data format for font.");i=n.parse(e)}t instanceof J&&(t=[t]);const r=new Me(i,t,s);return Me.available[r.font]=r,r}static uninstall(e){const t=Me.available[e];if(!t)throw new Error(`No font found named '${e}'`);t.destroy(),delete Me.available[e]}static from(e,t,s){if(!e)throw new Error("[BitmapFont] Property `name` is required.");const{chars:i,padding:r,resolution:n,textureWidth:o,textureHeight:a,...l}=Object.assign({},Me.defaultOptions,s),h=bE(i),c=t instanceof gs?t:new gs(t),u=o,d=new Kn;d.info[0]={face:c.fontFamily,size:c.fontSize},d.common[0]={lineHeight:c.fontSize};let p=0,f=0,m,_,v,b=0;const g=[];for(let S=0;S<h.length;S++){m||(m=q.ADAPTER.createCanvas(),m.width=o,m.height=a,_=m.getContext("2d"),v=new pt(m,{resolution:n,...l}),g.push(new J(v)),d.page.push({id:g.length-1,file:""}));const C=h[S],T=ee.measureText(C,c,!1,m),y=T.width,I=Math.ceil(T.height),B=Math.ceil((c.fontStyle==="italic"?2:1)*y);if(f>=a-I*n){if(f===0)throw new Error(`[BitmapFont] textureHeight ${a}px is too small (fontFamily: '${c.fontFamily}', fontSize: ${c.fontSize}px, char: '${C}')`);--S,m=null,_=null,v=null,f=0,p=0,b=0;continue}if(b=Math.max(I+T.fontProperties.descent,b),B*n+p>=u){if(p===0)throw new Error(`[BitmapFont] textureWidth ${o}px is too small (fontFamily: '${c.fontFamily}', fontSize: ${c.fontSize}px, char: '${C}')`);--S,f+=b*n,f=Math.ceil(f),p=0,b=0;continue}EE(m,_,T,p,f,n,c);const F=Sn(T.text);d.char.push({id:F,page:g.length-1,x:p/n,y:f/n,width:B,height:I,xoffset:0,yoffset:0,xadvance:y-(c.dropShadow?c.dropShadowDistance:0)-(c.stroke?c.strokeThickness:0)}),p+=(B+2*r)*n,p=Math.ceil(p)}for(let S=0,C=h.length;S<C;S++){const T=h[S];for(let y=0;y<C;y++){const I=h[y],B=_.measureText(T).width,F=_.measureText(I).width,L=_.measureText(T+I).width-(B+F);L&&d.kerning.push({first:Sn(T),second:Sn(I),amount:L})}}const E=new Me(d,g,!0);return Me.available[e]!==void 0&&Me.uninstall(e),Me.available[e]=E,E}};let ue=Me;ue.ALPHA=[["a","z"],["A","Z"]," "];ue.NUMERIC=[["0","9"]];ue.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "];ue.ASCII=[[" ","~"]];ue.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:Me.ALPHANUMERIC};ue.available={};var TE=`// Pixi texture info\r
varying vec2 vTextureCoord;\r
uniform sampler2D uSampler;\r
\r
// Tint\r
uniform vec4 uColor;\r
\r
// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r
uniform float uFWidth;\r
\r
void main(void) {\r
\r
  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r
  vec4 texColor = texture2D(uSampler, vTextureCoord);\r
\r
  // MSDF\r
  float median = texColor.r + texColor.g + texColor.b -\r
                  min(texColor.r, min(texColor.g, texColor.b)) -\r
                  max(texColor.r, max(texColor.g, texColor.b));\r
  // SDF\r
  median = min(median, texColor.a);\r
\r
  float screenPxDistance = uFWidth * (median - 0.5);\r
  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r
  if (median < 0.01) {\r
    alpha = 0.0;\r
  } else if (median > 0.99) {\r
    alpha = 1.0;\r
  }\r
\r
  // Gamma correction for coverage-like alpha\r
  float luma = dot(uColor.rgb, vec3(0.299, 0.587, 0.114));\r
  float gamma = mix(1.0, 1.0 / 2.2, luma);\r
  float coverage = pow(uColor.a * alpha, gamma);  \r
\r
  // NPM Textures, NPM outputs\r
  gl_FragColor = vec4(uColor.rgb, coverage);\r
}\r
`,wE=`// Mesh material default fragment\r
attribute vec2 aVertexPosition;\r
attribute vec2 aTextureCoord;\r
\r
uniform mat3 projectionMatrix;\r
uniform mat3 translationMatrix;\r
uniform mat3 uTextureMatrix;\r
\r
varying vec2 vTextureCoord;\r
\r
void main(void)\r
{\r
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r
\r
    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r
}\r
`;const nu=[],ou=[],au=[],$f=class extends fe{constructor(e,t={}){super();const{align:s,tint:i,maxWidth:r,letterSpacing:n,fontName:o,fontSize:a}=Object.assign({},$f.styleDefaults,t);if(!ue.available[o])throw new Error(`Missing BitmapFont "${o}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=s,this._tintColor=new Dt(i),this._font=void 0,this._fontName=o,this._fontSize=a,this.text=e,this._maxWidth=r,this._maxLineHeight=0,this._letterSpacing=n,this._anchor=new Cs(()=>{this.dirty=!0},this,0,0),this._roundPixels=q.ROUND_PIXELS,this.dirty=!0,this._resolution=q.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){var B;const e=ue.available[this._fontName],t=this.fontSize,s=t/e.size,i=new At,r=[],n=[],o=[],a=this._text.replace(/(?:\r\n|\r)/g,`
`)||" ",l=Hf(a),h=this._maxWidth*e.size/t,c=e.distanceFieldType==="none"?nu:ou;let u=null,d=0,p=0,f=0,m=-1,_=0,v=0,b=0,g=0;for(let F=0;F<l.length;F++){const z=l[F],L=Sn(z);if(/(?:\s)/.test(z)&&(m=F,_=d,g++),z==="\r"||z===`
`){n.push(d),o.push(-1),p=Math.max(p,d),++f,++v,i.x=0,i.y+=e.lineHeight,u=null,g=0;continue}const P=e.chars[L];if(!P)continue;u&&P.kerning[u]&&(i.x+=P.kerning[u]);const ut=au.pop()||{texture:J.EMPTY,line:0,charCode:0,prevSpaces:0,position:new At};ut.texture=P.texture,ut.line=f,ut.charCode=L,ut.position.x=Math.round(i.x+P.xOffset+this._letterSpacing/2),ut.position.y=Math.round(i.y+P.yOffset),ut.prevSpaces=g,r.push(ut),d=ut.position.x+Math.max(P.xAdvance-P.xOffset,P.texture.orig.width),i.x+=P.xAdvance+this._letterSpacing,b=Math.max(b,P.yOffset+P.texture.height),u=L,m!==-1&&h>0&&i.x>h&&(++v,Oi(r,1+m-v,1+F-m),F=m,m=-1,n.push(_),o.push(r.length>0?r[r.length-1].prevSpaces:0),p=Math.max(p,_),f++,i.x=0,i.y+=e.lineHeight,u=null,g=0)}const E=l[l.length-1];E!=="\r"&&E!==`
`&&(/(?:\s)/.test(E)&&(d=_),n.push(d),p=Math.max(p,d),o.push(-1));const S=[];for(let F=0;F<=f;F++){let z=0;this._align==="right"?z=p-n[F]:this._align==="center"?z=(p-n[F])/2:this._align==="justify"&&(z=o[F]<0?0:(p-n[F])/o[F]),S.push(z)}const C=r.length,T={},y=[],I=this._activePagesMeshData;c.push(...I);for(let F=0;F<C;F++){const z=r[F].texture,L=z.baseTexture.uid;if(!T[L]){let P=c.pop();if(!P){const nt=new Ky;let G,st;e.distanceFieldType==="none"?(G=new su(J.EMPTY),st=ct.NORMAL):(G=new su(J.EMPTY,{program:Le.from(wE,TE),uniforms:{uFWidth:0}}),st=ct.NORMAL_NPM);const Ct=new hl(nt,G);Ct.blendMode=st,P={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:Ct,vertices:null,uvs:null,indices:null}}P.index=0,P.indexCount=0,P.vertexCount=0,P.uvsCount=0,P.total=0;const{_textureCache:ut}=this;ut[L]=ut[L]||new J(z.baseTexture),P.mesh.texture=ut[L],P.mesh.tint=this._tintColor.value,y.push(P),T[L]=P}T[L].total++}for(let F=0;F<I.length;F++)y.includes(I[F])||this.removeChild(I[F].mesh);for(let F=0;F<y.length;F++)y[F].mesh.parent!==this&&this.addChild(y[F].mesh);this._activePagesMeshData=y;for(const F in T){const z=T[F],L=z.total;if(!(((B=z.indices)==null?void 0:B.length)>6*L)||z.vertices.length<hl.BATCHABLE_SIZE*2)z.vertices=new Float32Array(4*2*L),z.uvs=new Float32Array(4*2*L),z.indices=new Uint16Array(6*L);else{const P=z.total,ut=z.vertices;for(let nt=P*4*2;nt<ut.length;nt++)ut[nt]=0}z.mesh.size=6*L}for(let F=0;F<C;F++){const z=r[F];let L=z.position.x+S[z.line]*(this._align==="justify"?z.prevSpaces:1);this._roundPixels&&(L=Math.round(L));const P=L*s,ut=z.position.y*s,nt=z.texture,G=T[nt.baseTexture.uid],st=nt.frame,Ct=nt._uvs,N=G.index++;G.indices[N*6+0]=0+N*4,G.indices[N*6+1]=1+N*4,G.indices[N*6+2]=2+N*4,G.indices[N*6+3]=0+N*4,G.indices[N*6+4]=2+N*4,G.indices[N*6+5]=3+N*4,G.vertices[N*8+0]=P,G.vertices[N*8+1]=ut,G.vertices[N*8+2]=P+st.width*s,G.vertices[N*8+3]=ut,G.vertices[N*8+4]=P+st.width*s,G.vertices[N*8+5]=ut+st.height*s,G.vertices[N*8+6]=P,G.vertices[N*8+7]=ut+st.height*s,G.uvs[N*8+0]=Ct.x0,G.uvs[N*8+1]=Ct.y0,G.uvs[N*8+2]=Ct.x1,G.uvs[N*8+3]=Ct.y1,G.uvs[N*8+4]=Ct.x2,G.uvs[N*8+5]=Ct.y2,G.uvs[N*8+6]=Ct.x3,G.uvs[N*8+7]=Ct.y3}this._textWidth=p*s,this._textHeight=(i.y+e.lineHeight)*s;for(const F in T){const z=T[F];if(this.anchor.x!==0||this.anchor.y!==0){let nt=0;const G=this._textWidth*this.anchor.x,st=this._textHeight*this.anchor.y;for(let Ct=0;Ct<z.total;Ct++)z.vertices[nt++]-=G,z.vertices[nt++]-=st,z.vertices[nt++]-=G,z.vertices[nt++]-=st,z.vertices[nt++]-=G,z.vertices[nt++]-=st,z.vertices[nt++]-=G,z.vertices[nt++]-=st}this._maxLineHeight=b*s;const L=z.mesh.geometry.getBuffer("aVertexPosition"),P=z.mesh.geometry.getBuffer("aTextureCoord"),ut=z.mesh.geometry.getIndex();L.data=z.vertices,P.data=z.uvs,ut.data=z.indices,L.update(),P.update(),ut.update()}for(let F=0;F<r.length;F++)au.push(r[F]);this._font=e,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0);const{distanceFieldRange:t,distanceFieldType:s,size:i}=ue.available[this._fontName];if(s!=="none"){const{a:r,b:n,c:o,d:a}=this.worldTransform,l=Math.sqrt(r*r+n*n),h=Math.sqrt(o*o+a*a),c=(Math.abs(l)+Math.abs(h))/2,u=this.fontSize/i,d=e._view.resolution;for(const p of this._activePagesMeshData)p.mesh.shader.uniforms.uFWidth=c*t*u*d}super._render(e)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){const e=ue.available[this._fontName];if(!e)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==e&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tintColor.value}set tint(e){if(this.tint!==e){this._tintColor.setValue(e);for(let t=0;t<this._activePagesMeshData.length;t++)this._activePagesMeshData[t].mesh.tint=e}}get align(){return this._align}set align(e){this._align!==e&&(this._align=e,this.dirty=!0)}get fontName(){return this._fontName}set fontName(e){if(!ue.available[e])throw new Error(`Missing BitmapFont "${e}"`);this._fontName!==e&&(this._fontName=e,this.dirty=!0)}get fontSize(){return this._fontSize??ue.available[this._fontName].size}set fontSize(e){this._fontSize!==e&&(this._fontSize=e,this.dirty=!0)}get anchor(){return this._anchor}set anchor(e){typeof e=="number"?this._anchor.set(e):this._anchor.copyFrom(e)}get text(){return this._text}set text(e){e=String(e??""),this._text!==e&&(this._text=e,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(e){this._maxWidth!==e&&(this._maxWidth=e,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(e){this._letterSpacing!==e&&(this._letterSpacing=e,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(e){e!==this._roundPixels&&(this._roundPixels=e,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)}destroy(e){const{_textureCache:t}=this,i=ue.available[this._fontName].distanceFieldType==="none"?nu:ou;i.push(...this._activePagesMeshData);for(const r of this._activePagesMeshData)this.removeChild(r.mesh);this._activePagesMeshData=[],i.filter(r=>t[r.mesh.texture.baseTexture.uid]).forEach(r=>{r.mesh.texture=J.EMPTY});for(const r in t)t[r].destroy(),delete t[r];this._font=null,this._tintColor=null,this._textureCache=null,super.destroy(e)}};let SE=$f;SE.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};const AE=[".xml",".fnt"],CE={extension:{type:Z.LoadParser,priority:ns.Normal},name:"loadBitmapFont",test(e){return AE.includes(ae.extname(e).toLowerCase())},async testParse(e){return wn.test(e)||fl.test(e)},async parse(e,t,s){const i=wn.test(e)?wn.parse(e):fl.parse(e),{src:r}=t,{page:n}=i,o=[];for(let h=0;h<n.length;++h){const c=n[h].file;let u=ae.join(ae.dirname(r),c);u=al(u,r),o.push(u)}const a=await s.load(o),l=o.map(h=>a[h]);return ue.install(i,l,!0)},async load(e,t){return(await q.ADAPTER.fetch(e)).text()},unload(e){e.destroy()}};rt.add(CE);const yi=class extends gs{constructor(){super(...arguments),this._fonts=[],this._overrides=[],this._stylesheet="",this.fontsDirty=!1}static from(e){return new yi(Object.keys(yi.defaultOptions).reduce((t,s)=>({...t,[s]:e[s]}),{}))}cleanFonts(){this._fonts.length>0&&(this._fonts.forEach(e=>{URL.revokeObjectURL(e.src),e.refs--,e.refs===0&&(e.fontFace&&document.fonts.delete(e.fontFace),delete yi.availableFonts[e.originalUrl])}),this.fontFamily="Arial",this._fonts.length=0,this.styleID++,this.fontsDirty=!0)}loadFont(e,t={}){const{availableFonts:s}=yi;if(s[e]){const i=s[e];return this._fonts.push(i),i.refs++,this.styleID++,this.fontsDirty=!0,Promise.resolve()}return q.ADAPTER.fetch(e).then(i=>i.blob()).then(async i=>new Promise((r,n)=>{const o=URL.createObjectURL(i),a=new FileReader;a.onload=()=>r([o,a.result]),a.onerror=n,a.readAsDataURL(i)})).then(async([i,r])=>{const n=Object.assign({family:ae.basename(e,ae.extname(e)),weight:"normal",style:"normal",src:i,dataSrc:r,refs:1,originalUrl:e,fontFace:null},t);s[e]=n,this._fonts.push(n),this.styleID++;const o=new FontFace(n.family,`url(${n.src})`,{weight:n.weight,style:n.style});n.fontFace=o,await o.load(),document.fonts.add(o),await document.fonts.ready,this.styleID++,this.fontsDirty=!0})}addOverride(...e){const t=e.filter(s=>!this._overrides.includes(s));t.length>0&&(this._overrides.push(...t),this.styleID++)}removeOverride(...e){const t=e.filter(s=>this._overrides.includes(s));t.length>0&&(this._overrides=this._overrides.filter(s=>!t.includes(s)),this.styleID++)}toCSS(e){return[`transform: scale(${e})`,"transform-origin: top left","display: inline-block",`color: ${this.normalizeColor(this.fill)}`,`font-size: ${this.fontSize}px`,`font-family: ${this.fontFamily}`,`font-weight: ${this.fontWeight}`,`font-style: ${this.fontStyle}`,`font-variant: ${this.fontVariant}`,`letter-spacing: ${this.letterSpacing}px`,`text-align: ${this.align}`,`padding: ${this.padding}px`,`white-space: ${this.whiteSpace}`,...this.lineHeight?[`line-height: ${this.lineHeight}px`]:[],...this.wordWrap?[`word-wrap: ${this.breakWords?"break-all":"break-word"}`,`max-width: ${this.wordWrapWidth}px`]:[],...this.strokeThickness?[`-webkit-text-stroke-width: ${this.strokeThickness}px`,`-webkit-text-stroke-color: ${this.normalizeColor(this.stroke)}`,`text-stroke-width: ${this.strokeThickness}px`,`text-stroke-color: ${this.normalizeColor(this.stroke)}`,"paint-order: stroke"]:[],...this.dropShadow?[this.dropShadowToCSS()]:[],...this._overrides].join(";")}toGlobalCSS(){return this._fonts.reduce((e,t)=>`${e}
            @font-face {
                font-family: "${t.family}";
                src: url('${t.dataSrc}');
                font-weight: ${t.weight};
                font-style: ${t.style}; 
            }`,this._stylesheet)}get stylesheet(){return this._stylesheet}set stylesheet(e){this._stylesheet!==e&&(this._stylesheet=e,this.styleID++)}normalizeColor(e){return Array.isArray(e)&&(e=Px(e)),typeof e=="number"?Rx(e):e}dropShadowToCSS(){let e=this.normalizeColor(this.dropShadowColor);const t=this.dropShadowAlpha,s=Math.round(Math.cos(this.dropShadowAngle)*this.dropShadowDistance),i=Math.round(Math.sin(this.dropShadowAngle)*this.dropShadowDistance);e.startsWith("#")&&t<1&&(e+=(t*255|0).toString(16).padStart(2,"0"));const r=`${s}px ${i}px`;return this.dropShadowBlur>0?`text-shadow: ${r} ${this.dropShadowBlur}px ${e}`:`text-shadow: ${r} ${e}`}reset(){Object.assign(this,yi.defaultOptions)}onBeforeDraw(){const{fontsDirty:e}=this;return this.fontsDirty=!1,this.isSafari&&this._fonts.length>0&&e?new Promise(t=>setTimeout(t,100)):Promise.resolve()}get isSafari(){const{userAgent:e}=q.ADAPTER.getNavigator();return/^((?!chrome|android).)*safari/i.test(e)}set fillGradientStops(e){console.warn("[HTMLTextStyle] fillGradientStops is not supported by HTMLText")}get fillGradientStops(){return super.fillGradientStops}set fillGradientType(e){console.warn("[HTMLTextStyle] fillGradientType is not supported by HTMLText")}get fillGradientType(){return super.fillGradientType}set miterLimit(e){console.warn("[HTMLTextStyle] miterLimit is not supported by HTMLText")}get miterLimit(){return super.miterLimit}set trim(e){console.warn("[HTMLTextStyle] trim is not supported by HTMLText")}get trim(){return super.trim}set textBaseline(e){console.warn("[HTMLTextStyle] textBaseline is not supported by HTMLText")}get textBaseline(){return super.textBaseline}set leading(e){console.warn("[HTMLTextStyle] leading is not supported by HTMLText")}get leading(){return super.leading}set lineJoin(e){console.warn("[HTMLTextStyle] lineJoin is not supported by HTMLText")}get lineJoin(){return super.lineJoin}};let _r=yi;_r.availableFonts={};_r.defaultOptions={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,padding:0,stroke:"black",strokeThickness:0,whiteSpace:"normal",wordWrap:!1,wordWrapWidth:100};const Ei=class extends ci{constructor(e="",t={}){super(J.EMPTY),this._text=null,this._style=null,this._autoResolution=!0,this._loading=!1,this.localStyleID=-1,this.dirty=!1,this.ownsStyle=!1;const s=new Image,i=J.from(s,{scaleMode:q.SCALE_MODE,resourceOptions:{autoLoad:!1}});i.orig=new xt,i.trim=new xt,this.texture=i;const r="http://www.w3.org/2000/svg",n="http://www.w3.org/1999/xhtml",o=document.createElementNS(r,"svg"),a=document.createElementNS(r,"foreignObject"),l=document.createElementNS(n,"div"),h=document.createElementNS(n,"style");a.setAttribute("width","10000"),a.setAttribute("height","10000"),a.style.overflow="hidden",o.appendChild(a),this.maxWidth=Ei.defaultMaxWidth,this.maxHeight=Ei.defaultMaxHeight,this._domElement=l,this._styleElement=h,this._svgRoot=o,this._foreignObject=a,this._foreignObject.appendChild(h),this._foreignObject.appendChild(l),this._image=s,this._loadImage=new Image,this._autoResolution=Ei.defaultAutoResolution,this._resolution=Ei.defaultResolution??q.RESOLUTION,this.text=e,this.style=t}measureText(e){var a,l;const{text:t,style:s,resolution:i}=Object.assign({text:this._text,style:this._style,resolution:this._resolution},e);Object.assign(this._domElement,{innerHTML:t,style:s.toCSS(i)}),this._styleElement.textContent=s.toGlobalCSS(),document.body.appendChild(this._svgRoot);const r=this._domElement.getBoundingClientRect();this._svgRoot.remove();const n=Math.min(this.maxWidth,Math.ceil(r.width)),o=Math.min(this.maxHeight,Math.ceil(r.height));return this._svgRoot.setAttribute("width",n.toString()),this._svgRoot.setAttribute("height",o.toString()),t!==this._text&&(this._domElement.innerHTML=this._text),s!==this._style&&(Object.assign(this._domElement,{style:(a=this._style)==null?void 0:a.toCSS(i)}),this._styleElement.textContent=(l=this._style)==null?void 0:l.toGlobalCSS()),{width:n+s.padding*2,height:o+s.padding*2}}async updateText(e=!0){const{style:t,_image:s,_loadImage:i}=this;if(this.localStyleID!==t.styleID&&(this.dirty=!0,this.localStyleID=t.styleID),!this.dirty&&e)return;const{width:r,height:n}=this.measureText();s.width=i.width=Math.ceil(Math.max(1,r)),s.height=i.height=Math.ceil(Math.max(1,n)),this._loading||(this._loading=!0,await new Promise(o=>{i.onload=async()=>{await t.onBeforeDraw(),this._loading=!1,s.src=i.src,i.onload=null,i.src="",this.updateTexture(),o()};const a=new XMLSerializer().serializeToString(this._svgRoot);i.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(a)}`}))}get source(){return this._image}updateTexture(){const{style:e,texture:t,_image:s,resolution:i}=this,{padding:r}=e,{baseTexture:n}=t;t.trim.width=t._frame.width=s.width/i,t.trim.height=t._frame.height=s.height/i,t.trim.x=-r,t.trim.y=-r,t.orig.width=t._frame.width-r*2,t.orig.height=t._frame.height-r*2,this._onTextureUpdate(),n.setRealSize(s.width,s.height,i),this.dirty=!1}_render(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),super._render(e)}_renderCanvas(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),super._renderCanvas(e)}getLocalBounds(e){return this.updateText(!0),super.getLocalBounds(e)}_calculateBounds(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_onStyleChange(){this.dirty=!0}destroy(e){var s,i,r,n,o;typeof e=="boolean"&&(e={children:e}),e=Object.assign({},Ei.defaultDestroyOptions,e),super.destroy(e);const t=null;this.ownsStyle&&((s=this._style)==null||s.cleanFonts()),this._style=t,(i=this._svgRoot)==null||i.remove(),this._svgRoot=t,(r=this._domElement)==null||r.remove(),this._domElement=t,(n=this._foreignObject)==null||n.remove(),this._foreignObject=t,(o=this._styleElement)==null||o.remove(),this._styleElement=t,this._loadImage.src="",this._loadImage.onload=null,this._loadImage=t,this._image.src="",this._image=t}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._image.width/this.resolution}set width(e){this.updateText(!0);const t=As(this.scale.x)||1;this.scale.x=t*e/this._image.width/this.resolution,this._width=e}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._image.height/this.resolution}set height(e){this.updateText(!0);const t=As(this.scale.y)||1;this.scale.y=t*e/this._image.height/this.resolution,this._height=e}get style(){return this._style}set style(e){this._style!==e&&(e=e||{},e instanceof _r?(this.ownsStyle=!1,this._style=e):e instanceof gs?(console.warn("[HTMLText] Cloning TextStyle, if this is not what you want, use HTMLTextStyle"),this.ownsStyle=!0,this._style=_r.from(e)):(this.ownsStyle=!0,this._style=new _r(e)),this.localStyleID=-1,this.dirty=!0)}get text(){return this._text}set text(e){e=String(e===""||e===null||e===void 0?" ":e),e=this.sanitiseText(e),this._text!==e&&(this._text=e,this.dirty=!0)}get resolution(){return this._resolution}set resolution(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)}sanitiseText(e){return e.replace(/<br>/gi,"<br/>").replace(/<hr>/gi,"<hr/>").replace(/&nbsp;/gi,"&#160;")}};let So=Ei;So.defaultDestroyOptions={texture:!0,children:!1,baseTexture:!0};So.defaultMaxWidth=2024;So.defaultMaxHeight=2024;So.defaultAutoResolution=!0;let lu=0,hu=0,pa=0,ma=0,ga=0;const cu=5,eh=(e,t)=>(e&&t&&(lu=e.maxX,hu=e.maxY,pa=t.width,ma=t.height,pa>ma?ga=ma*((100-cu)/100)/(hu+1):ga=pa*((100-cu)/100)/(lu+1)),ga),Wf=eh(),IE=33*Wf,RE=18*Wf,PE={powerPreference:"high-performance",width:IE,height:RE,autoDensity:!0,preserveDrawingBuffer:!0,antialias:!0},ME=8,OE=100,oi=80,BE="/things/game_sprites.json",DE=()=>(q.RENDER_OPTIONS.hello=!1,Ee.defaultMode=co.AUTO,xe.defaultBatchSize=Math.min(xe.defaultBatchSize,16),new ql(PE));let fn;const LE=new Uint8Array(16);function FE(){if(!fn&&(fn=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!fn))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return fn(LE)}const te=[];for(let e=0;e<256;++e)te.push((e+256).toString(16).slice(1));function NE(e,t=0){return(te[e[t+0]]+te[e[t+1]]+te[e[t+2]]+te[e[t+3]]+"-"+te[e[t+4]]+te[e[t+5]]+"-"+te[e[t+6]]+te[e[t+7]]+"-"+te[e[t+8]]+te[e[t+9]]+"-"+te[e[t+10]]+te[e[t+11]]+te[e[t+12]]+te[e[t+13]]+te[e[t+14]]+te[e[t+15]]).toLowerCase()}const UE=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),uu={randomUUID:UE};function kE(e,t,s){if(uu.randomUUID&&!t&&!e)return uu.randomUUID();e=e||{};const i=e.random||(e.rng||FE)();if(i[6]=i[6]&15|64,i[8]=i[8]&63|128,t){s=s||0;for(let r=0;r<16;++r)t[s+r]=i[r];return t}return NE(i)}const ai=()=>kE();globalThis&&globalThis.__spreadArray;var GE=function(e){return e._tag==="Some"},HE={_tag:"None"},$E=function(e){return{_tag:"Some",value:e}},Mt=HE,Qt=$E,qe=GE,Tt=function(e){return e._tag==="None"};class WE{constructor(){W(this,"_containerPackages",[]);W(this,"_emptyContainerPackages",[])}get _nonEmptySize(){return this._containerPackages.length}_removeContainerPackage(t){const s=this._containerPackages.findIndex(i=>i.id===t);if(s===-1){if(this._emptyContainerPackages.findIndex(r=>r.id===t)===-1)throw new Error(`containerPackage ${t} does not exist.`);this._emptyContainerPackages.splice(s,1);return}this._containerPackages.splice(s,1)}hasContainerById(t){return this._containerPackages.concat(this._emptyContainerPackages).findIndex(s=>s.id===t)!==-1}hasContainerByName(t){return this._containerPackages.concat(this._emptyContainerPackages).findIndex(s=>s.name===t)!==-1}hasAnyContainer(){return this._containerPackages.concat(this._emptyContainerPackages).length!==0}getNonEmptyContainerByIndex(t){const s=this._nonEmptySize;if(t<0||t>=s)throw new Error(`Index ${t} out of range`);const i=this._containerPackages[t];if(!i)throw new Error(`Container package ${t} not a valid container package`);return this._removeContainerPackage(i.id),i.container}getEmptyContainer(){const t=this._emptyContainerPackages.length;if(t===0)return Mt;const s=this._emptyContainerPackages[t-1];return this._removeContainerPackage(s.id),Qt(s.container)}getContainerByName(t){let s=this._containerPackages.find(i=>i.name===t);if(!s){const i=this._emptyContainerPackages.find(r=>r.name===t);if(!i)throw new Error(`Invalid container ${t} not found`);s=i}return this._removeContainerPackage(s.id),s.container}addContainer(t,s,i){const n={id:ai(),name:s,container:t};t.children.length===0&&this._emptyContainerPackages.splice(Number(i),0,n),this._containerPackages.splice(Number(i),0,n)}}const XE=()=>new WE;class Li{constructor(t){W(this,"compare");this.compare=t||Li.defaultCompareFunction}static defaultCompareFunction(t,s){return t===s?0:t<s?-1:1}equal(t,s){return this.compare(t,s)===0}lessThan(t,s){return this.compare(t,s)<0}greaterThan(t,s){return this.compare(t,s)>0}lessThanOrEqual(t,s){return this.lessThan(t,s)||this.equal(t,s)}greaterThanOrEqual(t,s){return this.greaterThan(t,s)||this.equal(t,s)}reverse(){const t=this.compare;this.compare=(s,i)=>t(i,s)}}class sh{constructor(t){W(this,"compare");W(this,"heapContainer");if(new.target===sh)throw new TypeError("Cannot construct Heap instance directly");this.heapContainer=[],this.compare=new Li(t)}getLeftChildIndex(t){return 2*t+1}getRightChildIndex(t){return 2*t+2}getParentIndex(t){return Math.floor((t-1)/2)}hasParent(t){return this.getParentIndex(t)>=0}hasLeftChild(t){return this.getLeftChildIndex(t)<this.heapContainer.length}hasRightChild(t){return this.getRightChildIndex(t)<this.heapContainer.length}leftChild(t){return this.heapContainer[this.getLeftChildIndex(t)]}rightChild(t){return this.heapContainer[this.getRightChildIndex(t)]}parent(t){return this.heapContainer[this.getParentIndex(t)]}swap(t,s){const i=this.heapContainer[s];this.heapContainer[s]=this.heapContainer[t],this.heapContainer[t]=i}peek(){return this.heapContainer.length===0?null:this.heapContainer[0]}poll(){if(this.heapContainer.length===0)return null;if(this.heapContainer.length===1)return this.heapContainer.pop();const t=this.heapContainer[0];return this.heapContainer[0]=this.heapContainer.pop(),this.heapifyDown(),t}add(t){return this.heapContainer.push(t),this.heapifyUp(),this}remove(t,s=this.compare){const i=this.find(t,s).length;for(let r=0;r<i;r+=1){const n=Number(this.find(t,s).pop());if(n===this.heapContainer.length-1)this.heapContainer.pop();else{this.heapContainer[n]=this.heapContainer.pop();const o=this.parent(n);this.hasLeftChild(n)&&(!o||this.pairIsInCorrectOrder(o,this.heapContainer[n]))?this.heapifyDown(n):this.heapifyUp(n)}}return this}find(t,s=this.compare){const i=[];for(let r=0;r<this.heapContainer.length;r+=1)s.equal(t,this.heapContainer[r])&&i.push(r);return i}isEmpty(){return!this.heapContainer.length}toString(){return this.heapContainer.toString()}heapifyUp(t){let s=t||this.heapContainer.length-1;for(;this.hasParent(s)&&!this.pairIsInCorrectOrder(this.parent(s),this.heapContainer[s]);)this.swap(s,this.getParentIndex(s)),s=this.getParentIndex(s)}heapifyDown(t=0){let s=t,i=null;for(;this.hasLeftChild(s)&&(this.hasRightChild(s)&&this.pairIsInCorrectOrder(this.rightChild(s),this.leftChild(s))?i=this.getRightChildIndex(s):i=this.getLeftChildIndex(s),!this.pairIsInCorrectOrder(this.heapContainer[s],this.heapContainer[i]));)this.swap(s,i),s=i}pairIsInCorrectOrder(t,s){throw new Error(`
      You have to implement heap pair comparision method
      for ${t} and ${s} values.
    `)}clear(){this.heapContainer.length=0}heapSize(){return this.heapContainer.length}}class zE extends sh{pairIsInCorrectOrder(t,s){return this.compare.lessThanOrEqual(t,s)}}class Xf extends zE{constructor(){super();W(this,"priorities");this.priorities=new Map,this.compare=new Li(this.comparePriority.bind(this))}add(s,i=0){return this.priorities.set(s,i),super.add(s),this}remove(s,i){return super.remove(s,i),this.priorities.delete(s),this}changePriority(s,i){return this.remove(s,new Li(this.compareValue)),this.add(s,i),this}findByValue(s){return this.find(s,new Li(this.compareValue))}hasValue(s){return this.findByValue(s).length>0}comparePriority(s,i){return this.priorities.get(s)===this.priorities.get(i)?0:Number(this.priorities.get(s))<Number(this.priorities.get(i))?-1:1}compareValue(s,i){return s===i?0:s<i?-1:1}size(){return this.heapSize()}}const jE=(e,t,...s)=>{let i;return()=>{clearTimeout(i),i=setTimeout(()=>{e(s)},t)}};var qn={},VE={get exports(){return qn},set exports(e){qn=e}};(function(e){(function(t,s,i){if(!t)return;for(var r={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},n={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},o={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},a={option:"alt",command:"meta",return:"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},l,h=1;h<20;++h)r[111+h]="f"+h;for(h=0;h<=9;++h)r[h+96]=h.toString();function c(T,y,I){if(T.addEventListener){T.addEventListener(y,I,!1);return}T.attachEvent("on"+y,I)}function u(T){if(T.type=="keypress"){var y=String.fromCharCode(T.which);return T.shiftKey||(y=y.toLowerCase()),y}return r[T.which]?r[T.which]:n[T.which]?n[T.which]:String.fromCharCode(T.which).toLowerCase()}function d(T,y){return T.sort().join(",")===y.sort().join(",")}function p(T){var y=[];return T.shiftKey&&y.push("shift"),T.altKey&&y.push("alt"),T.ctrlKey&&y.push("ctrl"),T.metaKey&&y.push("meta"),y}function f(T){if(T.preventDefault){T.preventDefault();return}T.returnValue=!1}function m(T){if(T.stopPropagation){T.stopPropagation();return}T.cancelBubble=!0}function _(T){return T=="shift"||T=="ctrl"||T=="alt"||T=="meta"}function v(){if(!l){l={};for(var T in r)T>95&&T<112||r.hasOwnProperty(T)&&(l[r[T]]=T)}return l}function b(T,y,I){return I||(I=v()[T]?"keydown":"keypress"),I=="keypress"&&y.length&&(I="keydown"),I}function g(T){return T==="+"?["+"]:(T=T.replace(/\+{2}/g,"+plus"),T.split("+"))}function E(T,y){var I,B,F,z=[];for(I=g(T),F=0;F<I.length;++F)B=I[F],a[B]&&(B=a[B]),y&&y!="keypress"&&o[B]&&(B=o[B],z.push("shift")),_(B)&&z.push(B);return y=b(B,z,y),{key:B,modifiers:z,action:y}}function S(T,y){return T===null||T===s?!1:T===y?!0:S(T.parentNode,y)}function C(T){var y=this;if(T=T||s,!(y instanceof C))return new C(T);y.target=T,y._callbacks={},y._directMap={};var I={},B,F=!1,z=!1,L=!1;function P(U){U=U||{};var Y=!1,it;for(it in I){if(U[it]){Y=!0;continue}I[it]=0}Y||(L=!1)}function ut(U,Y,it,Q,dt,_t){var ht,vt,Lt=[],Rt=it.type;if(!y._callbacks[U])return[];for(Rt=="keyup"&&_(U)&&(Y=[U]),ht=0;ht<y._callbacks[U].length;++ht)if(vt=y._callbacks[U][ht],!(!Q&&vt.seq&&I[vt.seq]!=vt.level)&&Rt==vt.action&&(Rt=="keypress"&&!it.metaKey&&!it.ctrlKey||d(Y,vt.modifiers))){var Pt=!Q&&vt.combo==dt,x=Q&&vt.seq==Q&&vt.level==_t;(Pt||x)&&y._callbacks[U].splice(ht,1),Lt.push(vt)}return Lt}function nt(U,Y,it,Q){y.stopCallback(Y,Y.target||Y.srcElement,it,Q)||U(Y,it)===!1&&(f(Y),m(Y))}y._handleKey=function(U,Y,it){var Q=ut(U,Y,it),dt,_t={},ht=0,vt=!1;for(dt=0;dt<Q.length;++dt)Q[dt].seq&&(ht=Math.max(ht,Q[dt].level));for(dt=0;dt<Q.length;++dt){if(Q[dt].seq){if(Q[dt].level!=ht)continue;vt=!0,_t[Q[dt].seq]=1,nt(Q[dt].callback,it,Q[dt].combo,Q[dt].seq);continue}vt||nt(Q[dt].callback,it,Q[dt].combo)}var Lt=it.type=="keypress"&&z;it.type==L&&!_(U)&&!Lt&&P(_t),z=vt&&it.type=="keydown"};function G(U){typeof U.which!="number"&&(U.which=U.keyCode);var Y=u(U);if(Y){if(U.type=="keyup"&&F===Y){F=!1;return}y.handleKey(Y,p(U),U)}}function st(){clearTimeout(B),B=setTimeout(P,1e3)}function Ct(U,Y,it,Q){I[U]=0;function dt(Rt){return function(){L=Rt,++I[U],st()}}function _t(Rt){nt(it,Rt,U),Q!=="keyup"&&(F=u(Rt)),setTimeout(P,10)}for(var ht=0;ht<Y.length;++ht){var vt=ht+1===Y.length,Lt=vt?_t:dt(Q||E(Y[ht+1]).action);N(Y[ht],Lt,Q,U,ht)}}function N(U,Y,it,Q,dt){y._directMap[U+":"+it]=Y,U=U.replace(/\s+/g," ");var _t=U.split(" "),ht;if(_t.length>1){Ct(U,_t,Y,it);return}ht=E(U,it),y._callbacks[ht.key]=y._callbacks[ht.key]||[],ut(ht.key,ht.modifiers,{type:ht.action},Q,U,dt),y._callbacks[ht.key][Q?"unshift":"push"]({callback:Y,modifiers:ht.modifiers,action:ht.action,seq:Q,level:dt,combo:U})}y._bindMultiple=function(U,Y,it){for(var Q=0;Q<U.length;++Q)N(U[Q],Y,it)},c(T,"keypress",G),c(T,"keydown",G),c(T,"keyup",G)}C.prototype.bind=function(T,y,I){var B=this;return T=T instanceof Array?T:[T],B._bindMultiple.call(B,T,y,I),B},C.prototype.unbind=function(T,y){var I=this;return I.bind.call(I,T,function(){},y)},C.prototype.trigger=function(T,y){var I=this;return I._directMap[T+":"+y]&&I._directMap[T+":"+y]({},T),I},C.prototype.reset=function(){var T=this;return T._callbacks={},T._directMap={},T},C.prototype.stopCallback=function(T,y){var I=this;if((" "+y.className+" ").indexOf(" mousetrap ")>-1||S(y,I.target))return!1;if("composedPath"in T&&typeof T.composedPath=="function"){var B=T.composedPath()[0];B!==T.target&&(y=B)}return y.tagName=="INPUT"||y.tagName=="SELECT"||y.tagName=="TEXTAREA"||y.isContentEditable},C.prototype.handleKey=function(){var T=this;return T._handleKey.apply(T,arguments)},C.addKeycodes=function(T){for(var y in T)T.hasOwnProperty(y)&&(r[y]=T[y]);l=null},C.init=function(){var T=C(s);for(var y in T)y.charAt(0)!=="_"&&(C[y]=function(I){return function(){return T[I].apply(T,arguments)}}(y))},C.init(),t.Mousetrap=C,e.exports&&(e.exports=C),typeof i=="function"&&i.amd&&i(function(){return C})})(typeof window<"u"?window:null,typeof window<"u"?document:null)})(VE);class zf{constructor(){W(this,"_changed",!1);W(this,"_observers");this._observers=new Array}addObserver(t){if(!t)throw new Error(`observer is ${typeof t}`);this._observers.includes(t)||this._observers.push(t)}clearChanged(){this._changed=!1}countObservers(){return this._observers.length}deleteObserver(t){const s=this._observers.findIndex(i=>i.observeId===t.observeId);s!==-1&&this._observers.splice(s,1)}deleteObservers(){for(;this._observers.length;)this._observers.pop();this._observers.length=0}hasChanged(){return this._changed}async notifyObservers(...t){let s=[];this.hasChanged()&&(s=this._observers.slice(),this.clearChanged());const i=[];for(let r=s.length-1;r>=0;r--)i.push(s[r].update(this,...t));await Promise.allSettled(i)}setChanged(){this._changed=!0}}var hs=(e=>(e.UP="up",e.DOWN="down",e.LEFT="left",e.RIGHT="right",e.ESC="esc",e))(hs||{});const pl=[{command:{value:"up"},priority:1},{command:{value:"down"},priority:1},{command:{value:"left"},priority:1},{command:{value:"right"},priority:1}],YE=()=>{const e=new Map;for(const t of pl)e.set(t.command,t.priority);return e};class KE{constructor(){W(this,"_commandPackages",new Xf);W(this,"_commandPrioritiesMap",YE());W(this,"_dispatchNotifier",new zf);W(this,"_commandWatchServiceStarted",!1)}_judgementCommandPriority(t){const s=this._commandPrioritiesMap.get(t);if(typeof s>"u"||s===void 0)throw new Error(`this command ${t} is not have any priority defined`);return s===0?s:Date.now()}get _size(){return this._commandPackages.size()}addCommand(t){this._size<ME&&jE(()=>{const s=this._judgementCommandPriority(t);this._commandPackages.add({command:t,priority:s},s),this._dispatchNotifier.setChanged(),this._dispatchNotifier.notifyObservers().then()},OE)()}connectDispatchListener(t){this._dispatchNotifier.addObserver(t)}clearCommand(){this._commandPackages.clear()}nextCommand(){const t=this._commandPackages.poll();return t?Qt(t.command):Mt}initCommandWatchService(){if(!this._commandWatchServiceStarted){for(const s of pl)qn.bind(s.command.value,()=>this.addCommand(s.command));const t=["w","s","a","d"];for(let s=0;s<4;s++)qn.bind(t[s],()=>this.addCommand(pl[s].command));this._commandWatchServiceStarted=!0}}}const qE=()=>new KE;class ZE{constructor(){W(this,"_spritePackages",new Map)}_hasThisSprite(t){return this._spritePackages.has(t)}_removeSpritePackage(t,s){const i=this._spritePackages.get(t);if(!i)return;const r=i.findIndex(n=>n.id===s);if(!r)throw new Error(`sprite ${s} not found`);this._spritePackages.get(t).splice(r,1)}_removeSpritePackages(t,s){return this._spritePackages.get(t)?this._spritePackages.get(t).splice(0,s):null}addSpriteByName(t,s){const r={id:ai(),sprite:s};if(!this._hasThisSprite(t)){this._spritePackages.set(t,[r]);return}this._spritePackages.get(t).push(r)}addSpritesByName(t,s){const i=(r=>{const n=[];for(const o of r){const l={id:ai(),sprite:o};n.push(l)}return n})(s);if(!this._hasThisSprite(t)){this._spritePackages.set(t,i);return}this._spritePackages.get(t).push(...i)}getSpriteAmountByName(t){return this._hasThisSprite(t)?this._spritePackages.get(t).length:0}getSpriteByName(t){if(!this._hasThisSprite(t))return Mt;const s=this._spritePackages.get(t)[0];if(!s)throw new Error(`sprite ${t} not found`);return this._removeSpritePackage(t,s.id),Qt(s.sprite)}getSpritesByName(t,s){if(!this._hasThisSprite(t))return Mt;const i=this.getSpriteAmountByName(t);if(i<s)throw new Error(`sprites amount in store ${i} < ${s}`);const r=this._removeSpritePackages(t,s);if(!r)throw new Error(`sprites ${t} can not be removed`);const n=[];for(const o of r)n.push(o.sprite);return Qt(n)}}const JE=()=>new ZE;class QE{constructor(){W(this,"_resourcesSheet");W(this,"_loadingProgress",0)}async _prepareLoadedResources(t){const s=await or.load(t.trim());if(!s)throw new Error("Could not get game resources!");this._resourcesSheet=s}async loadResources(t){this._resourcesSheet||await this._prepareLoadedResources(t)}getLoadingProgress(){return this._loadingProgress}getAnimationTextures(t,s){const i=this._resourcesSheet.animations[`${t}/${s}`];if(!i)throw new Error(`Could not found the resource of ${t}/${s} !`);return i}}const tb=()=>new QE;class eb{constructor(){W(this,"_dispatchServer");W(this,"_ruleController");W(this,"_mapController")}getDispatchServer(){return this._dispatchServer}setDispatchServer(t){this._dispatchServer=t}initDispatchServer(){this._dispatchServer.enableService()}disposeDispatchServer(){this._dispatchServer.disableService()}getRuleController(){return this._ruleController}getMapController(){return this._mapController}setRuleController(t){this._ruleController=t}setMapController(t){this._mapController=t}changeMapSize(t){this._mapController.changeMapSize(t)}}const sb=()=>new eb;class ib{constructor(){W(this,"_gameApp");W(this,"_edge");W(this,"_screenHeight");W(this,"_screenWidth")}getAppEdge(){return this._edge}getScreenSize(){return{width:this._screenWidth,height:this._screenHeight}}setAppSize(t,s){this._edge.maxX=t-1,this._edge.maxY=s-1,this._screenHeight=innerHeight,this._screenWidth=innerWidth;const i=eh(this._edge,this.getScreenSize());this._gameApp.renderer.resize(t*i,s*i)}bindAppToScreenService(t){this._gameApp=t,this._edge={maxX:this._gameApp.screen.x,maxY:this._gameApp.screen.y}}}const rb=()=>new ib;class nb{constructor(){W(this,"_scanner")}getScanner(){return this._scanner}setScanner(t){this._scanner=t}}const ob=()=>new nb;class ab{constructor(){W(this,"_stageBuilder");W(this,"_containerBuilder");W(this,"_spriteBuilder")}getContainerBuilder(){return this._containerBuilder}getSpriteBuilder(){return this._spriteBuilder}getStageBuilder(){return this._stageBuilder}setContainerBuilder(t){this._containerBuilder=t}setSpriteBuilder(t){this._spriteBuilder=t}setStageBuilder(t){this._stageBuilder=t}}const lb=()=>new ab,hb=()=>{const e=XE(),t=qE(),s=JE(),i=tb(),r=sb(),n=rb(),o=ob(),a=lb();return{containerService:e,commandService:t,spriteService:s,textureService:i,controllerService:r,screenService:n,scannerService:o,builderService:a}},cb=e=>({getContainerByName:t=>e.getContainerByName(t),getNonEmptyContainerByIndex:t=>e.getNonEmptyContainerByIndex(t),getEmptyContainer:()=>e.getEmptyContainer(),addContainer:(t,s,i)=>e.addContainer(t,s,i),hasContainerById:t=>e.hasContainerById(t),hasContainerByName:t=>e.hasContainerByName(t),hasAnyContainer:()=>e.hasAnyContainer()}),ub=e=>({getSpriteByName:t=>e.getSpriteByName(t),getSpritesByName:(t,s)=>e.getSpritesByName(t,s),getSpriteAmountByName:t=>e.getSpriteAmountByName(t),addSpriteByName:(t,s)=>e.addSpriteByName(t,s),addSpritesByName:(t,s)=>e.addSpritesByName(t,s)}),db=e=>({loadResources:t=>e.loadResources(t),getAnimationTextures:(t,s)=>e.getAnimationTextures(t,s),getLoadingProgress:()=>e.getLoadingProgress()}),fb=e=>({setDispatchServer:t=>e.setDispatchServer(t),getDispatchServer:()=>e.getDispatchServer(),initDispatchServer:()=>e.initDispatchServer(),disposeDispatchServer:()=>e.disposeDispatchServer(),setRuleController:t=>e.setRuleController(t),setMapController:t=>e.setMapController(t),getRuleController:()=>e.getRuleController(),getMapController:()=>e.getMapController(),changeMapSize:t=>e.changeMapSize(t)}),pb=e=>({nextCommand:()=>e.nextCommand(),addCommand:t=>e.addCommand(t),clearCommand:()=>e.clearCommand(),initCommandWatchService:()=>e.initCommandWatchService(),connectDispatchListener:t=>e.connectDispatchListener(t)}),mb=e=>({setAppSize:(t,s)=>e.setAppSize(t,s),getAppEdge:()=>e.getAppEdge(),bindAppToScreenService:t=>e.bindAppToScreenService(t),getScreenSize:()=>e.getScreenSize()}),gb=e=>({setScanner:t=>e.setScanner(t),getScanner:()=>e.getScanner()}),_b=e=>({setStageBuilder:t=>e.setStageBuilder(t),setContainerBuilder:t=>e.setContainerBuilder(t),setSpriteBuilder:t=>e.setSpriteBuilder(t),getStageBuilder:()=>e.getStageBuilder(),getContainerBuilder:()=>e.getContainerBuilder(),getSpriteBuilder:()=>e.getSpriteBuilder()}),xb=()=>{const e=hb(),t=cb(e.containerService),s=ub(e.spriteService),i=db(e.textureService),r=fb(e.controllerService),n=pb(e.commandService),o=mb(e.screenService),a=gb(e.scannerService),l=_b(e.builderService);return{...t,...n,...s,...i,...r,...o,...a,...l}};class jf{constructor(){W(this,"_stage");W(this,"_container")}}class vb extends jf{setArgs(t,s){this._stage=t,this._container=s}async execute(){return await new Promise(t=>{this._stage.removeChild(this._container),t()})}}class yb extends jf{constructor(){super(...arguments);W(this,"_mountAtIndex")}setArgs(s,i,r){this._stage=s,this._container=i,this._mountAtIndex=r}async execute(){await new Promise(s=>{this._stage.addChildAt(this._container,this._mountAtIndex),s()})}}class Eb{constructor(t){W(this,"_stage");W(this,"_containerBuilder");this._stage=t,this._stage.sortableChildren=!0,this._containerBuilder=V.getContainerBuilder()}async addGameScene(t){V.setAppSize(t.sceneWidth,t.sceneHeight),V.changeMapSize(V.getAppEdge());const s=await this._containerBuilder.createGameScene(t),i=new yb;i.setArgs(this._stage,s,0),await i.execute()}async removeScene(){const t=this._containerBuilder.gameScene,s=new vb;s.setArgs(this._stage,t),await s.execute()}}const bb=e=>new Eb(e);class Vf{}class Tb extends Vf{constructor(){super(...arguments);W(this,"_things");W(this,"_container")}setArgs(s,i){this._things=i,this._container=s}async execute(){return await new Promise(s=>{this._container.addChild(...this._things),s(this._container)})}}class wb extends Vf{constructor(){super(...arguments);W(this,"_container");W(this,"_target")}setArgs(s,i){this._container=i,this._target=s}async execute(){return await new Promise(s=>{const i=this._container.getChildIndex(this._target),r=this._container.removeChildAt(i);s(r)})}}class Sb{constructor(){W(this,"_spriteController");W(this,"gameScene",new fe);this._spriteController=V.getSpriteBuilder()}async createEmptyScene(){const t=V.getEmptyContainer();return Tt(t)?new fe:t.value}async createGameScene(t){const s=await this.createEmptyScene(),i=await this._spriteController.getThings(t.thingsMap);await this._spriteController.connectThingsToThingController(i),V.getScanner().findRulesFromMap(V.getAppEdge());const r=new Tb;return r.setArgs(s,i),await r.execute(),this.gameScene=s,s}async removeThingFromGameScene(t){const s=new wb;s.setArgs(t,this.gameScene),await s.execute()}}const Ab=()=>new Sb;var O=(e=>(e[e.TOP=0]="TOP",e[e.DOWN=1]="DOWN",e[e.RIGHT=2]="RIGHT",e[e.LEFT=3]="LEFT",e[e.UNDEFINED=4]="UNDEFINED",e))(O||{}),bt=(e=>(e.AUTO="Text_AUTO",e.RIGHT="Text_RIGHT",e.UP="Text_UP",e.LEFT="Text_LEFT",e.DOWN="Text_DOWN",e.RED="Text_RED",e.BLUE="Text_BLUE",e.ORANGE="Text_ORANGE",e.YELLOW="Text_YELLOW",e.LIME="Text_LIME",e.GREEN="Text_GREEN",e.CYAN="Text_CYAN",e.PURPLE="Text_PURPLE",e.PINK="Text_PINK",e.ROSY="Text_ROSY",e.GREY="Text_GREY",e.BLACK="Text_BLACK",e.SILVER="Text_SILVER",e.WHITE="Text_WHITE",e.BROWN="Text_BROWN",e.BEST="Text_BEST",e.SAD="Text_SAD",e.WONDER="Text_WONDER",e.PARTY="Text_PARTY",e.BROKEN="Text_BROKEN",e.CHILL="Text_CHILL",e.DEFEAT="Text_DEFEAT",e.BACK="Text_BACK",e.FALLDOWN="Text_FALLDOWN",e.FALLRIGHT="Text_FALLRIGHT",e.FALLUP="Text_FALLUP",e.FALLLEFT="Text_FALLLEFT",e.NUDGEDOWN="Text_NUDGEDOWN",e.NUDGERIGHT="Text_NUDGERIGHT",e.NUDGEUP="Text_NUDGEUP",e.NUDGELEFT="Text_NUDGELEFT",e.TURNCLOCKWISE="Text_TURNCLOCKWISE",e.TURNCOUNTERCLOCKWISE="Text_TURNCOUNTERCLOCKWISE",e.FLOAT="Text_FLOAT",e.PHANTOM="Text_PHANTOM",e.HIDE="Text_HIDE",e.HOT="Text_HOT",e.MELT="Text_MELT",e.MORE="Text_MORE",e.MOVE="Text_MOVE",e.OPEN="Text_OPEN",e.SHUT="Text_SHUT",e.POWER="Text_POWER",e.PULL="Text_PULL",e.PUSH="Text_PUSH",e.SAFE="Text_SAFE",e.SHIFT="Text_SHIFT",e.SINK="Text_SINK",e.SLEEP="Text_SLEEP",e.STILL="Text_STILL",e.LOCKEDDOWN="Text_LOCKEDDOWN",e.LOCKEDRIGHT="Text_LOCKEDRIGHT",e.LOCKEDLEFT="Text_LOCKEDLEFT",e.LOCKEDUP="Text_LOCKEDUP",e.STOP="Text_STOP",e.SWAP="Text_SWAP",e.TELE="Text_TELE",e.WEAK="Text_WEAK",e.WIN="Text_WIN",e.WORD="Text_WORD",e.YOU="Text_YOU",e.YOU2="Text_YOU2",e.BONUS="Text_BONUS",e.END="Text_END",e.DONE="Text_DONE",e.REVERT="Text_REVERT",e.SELECT="Text_SELECT",e))(bt||{});const Ao=e=>e===O.UNDEFINED?e:e%2?e-1:e+1,Cb=async(e,t,s)=>{switch(s){case O.DOWN:if(e.atTopEdge())return!1;break;case O.TOP:if(e.atBottomEdge())return!1;break;case O.RIGHT:if(e.atLeftEdge())return!1;break;case O.LEFT:if(e.atRightEdge())return!1;break}return await t.canIEncounter(e,Ao(s))};class vs{constructor(t){W(this,"_id");W(this,"_subject");W(this,"_priority");this._id=ai(),this._subject=t}setPriority(t){this._priority=t}getPriority(){return this._priority}}class ih extends vs{async perform(){}async unperform(){}}var Yf=(e=>(e.ALGAE="ALGAE",e.ARROW="ARROW",e.BABA="BABA",e.BANANA="BANANA",e.BAT="BAT",e.BEE="BEE",e.BELT="BELT",e.BIRD="BIRD",e.BLOB="BLOB",e.BOAT="BOAT",e.BOG="BOG",e.BOLT="BOLT",e.BOOK="BOOK",e.BOX="BOX",e.BRICK="BRICK",e.BUBBLE="BUBBLE",e.BUCKET="BUCKET",e.BURGER="BURGER",e.BUG="BUG",e.CAKE="CAKE",e.CART="CART",e.CASH="CASH",e.CIRCLE="CIRCLE",e.CLIFF="CLIFF",e.CLOUD="CLOUD",e.COG="COG",e.CRAB="CRAB",e.CRYSTAL="CRYSTAL",e.CUP="CUP",e.DOOR="DOOR",e.DOT="DOT",e.DRINK="DRINK",e.DRUM="DRUM",e.DUST="DUST",e.EAR="EAR",e.EYE="EYE",e.FENCE="FENCE",e.FIRE="FIRE",e.FISH="FISH",e.FLAG="FLAG",e.FLOWER="FLOWER",e.FOFO="FOFO",e.FOLIAGE="FOLIAGE",e.FOOT="FOOT",e.FORT="FORT",e.FRUIT="FRUIT",e.FUNGI="FUNGI",e.FUNGUS="FUNGUS",e.GATE="GATE",e.GEM="GEM",e.GHOST="GHOST",e.GRASS="GRASS",e.GUITAR="GUITAR",e.HAND="HAND",e.HEDGE="HEDGE",e.HIHAT="HIHAT",e.HOUSE="HOUSE",e.HUSK="HUSK",e.HUSKS="HUSKS",e.ICE="ICE",e.IT="IT",e.JELLY="JELLY",e.JIJI="JIJI",e.KEKE="KEKE",e.KEY="KEY",e.LADDER="LADDER",e.LAMP="LAMP",e.LAVA="LAVA",e.LEAF="LEAF",e.LIFT="LIFT",e.LINE="LINE",e.LIZARD="LIZARD",e.LOVE="LOVE",e.ME="ME",e.MONITOR="MONITOR",e.MOON="MOON",e.NOSE="NOSE",e.ORB="ORB",e.PANTS="PANTS",e.PIANO="PIANO",e.PILLAR="PILLAR",e.PIPE="PIPE",e.PIXEL="PIXEL",e.PLANE="PLANE",e.PLANET="PLANET",e.PUMPKIN="PUMPKIN",e.REED="REED",e.RING="RING",e.ROAD="ROAD",e.ROBOT="ROBOT",e.ROCK="ROCK",e.ROCKET="ROCKET",e.ROSE="ROSE",e.RUBBLE="RUBBLE",e.SAX="SAX",e.SEED="SEED",e.SHELL="SHELL",e.SHIRT="SHIRT",e.SHOVEL="SHOVEL",e.SIGN="SIGN",e.SKULL="SKULL",e.SPIKE="SPIKE",e.SPROUT="SPROUT",e.SQUARE="SQUARE",e.STAR="STAR",e.STATUE="STATUE",e.STICK="STICK",e.STUMP="STUMP",e.SUN="SUN",e.TILE="TILE",e.TOWER="TOWER",e.TRACK="TRACK",e.TRAIN="TRAIN",e.TREE="TREE",e.TREES="TREES",e.TRIANGLE="TRIANGLE",e.TURNIP="TURNIP",e.UFO="UFO",e.VINE="VINE",e.WALL="WALL",e.WATER="WATER",e.WIND="WIND",e.WORM="WORM",e))(Yf||{}),Ht=(e=>(e.CHARACTERS="characters",e.NOUNS="nouns",e.OPERATORS="operators",e.PROPERTIES="properties",e))(Ht||{}),rh=(e=>(e.ALGAE="Text_ALGAE",e.ARROW="Text_ARROW",e.BABA="Text_BABA",e.BANANA="Text_BANANA",e.BAT="Text_BAT",e.BEE="Text_BEE",e.BELT="Text_BELT",e.BIRD="Text_BIRD",e.BLOB="Text_BLOB",e.BOAT="Text_BOAT",e.BOG="Text_BOG",e.BOLT="Text_BOLT",e.BOOK="Text_BOOK",e.BOX="Text_BOX",e.BRICK="Text_BRICK",e.BUBBLE="Text_BUBBLE",e.BUCKET="Text_BUCKET",e.BURGER="Text_BURGER",e.BUG="Text_BUG",e.CAKE="Text_CAKE",e.CART="Text_CART",e.CASH="Text_CASH",e.CIRCLE="Text_CIRCLE",e.CLIFF="Text_CLIFF",e.CLOUD="Text_CLOUD",e.COG="Text_COG",e.CRAB="Text_CRAB",e.CRYSTAL="Text_CRYSTAL",e.CUP="Text_CUP",e.DOOR="Text_DOOR",e.DOT="Text_DOT",e.DRINK="Text_DRINK",e.DRUM="Text_DRUM",e.DUST="Text_DUST",e.EAR="Text_EAR",e.EYE="Text_EYE",e.FENCE="Text_FENCE",e.FIRE="Text_FIRE",e.FISH="Text_FISH",e.FLAG="Text_FLAG",e.FLOWER="Text_FLOWER",e.FOFO="Text_FOFO",e.FOLIAGE="Text_FOLIAGE",e.FOOT="Text_FOOT",e.FORT="Text_FORT",e.FRUIT="Text_FRUIT",e.FUNGI="Text_FUNGI",e.FUNGUS="Text_FUNGUS",e.GATE="Text_GATE",e.GEM="Text_GEM",e.GHOST="Text_GHOST",e.GRASS="Text_GRASS",e.GUITAR="Text_GUITAR",e.HAND="Text_HAND",e.HEDGE="Text_HEDGE",e.HIHAT="Text_HIHAT",e.HOUSE="Text_HOUSE",e.HUSK="Text_HUSK",e.HUSKS="Text_HUSKS",e.ICE="Text_ICE",e.IT="Text_IT",e.JELLY="Text_JELLY",e.JIJI="Text_JIJI",e.KEKE="Text_KEKE",e.KEY="Text_KEY",e.LADDER="Text_LADDER",e.LAMP="Text_LAMP",e.LAVA="Text_LAVA",e.LEAF="Text_LEAF",e.LIFT="Text_LIFT",e.LINE="Text_LINE",e.LIZARD="Text_LIZARD",e.LOVE="Text_LOVE",e.ME="Text_ME",e.MONITOR="Text_MONITOR",e.MOON="Text_MOON",e.NOSE="Text_NOSE",e.ORB="Text_ORB",e.PANTS="Text_PANTS",e.PIANO="Text_PIANO",e.PILLAR="Text_PILLAR",e.PIPE="Text_PIPE",e.PIXEL="Text_PIXEL",e.PLANE="Text_PLANE",e.PLANET="Text_PLANET",e.PUMPKIN="Text_PUMPKIN",e.REED="Text_REED",e.RING="Text_RING",e.ROAD="Text_ROAD",e.ROBOT="Text_ROBOT",e.ROCK="Text_ROCK",e.ROCKET="Text_ROCKET",e.ROSE="Text_ROSE",e.RUBBLE="Text_RUBBLE",e.SAX="Text_SAX",e.SEED="Text_SEED",e.SHELL="Text_SHELL",e.SHIRT="Text_SHIRT",e.SHOVEL="Text_SHOVEL",e.SIGN="Text_SIGN",e.SKULL="Text_SKULL",e.SPIKE="Text_SPIKE",e.SPROUT="Text_SPROUT",e.SQUARE="Text_SQUARE",e.STAR="Text_STAR",e.STATUE="Text_STATUE",e.STICK="Text_STICK",e.STUMP="Text_STUMP",e.SUN="Text_SUN",e.TILE="Text_TILE",e.TOWER="Text_TOWER",e.TRACK="Text_TRACK",e.TRAIN="Text_TRAIN",e.TREE="Text_TREE",e.TREES="Text_TREES",e.TRIANGLE="Text_TRIANGLE",e.TURNIP="Text_TURNIP",e.UFO="Text_UFO",e.VINE="Text_VINE",e.WALL="Text_WALL",e.WATER="Text_WATER",e.WIND="Text_WIND",e.WORM="Text_WORM",e))(rh||{}),Ot=(e=>(e.IS="Text_IS",e.HAS="Text_HAS",e.MAKE="Text_MAKE",e.AND="Text_AND",e.NOT="Text_NOT",e.ON="Text_ON",e.NEAR="Text_NEAR",e.FACING="Text_FACING",e.LONELY="Text_LONELY",e.FEAR="Text_FEAR",e.EAT="Text_EAT",e.FOLLOW="Text_FOLLOW",e.MIMIC="Text_MIMIC",e.IDLE="Text_IDLE",e.POWERED="Text_POWERED",e.WITHOUT="Text_WITHOUT",e.ABOVE="Text_ABOVE",e.BELOW="Text_BELOW",e.FEELING="Text_FEELING",e.PLAY="Text_PLAY",e.OFTEN="Text_OFTEN",e.SELDOM="Text_SELDOM",e.NEVER="Text_NEVER",e))(Ot||{});const Kf=e=>e.substring(5),Ib=e=>Object.values(Yf).includes(e),qf=e=>Object.values(rh).includes(e),Rb=e=>Object.values(Ot).includes(e),Pb=e=>Object.values(bt).includes(e),Mb=e=>{if(Ib(e))return Ht.CHARACTERS;if(qf(e))return Ht.NOUNS;if(Rb(e))return Ht.OPERATORS;if(Pb(e))return Ht.PROPERTIES;throw new Error(`ThingType ${e} does not exist in all Species`)},Hi=async e=>{await new Promise(t=>setTimeout(()=>t(),e))};class Ob extends vs{constructor(s){super(s);W(this,"_originalName");W(this,"_originalTexture");W(this,"_thingTypes");this._originalName=this._subject.name,this._originalTexture=this._subject.texture,this._thingTypes=Mt}addTransformName(s){qe(this._thingTypes)?this._thingTypes.value.push(s):this._thingTypes=Qt([s])}async perform(){if(Tt(this._thingTypes)||this._thingTypes.value.length>1)return;await Hi(oi);const s=Kf(this._thingTypes.value[0]);this._subject.name=s;const i=Mb(s);this._subject.textures=V.getAnimationTextures(i,this._subject.name)}async unperform(){await Hi(oi),this._subject.texture=this._originalTexture,this._subject.name=this._originalName}}var Se=(e=>(e.UP="up",e.DOWN="down",e.RIGHT="right",e.LEFT="left",e.APPEAR="appear",e.DISAPPEAR="disappear",e))(Se||{});class Bb{constructor(){W(this,"_gameMap");W(this,"maxX");W(this,"maxY");this.maxX=0,this.maxY=0,this._gameMap=new Array(this.maxX+1);for(let t=0;t<=this.maxX;t++)this._gameMap[t]=new Array(this.maxY+1);this._resetMap()}_resetMap(){for(let t=0;t<=this.maxX;t++)for(let s=0;s<=this.maxY;s++)this._gameMap[t][s]=Mt}_placeToPosition(t,s,i){if(t<0||t>this.maxX||s<0||s>this.maxY)throw new Error(`Map system error, pos @ x:${t} y:${s} is out of range!`);if(Tt(this._gameMap[t][s]))this._gameMap[t][s]=Qt([i]);else if(qe(this._gameMap[t][s]))this._gameMap[t][s].value.push(i);else throw new Error(`Map system error, pos @ x:${t} y:${s} is invalid type!`)}_removeFromPosition(t,s,i){if(t<0||t>this.maxX||s<0||s>this.maxY)throw new Error(`Map system error, pos @ x:${t} y:${s} is out of range!`);if(qe(this._gameMap[t][s])){const r=this._gameMap[t][s].value.findIndex(n=>n.id===i.id);if(r===-1)throw new Error(`Thing ${i.id} name = ${i.name} is not in the pos @ x:${t} y:${s}, can't be removed!`);this._gameMap[t][s].value.splice(r,1)}else throw new Error(`Map system error, pos @ x:${t} y:${s} is invalid type!`)}async canIEncounter(t,s){const i=t.blockX,r=t.blockY;switch(s){case O.UNDEFINED:return!1;case O.LEFT:return t.atLeftEdge()?!1:Tt(this._gameMap[i-1][r])?!0:(await Promise.all(this._gameMap[i-1][r].value.map(n=>n.handleEncounter(t,O.RIGHT)))).reduce((n,o)=>n&&o,!0);case O.RIGHT:return t.atRightEdge()?!1:Tt(this._gameMap[i+1][r])?!0:(await Promise.all(this._gameMap[i+1][r].value.map(n=>n.handleEncounter(t,O.LEFT)))).reduce((n,o)=>n&&o,!0);case O.TOP:return t.atTopEdge()?!1:Tt(this._gameMap[i][r-1])?!0:(await Promise.all(this._gameMap[i][r-1].value.map(n=>n.handleEncounter(t,O.DOWN)))).reduce((n,o)=>n&&o,!0);case O.DOWN:return t.atBottomEdge()?!1:Tt(this._gameMap[i][r+1])?!0:(await Promise.all(this._gameMap[i][r+1].value.map(n=>n.handleEncounter(t,O.TOP)))).reduce((n,o)=>n&&o,!0)}}async notifyBeside(t,s){const i=t.blockX,r=t.blockY;await Promise.allSettled(s.map(n=>{switch(n){case O.UNDEFINED:return Promise.resolve();case O.LEFT:return t.atLeftEdge()||Tt(this._gameMap[i-1][r])?Promise.resolve():Promise.allSettled(this._gameMap[i-1][r].value.map(o=>o.handleBeside(t,O.RIGHT)));case O.RIGHT:return t.atRightEdge()||Tt(this._gameMap[i+1][r])?Promise.resolve():Promise.allSettled(this._gameMap[i+1][r].value.map(o=>o.handleBeside(t,O.LEFT)));case O.TOP:return t.atTopEdge()||Tt(this._gameMap[i][r-1])?Promise.resolve():Promise.allSettled(this._gameMap[i][r-1].value.map(o=>o.handleBeside(t,O.DOWN)));case O.DOWN:return t.atBottomEdge()||Tt(this._gameMap[i][r+1])?Promise.resolve():Promise.allSettled(this._gameMap[i][r+1].value.map(o=>o.handleBeside(t,O.TOP)))}}))}async notifyLeave(t,s){const i=t.blockX,r=t.blockY;await Promise.allSettled(s.map(n=>{switch(n){case O.UNDEFINED:return Promise.resolve();case O.LEFT:return t.atLeftEdge()||Tt(this._gameMap[i-1][r])?Promise.resolve():Promise.allSettled(this._gameMap[i-1][r].value.map(o=>o.handleLeave(t,O.RIGHT)));case O.RIGHT:return t.atRightEdge()||Tt(this._gameMap[i+1][r])?Promise.resolve():Promise.allSettled(this._gameMap[i+1][r].value.map(o=>o.handleLeave(t,O.LEFT)));case O.TOP:return t.atTopEdge()||Tt(this._gameMap[i][r-1])?Promise.resolve():Promise.allSettled(this._gameMap[i][r-1].value.map(o=>o.handleLeave(t,O.DOWN)));case O.DOWN:return t.atBottomEdge()||Tt(this._gameMap[i][r+1])?Promise.resolve():Promise.allSettled(this._gameMap[i][r+1].value.map(o=>o.handleLeave(t,O.TOP)))}}))}async update(t,s){const i=t.blockX,r=t.blockY;switch(s){case"appear":this._placeToPosition(i,r,t);break;case"disappear":this._removeFromPosition(i,r,t);break;case"up":this._removeFromPosition(i,r+1,t),this._placeToPosition(i,r,t);break;case"down":this._removeFromPosition(i,r-1,t),this._placeToPosition(i,r,t);break;case"left":this._removeFromPosition(i+1,r,t),this._placeToPosition(i,r,t);break;case"right":this._removeFromPosition(i-1,r,t),this._placeToPosition(i,r,t);break}}async appendTransformInstructions(t){for(let s=0;s<=this.maxX;s++)for(let i=0;i<=this.maxY;i++){const r=this._gameMap[s][i];if(!Tt(r))for(const n of r.value){const o=t.get(n.name);if(!o||o.length===0)continue;const a=new Ob(n);for(const l of o)a.addTransformName(l.feature);a.setPriority(9999999990002),n.thingController.addNewInstruction(a),n.thingController.pushInstructions()}}}async processMoveInstructions(t){for(let s=0;s<=this.maxX;s++)for(let i=0;i<=this.maxY;i++){const r=this._gameMap[s][i];if(!Tt(r))for(const n of r.value){const o=t.get(n.name);if(o&&o.length!==0){for(const a of o)if(a.feature===bt.MOVE){const l=h=>{let c;switch(h.towards){case O.TOP:c=new Zf(h);break;case O.DOWN:c=new Jf(h);break;case O.RIGHT:c=new tp(h);break;case O.LEFT:c=new Qf(h);break;default:c=new ih(h)}c.setPriority(9999999990001),h.thingController.addNewInstruction(c),h.thingController.pushInstructions()};await this.canIEncounter(n,n.towards)?await l(n):await this.canIEncounter(n,Ao(n.towards))&&(await n.reverseTowards(),await l(n))}}}}}async checkYouExistsInMap(t){for(let s=0;s<=this.maxX;s++)for(let i=0;i<=this.maxY;i++){const r=this._gameMap[s][i];if(!Tt(r)){for(const n of r.value)if(t.includes(n.name))return!0}}return!1}clean(){this._resetMap()}whoAreThere(t,s){if(t<0||t>this.maxX||s<0||s>this.maxY)throw new Error(`Map system error, pos @ x:${t} y:${s} is out of range!`);return this._gameMap[t][s]}whoNearMe(t){const s=t.blockX,i=t.blockY,r=t.atTopEdge()?Mt:this._gameMap[s][i-1],n=t.atBottomEdge()?Mt:this._gameMap[s][i+1],o=t.atLeftEdge()?Mt:this._gameMap[s-1][i],a=t.atRightEdge()?Mt:this._gameMap[s+1][i];return{up:r,down:n,left:o,right:a}}changeMapSize(t){this.maxX=t.maxX,this.maxY=t.maxY,this._gameMap=new Array(this.maxX+1);for(let s=0;s<=this.maxX;s++)this._gameMap[s]=new Array(this.maxY+1);this.clean()}}const Db=()=>new Bb;class Zf extends vs{async perform(){await V.getMapController().notifyLeave(this._subject,[O.LEFT,O.RIGHT,O.DOWN]),await this._subject.moveUp(),await V.getMapController().update(this._subject,Se.UP),await V.getMapController().notifyBeside(this._subject,[O.LEFT,O.RIGHT,O.TOP])}async unperform(){await V.getMapController().notifyLeave(this._subject,[O.TOP,O.LEFT,O.RIGHT]),await V.getMapController().update(this._subject,Se.DOWN),await this._subject.moveDown(),await V.getMapController().notifyBeside(this._subject,[O.LEFT,O.RIGHT,O.DOWN])}}class Jf extends vs{async perform(){await V.getMapController().notifyLeave(this._subject,[O.TOP,O.RIGHT,O.LEFT]),await this._subject.moveDown(),await V.getMapController().update(this._subject,Se.DOWN),await V.getMapController().notifyBeside(this._subject,[O.DOWN,O.RIGHT,O.LEFT])}async unperform(){await V.getMapController().notifyLeave(this._subject,[O.TOP,O.RIGHT,O.LEFT]),await V.getMapController().update(this._subject,Se.UP),await this._subject.moveUp(),await V.getMapController().notifyBeside(this._subject,[O.DOWN,O.RIGHT,O.LEFT])}}class Qf extends vs{async perform(){await V.getMapController().notifyLeave(this._subject,[O.TOP,O.DOWN,O.RIGHT]),await this._subject.moveLeft(),await V.getMapController().update(this._subject,Se.LEFT),await V.getMapController().notifyBeside(this._subject,[O.TOP,O.DOWN,O.LEFT])}async unperform(){await V.getMapController().notifyLeave(this._subject,[O.TOP,O.DOWN,O.LEFT]),await V.getMapController().update(this._subject,Se.RIGHT),await this._subject.moveRight(),await V.getMapController().notifyBeside(this._subject,[O.TOP,O.DOWN,O.RIGHT])}}class tp extends vs{async perform(){await V.getMapController().notifyLeave(this._subject,[O.TOP,O.DOWN,O.LEFT]),await this._subject.moveRight(),await V.getMapController().update(this._subject,Se.RIGHT),await V.getMapController().notifyBeside(this._subject,[O.TOP,O.DOWN,O.RIGHT])}async unperform(){await V.getMapController().notifyLeave(this._subject,[O.TOP,O.DOWN,O.RIGHT]),await V.getMapController().update(this._subject,Se.LEFT),await this._subject.moveLeft(),await V.getMapController().notifyBeside(this._subject,[O.TOP,O.DOWN,O.LEFT])}}const Is={MoveUpInstruction:Zf,MoveDownInstruction:Jf,MoveLeftInstruction:Qf,MoveRightInstruction:tp},Lb=(e,t,s)=>{let i;switch(t){case O.TOP:i=new Is.MoveDownInstruction(e);break;case O.DOWN:i=new Is.MoveUpInstruction(e);break;case O.LEFT:i=new Is.MoveRightInstruction(e);break;case O.RIGHT:i=new Is.MoveLeftInstruction(e);break;default:i=new ih(e);break}s.addNewInstruction(i),s.pushInstructions()};function ep(e,t){return function(){return e.apply(t,arguments)}}const{toString:sp}=Object.prototype,{getPrototypeOf:nh}=Object,oh=(e=>t=>{const s=sp.call(t);return e[s]||(e[s]=s.slice(8,-1).toLowerCase())})(Object.create(null)),ys=e=>(e=e.toLowerCase(),t=>oh(t)===e),Co=e=>t=>typeof t===e,{isArray:Vi}=Array,Pr=Co("undefined");function Fb(e){return e!==null&&!Pr(e)&&e.constructor!==null&&!Pr(e.constructor)&&Us(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const ip=ys("ArrayBuffer");function Nb(e){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(e):t=e&&e.buffer&&ip(e.buffer),t}const Ub=Co("string"),Us=Co("function"),rp=Co("number"),ah=e=>e!==null&&typeof e=="object",kb=e=>e===!0||e===!1,An=e=>{if(oh(e)!=="object")return!1;const t=nh(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},Gb=ys("Date"),Hb=ys("File"),$b=ys("Blob"),Wb=ys("FileList"),Xb=e=>ah(e)&&Us(e.pipe),zb=e=>{const t="[object FormData]";return e&&(typeof FormData=="function"&&e instanceof FormData||sp.call(e)===t||Us(e.toString)&&e.toString()===t)},jb=ys("URLSearchParams"),Vb=e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Fr(e,t,{allOwnKeys:s=!1}={}){if(e===null||typeof e>"u")return;let i,r;if(typeof e!="object"&&(e=[e]),Vi(e))for(i=0,r=e.length;i<r;i++)t.call(null,e[i],i,e);else{const n=s?Object.getOwnPropertyNames(e):Object.keys(e),o=n.length;let a;for(i=0;i<o;i++)a=n[i],t.call(null,e[a],a,e)}}function np(e,t){t=t.toLowerCase();const s=Object.keys(e);let i=s.length,r;for(;i-- >0;)if(r=s[i],t===r.toLowerCase())return r;return null}const op=(()=>typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global)(),ap=e=>!Pr(e)&&e!==op;function ml(){const{caseless:e}=ap(this)&&this||{},t={},s=(i,r)=>{const n=e&&np(t,r)||r;An(t[n])&&An(i)?t[n]=ml(t[n],i):An(i)?t[n]=ml({},i):Vi(i)?t[n]=i.slice():t[n]=i};for(let i=0,r=arguments.length;i<r;i++)arguments[i]&&Fr(arguments[i],s);return t}const Yb=(e,t,s,{allOwnKeys:i}={})=>(Fr(t,(r,n)=>{s&&Us(r)?e[n]=ep(r,s):e[n]=r},{allOwnKeys:i}),e),Kb=e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),qb=(e,t,s,i)=>{e.prototype=Object.create(t.prototype,i),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),s&&Object.assign(e.prototype,s)},Zb=(e,t,s,i)=>{let r,n,o;const a={};if(t=t||{},e==null)return t;do{for(r=Object.getOwnPropertyNames(e),n=r.length;n-- >0;)o=r[n],(!i||i(o,e,t))&&!a[o]&&(t[o]=e[o],a[o]=!0);e=s!==!1&&nh(e)}while(e&&(!s||s(e,t))&&e!==Object.prototype);return t},Jb=(e,t,s)=>{e=String(e),(s===void 0||s>e.length)&&(s=e.length),s-=t.length;const i=e.indexOf(t,s);return i!==-1&&i===s},Qb=e=>{if(!e)return null;if(Vi(e))return e;let t=e.length;if(!rp(t))return null;const s=new Array(t);for(;t-- >0;)s[t]=e[t];return s},tT=(e=>t=>e&&t instanceof e)(typeof Uint8Array<"u"&&nh(Uint8Array)),eT=(e,t)=>{const i=(e&&e[Symbol.iterator]).call(e);let r;for(;(r=i.next())&&!r.done;){const n=r.value;t.call(e,n[0],n[1])}},sT=(e,t)=>{let s;const i=[];for(;(s=e.exec(t))!==null;)i.push(s);return i},iT=ys("HTMLFormElement"),rT=e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(s,i,r){return i.toUpperCase()+r}),du=(({hasOwnProperty:e})=>(t,s)=>e.call(t,s))(Object.prototype),nT=ys("RegExp"),lp=(e,t)=>{const s=Object.getOwnPropertyDescriptors(e),i={};Fr(s,(r,n)=>{t(r,n,e)!==!1&&(i[n]=r)}),Object.defineProperties(e,i)},oT=e=>{lp(e,(t,s)=>{if(Us(e)&&["arguments","caller","callee"].indexOf(s)!==-1)return!1;const i=e[s];if(Us(i)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+s+"'")})}})},aT=(e,t)=>{const s={},i=r=>{r.forEach(n=>{s[n]=!0})};return Vi(e)?i(e):i(String(e).split(t)),s},lT=()=>{},hT=(e,t)=>(e=+e,Number.isFinite(e)?e:t),_a="abcdefghijklmnopqrstuvwxyz",fu="0123456789",hp={DIGIT:fu,ALPHA:_a,ALPHA_DIGIT:_a+_a.toUpperCase()+fu},cT=(e=16,t=hp.ALPHA_DIGIT)=>{let s="";const{length:i}=t;for(;e--;)s+=t[Math.random()*i|0];return s};function uT(e){return!!(e&&Us(e.append)&&e[Symbol.toStringTag]==="FormData"&&e[Symbol.iterator])}const dT=e=>{const t=new Array(10),s=(i,r)=>{if(ah(i)){if(t.indexOf(i)>=0)return;if(!("toJSON"in i)){t[r]=i;const n=Vi(i)?[]:{};return Fr(i,(o,a)=>{const l=s(o,r+1);!Pr(l)&&(n[a]=l)}),t[r]=void 0,n}}return i};return s(e,0)},R={isArray:Vi,isArrayBuffer:ip,isBuffer:Fb,isFormData:zb,isArrayBufferView:Nb,isString:Ub,isNumber:rp,isBoolean:kb,isObject:ah,isPlainObject:An,isUndefined:Pr,isDate:Gb,isFile:Hb,isBlob:$b,isRegExp:nT,isFunction:Us,isStream:Xb,isURLSearchParams:jb,isTypedArray:tT,isFileList:Wb,forEach:Fr,merge:ml,extend:Yb,trim:Vb,stripBOM:Kb,inherits:qb,toFlatObject:Zb,kindOf:oh,kindOfTest:ys,endsWith:Jb,toArray:Qb,forEachEntry:eT,matchAll:sT,isHTMLForm:iT,hasOwnProperty:du,hasOwnProp:du,reduceDescriptors:lp,freezeMethods:oT,toObjectSet:aT,toCamelCase:rT,noop:lT,toFiniteNumber:hT,findKey:np,global:op,isContextDefined:ap,ALPHABET:hp,generateString:cT,isSpecCompliantForm:uT,toJSONObject:dT};function St(e,t,s,i,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),s&&(this.config=s),i&&(this.request=i),r&&(this.response=r)}R.inherits(St,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:R.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const cp=St.prototype,up={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{up[e]={value:e}});Object.defineProperties(St,up);Object.defineProperty(cp,"isAxiosError",{value:!0});St.from=(e,t,s,i,r,n)=>{const o=Object.create(cp);return R.toFlatObject(e,o,function(l){return l!==Error.prototype},a=>a!=="isAxiosError"),St.call(o,e.message,t,s,i,r),o.cause=e,o.name=e.name,n&&Object.assign(o,n),o};const fT=null;function gl(e){return R.isPlainObject(e)||R.isArray(e)}function dp(e){return R.endsWith(e,"[]")?e.slice(0,-2):e}function pu(e,t,s){return e?e.concat(t).map(function(r,n){return r=dp(r),!s&&n?"["+r+"]":r}).join(s?".":""):t}function pT(e){return R.isArray(e)&&!e.some(gl)}const mT=R.toFlatObject(R,{},null,function(t){return/^is[A-Z]/.test(t)});function Io(e,t,s){if(!R.isObject(e))throw new TypeError("target must be an object");t=t||new FormData,s=R.toFlatObject(s,{metaTokens:!0,dots:!1,indexes:!1},!1,function(m,_){return!R.isUndefined(_[m])});const i=s.metaTokens,r=s.visitor||c,n=s.dots,o=s.indexes,l=(s.Blob||typeof Blob<"u"&&Blob)&&R.isSpecCompliantForm(t);if(!R.isFunction(r))throw new TypeError("visitor must be a function");function h(f){if(f===null)return"";if(R.isDate(f))return f.toISOString();if(!l&&R.isBlob(f))throw new St("Blob is not supported. Use a Buffer instead.");return R.isArrayBuffer(f)||R.isTypedArray(f)?l&&typeof Blob=="function"?new Blob([f]):Buffer.from(f):f}function c(f,m,_){let v=f;if(f&&!_&&typeof f=="object"){if(R.endsWith(m,"{}"))m=i?m:m.slice(0,-2),f=JSON.stringify(f);else if(R.isArray(f)&&pT(f)||(R.isFileList(f)||R.endsWith(m,"[]"))&&(v=R.toArray(f)))return m=dp(m),v.forEach(function(g,E){!(R.isUndefined(g)||g===null)&&t.append(o===!0?pu([m],E,n):o===null?m:m+"[]",h(g))}),!1}return gl(f)?!0:(t.append(pu(_,m,n),h(f)),!1)}const u=[],d=Object.assign(mT,{defaultVisitor:c,convertValue:h,isVisitable:gl});function p(f,m){if(!R.isUndefined(f)){if(u.indexOf(f)!==-1)throw Error("Circular reference detected in "+m.join("."));u.push(f),R.forEach(f,function(v,b){(!(R.isUndefined(v)||v===null)&&r.call(t,v,R.isString(b)?b.trim():b,m,d))===!0&&p(v,m?m.concat(b):[b])}),u.pop()}}if(!R.isObject(e))throw new TypeError("data must be an object");return p(e),t}function mu(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(i){return t[i]})}function lh(e,t){this._pairs=[],e&&Io(e,this,t)}const fp=lh.prototype;fp.append=function(t,s){this._pairs.push([t,s])};fp.toString=function(t){const s=t?function(i){return t.call(this,i,mu)}:mu;return this._pairs.map(function(r){return s(r[0])+"="+s(r[1])},"").join("&")};function gT(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function pp(e,t,s){if(!t)return e;const i=s&&s.encode||gT,r=s&&s.serialize;let n;if(r?n=r(t,s):n=R.isURLSearchParams(t)?t.toString():new lh(t,s).toString(i),n){const o=e.indexOf("#");o!==-1&&(e=e.slice(0,o)),e+=(e.indexOf("?")===-1?"?":"&")+n}return e}class _T{constructor(){this.handlers=[]}use(t,s,i){return this.handlers.push({fulfilled:t,rejected:s,synchronous:i?i.synchronous:!1,runWhen:i?i.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){R.forEach(this.handlers,function(i){i!==null&&t(i)})}}const gu=_T,mp={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},xT=typeof URLSearchParams<"u"?URLSearchParams:lh,vT=typeof FormData<"u"?FormData:null,yT=typeof Blob<"u"?Blob:null,ET=(()=>{let e;return typeof navigator<"u"&&((e=navigator.product)==="ReactNative"||e==="NativeScript"||e==="NS")?!1:typeof window<"u"&&typeof document<"u"})(),bT=(()=>typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),Qe={isBrowser:!0,classes:{URLSearchParams:xT,FormData:vT,Blob:yT},isStandardBrowserEnv:ET,isStandardBrowserWebWorkerEnv:bT,protocols:["http","https","file","blob","url","data"]};function TT(e,t){return Io(e,new Qe.classes.URLSearchParams,Object.assign({visitor:function(s,i,r,n){return Qe.isNode&&R.isBuffer(s)?(this.append(i,s.toString("base64")),!1):n.defaultVisitor.apply(this,arguments)}},t))}function wT(e){return R.matchAll(/\w+|\[(\w*)]/g,e).map(t=>t[0]==="[]"?"":t[1]||t[0])}function ST(e){const t={},s=Object.keys(e);let i;const r=s.length;let n;for(i=0;i<r;i++)n=s[i],t[n]=e[n];return t}function gp(e){function t(s,i,r,n){let o=s[n++];const a=Number.isFinite(+o),l=n>=s.length;return o=!o&&R.isArray(r)?r.length:o,l?(R.hasOwnProp(r,o)?r[o]=[r[o],i]:r[o]=i,!a):((!r[o]||!R.isObject(r[o]))&&(r[o]=[]),t(s,i,r[o],n)&&R.isArray(r[o])&&(r[o]=ST(r[o])),!a)}if(R.isFormData(e)&&R.isFunction(e.entries)){const s={};return R.forEachEntry(e,(i,r)=>{t(wT(i),r,s,0)}),s}return null}const AT={"Content-Type":void 0};function CT(e,t,s){if(R.isString(e))try{return(t||JSON.parse)(e),R.trim(e)}catch(i){if(i.name!=="SyntaxError")throw i}return(s||JSON.stringify)(e)}const Ro={transitional:mp,adapter:["xhr","http"],transformRequest:[function(t,s){const i=s.getContentType()||"",r=i.indexOf("application/json")>-1,n=R.isObject(t);if(n&&R.isHTMLForm(t)&&(t=new FormData(t)),R.isFormData(t))return r&&r?JSON.stringify(gp(t)):t;if(R.isArrayBuffer(t)||R.isBuffer(t)||R.isStream(t)||R.isFile(t)||R.isBlob(t))return t;if(R.isArrayBufferView(t))return t.buffer;if(R.isURLSearchParams(t))return s.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let a;if(n){if(i.indexOf("application/x-www-form-urlencoded")>-1)return TT(t,this.formSerializer).toString();if((a=R.isFileList(t))||i.indexOf("multipart/form-data")>-1){const l=this.env&&this.env.FormData;return Io(a?{"files[]":t}:t,l&&new l,this.formSerializer)}}return n||r?(s.setContentType("application/json",!1),CT(t)):t}],transformResponse:[function(t){const s=this.transitional||Ro.transitional,i=s&&s.forcedJSONParsing,r=this.responseType==="json";if(t&&R.isString(t)&&(i&&!this.responseType||r)){const o=!(s&&s.silentJSONParsing)&&r;try{return JSON.parse(t)}catch(a){if(o)throw a.name==="SyntaxError"?St.from(a,St.ERR_BAD_RESPONSE,this,null,this.response):a}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Qe.classes.FormData,Blob:Qe.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};R.forEach(["delete","get","head"],function(t){Ro.headers[t]={}});R.forEach(["post","put","patch"],function(t){Ro.headers[t]=R.merge(AT)});const hh=Ro,IT=R.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),RT=e=>{const t={};let s,i,r;return e&&e.split(`
`).forEach(function(o){r=o.indexOf(":"),s=o.substring(0,r).trim().toLowerCase(),i=o.substring(r+1).trim(),!(!s||t[s]&&IT[s])&&(s==="set-cookie"?t[s]?t[s].push(i):t[s]=[i]:t[s]=t[s]?t[s]+", "+i:i)}),t},_u=Symbol("internals");function sr(e){return e&&String(e).trim().toLowerCase()}function Cn(e){return e===!1||e==null?e:R.isArray(e)?e.map(Cn):String(e)}function PT(e){const t=Object.create(null),s=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let i;for(;i=s.exec(e);)t[i[1]]=i[2];return t}const MT=e=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim());function xa(e,t,s,i,r){if(R.isFunction(i))return i.call(this,t,s);if(r&&(t=s),!!R.isString(t)){if(R.isString(i))return t.indexOf(i)!==-1;if(R.isRegExp(i))return i.test(t)}}function OT(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,s,i)=>s.toUpperCase()+i)}function BT(e,t){const s=R.toCamelCase(" "+t);["get","set","has"].forEach(i=>{Object.defineProperty(e,i+s,{value:function(r,n,o){return this[i].call(this,t,r,n,o)},configurable:!0})})}class Po{constructor(t){t&&this.set(t)}set(t,s,i){const r=this;function n(a,l,h){const c=sr(l);if(!c)throw new Error("header name must be a non-empty string");const u=R.findKey(r,c);(!u||r[u]===void 0||h===!0||h===void 0&&r[u]!==!1)&&(r[u||l]=Cn(a))}const o=(a,l)=>R.forEach(a,(h,c)=>n(h,c,l));return R.isPlainObject(t)||t instanceof this.constructor?o(t,s):R.isString(t)&&(t=t.trim())&&!MT(t)?o(RT(t),s):t!=null&&n(s,t,i),this}get(t,s){if(t=sr(t),t){const i=R.findKey(this,t);if(i){const r=this[i];if(!s)return r;if(s===!0)return PT(r);if(R.isFunction(s))return s.call(this,r,i);if(R.isRegExp(s))return s.exec(r);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,s){if(t=sr(t),t){const i=R.findKey(this,t);return!!(i&&this[i]!==void 0&&(!s||xa(this,this[i],i,s)))}return!1}delete(t,s){const i=this;let r=!1;function n(o){if(o=sr(o),o){const a=R.findKey(i,o);a&&(!s||xa(i,i[a],a,s))&&(delete i[a],r=!0)}}return R.isArray(t)?t.forEach(n):n(t),r}clear(t){const s=Object.keys(this);let i=s.length,r=!1;for(;i--;){const n=s[i];(!t||xa(this,this[n],n,t,!0))&&(delete this[n],r=!0)}return r}normalize(t){const s=this,i={};return R.forEach(this,(r,n)=>{const o=R.findKey(i,n);if(o){s[o]=Cn(r),delete s[n];return}const a=t?OT(n):String(n).trim();a!==n&&delete s[n],s[a]=Cn(r),i[a]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const s=Object.create(null);return R.forEach(this,(i,r)=>{i!=null&&i!==!1&&(s[r]=t&&R.isArray(i)?i.join(", "):i)}),s}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,s])=>t+": "+s).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...s){const i=new this(t);return s.forEach(r=>i.set(r)),i}static accessor(t){const i=(this[_u]=this[_u]={accessors:{}}).accessors,r=this.prototype;function n(o){const a=sr(o);i[a]||(BT(r,o),i[a]=!0)}return R.isArray(t)?t.forEach(n):n(t),this}}Po.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);R.freezeMethods(Po.prototype);R.freezeMethods(Po);const ps=Po;function va(e,t){const s=this||hh,i=t||s,r=ps.from(i.headers);let n=i.data;return R.forEach(e,function(a){n=a.call(s,n,r.normalize(),t?t.status:void 0)}),r.normalize(),n}function _p(e){return!!(e&&e.__CANCEL__)}function Nr(e,t,s){St.call(this,e??"canceled",St.ERR_CANCELED,t,s),this.name="CanceledError"}R.inherits(Nr,St,{__CANCEL__:!0});function DT(e,t,s){const i=s.config.validateStatus;!s.status||!i||i(s.status)?e(s):t(new St("Request failed with status code "+s.status,[St.ERR_BAD_REQUEST,St.ERR_BAD_RESPONSE][Math.floor(s.status/100)-4],s.config,s.request,s))}const LT=Qe.isStandardBrowserEnv?function(){return{write:function(s,i,r,n,o,a){const l=[];l.push(s+"="+encodeURIComponent(i)),R.isNumber(r)&&l.push("expires="+new Date(r).toGMTString()),R.isString(n)&&l.push("path="+n),R.isString(o)&&l.push("domain="+o),a===!0&&l.push("secure"),document.cookie=l.join("; ")},read:function(s){const i=document.cookie.match(new RegExp("(^|;\\s*)("+s+")=([^;]*)"));return i?decodeURIComponent(i[3]):null},remove:function(s){this.write(s,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}();function FT(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}function NT(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}function xp(e,t){return e&&!FT(t)?NT(e,t):t}const UT=Qe.isStandardBrowserEnv?function(){const t=/(msie|trident)/i.test(navigator.userAgent),s=document.createElement("a");let i;function r(n){let o=n;return t&&(s.setAttribute("href",o),o=s.href),s.setAttribute("href",o),{href:s.href,protocol:s.protocol?s.protocol.replace(/:$/,""):"",host:s.host,search:s.search?s.search.replace(/^\?/,""):"",hash:s.hash?s.hash.replace(/^#/,""):"",hostname:s.hostname,port:s.port,pathname:s.pathname.charAt(0)==="/"?s.pathname:"/"+s.pathname}}return i=r(window.location.href),function(o){const a=R.isString(o)?r(o):o;return a.protocol===i.protocol&&a.host===i.host}}():function(){return function(){return!0}}();function kT(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}function GT(e,t){e=e||10;const s=new Array(e),i=new Array(e);let r=0,n=0,o;return t=t!==void 0?t:1e3,function(l){const h=Date.now(),c=i[n];o||(o=h),s[r]=l,i[r]=h;let u=n,d=0;for(;u!==r;)d+=s[u++],u=u%e;if(r=(r+1)%e,r===n&&(n=(n+1)%e),h-o<t)return;const p=c&&h-c;return p?Math.round(d*1e3/p):void 0}}function xu(e,t){let s=0;const i=GT(50,250);return r=>{const n=r.loaded,o=r.lengthComputable?r.total:void 0,a=n-s,l=i(a),h=n<=o;s=n;const c={loaded:n,total:o,progress:o?n/o:void 0,bytes:a,rate:l||void 0,estimated:l&&o&&h?(o-n)/l:void 0,event:r};c[t?"download":"upload"]=!0,e(c)}}const HT=typeof XMLHttpRequest<"u",$T=HT&&function(e){return new Promise(function(s,i){let r=e.data;const n=ps.from(e.headers).normalize(),o=e.responseType;let a;function l(){e.cancelToken&&e.cancelToken.unsubscribe(a),e.signal&&e.signal.removeEventListener("abort",a)}R.isFormData(r)&&(Qe.isStandardBrowserEnv||Qe.isStandardBrowserWebWorkerEnv)&&n.setContentType(!1);let h=new XMLHttpRequest;if(e.auth){const p=e.auth.username||"",f=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";n.set("Authorization","Basic "+btoa(p+":"+f))}const c=xp(e.baseURL,e.url);h.open(e.method.toUpperCase(),pp(c,e.params,e.paramsSerializer),!0),h.timeout=e.timeout;function u(){if(!h)return;const p=ps.from("getAllResponseHeaders"in h&&h.getAllResponseHeaders()),m={data:!o||o==="text"||o==="json"?h.responseText:h.response,status:h.status,statusText:h.statusText,headers:p,config:e,request:h};DT(function(v){s(v),l()},function(v){i(v),l()},m),h=null}if("onloadend"in h?h.onloadend=u:h.onreadystatechange=function(){!h||h.readyState!==4||h.status===0&&!(h.responseURL&&h.responseURL.indexOf("file:")===0)||setTimeout(u)},h.onabort=function(){h&&(i(new St("Request aborted",St.ECONNABORTED,e,h)),h=null)},h.onerror=function(){i(new St("Network Error",St.ERR_NETWORK,e,h)),h=null},h.ontimeout=function(){let f=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded";const m=e.transitional||mp;e.timeoutErrorMessage&&(f=e.timeoutErrorMessage),i(new St(f,m.clarifyTimeoutError?St.ETIMEDOUT:St.ECONNABORTED,e,h)),h=null},Qe.isStandardBrowserEnv){const p=(e.withCredentials||UT(c))&&e.xsrfCookieName&&LT.read(e.xsrfCookieName);p&&n.set(e.xsrfHeaderName,p)}r===void 0&&n.setContentType(null),"setRequestHeader"in h&&R.forEach(n.toJSON(),function(f,m){h.setRequestHeader(m,f)}),R.isUndefined(e.withCredentials)||(h.withCredentials=!!e.withCredentials),o&&o!=="json"&&(h.responseType=e.responseType),typeof e.onDownloadProgress=="function"&&h.addEventListener("progress",xu(e.onDownloadProgress,!0)),typeof e.onUploadProgress=="function"&&h.upload&&h.upload.addEventListener("progress",xu(e.onUploadProgress)),(e.cancelToken||e.signal)&&(a=p=>{h&&(i(!p||p.type?new Nr(null,e,h):p),h.abort(),h=null)},e.cancelToken&&e.cancelToken.subscribe(a),e.signal&&(e.signal.aborted?a():e.signal.addEventListener("abort",a)));const d=kT(c);if(d&&Qe.protocols.indexOf(d)===-1){i(new St("Unsupported protocol "+d+":",St.ERR_BAD_REQUEST,e));return}h.send(r||null)})},In={http:fT,xhr:$T};R.forEach(In,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});const WT={getAdapter:e=>{e=R.isArray(e)?e:[e];const{length:t}=e;let s,i;for(let r=0;r<t&&(s=e[r],!(i=R.isString(s)?In[s.toLowerCase()]:s));r++);if(!i)throw i===!1?new St(`Adapter ${s} is not supported by the environment`,"ERR_NOT_SUPPORT"):new Error(R.hasOwnProp(In,s)?`Adapter '${s}' is not available in the build`:`Unknown adapter '${s}'`);if(!R.isFunction(i))throw new TypeError("adapter is not a function");return i},adapters:In};function ya(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Nr(null,e)}function vu(e){return ya(e),e.headers=ps.from(e.headers),e.data=va.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),WT.getAdapter(e.adapter||hh.adapter)(e).then(function(i){return ya(e),i.data=va.call(e,e.transformResponse,i),i.headers=ps.from(i.headers),i},function(i){return _p(i)||(ya(e),i&&i.response&&(i.response.data=va.call(e,e.transformResponse,i.response),i.response.headers=ps.from(i.response.headers))),Promise.reject(i)})}const yu=e=>e instanceof ps?e.toJSON():e;function $i(e,t){t=t||{};const s={};function i(h,c,u){return R.isPlainObject(h)&&R.isPlainObject(c)?R.merge.call({caseless:u},h,c):R.isPlainObject(c)?R.merge({},c):R.isArray(c)?c.slice():c}function r(h,c,u){if(R.isUndefined(c)){if(!R.isUndefined(h))return i(void 0,h,u)}else return i(h,c,u)}function n(h,c){if(!R.isUndefined(c))return i(void 0,c)}function o(h,c){if(R.isUndefined(c)){if(!R.isUndefined(h))return i(void 0,h)}else return i(void 0,c)}function a(h,c,u){if(u in t)return i(h,c);if(u in e)return i(void 0,h)}const l={url:n,method:n,data:n,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:a,headers:(h,c)=>r(yu(h),yu(c),!0)};return R.forEach(Object.keys(e).concat(Object.keys(t)),function(c){const u=l[c]||r,d=u(e[c],t[c],c);R.isUndefined(d)&&u!==a||(s[c]=d)}),s}const vp="1.3.5",ch={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{ch[e]=function(i){return typeof i===e||"a"+(t<1?"n ":" ")+e}});const Eu={};ch.transitional=function(t,s,i){function r(n,o){return"[Axios v"+vp+"] Transitional option '"+n+"'"+o+(i?". "+i:"")}return(n,o,a)=>{if(t===!1)throw new St(r(o," has been removed"+(s?" in "+s:"")),St.ERR_DEPRECATED);return s&&!Eu[o]&&(Eu[o]=!0,console.warn(r(o," has been deprecated since v"+s+" and will be removed in the near future"))),t?t(n,o,a):!0}};function XT(e,t,s){if(typeof e!="object")throw new St("options must be an object",St.ERR_BAD_OPTION_VALUE);const i=Object.keys(e);let r=i.length;for(;r-- >0;){const n=i[r],o=t[n];if(o){const a=e[n],l=a===void 0||o(a,n,e);if(l!==!0)throw new St("option "+n+" must be "+l,St.ERR_BAD_OPTION_VALUE);continue}if(s!==!0)throw new St("Unknown option "+n,St.ERR_BAD_OPTION)}}const _l={assertOptions:XT,validators:ch},Ts=_l.validators;class Zn{constructor(t){this.defaults=t,this.interceptors={request:new gu,response:new gu}}request(t,s){typeof t=="string"?(s=s||{},s.url=t):s=t||{},s=$i(this.defaults,s);const{transitional:i,paramsSerializer:r,headers:n}=s;i!==void 0&&_l.assertOptions(i,{silentJSONParsing:Ts.transitional(Ts.boolean),forcedJSONParsing:Ts.transitional(Ts.boolean),clarifyTimeoutError:Ts.transitional(Ts.boolean)},!1),r!=null&&(R.isFunction(r)?s.paramsSerializer={serialize:r}:_l.assertOptions(r,{encode:Ts.function,serialize:Ts.function},!0)),s.method=(s.method||this.defaults.method||"get").toLowerCase();let o;o=n&&R.merge(n.common,n[s.method]),o&&R.forEach(["delete","get","head","post","put","patch","common"],f=>{delete n[f]}),s.headers=ps.concat(o,n);const a=[];let l=!0;this.interceptors.request.forEach(function(m){typeof m.runWhen=="function"&&m.runWhen(s)===!1||(l=l&&m.synchronous,a.unshift(m.fulfilled,m.rejected))});const h=[];this.interceptors.response.forEach(function(m){h.push(m.fulfilled,m.rejected)});let c,u=0,d;if(!l){const f=[vu.bind(this),void 0];for(f.unshift.apply(f,a),f.push.apply(f,h),d=f.length,c=Promise.resolve(s);u<d;)c=c.then(f[u++],f[u++]);return c}d=a.length;let p=s;for(u=0;u<d;){const f=a[u++],m=a[u++];try{p=f(p)}catch(_){m.call(this,_);break}}try{c=vu.call(this,p)}catch(f){return Promise.reject(f)}for(u=0,d=h.length;u<d;)c=c.then(h[u++],h[u++]);return c}getUri(t){t=$i(this.defaults,t);const s=xp(t.baseURL,t.url);return pp(s,t.params,t.paramsSerializer)}}R.forEach(["delete","get","head","options"],function(t){Zn.prototype[t]=function(s,i){return this.request($i(i||{},{method:t,url:s,data:(i||{}).data}))}});R.forEach(["post","put","patch"],function(t){function s(i){return function(n,o,a){return this.request($i(a||{},{method:t,headers:i?{"Content-Type":"multipart/form-data"}:{},url:n,data:o}))}}Zn.prototype[t]=s(),Zn.prototype[t+"Form"]=s(!0)});const Rn=Zn;class uh{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let s;this.promise=new Promise(function(n){s=n});const i=this;this.promise.then(r=>{if(!i._listeners)return;let n=i._listeners.length;for(;n-- >0;)i._listeners[n](r);i._listeners=null}),this.promise.then=r=>{let n;const o=new Promise(a=>{i.subscribe(a),n=a}).then(r);return o.cancel=function(){i.unsubscribe(n)},o},t(function(n,o,a){i.reason||(i.reason=new Nr(n,o,a),s(i.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const s=this._listeners.indexOf(t);s!==-1&&this._listeners.splice(s,1)}static source(){let t;return{token:new uh(function(r){t=r}),cancel:t}}}const zT=uh;function jT(e){return function(s){return e.apply(null,s)}}function VT(e){return R.isObject(e)&&e.isAxiosError===!0}const xl={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(xl).forEach(([e,t])=>{xl[t]=e});const YT=xl;function yp(e){const t=new Rn(e),s=ep(Rn.prototype.request,t);return R.extend(s,Rn.prototype,t,{allOwnKeys:!0}),R.extend(s,t,null,{allOwnKeys:!0}),s.create=function(r){return yp($i(e,r))},s}const Zt=yp(hh);Zt.Axios=Rn;Zt.CanceledError=Nr;Zt.CancelToken=zT;Zt.isCancel=_p;Zt.VERSION=vp;Zt.toFormData=Io;Zt.AxiosError=St;Zt.Cancel=Zt.CanceledError;Zt.all=function(t){return Promise.all(t)};Zt.spread=jT;Zt.isAxiosError=VT;Zt.mergeConfig=$i;Zt.AxiosHeaders=ps;Zt.formToJSON=e=>gp(R.isHTMLForm(e)?new FormData(e):e);Zt.HttpStatusCode=YT;Zt.default=Zt;const Ep=Zt;Ep.defaults.baseURL="/sceneSetups/";const KT=e=>{const t=e.sceneWidth,s=e.sceneHeight,i=new Map;for(const r of e.thingsMap){const n={species:r.species,name:r.name},o=new Array;for(const a of r.thingSetup){const l={defaultBlockX:a.defaultBlockX,defaultBlockY:a.defaultBlockY,textureName:a.textureName,defaultTowards:a.defaultTowards};o.push(l)}i.set(n,o)}return{id:e.id,name:e.name,sceneWidth:t,sceneHeight:s,thingsMap:i}},qT=async e=>{try{const{data:t}=await Ep.get(e);return t}catch(t){throw new Error("Error occurred while loading JSON from local"+t)}},ZT=async e=>KT(await qT(e));class dh extends zf{constructor(){super();W(this,"_runningCommand",!1);W(this,"_isActive",!1);W(this,"_pendingInstructions");W(this,"_needScanRule",!1);W(this,"_existYou",!0);W(this,"commandListener");this._pendingInstructions=new Xf,this.commandListener={observeId:ai(),update:async()=>{await this._run()}}}_setRunning(){this._runningCommand=!0}_setNotRunning(){this._runningCommand=!1}enableService(){this._isActive=!0}disableService(){this._isActive=!1}static _judgementInstructionPriority(s){const i=s.getPriority();return i||Date.now()}addInstructions(s){for(const i of s){const r=dh._judgementInstructionPriority(i);this._pendingInstructions.add(i,r)}}_nextInstruction(){const s=this._pendingInstructions.poll();return s?Qt(s):Mt}needScanRule(){this._needScanRule=!0}async _executeInstructions(){let s=this._nextInstruction();for(;qe(s);)await s.value.perform(),s=this._nextInstruction()}async _run(){const s=V.nextCommand();if(!this._isActive||this._runningCommand||Tt(s))return;this._setRunning(),this.setChanged(),await this.notifyObservers(s.value),await this._executeInstructions(),this._needScanRule&&(V.getRuleController().refreshAll(),V.getScanner().findRulesFromMap(V.getAppEdge()),await V.getRuleController().processImmediateChanges(),this._needScanRule=!1),await this._executeInstructions();const i=await V.getRuleController().checkYouExistsInLevel();i!==this._existYou&&(this._existYou=i,setTimeout(()=>{Tp(this._existYou)},2e3)),this._setNotRunning()}}const JT=()=>new dh;class QT{constructor(t){W(this,"_features");W(this,"_patterns");W(this,"_mapController");this._features=new Map,this._patterns=new Map,this._mapController=t,this._giveDefaultRules()}refreshAll(){this._features.clear(),this._giveDefaultRules()}_giveDefaultRules(){const t={_is:[{feature:bt.PUSH,on:[],near:[],facing:[]}],_has:[],_make:[]},s=[...Object.values(rh),...Object.values(bt),...Object.values(Ot)];for(const i of s)this._features.set(i,t)}async processImmediateChanges(){const t=new Map;this._features.forEach((i,r)=>{const n=i._is.filter(o=>qf(o.feature));t.set(r,n)}),await this._mapController.appendTransformInstructions(t);const s=new Map;this._features.forEach((i,r)=>{const n=i._is.filter(o=>{switch(o.feature){case bt.MOVE:case bt.TELE:return!0;default:return!1}});s.set(r,n)}),await this._mapController.processMoveInstructions(s)}async checkYouExistsInLevel(){const t=[];return this._features.forEach((s,i)=>{for(const r of s._is)if(r.feature===bt.YOU){t.push(i);break}}),t.length===0?!1:await this._mapController.checkYouExistsInMap(t)}$is(t,s){const i=t.name,r=this._features.get(i);if(!r)return!1;const n=!!r._is.find(o=>o.feature===s);return!!(r&&n)}$has(t,s){const i=t.name,r=this._features.get(i);if(!r)return!1;const n=!!r._has.find(o=>o.feature===s);return!!(r&&n)}$make(t,s){const i=t.name,r=this._features.get(i);if(!r)return!1;const n=!!r._make.find(o=>o.feature===s);return!!(r&&n)}getFeaturesOfThing(t,s){if(t.species!==Ht.CHARACTERS)throw new Error('[MY FAULT] Feature "getFeaturesOfThings" for Text-type things are not implemented yet');const i=t.name;if(!this._features.has(i))return Mt;const r=this._features.get(i);if(!r)throw new Error(`Thing ${i} in featureList has unexpected undefined value`);switch(s){case Ot.IS:return Qt(r._is);case Ot.HAS:return Qt(r._has);case Ot.MAKE:return Qt(r._make);default:throw new Error(`operator ${s} should be a verb (OperatorType.IS, OperatorType.HAS, OperatorType.MAKE) instead of an adjective`)}}addFeature(t,s,i){if(!this._features.has(t)){const r={_is:[],_has:[],_make:[]};this._features.set(t,r)}switch(s){case Ot.IS:this._features.get(t)._is.push(i);break;case Ot.HAS:this._features.get(t)._has.push(i);break;case Ot.MAKE:this._features.get(t)._make.push(i);break;default:throw new Error(`operator ${s} should be a verb (OperatorType.IS, OperatorType.HAS, OperatorType.MAKE) instead of an adjective`)}}removeFeature(t,s,i){if(!this._features.has(t))throw new Error(`thingType ${t} not been recorded yet`);let r=-1;switch(s){case Ot.IS:if(r=this._features.get(t)._is.indexOf(i),r===-1)throw new Error(`thingType ${t} does not contain feature ${i}`);this._features.get(t)._is.splice(r,1);break;case Ot.HAS:if(r=this._features.get(t)._has.indexOf(i),r===-1)throw new Error(`thingType ${t} does not contain feature ${i}`);this._features.get(t)._has.splice(r,1);break;case Ot.MAKE:if(r=this._features.get(t)._make.indexOf(i),r===-1)throw new Error(`thingType ${t} does not contain feature ${i}`);this._features.get(t)._make.splice(r,1);break;default:throw new Error(`operator ${s} should be a verb (OperatorType.IS, OperatorType.HAS, OperatorType.MAKE) instead of an adjective`)}}}const tw=e=>new QT(e);class ew{constructor(t,s){W(this,"_ruleController");W(this,"_mapController");this._ruleController=t,this._mapController=s}scanRule(t,s,i,r,n){if(n===O.LEFT||n===O.TOP)throw new Error(`scan direction ${n} should be Direction.RIGHT or Direction.DOWN`);const o=[Ot.IS,Ot.HAS,Ot.MAKE],a=[Ot.ON,Ot.NEAR,Ot.FACING];let l=t,h=s,c=!1;const u={primaryCharacters:Mt,conditionSettings:Mt,effectRules:Mt};for(;;){if(l>=i||h>=r)return Mt;const b=this._mapController.whoAreThere(l,h);if(Tt(b))return Mt;if(c){let g=!1;for(const E of b.value)if(E.name===Ot.AND){g=!0;break}if(!g)break}else{let g=!1;for(const E of b.value)if(E.species===Ht.NOUNS)if(Tt(u.primaryCharacters)&&(u.primaryCharacters=Qt([])),qe(u.primaryCharacters)){const C=E.name;u.primaryCharacters.value.push(C),g=!0}else throw new Error("unexpected error cause by rulePattern.primaryCharacters is not a some value");if(!g)return Mt}c=!c,n===O.RIGHT&&l++,n===O.DOWN&&h++}c=!1;let d=!1,p=!0,f=Mt;for(;;){if(l>=i||h>=r)return Mt;const b=this._mapController.whoAreThere(l,h);if(Tt(b))return Mt;const g=(E,S)=>{if(!a.includes(S))throw new Error(`currentAdj ${S} was passed in as unacceptable OperatorType`);const C=E.name;if(Tt(u.conditionSettings)&&(u.conditionSettings=Qt(new Map)),qe(u.conditionSettings))if(u.conditionSettings.value.has(S)){const T=u.conditionSettings.value.get(S);T&&(T.push(C),u.conditionSettings.value.set(S,T))}else u.conditionSettings.value.set(S,[C]);else throw new Error("unexpected error cause by rulePattern.conditionSettings is not a some value")};if(p&&d)for(const E of b.value){const S=E.species;if(S===Ht.NOUNS){if(Tt(f))throw new Error(`adjective ${f} should not be none`);if(!a.includes(f.value))throw new Error(`currentAdj ${f} should be an adjective operator`);g(E,f.value),d=!1,p=!1,c=!0}if(S===Ht.OPERATORS){const C=E.name;if(a.includes(C))f=Qt(C),d=!0,p=!1,c=!1;else return Mt}}else if(p){let E=!1,S=!1;for(const C of b.value)if(C.species===Ht.OPERATORS){const y=C.name;if(y===Ot.AND)return Mt;if(a.includes(y))f=Qt(y),E=!0;else if(o.includes(y)){S=!0;break}}if(S)break;if(!E)return Mt;p=!1,d=!0}else if(d)for(const E of b.value){if(E.species===Ht.NOUNS){if(Tt(f))throw new Error(`adjective ${f} should not be none`);if(!a.includes(f.value))throw new Error(`currentAdj ${f} should be an adjective operator`);g(E,f.value)}else return Mt;c=!0,d=!1}else if(c){let E=!1;for(const S of b.value)if(S.species===Ht.OPERATORS){const T=S.name;if(T!==Ot.AND)return Mt;if(o.includes(T)){E=!1;break}}else return Mt;if(E)break;c=!1,p=!0,d=!0}else throw new Error("unexpected error occurred caused by nonexistent scan condition");n===O.RIGHT&&l++,n===O.DOWN&&h++}c=!1;let m=!1,_=!0,v=Mt;for(;!(l>=i||h>=r);){const b=this._mapController.whoAreThere(l,h);if(Tt(b))break;const g=(S,C)=>{if(!o.includes(C))throw new Error(`currentVerb ${C} was passed in as unacceptable OperatorType`);const T=S.name;if(Tt(u.effectRules)&&(u.effectRules=Qt(new Map)),qe(u.effectRules))if(u.effectRules.value.has(C)){const y=u.effectRules.value.get(C);y&&(y.push(T),u.effectRules.value.set(C,y))}else u.effectRules.value.set(C,[T]);else throw new Error("unexpected error cause by rulePattern.effectRules is not a some value")};let E=!1;if(_&&m){let S=!1;for(const C of b.value){const T=C.species;if(T===Ht.OPERATORS){const y=C.name;o.includes(y)&&(v=Qt(y),S=!0)}else if(T===Ht.PROPERTIES){if(Tt(v))throw new Error(`verb ${v} should not be none`);v.value===Ot.IS&&(g(C,v.value),S=!0)}else if(T===Ht.NOUNS){if(Tt(v))throw new Error(`verb ${v} should not be none`);if(!o.includes(v.value))throw new Error(`currentVerb ${v} should be a verb operator`);g(C,v.value),S=!0}}S||(E=!0)}else if(_){let S=!1;for(const C of b.value)if(C.species===Ht.OPERATORS){const y=C.name;o.includes(y)&&(v=Qt(y),S=!0)}if(!S)return Mt;m=!0,_=!1}else if(m){let S=!1;for(const C of b.value){if(Tt(v))throw new Error(`verb ${v} should not be none`);if(!o.includes(v.value))throw new Error(`currentVerb ${v} should be a verb operator`);const T=C.species;(T===Ht.PROPERTIES&&v.value===Ot.IS||T===Ht.NOUNS)&&(g(C,v.value),S=!0)}S||(E=!0),m=!1,c=!0}else if(c){let S=!1;for(const C of b.value)C.name===Ot.AND&&(S=!0);S||(E=!0),c=!1,_=!0,m=!0}else return Mt;if(n===O.RIGHT&&l++,n===O.DOWN&&h++,E)break}return Qt(u)}addRulesFromRulePattern(t){if(Tt(t.primaryCharacters)||Tt(t.effectRules))return;const s=[Ot.IS,Ot.HAS,Ot.MAKE];for(const i of t.primaryCharacters.value){const r=Kf(i);for(const n of s){const o=t.effectRules.value.get(n);if(o)for(const a of o){const l={feature:a,on:[],near:[],facing:[]};qe(t.conditionSettings)&&(l.on=t.conditionSettings.value.get(Ot.ON)||[],l.near=t.conditionSettings.value.get(Ot.NEAR)||[],l.facing=t.conditionSettings.value.get(Ot.FACING)||[]),this._ruleController.addFeature(r,n,l)}}}}findRulesFromMap(t){const s=t.maxX+1,i=t.maxY+1;for(let r=0;r<s;r++)for(let n=0;n<i;n++){const o=this._mapController.whoAreThere(r,n);if(!Tt(o)){for(const a of o.value)if(a.species===Ht.NOUNS){const l=this.scanRule(r,n,s,i,O.RIGHT);qe(l)&&this.addRulesFromRulePattern(l.value);const h=this.scanRule(r,n,s,i,O.DOWN);qe(h)&&this.addRulesFromRulePattern(h.value)}}}}}const sw=(e,t)=>new ew(e,t),iw=async e=>{const t=V.getStageBuilder();V.getDispatchServer()&&V.disposeDispatchServer(),await V.loadResources(BE);const s=Db();V.setMapController(s);const i=tw(s);V.setRuleController(i);const r=sw(i,s);V.setScanner(r);const n=JT();V.setDispatchServer(n),V.connectDispatchListener(n.commandListener),await t.removeScene();const o=await ZT(e);await t.addGameScene(o),V.initDispatchServer(),V.initCommandWatchService()};let bp,Tp;const rw=e=>{Tp=async t=>{await e(t)}},nw=e=>{bp=async t=>{const s=V.getStageBuilder();V.disposeDispatchServer(),await Hi(300),await e(t),await s.removeScene()}},ow=()=>{V.disposeDispatchServer()},aw=()=>{V.initDispatchServer()};var wp=(e=>(e.WIN="WIN",e.LEAVE="LEAVE",e.RESTART="RESTART",e))(wp||{});class lw extends vs{async perform(){await Hi(oi),await bp(wp.WIN)}async unperform(){return Promise.reject()}}const bu=(e,t)=>{const s=new lw(e);s.setPriority(9999999999999),t.addNewInstruction(s),t.pushInstructions()};class vl extends vs{async perform(){await Hi(oi),this._subject.thingController.disconnect(),await V.getMapController().update(this._subject,Se.DISAPPEAR),await V.getContainerBuilder().removeThingFromGameScene(this._subject)}async unperform(){await Hi(oi),await V.getMapController().update(this._subject,Se.APPEAR)}}const gi=async(e,t)=>{const s=new vl(e);s.setPriority(9999999990001),t.addNewInstruction(s),t.pushInstructions()},pn=async(e,t,s)=>{const i=new vl(e),r=new vl(t);i.setPriority(9999999990001),r.setPriority(9999999990001),s.addNewInstruction(i),s.addNewInstruction(r),s.pushInstructions()},hw=async(e,t,s,i)=>{const n=V.getRuleController(),o=V.getMapController(),a=n.$is(e,bt.YOU)||n.$is(e,bt.YOU2),l=n.$is(t,bt.YOU)||n.$is(t,bt.YOU2),h=n.$is(e,bt.FLOAT),c=n.$is(t,bt.FLOAT),u=h===c,d=n.$is(e,bt.WIN),p=n.$is(t,bt.WIN);if(a&&d||l&&p||h===c&&(d&&l||p&&a))return bu(e,i),!0;if(n.$is(e,bt.PUSH))return await Cb(e,o,s)?(Lb(e,s,i),!0):!1;const m=n.$is(e,bt.OPEN),_=n.$is(t,bt.OPEN);if(m&&n.$is(t,bt.SHUT))return await pn(e,t,i),!0;if(_&&n.$is(e,bt.SHUT))return await pn(e,t,i),!0;const v=n.$is(e,bt.WEAK),b=n.$is(t,bt.WEAK);if(v&&b)return await pn(e,t,i),!0;if(v)return await gi(e,i),!0;if(b)return await gi(t,i),!0;if(v?!1:n.$is(e,bt.STOP))return!1;if(u){const B=n.$is(e,bt.SINK),F=n.$is(t,bt.SINK);if(B||F)return await pn(e,t,i),!0}const E=n.$is(e,bt.DEFEAT),S=n.$is(t,bt.DEFEAT);if(u){if(E&&l)return await gi(t,i),!0;if(S&&a)return await gi(e,i),!0}const C=n.$is(e,bt.HOT),T=n.$is(t,bt.HOT),y=n.$is(e,bt.MELT),I=n.$is(t,bt.MELT);if(u){if(C&&I)return await gi(t,i),!0;if(T&&y)return await gi(e,i),!0}return!0};var si=Object.freeze({Linear:Object.freeze({None:function(e){return e},In:function(e){return this.None(e)},Out:function(e){return this.None(e)},InOut:function(e){return this.None(e)}}),Quadratic:Object.freeze({In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}}),Cubic:Object.freeze({In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}}),Quartic:Object.freeze({In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}}),Quintic:Object.freeze({In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}}),Sinusoidal:Object.freeze({In:function(e){return 1-Math.sin((1-e)*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return .5*(1-Math.sin(Math.PI*(.5-e)))}}),Exponential:Object.freeze({In:function(e){return e===0?0:Math.pow(1024,e-1)},Out:function(e){return e===1?1:1-Math.pow(2,-10*e)},InOut:function(e){return e===0?0:e===1?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(-Math.pow(2,-10*(e-1))+2)}}),Circular:Object.freeze({In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}}),Elastic:Object.freeze({In:function(e){return e===0?0:e===1?1:-Math.pow(2,10*(e-1))*Math.sin((e-1.1)*5*Math.PI)},Out:function(e){return e===0?0:e===1?1:Math.pow(2,-10*e)*Math.sin((e-.1)*5*Math.PI)+1},InOut:function(e){return e===0?0:e===1?1:(e*=2,e<1?-.5*Math.pow(2,10*(e-1))*Math.sin((e-1.1)*5*Math.PI):.5*Math.pow(2,-10*(e-1))*Math.sin((e-1.1)*5*Math.PI)+1)}}),Back:Object.freeze({In:function(e){var t=1.70158;return e===1?1:e*e*((t+1)*e-t)},Out:function(e){var t=1.70158;return e===0?0:--e*e*((t+1)*e+t)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?.5*(e*e*((t+1)*e-t)):.5*((e-=2)*e*((t+1)*e+t)+2)}}),Bounce:Object.freeze({In:function(e){return 1-si.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?si.Bounce.In(e*2)*.5:si.Bounce.Out(e*2-1)*.5+.5}}),generatePow:function(e){return e===void 0&&(e=4),e=e<Number.EPSILON?Number.EPSILON:e,e=e>1e4?1e4:e,{In:function(t){return Math.pow(t,e)},Out:function(t){return 1-Math.pow(1-t,e)},InOut:function(t){return t<.5?Math.pow(t*2,e)/2:(1-Math.pow(2-t*2,e))/2+.5}}}}),cr;typeof self>"u"&&typeof process<"u"&&process.hrtime?cr=function(){var e=process.hrtime();return e[0]*1e3+e[1]/1e6}:typeof self<"u"&&self.performance!==void 0&&self.performance.now!==void 0?cr=self.performance.now.bind(self.performance):Date.now!==void 0?cr=Date.now:cr=function(){return new Date().getTime()};var ur=cr,cw=function(){function e(){this._tweens={},this._tweensAddedDuringUpdate={}}return e.prototype.getAll=function(){var t=this;return Object.keys(this._tweens).map(function(s){return t._tweens[s]})},e.prototype.removeAll=function(){this._tweens={}},e.prototype.add=function(t){this._tweens[t.getId()]=t,this._tweensAddedDuringUpdate[t.getId()]=t},e.prototype.remove=function(t){delete this._tweens[t.getId()],delete this._tweensAddedDuringUpdate[t.getId()]},e.prototype.update=function(t,s){t===void 0&&(t=ur()),s===void 0&&(s=!1);var i=Object.keys(this._tweens);if(i.length===0)return!1;for(;i.length>0;){this._tweensAddedDuringUpdate={};for(var r=0;r<i.length;r++){var n=this._tweens[i[r]],o=!s;n&&n.update(t,o)===!1&&!s&&delete this._tweens[i[r]]}i=Object.keys(this._tweensAddedDuringUpdate)}return!0},e}(),wi={Linear:function(e,t){var s=e.length-1,i=s*t,r=Math.floor(i),n=wi.Utils.Linear;return t<0?n(e[0],e[1],i):t>1?n(e[s],e[s-1],s-i):n(e[r],e[r+1>s?s:r+1],i-r)},Bezier:function(e,t){for(var s=0,i=e.length-1,r=Math.pow,n=wi.Utils.Bernstein,o=0;o<=i;o++)s+=r(1-t,i-o)*r(t,o)*e[o]*n(i,o);return s},CatmullRom:function(e,t){var s=e.length-1,i=s*t,r=Math.floor(i),n=wi.Utils.CatmullRom;return e[0]===e[s]?(t<0&&(r=Math.floor(i=s*(1+t))),n(e[(r-1+s)%s],e[r],e[(r+1)%s],e[(r+2)%s],i-r)):t<0?e[0]-(n(e[0],e[0],e[1],e[1],-i)-e[0]):t>1?e[s]-(n(e[s],e[s],e[s-1],e[s-1],i-s)-e[s]):n(e[r?r-1:0],e[r],e[s<r+1?s:r+1],e[s<r+2?s:r+2],i-r)},Utils:{Linear:function(e,t,s){return(t-e)*s+e},Bernstein:function(e,t){var s=wi.Utils.Factorial;return s(e)/s(t)/s(e-t)},Factorial:function(){var e=[1];return function(t){var s=1;if(e[t])return e[t];for(var i=t;i>1;i--)s*=i;return e[t]=s,s}}(),CatmullRom:function(e,t,s,i,r){var n=(s-e)*.5,o=(i-t)*.5,a=r*r,l=r*a;return(2*t-2*s+n+o)*l+(-3*t+3*s-2*n-o)*a+n*r+t}}},uw=function(){function e(){}return e.nextId=function(){return e._nextId++},e._nextId=0,e}(),yl=new cw,Tu=function(){function e(t,s){s===void 0&&(s=yl),this._object=t,this._group=s,this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=si.Linear.None,this._interpolationFunction=wi.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._id=uw.nextId(),this._isChainStopped=!1,this._goToEnd=!1}return e.prototype.getId=function(){return this._id},e.prototype.isPlaying=function(){return this._isPlaying},e.prototype.isPaused=function(){return this._isPaused},e.prototype.to=function(t,s){return this._valuesEnd=Object.create(t),s!==void 0&&(this._duration=s),this},e.prototype.duration=function(t){return t===void 0&&(t=1e3),this._duration=t,this},e.prototype.start=function(t,s){if(t===void 0&&(t=ur()),s===void 0&&(s=!1),this._isPlaying)return this;if(this._group&&this._group.add(this),this._repeat=this._initialRepeat,this._reversed){this._reversed=!1;for(var i in this._valuesStartRepeat)this._swapEndStartRepeatValues(i),this._valuesStart[i]=this._valuesStartRepeat[i]}return this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=t,this._startTime+=this._delayTime,this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat,s),this},e.prototype.startFromCurrentValues=function(t){return this.start(t,!0)},e.prototype._setupProperties=function(t,s,i,r,n){for(var o in i){var a=t[o],l=Array.isArray(a),h=l?"array":typeof a,c=!l&&Array.isArray(i[o]);if(!(h==="undefined"||h==="function")){if(c){var u=i[o];if(u.length===0)continue;u=u.map(this._handleRelativeValue.bind(this,a)),s[o]===void 0&&(i[o]=[a].concat(u))}if((h==="object"||l)&&a&&!c){s[o]=l?[]:{};for(var d in a)s[o][d]=a[d];r[o]=l?[]:{},this._setupProperties(a,s[o],i[o],r[o],n)}else(typeof s[o]>"u"||n)&&(s[o]=a),l||(s[o]*=1),c?r[o]=i[o].slice().reverse():r[o]=s[o]||0}}},e.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._group&&this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},e.prototype.end=function(){return this._goToEnd=!0,this.update(1/0),this},e.prototype.pause=function(t){return t===void 0&&(t=ur()),this._isPaused||!this._isPlaying?this:(this._isPaused=!0,this._pauseStart=t,this._group&&this._group.remove(this),this)},e.prototype.resume=function(t){return t===void 0&&(t=ur()),!this._isPaused||!this._isPlaying?this:(this._isPaused=!1,this._startTime+=t-this._pauseStart,this._pauseStart=0,this._group&&this._group.add(this),this)},e.prototype.stopChainedTweens=function(){for(var t=0,s=this._chainedTweens.length;t<s;t++)this._chainedTweens[t].stop();return this},e.prototype.group=function(t){return t===void 0&&(t=yl),this._group=t,this},e.prototype.delay=function(t){return t===void 0&&(t=0),this._delayTime=t,this},e.prototype.repeat=function(t){return t===void 0&&(t=0),this._initialRepeat=t,this._repeat=t,this},e.prototype.repeatDelay=function(t){return this._repeatDelayTime=t,this},e.prototype.yoyo=function(t){return t===void 0&&(t=!1),this._yoyo=t,this},e.prototype.easing=function(t){return t===void 0&&(t=si.Linear.None),this._easingFunction=t,this},e.prototype.interpolation=function(t){return t===void 0&&(t=wi.Linear),this._interpolationFunction=t,this},e.prototype.chain=function(){for(var t=[],s=0;s<arguments.length;s++)t[s]=arguments[s];return this._chainedTweens=t,this},e.prototype.onStart=function(t){return this._onStartCallback=t,this},e.prototype.onEveryStart=function(t){return this._onEveryStartCallback=t,this},e.prototype.onUpdate=function(t){return this._onUpdateCallback=t,this},e.prototype.onRepeat=function(t){return this._onRepeatCallback=t,this},e.prototype.onComplete=function(t){return this._onCompleteCallback=t,this},e.prototype.onStop=function(t){return this._onStopCallback=t,this},e.prototype.update=function(t,s){if(t===void 0&&(t=ur()),s===void 0&&(s=!0),this._isPaused)return!0;var i,r,n=this._startTime+this._duration;if(!this._goToEnd&&!this._isPlaying){if(t>n)return!1;s&&this.start(t,!0)}if(this._goToEnd=!1,t<this._startTime)return!0;this._onStartCallbackFired===!1&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),this._onEveryStartCallbackFired===!1&&(this._onEveryStartCallback&&this._onEveryStartCallback(this._object),this._onEveryStartCallbackFired=!0),r=(t-this._startTime)/this._duration,r=this._duration===0||r>1?1:r;var o=this._easingFunction(r);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,o),this._onUpdateCallback&&this._onUpdateCallback(this._object,r),r===1)if(this._repeat>0){isFinite(this._repeat)&&this._repeat--;for(i in this._valuesStartRepeat)!this._yoyo&&typeof this._valuesEnd[i]=="string"&&(this._valuesStartRepeat[i]=this._valuesStartRepeat[i]+parseFloat(this._valuesEnd[i])),this._yoyo&&this._swapEndStartRepeatValues(i),this._valuesStart[i]=this._valuesStartRepeat[i];return this._yoyo&&(this._reversed=!this._reversed),this._repeatDelayTime!==void 0?this._startTime=t+this._repeatDelayTime:this._startTime=t+this._delayTime,this._onRepeatCallback&&this._onRepeatCallback(this._object),this._onEveryStartCallbackFired=!1,!0}else{this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var a=0,l=this._chainedTweens.length;a<l;a++)this._chainedTweens[a].start(this._startTime+this._duration,!1);return this._isPlaying=!1,!1}return!0},e.prototype._updateProperties=function(t,s,i,r){for(var n in i)if(s[n]!==void 0){var o=s[n]||0,a=i[n],l=Array.isArray(t[n]),h=Array.isArray(a),c=!l&&h;c?t[n]=this._interpolationFunction(a,r):typeof a=="object"&&a?this._updateProperties(t[n],o,a,r):(a=this._handleRelativeValue(o,a),typeof a=="number"&&(t[n]=o+(a-o)*r))}},e.prototype._handleRelativeValue=function(t,s){return typeof s!="string"?s:s.charAt(0)==="+"||s.charAt(0)==="-"?t+parseFloat(s):parseFloat(s)},e.prototype._swapEndStartRepeatValues=function(t){var s=this._valuesStartRepeat[t],i=this._valuesEnd[t];typeof i=="string"?this._valuesStartRepeat[t]=this._valuesStartRepeat[t]+parseFloat(i):this._valuesStartRepeat[t]=this._valuesEnd[t],this._valuesEnd[t]=s},e}(),rs=yl;rs.getAll.bind(rs);rs.removeAll.bind(rs);rs.add.bind(rs);rs.remove.bind(rs);var wu=rs.update.bind(rs);class dw extends Yn{constructor(s,i,r,n,o,a,l,h,c){super(r);W(this,"_id");W(this,"_species");W(this,"_blockX");W(this,"_blockY");W(this,"_maxBlockX");W(this,"_maxBlockY");W(this,"_blockSize");W(this,"_towards");W(this,"thingController");this._id=ai(),this.name=s,this._species=i,this._blockX=n,this._blockY=o,this._maxBlockX=l,this._maxBlockY=h,this._towards=c??0,this.updateTowards(this._towards),this._blockSize=a,this.height=a,this.width=a,this.anchor.set(.5),this.x=(this._blockX+.5)*this._blockSize,this.y=(this._blockY+.5)*this._blockSize,super.animationSpeed=.08,super.play()}bindThingController(s){this.thingController=s}setup(s){this.blockX=s.defaultBlockX,this.blockY=s.defaultBlockY,this.updateTowards(s.defaultTowards)}get blockX(){return Number(this._blockX)}set blockX(s){this._blockX=s;const i={x:this.x},r={x:(s+.5)*this._blockSize};let n=0;const o=a=>{n=requestAnimationFrame(o),wu(a)};n=requestAnimationFrame(o),new Tu(i).to(r,oi).onUpdate(()=>this.x=i.x).easing(si.Quadratic.Out).onComplete(()=>cancelAnimationFrame(n)).start()}get blockY(){return Number(this._blockY)}set blockY(s){this._blockY=s;const i={y:this.y},r={y:(s+.5)*this._blockSize};let n=0;const o=a=>{n=requestAnimationFrame(o),wu(a)};n=requestAnimationFrame(o),new Tu(i).to(r,oi).easing(si.Quadratic.Out).onUpdate(()=>this.y=i.y).onComplete(()=>cancelAnimationFrame(n)).start()}updateTowards(s){switch(s){case O.LEFT:this.scale.x=-1*Math.abs(this.scale.x);break;case O.RIGHT:this.scale.x=Math.abs(this.scale.x);break}this.towards=s}set towards(s){this._towards=s}get towards(){return this._towards}get id(){return this._id}get species(){return this._species}atRightEdge(){return this.blockX===this._maxBlockX}atLeftEdge(){return this.blockX===0}atTopEdge(){return this.blockY===0}atBottomEdge(){return this.blockY===this._maxBlockY}async moveUp(){await new Promise((s,i)=>{this.atTopEdge()?i():this.blockY--,s()})}async moveDown(){await new Promise((s,i)=>{this.atBottomEdge()?i():this.blockY++,s()})}async moveRight(){await new Promise((s,i)=>{this.atRightEdge()?i():this.blockX++,s()})}async moveLeft(){await new Promise((s,i)=>{this.atLeftEdge()?i():this.blockX--,s()})}async reverseTowards(){await new Promise((s,i)=>{this.towards===O.UNDEFINED?i():(this.updateTowards(Ao(this.towards)),s())})}handleBeside(){return Promise.resolve(void 0)}async handleEncounter(s,i){return await hw(this,s,i,this.thingController)}handleLeave(){return Promise.resolve(void 0)}}class fw{constructor(t,s){W(this,"_species");W(this,"_name");this._species=t,this._name=s}createInstance(t,s,i,r,n,o,a,l,h){return new dw(t,s,i,r,n,o,a,l,h)}}class mn extends vs{constructor(s,i){super(s);W(this,"_towards");this._towards=i}async perform(){this._subject.updateTowards(this._towards)}async unperform(){this._subject.updateTowards(Ao(this._towards))}}class pw{constructor(t){W(this,"observeId");W(this,"_instructions");W(this,"_thing");this.observeId=ai(),this._instructions=[],V.getDispatchServer().addObserver(this),this._thing=t,this._thing.bindThingController(this),V.getMapController().update(this._thing,Se.APPEAR).then()}clearInstructions(){this._instructions=[]}addNewInstruction(t){this._instructions.push(t)}pushInstructions(){V.getDispatchServer().addInstructions(this._instructions),this.clearInstructions()}async update(t,s){if(!(V.getRuleController().$is(this._thing,bt.YOU)||V.getRuleController().$is(this._thing,bt.YOU2))||!await V.getMapController().canIEncounter(this._thing,(()=>{switch(s.value){case hs.UP:return O.TOP;case hs.DOWN:return O.DOWN;case hs.LEFT:return O.LEFT;case hs.RIGHT:return O.RIGHT;default:return O.UNDEFINED}})()))return;let n;switch(s.value){case hs.UP:n=new Is.MoveUpInstruction(this._thing),this._thing.species===Ht.CHARACTERS&&this.addNewInstruction(new mn(this._thing,O.TOP));break;case hs.DOWN:n=new Is.MoveDownInstruction(this._thing),this._thing.species===Ht.CHARACTERS&&this.addNewInstruction(new mn(this._thing,O.DOWN));break;case hs.LEFT:n=new Is.MoveLeftInstruction(this._thing),this._thing.species===Ht.CHARACTERS&&this.addNewInstruction(new mn(this._thing,O.LEFT));break;case hs.RIGHT:n=new Is.MoveRightInstruction(this._thing),this._thing.species===Ht.CHARACTERS&&this.addNewInstruction(new mn(this._thing,O.RIGHT));break;default:n=new ih(this._thing);break}V.getDispatchServer().needScanRule(),this.addNewInstruction(n),this.pushInstructions()}stopDispatcher(){V.getDispatchServer().disableService()}disconnect(){V.getDispatchServer().deleteObserver(this)}}const mw=e=>new pw(e);class Sp{}class gw extends Sp{constructor(){super(...arguments);W(this,"_name");W(this,"_species");W(this,"_textures");W(this,"_defaultBlockX");W(this,"_defaultBlockY");W(this,"_blockSize");W(this,"_maxBlockX");W(this,"_maxBlockY");W(this,"_defaultTowards")}setArgs(s,i,r,n,o,a,l,h,c){this._name=s,this._species=i,this._textures=r,this._defaultBlockX=n,this._defaultBlockY=o,this._blockSize=a,this._maxBlockX=l,this._maxBlockY=h,this._defaultTowards=c}async execute(){return await new Promise((s,i)=>{const r=new fw(this._species,this._name).createInstance(this._name,this._species,this._textures,this._defaultBlockX,this._defaultBlockY,this._blockSize,this._maxBlockX,this._maxBlockY,this._defaultTowards);r&&s(r),i(r)})}}class _w extends Sp{constructor(){super(...arguments);W(this,"_thing")}setArgs(s){this._thing=s}async execute(){return await new Promise(s=>{mw(this._thing),s()})}}class xw{async getThings(t){const s=[];for(const[{species:i,name:r},n]of t){const o=n.length;if(!o)break;const a=V.getSpriteAmountByName(r),l=V.getSpritesByName(r,Math.min(a,o));let h=[];Tt(l)||(h=l.value);let c=0;for(const u of h)u.setup({...n[c++]});if(a<o){const u=o-a,d=V.getAnimationTextures(i,r),p=new gw,f=eh(),{maxX:m,maxY:_}=V.getAppEdge();for(let v=0;v<u;v++){const b=n[c++];p.setArgs(r,i,d,b.defaultBlockX,b.defaultBlockY,f,m,_,b.defaultTowards),h.push(await p.execute())}}s.push(...h)}return s}async connectThingsToThingController(t){const s=new _w;for(const i of t)s.setArgs(i),await s.execute()}}const vw=()=>new xw,fh=DE(),V=xb();V.bindAppToScreenService(fh);const yw=vw();V.setSpriteBuilder(yw);const Ew=Ab();V.setContainerBuilder(Ew);const bw=bb(fh.stage);V.setStageBuilder(bw);const Tw={gameView:fh.view,startLevel:iw,pause:ow,resume:aw,setYouGoneOutsideHandler:rw,setGameOverOutsideHandler:nw},$w=new Promise(e=>e(Tw));export{Sw as A,Iw as B,Gw as C,Dw as D,qn as E,je as F,$w as G,wp as H,kw as I,Hw as J,Rw as K,Nw as L,Ed as a,Mw as b,_g as c,Mg as d,Bl as e,Hm as f,dr as g,Lw as h,_n as i,fr as j,Uw as k,Bw as l,bl as m,Ul as n,mg as o,Fm as p,ie as q,Pw as r,xm as s,Aw as t,Yu as u,Cw as v,Rm as w,yg as x,Ow as y,Fw as z};
